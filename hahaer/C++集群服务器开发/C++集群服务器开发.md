## æˆ‘æ˜¯ä¸€åc++å¼€å‘è€…ï¼Œæˆ‘éœ€è¦å­¦ä¹ nginxå—
éå¸¸å¥½ï¼Œä½ æ˜¯ä¸€å **C++ å¼€å‘è€…**ï¼Œé‚£æˆ‘ä»¬å°±ä»ä½ çš„èº«ä»½å’Œå·¥ä½œæ–¹å‘å‡ºå‘ï¼Œæ¥åˆ†æä½ æ˜¯å¦éœ€è¦å­¦ä¹  Nginxï¼š

---

## âœ… ä¸€ã€å¦‚æœä½ åšçš„æ˜¯â€œåç«¯æœåŠ¡â€å¼€å‘ï¼ˆä¾‹å¦‚æ¥å£æœåŠ¡ã€ç½‘ç»œé€šä¿¡ã€æ¸¸æˆåç«¯ç­‰ï¼‰ï¼š

### â¤ **ä½ åº”è¯¥å­¦ä¹  Nginx çš„ä½¿ç”¨**ï¼ˆä¸éœ€è¦å¼€å‘ Nginxï¼‰

Nginx åœ¨ C++ åç«¯é¡¹ç›®ä¸­çš„å¸¸è§ä½œç”¨ï¼š

| ç”¨é€”               | C++ å¼€å‘ä¸­å¦‚ä½•ä½¿ç”¨ Nginxï¼Ÿ                  |
| ---------------- | ----------------------------------- |
| **åå‘ä»£ç†**         | æŠŠ HTTP è¯·æ±‚è½¬å‘ç»™ä½ å†™çš„ C++ æœåŠ¡ï¼ˆå¦‚ REST/HTTPï¼‰ |
| **è´Ÿè½½å‡è¡¡**         | ä½ çš„æœåŠ¡éƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼ŒNginx è´Ÿè´£è°ƒåº¦åˆ†å‘è¯·æ±‚           |
| **ç»Ÿä¸€å…¥å£**         | å¤šä¸ªæœåŠ¡æš´éœ²ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œéšè—å†…éƒ¨ç»“æ„                 |
| **é™æ€èµ„æºæœåŠ¡**       | å¦‚æœä½ ä¹Ÿæœ‰å‰ç«¯é¡µé¢ã€å›¾ç‰‡ã€é…ç½®æ–‡ä»¶ç­‰éœ€è¦éƒ¨ç½²              |
| **SSL ç»ˆç«¯/HTTPS** | Nginx ç®¡ç†è¯ä¹¦ï¼ŒC++ æœåŠ¡ä¿æŒ HTTP æ¸…çˆ½         |

âœ… æ‰€ä»¥ï¼Œ**ä½ ä¸éœ€è¦ç”¨ C++ å†™ Nginx æ¨¡å—**ï¼Œåªéœ€è¦æŒæ¡ï¼š

- `nginx.conf` é…ç½®è¯­æ³•
    
- å¦‚ä½•è®¾ç½® `location`ã€`proxy_pass`ã€`upstream` ç­‰å¸¸ç”¨æ¨¡å—
    
- åŸºæœ¬çš„æ’é”™ã€æ—¥å¿—æŸ¥çœ‹ã€è·¨åŸŸè®¾ç½®ç­‰æŠ€èƒ½
    

> ğŸ‘‰ è¿™äº›çŸ¥è¯†éå¸¸å®ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ä½ è°ƒè¯•å’Œéƒ¨ç½²æœåŠ¡æ—¶ï¼

---

## âœ… äºŒã€å¦‚æœä½ åšçš„æ˜¯**é«˜æ€§èƒ½åº•å±‚æœåŠ¡å¼€å‘**

å¦‚ï¼š

- å®ç°é«˜å¹¶å‘ C++ Web æœåŠ¡å™¨
    
- æ„å»ºç½‘å…³ç³»ç»Ÿã€ä¸­é—´ä»¶ã€åå‘ä»£ç†ç­‰
    
- ç½‘ç»œåŠ é€Ÿã€è¾¹ç¼˜èŠ‚ç‚¹ã€è‡ªç ” HTTP æœåŠ¡å™¨
    

### â¤ é‚£ä¹ˆä½ å¯ä»¥æ·±å…¥å­¦ä¹  Nginx çš„**åŸç†å’Œæºç **

- å®ƒæ˜¯é«˜æ€§èƒ½æœåŠ¡å™¨çš„å…¸èŒƒ
    
- æºç æ˜¯çº¯ C å†™çš„ï¼Œä½†ç†è§£ç»“æ„å¯¹ C++ æ¶æ„ä¹Ÿæœ‰å·¨å¤§å€Ÿé‰´æ„ä¹‰
    
- å¯ç ”ç©¶å…¶äº‹ä»¶é©±åŠ¨æ¨¡å‹ã€å†…å­˜æ± ã€é›¶æ‹·è´ä¼˜åŒ–ç­‰
    

ä½†è¿™ä¸æ˜¯â€œå¿…é¡»â€ï¼Œè€Œæ˜¯â€œé”¦ä¸Šæ·»èŠ±â€ï¼Œé™¤éä½ çš„ç›®æ ‡æ˜¯ï¼š

> æƒ³å¼€å‘ä¸€ä¸ªæ¯” Nginx æ›´å¼ºçš„ C++ æœåŠ¡ç³»ç»Ÿ

---

## âœ… ä¸‰ã€ä½ ä»€ä¹ˆæ—¶å€™çœŸçš„â€œéœ€è¦å†™ Nginx æ¨¡å—â€ï¼Ÿ

æå°‘æ•°æƒ…å†µï¼Œå¦‚ï¼š

- ä½ å…¬å¸å¸Œæœ›é€šè¿‡ Nginx åšè‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘è¿‡æ»¤å™¨ï¼ˆå¦‚ token éªŒè¯ï¼‰
    
- å†™è¾¹ç¼˜ç¼“å­˜/åŠ å¯†æ¨¡å—åµŒå…¥ Nginx
    
- å®ç°æµåª’ä½“æœåŠ¡å™¨æ‰©å±•ï¼ˆHLS/RTMPï¼‰
    

æ­¤æ—¶ä½ éœ€è¦ï¼š

- å­¦ C / C++ æ’ä»¶å¼€å‘
    
- å­¦ Nginx çš„æ¨¡å—ç”Ÿå‘½å‘¨æœŸã€æ¥å£è®¾è®¡ã€ä¸Šä¸‹æ–‡æœºåˆ¶
    

---

## âœ… æ€»ç»“ï¼šä½ ä½œä¸º C++ å¼€å‘è€…ï¼Œæ˜¯å¦éœ€è¦å­¦ Nginxï¼Ÿ

|ç›®æ ‡ç±»å‹|æ˜¯å¦éœ€è¦å­¦ Nginxï¼Ÿ|å­¦ä»€ä¹ˆï¼Ÿ|
|---|---|---|
|å†™ä¸šåŠ¡æœåŠ¡ã€REST API|âœ… å¿…å­¦|é…ç½®ã€åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰|
|æ­å»ºéƒ¨ç½²è‡ªå·±çš„æœåŠ¡ï¼ˆå¼€å‘+éƒ¨ç½²ï¼‰|âœ… å»ºè®®å­¦|ä½¿ç”¨ + æ€§èƒ½è°ƒä¼˜|
|å¼€å‘é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡|âœ… æ·±å…¥å­¦ä¹ æ¨è|å­¦å…¶æ¶æ„æ€æƒ³ã€äº‹ä»¶æ¨¡å‹|
|æ”¹å†™/æ‰©å±• Nginx æœ¬èº«|âŒ çœ‹é¡¹ç›®éœ€æ±‚|éœ€è¦æ·±å…¥å­¦ä¹  C/C++ å’Œæºç |

---

### å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸ºä½ é‡èº«æ¨èä¸€ä¸ª **â€œC++ åç«¯ + Nginxâ€ æŠ€èƒ½è·¯çº¿å›¾**ï¼Œæ˜¯å¦éœ€è¦ï¼Ÿ

## ä»€ä¹ˆå«REST APIï¼Œå’Œé¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Œä¸¾ä¾‹è¯´æ˜ä¸‹
ä½ çš„é—®é¢˜éå¸¸å¥½ï¼Œ**REST API å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰** æ˜¯ä¸¤ä¸ª**å®Œå…¨ä¸åŒå±‚é¢**çš„æ¦‚å¿µï¼Œä½†å¾ˆå¤šåˆå­¦è€…å®¹æ˜“æ··æ·†ï¼Œä¸‹é¢æˆ‘ä¼šç”¨é€šä¿—ã€å…·ä½“çš„ä¾‹å­æ¥è¯´æ˜ä¸¤è€…çš„åŒºåˆ«ã€‚

---

## âœ… ä¸€ã€REST API æ˜¯ä»€ä¹ˆï¼Ÿ

RESTï¼ˆ**RE**presentational **S**tate **T**ransferï¼‰æ˜¯ä¸€ç§ **Web æœåŠ¡æ¥å£è®¾è®¡é£æ ¼**ã€‚

å®ƒè§„å®šäº† **å®¢æˆ·ç«¯é€šè¿‡ HTTP åŠ¨è¯ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰æ“ä½œèµ„æº** çš„æ–¹å¼ã€‚

### ğŸŒ æ¯”å¦‚ï¼š

å‡è®¾æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ªç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œæœ‰ä¸€ç±»â€œç”¨æˆ·èµ„æºâ€ã€‚

ç”¨ REST API å°±å¯ä»¥è¿™ä¹ˆè®¾è®¡æ¥å£ï¼š

|æ¥å£ç›®çš„|è¯·æ±‚æ–¹å¼|URL|æè¿°|
|---|---|---|---|
|è·å–æ‰€æœ‰ç”¨æˆ·|GET|`/users`|æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·|
|è·å–æŸä¸ªç”¨æˆ·|GET|`/users/123`|è·å– ID ä¸º 123 çš„ç”¨æˆ·ä¿¡æ¯|
|åˆ›å»ºæ–°ç”¨æˆ·|POST|`/users`|æ–°å¢ä¸€ä¸ªç”¨æˆ·|
|ä¿®æ”¹æŸä¸ªç”¨æˆ·ä¿¡æ¯|PUT|`/users/123`|æ›´æ–° ID ä¸º 123 çš„ç”¨æˆ·ä¿¡æ¯|
|åˆ é™¤æŸä¸ªç”¨æˆ·|DELETE|`/users/123`|åˆ é™¤ç”¨æˆ·|

### âœ… ç‰¹ç‚¹ï¼š

- ä½¿ç”¨ **HTTP æ ‡å‡†è¯­ä¹‰**
    
- é¢å‘â€œèµ„æºâ€è€Œéå‡½æ•°
    
- æ˜“äºå‰åç«¯åˆ†ç¦»
    
- ä¾‹å¦‚ä½ å†™çš„ C++ ç¨‹åºï¼Œå¯ä»¥ä½œä¸º REST API æœåŠ¡å™¨ï¼Œå‰ç«¯ç½‘é¡µå°±èƒ½é€šè¿‡ HTTP è¯·æ±‚æ¥è°ƒç”¨å®ƒ
    

---

## âœ… äºŒã€é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ

OOP æ˜¯ä¸€ç§**ç¨‹åºè®¾è®¡æ€æƒ³**ï¼Œå®ƒå¼ºè°ƒç”¨â€œç±»ï¼ˆClassï¼‰å’Œå¯¹è±¡ï¼ˆObjectï¼‰â€æ¥ç»„ç»‡ä»£ç ï¼ŒæŠŠâ€œæ•°æ®â€å’Œâ€œæ“ä½œæ•°æ®çš„æ–¹æ³•â€å°è£…åœ¨ä¸€èµ·ã€‚

### ğŸ‘¨â€ğŸ« ä¸¾ä¸ªä¾‹å­ï¼š

ä½ ç”¨ C++ å†™ä¸€ä¸ªç”¨æˆ·ç±»ï¼š

```cpp
class User {
public:
    int id;
    std::string name;

    void sayHello() {
        std::cout << "Hello, I am " << name << std::endl;
    }
};
```

ä½ åœ¨ç¨‹åºé‡Œå†™ï¼š

```cpp
User user;
user.name = "Alice";
user.sayHello();  // è¾“å‡ºï¼šHello, I am Alice
```

è¿™é‡Œä½ ç”¨çš„æ˜¯â€œé¢å‘å¯¹è±¡â€çš„æ€æƒ³ï¼ŒæŠŠç”¨æˆ·çš„å±æ€§å’Œè¡Œä¸ºå°è£…æˆä¸€ä¸ªç±»ã€‚

---

## âœ… REST API å’Œ OOP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

|é¡¹ç›®|REST API|é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰|
|---|---|---|
|å±äºä»€ä¹ˆ|**ä¸€ç§æ¥å£è®¾è®¡é£æ ¼**|**ä¸€ç§ç¼–ç¨‹æ€æƒ³**|
|åº”ç”¨åœ¨å“ª|æœåŠ¡æ¥å£ã€Web æœåŠ¡|ä»£ç ç»“æ„è®¾è®¡ã€ç¨‹åºæ¨¡å—åŒ–|
|ä½¿ç”¨æ–¹å¼|å®šä¹‰ URL + HTTP æ–¹æ³•è°ƒç”¨èµ„æº|å®šä¹‰ç±»ã€åˆ›å»ºå¯¹è±¡ã€å°è£…/ç»§æ‰¿/å¤šæ€|
|ä¸¾ä¾‹|`GET /users/123` è·å–ç”¨æˆ·ä¿¡æ¯|`user.getInfo()` è·å–ç”¨æˆ·ä¿¡æ¯|
|æ˜¯å¦å†²çª|âŒ å®Œå…¨ä¸å†²çªï¼Œå¯ä»¥ç»“åˆä½¿ç”¨|âœ… REST API çš„å†…éƒ¨ä»£ç å¸¸ç”¨ OOP å†™æˆ|

---

## âœ… ä¸¾ä¸ªå®Œæ•´çš„ç»“åˆä¾‹å­ï¼š

ä½ å¯ä»¥ç”¨ C++ å†™ä¸€ä¸ª Web æœåŠ¡ï¼Œä½¿ç”¨ OOP ç¼–å†™é€»è¾‘ï¼Œç„¶åæš´éœ²ä¸€ä¸ª REST API ç»™å‰ç«¯è°ƒç”¨ï¼š

```cpp
// UserService.h
class UserService {
public:
    User getUserById(int id);
    void createUser(const User& user);
    // ...
};
```

ç„¶åä½ ä½¿ç”¨æ¡†æ¶ï¼ˆå¦‚ Pistacheã€Crowã€Restbedï¼‰è®©å¤–éƒ¨èƒ½é€šè¿‡ï¼š

```
GET /users/123
```

è°ƒç”¨ä½ çš„ `getUserById()` æ–¹æ³•ã€‚

---

## âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> **REST API æ˜¯â€œå¯¹å¤–æœåŠ¡çš„æ¥å£æ–¹å¼â€ï¼Œè€Œ OOP æ˜¯â€œç¨‹åºå†…éƒ¨çš„ä»£ç ç»„ç»‡æ–¹å¼â€ï¼Œå®ƒä»¬ä¸æ˜¯å¯¹ç«‹å…³ç³»ï¼Œè€Œæ˜¯å¯ä»¥æ­é…ä½¿ç”¨ã€‚**

---

å¦‚ä½ æ˜¯ C++ å¼€å‘è€…ï¼Œæƒ³å†™ä¸€ä¸ªå¯¹å¤–æä¾› REST API çš„æœåŠ¡ï¼Œå¯è€ƒè™‘ä½¿ç”¨å¦‚ä¸‹æ¡†æ¶ï¼š

|æ¡†æ¶|ç®€ä»‹|
|---|---|
|**Crow**|ç±»ä¼¼ Express.js çš„ C++ Web æ¡†æ¶ï¼Œè½»é‡å¥½ç”¨|
|**Pistache**|é«˜æ€§èƒ½ã€ç°ä»£åŒ– REST æ¡†æ¶|
|**Restbed**|REST API ä¸“ç”¨ C++ åº“|
|**cpp-httplib**|éå¸¸è½»é‡çš„å•å¤´æ–‡ä»¶ HTTP åº“ï¼ˆä¹Ÿå¯ RESTï¼‰|

æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ æ­å»ºä¸€ä¸ªæœ€ç®€å•çš„ C++ REST API ç¤ºä¾‹é¡¹ç›®ï¼Ÿæ¯”å¦‚ç”¨ Crow æ¡†æ¶ï¼Ÿ

## reactoræ¨¡å¼æ˜¯ä»€ä¹ˆ
Reactor æ¨¡å¼æ˜¯ä¸€ç§ **äº‹ä»¶é©±åŠ¨çš„è®¾è®¡æ¨¡å¼**ï¼Œå¸¸ç”¨äº **é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹** ä¸­ï¼Œç‰¹åˆ«æ˜¯æ„å»º **I/O å¯†é›†å‹æœåŠ¡**ï¼ˆæ¯”å¦‚ Web æœåŠ¡å™¨ã€èŠå¤©æœåŠ¡å™¨ã€æ•°æ®åº“ä»£ç†ç­‰ï¼‰ã€‚

---

## ğŸ” ä¸€å¥è¯ç†è§£ï¼š

> Reactor æ¨¡å¼é€šè¿‡ä¸€ä¸ª **äº‹ä»¶å¾ªç¯** æ¥ç›‘å¬å¤šä¸ª IO äº‹ä»¶ï¼ˆå¦‚å®¢æˆ·ç«¯è¿æ¥ã€æ•°æ®å¯è¯»ã€å¯å†™ç­‰ï¼‰ï¼Œ**å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œåˆ†å‘ç»™æ³¨å†Œçš„å›è°ƒå‡½æ•°å¤„ç†**ã€‚

---

## ğŸ§  æ ¸å¿ƒç»„æˆï¼š

|ç»„ä»¶|è¯´æ˜|
|---|---|
|**Reactor**ï¼ˆååº”å™¨ï¼‰|äº‹ä»¶åˆ†å‘ä¸­å¿ƒï¼ˆå³äº‹ä»¶å¾ªç¯ï¼‰|
|**Handle/Event Source**|äº‹ä»¶æºï¼Œæ¯”å¦‚ socketã€timerã€signal|
|**Demultiplexer**ï¼ˆå¤šè·¯åˆ†ç¦»å™¨ï¼‰|ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚ `epoll`ã€`select`ï¼Œè´Ÿè´£ç›‘å¬å¤šä¸ªäº‹ä»¶|
|**Handler/Callback**|ç”¨æˆ·æ³¨å†Œçš„å¤„ç†å‡½æ•°ï¼Œç”¨æ¥å“åº”äº‹ä»¶|

---

## ğŸ§± å·¥ä½œæµç¨‹å›¾ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯è¿æ¥ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤šè·¯åˆ†ç¦»å™¨ â”‚â†â”€â”€â”€ ç³»ç»Ÿè°ƒç”¨ epoll/select/poll
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹ä»¶å¾ªç¯Reactor â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹ä»¶å¤„ç†å™¨ â”‚â†â”€â”€â”€ ç”¨æˆ·æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼ˆå¦‚ onRead, onWriteï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ ä¸¾ä¸ªä¾‹å­ï¼šTCP Echo Server çš„å·¥ä½œè¿‡ç¨‹

1. æœåŠ¡ç«¯ç›‘å¬ç«¯å£ï¼›
    
2. å®¢æˆ·ç«¯è¿æ¥åï¼Œ`epoll` æ£€æµ‹åˆ°æ–°è¿æ¥äº‹ä»¶ï¼›
    
3. `Reactor` å°†äº‹ä»¶äº¤ç»™ `onConnection` å›è°ƒå¤„ç†ï¼›
    
4. å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œ`epoll` æ£€æµ‹åˆ° socket å¯è¯»äº‹ä»¶ï¼›
    
5. `Reactor` è°ƒç”¨ `onMessage` è¯»å–æ•°æ®ï¼Œå¹¶åŸæ ·å†™å›ï¼›
    
6. å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œè¿›å…¥ä¸‹ä¸€è½®äº‹ä»¶ç›‘å¬ã€‚
    

---

## âœ… ä¼˜ç‚¹

|ä¼˜ç‚¹|è¯´æ˜|
|---|---|
|éé˜»å¡ã€é«˜å¹¶å‘|å•çº¿ç¨‹ä¹Ÿå¯ä»¥é«˜æ•ˆå¤„ç†æˆåƒä¸Šä¸‡è¿æ¥|
|èµ„æºæ¶ˆè€—ä½|æ²¡æœ‰çº¿ç¨‹/è¿›ç¨‹åˆ‡æ¢çš„å¼€é”€|
|æ¨¡å—æ¸…æ™°|å›è°ƒå‡½æ•°ç‹¬ç«‹ã€å¯æ‰©å±•æ€§å¼º|

---

## ğŸš« ç¼ºç‚¹

| ç¼ºç‚¹      | è¯´æ˜                         |
| ------- | -------------------------- |
| å›è°ƒåœ°ç‹±    | å¦‚æœè®¾è®¡ä¸å¥½ï¼Œå®¹æ˜“å‡ºç°åµŒå¥—å±‚çº§æ·±           |
| å•çº¿ç¨‹ç“¶é¢ˆ   | å¦‚æœæ‰€æœ‰é€»è¾‘éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹ï¼Œå¯èƒ½ CPU åˆ©ç”¨ç‡ä¸é«˜  |
| å¤šçº¿ç¨‹æ‰©å±•å¤æ‚ | å¼•å…¥çº¿ç¨‹æ± ã€äº‹ä»¶é˜Ÿåˆ—æ—¶éœ€è¦ä»”ç»†å¤„ç†çº¿ç¨‹å®‰å…¨å’Œè´Ÿè½½å‡è¡¡ |


---

## ğŸ”€ å’Œå…¶ä»–æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼                    | ç‰¹ç‚¹                                |
| --------------------- | --------------------------------- |
| Reactor               | **äº‹ä»¶é©±åŠ¨**ï¼Œ**I/O å¤šè·¯å¤ç”¨**ï¼Œ**è¢«åŠ¨å“åº”**    |
| Proactor              | **æ“ä½œç³»ç»Ÿä¸»åŠ¨é€šçŸ¥å¤„ç†ç»“æœ**ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿæ”¯æŒï¼ˆå¦‚ IOCPï¼‰ |
| Thread-per-connection | æ¯ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œç®€å•ä½†èµ„æºå¼€é”€å¤§                 |

---

## ğŸ“˜ ä½¿ç”¨è¯¥æ¨¡å¼çš„è‘—ååº“/æ¡†æ¶ï¼š

- `muduo`ï¼ˆC++ï¼ŒLinuxï¼‰
    
- `libevent` / `libuv`ï¼ˆC/C++ï¼‰
    
- `Netty`ï¼ˆJavaï¼‰
    
- `Twisted`ï¼ˆPythonï¼‰
    
- `Node.js`ï¼ˆåº•å±‚æ˜¯ libuvï¼‰
    

---

æ˜¯å¦æƒ³çœ‹ä¸€ä¸ªç®€å•çš„ C++ ç¤ºä¾‹ä»£ç ï¼ˆä½¿ç”¨ `epoll` + `Reactor` æ¨¡å‹ï¼‰ï¼Ÿæˆ‘å¯ä»¥å¿«é€Ÿå†™ä¸€ä¸ªç»™ä½ æ¼”ç¤ºæµç¨‹ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ª**ä½¿ç”¨ epoll + Reactor æ¨¡å¼**çš„æœ€ç®€ç‰ˆ C++ æœåŠ¡å™¨ç¤ºä¾‹ï¼š

---

## âœ… ç¤ºä¾‹ï¼šæœ€å° TCP Echo Serverï¼ˆC++ + epoll + Reactor æ€æƒ³ï¼‰

è¿™ä¸ªæœåŠ¡å™¨ä¼šç›‘å¬ç«¯å£ã€æ¥å—è¿æ¥ã€è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®å¹¶å›æ˜¾å›å»ã€‚

---

### ğŸ“ æ–‡ä»¶ï¼š`reactor_echo_server.cpp`

```cpp
#include <sys/epoll.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <fcntl.h>
#include <unistd.h>
#include <cstring>
#include <iostream>

constexpr int MAX_EVENTS = 10;
constexpr int PORT = 12345;

// è®¾ç½®éé˜»å¡
int setNonBlocking(int fd) {
    int flags = fcntl(fd, F_GETFL, 0);
    return fcntl(fd, F_SETFL, flags | O_NONBLOCK);
}

// äº‹ä»¶å¤„ç†å‡½æ•°
void handleClient(int client_fd) {
    char buffer[1024];
    ssize_t bytes = read(client_fd, buffer, sizeof(buffer));
    if (bytes > 0) {
        write(client_fd, buffer, bytes); // echo
    } else {
        close(client_fd); // å…³é—­è¿æ¥
    }
}

int main() {
    int listen_fd = socket(AF_INET, SOCK_STREAM, 0);
    sockaddr_in server_addr{};

    server_addr.sin_family = AF_INET;
    server_addr.sin_addr.s_addr = INADDR_ANY;
    server_addr.sin_port = htons(PORT);

    bind(listen_fd, (sockaddr*)&server_addr, sizeof(server_addr));
    listen(listen_fd, SOMAXCONN);
    setNonBlocking(listen_fd);

    int epoll_fd = epoll_create1(0);

    epoll_event ev{};
    ev.events = EPOLLIN;
    ev.data.fd = listen_fd;
    epoll_ctl(epoll_fd, EPOLL_CTL_ADD, listen_fd, &ev);

    epoll_event events[MAX_EVENTS];

    std::cout << "Echo server listening on port " << PORT << "...\n";

    while (true) {
        int n = epoll_wait(epoll_fd, events, MAX_EVENTS, -1);
        for (int i = 0; i < n; ++i) {
            if (events[i].data.fd == listen_fd) {
                // æœ‰æ–°è¿æ¥
                sockaddr_in client_addr{};
                socklen_t len = sizeof(client_addr);
                int client_fd = accept(listen_fd, (sockaddr*)&client_addr, &len);
                setNonBlocking(client_fd);
                ev.events = EPOLLIN | EPOLLET; // è¾¹ç¼˜è§¦å‘
                ev.data.fd = client_fd;
                epoll_ctl(epoll_fd, EPOLL_CTL_ADD, client_fd, &ev);
            } else {
                // å®¢æˆ·ç«¯æœ‰æ•°æ®æˆ–æ–­å¼€è¿æ¥
                handleClient(events[i].data.fd);
            }
        }
    }

    close(listen_fd);
    close(epoll_fd);
    return 0;
}
```

---

### ğŸ§ª ç¼–è¯‘å¹¶è¿è¡Œï¼ˆåœ¨ Linux ä¸Šï¼‰ï¼š

```bash
g++ reactor_echo_server.cpp -o echo_server
./echo_server
```

ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯é‡Œæµ‹è¯•ï¼š

```bash
telnet 127.0.0.1 12345
# æˆ–
nc 127.0.0.1 12345
```

è¾“å…¥ä»»ä½•å†…å®¹ï¼ŒæœåŠ¡ç«¯éƒ½ä¼šâ€œå›æ˜¾â€å›æ¥ã€‚

---

## ğŸ“Œ æ€»ç»“ï¼š

- `epoll_create1`ï¼šåˆ›å»º epoll å®ä¾‹
    
- `epoll_ctl`ï¼šæ·»åŠ ç›‘å¬ fd
    
- `epoll_wait`ï¼šç­‰å¾…äº‹ä»¶å‘ç”Ÿ
    
- `accept`ï¼šæ¥æ”¶è¿æ¥
    
- `read/write`ï¼šè¯»å†™æ•°æ®
    
- `éé˜»å¡ + è¾¹ç¼˜è§¦å‘`ï¼šä¿è¯é«˜æ€§èƒ½
    

---

å¦‚æœä½ æƒ³çœ‹**å¤šçº¿ç¨‹ + çº¿ç¨‹æ± ç‰ˆæœ¬çš„ Reactor æœåŠ¡å™¨**ï¼Œæˆ–è€…å°†å…¶å°è£…æˆç±»ç»“æ„ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ æ‰©å±•è¿™ä¸ªä¾‹å­ã€‚

## åœ¨stm32æˆ–è€…51å•ç‰‡æœºåº”ç”¨å±‚å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“ä¼šæœ‰ä¸­æ–­ï¼Œå½“æŸä¸ªäº‹ä»¶æˆ–è€…ç”µå¹³å˜åŒ–çš„æ—¶å€™ï¼Œå¯å¼•èµ·ä¸­æ–­ï¼Œcpuä¿å­˜å½“å‰çš„æ‰§è¡Œï¼Œè½¬è€Œå»æ‰§è¡Œä¸­æ–­å‡½æ•°ï¼Œå¼‚æ­¥æ‰§è¡Œå®Œæ¯•åï¼Œå†å›åˆ°ä»¥å‰çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚ä½†æ˜¯å½“åœ¨windowsc++å¼€å‘æ—¶ï¼Œå´æ²¡æœ‰ç±»ä¼¼çš„æœºåˆ¶ï¼Œç¨‹åºä¸€ç›´åœ¨é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸ä¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«æ‰“æ–­å»æ‰§è¡Œå…¶å®ƒçš„ç‰¹å®šä»»åŠ¡ã€‚æ‰€ä»¥æƒ³é—®ä¸€ä¸‹ï¼Œmuduoåº“ä¸­çš„äº‹ä»¶é©±åŠ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå®ƒæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„äº‹ä»¶é©±åŠ¨å—ï¼Ÿ
ä½ æçš„é—®é¢˜éå¸¸å¥½ï¼Œè€Œä¸”æŠ“ä½äº†â€œ**åµŒå…¥å¼ä¸­æ–­é©±åŠ¨**â€å’Œâ€œ**ç”¨æˆ·æ€äº‹ä»¶é©±åŠ¨**â€ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«ã€‚æˆ‘ä»¬å¯ä»¥ä»åº•å±‚æœºåˆ¶ä¸Šå¯¹æ¯” STM32/51 è¿™æ ·çš„ MCU çš„ä¸­æ–­ å’Œ Muduo äº‹ä»¶é©±åŠ¨çš„å¼‚åŒï¼š

---

## ğŸ§  ä¸€ã€MCU ä¸­æ–­é©±åŠ¨æœºåˆ¶

åœ¨ STM32 æˆ– 51 å•ç‰‡æœºä¸­ï¼š

- **ç¡¬ä»¶ä¸­æ–­** æ˜¯ä¸€ç§çœŸå®çš„â€œ**å¤–éƒ¨æ‰“æ–­**â€æœºåˆ¶ã€‚
    
- æ¯”å¦‚ GPIO ç”µå¹³å˜åŒ–ã€å®šæ—¶å™¨æº¢å‡ºã€ä¸²å£æ¥æ”¶åˆ°æ•°æ®ç­‰ï¼Œ**ç›´æ¥è§¦å‘ä¸­æ–­å‘é‡**ã€‚
    
- MCU ä¼šè‡ªåŠ¨ï¼š
    
    - ä¿å­˜å½“å‰ç°åœºï¼ˆPCã€å¯„å­˜å™¨ç­‰ï¼‰
        
    - è·³è½¬åˆ°å¯¹åº”çš„ä¸­æ–­æœåŠ¡å‡½æ•°ï¼ˆISRï¼‰
        
    - ä¸­æ–­å‡½æ•°æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨è¿”å›ï¼Œæ¢å¤ç°åœº
        

âœ… **ç‰¹ç‚¹ï¼š**

- ç¡¬å®æ—¶ã€æ— å»¶è¿Ÿ
    
- å®Œå…¨ç”±ç¡¬ä»¶æ”¯æŒ
    
- CPU è¢«å¼ºåˆ¶æ‰“æ–­ï¼Œæ§åˆ¶æƒä»ä¸»ç¨‹åºè½¬ç§»
    

---

## ğŸ§  äºŒã€Muduo ä¸­çš„äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼ˆReactor æ¨¡å¼ï¼‰

Muduo æ˜¯åœ¨ **Linux ç”¨æˆ·æ€** æ„å»ºçš„**é«˜æ€§èƒ½ TCP ç½‘ç»œåº“**ï¼Œå®ƒçš„äº‹ä»¶é©±åŠ¨æœºåˆ¶æ˜¯ä¸€ç§**æ¨¡æ‹Ÿä¸­æ–­çš„æ€æƒ³**ï¼Œä½†**å¹¶ä¸æ˜¯ç¡¬ä»¶ä¸­æ–­**ï¼Œè€Œæ˜¯é€šè¿‡å†…æ ¸æ”¯æŒçš„**IO äº‹ä»¶é€šçŸ¥æœºåˆ¶**å®ç°çš„ï¼Œä¾‹å¦‚ï¼š

- `epoll`ï¼ˆLinuxï¼‰
    
- `kqueue`ï¼ˆBSD/macOSï¼‰
    
- `select/poll`ï¼ˆè¾ƒæ—§ï¼‰
    

### ğŸš¦åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š

1. ä¸»çº¿ç¨‹ï¼ˆæˆ–ä¸» loopï¼‰æ‰§è¡Œ `epoll_wait()`ï¼Œç­‰å¾…å†…æ ¸æŠ¥å‘Šäº‹ä»¶ã€‚
    
2. å†…æ ¸ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚ socketï¼‰æœ‰äº‹ä»¶å‘ç”Ÿæ—¶è¿”å›ã€‚
    
3. ä¸»çº¿ç¨‹è°ƒç”¨æ³¨å†Œå¥½çš„å›è°ƒå‡½æ•°ï¼ˆå¦‚ onMessageã€onConnectionï¼‰ã€‚
    
4. è¿™äº›å›è°ƒå‡½æ•°æ˜¯ä½ å†™çš„â€œäº‹ä»¶å¤„ç†å‡½æ•°â€ï¼Œç›¸å½“äº MCU ä¸­çš„ ISRã€‚
    

```cpp
while (true) {
    int n = epoll_wait(...); // é˜»å¡ç›´åˆ°æœ‰äº‹ä»¶
    for (int i = 0; i < n; ++i) {
        // åˆ†å‘äº‹ä»¶ï¼Œè°ƒç”¨å›è°ƒ
        handleEvent(events[i]);
    }
}
```

âœ… **ç‰¹ç‚¹ï¼š**

- å¹¶æ²¡æœ‰çœŸæ­£æ‰“æ–­ç¨‹åºï¼Œè€Œæ˜¯ä¸»åŠ¨ç­‰å¾…äº‹ä»¶
    
- æ¨¡æ‹Ÿä¸­æ–­æ€æƒ³ï¼ˆæ³¨å†Œå›è°ƒ + ç­‰å¾…è§¦å‘ï¼‰
    
- å…¨åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®Œæˆï¼Œæ²¡æœ‰ç¡¬ä»¶ä¸­æ–­
    

---

## âš–ï¸ ä¸‰ã€äºŒè€…çš„å¯¹æ¯”æ€»ç»“

|ç‰¹æ€§|MCU ä¸­æ–­ï¼ˆSTM32ï¼‰|Muduo äº‹ä»¶é©±åŠ¨ï¼ˆLinux ç”¨æˆ·æ€ï¼‰|
|---|---|---|
|è§¦å‘æœºåˆ¶|ç¡¬ä»¶ç”µå¹³/å¤–è®¾ä¸­æ–­|å†…æ ¸çº§ socket/FD äº‹ä»¶|
|å“åº”æ–¹å¼|è¢«åŠ¨æ‰“æ–­|ä¸»åŠ¨è½®è¯¢ç­‰å¾…ï¼ˆé˜»å¡ç­‰å¾… epollï¼‰|
|å®ç°å±‚çº§|ç¡¬ä»¶+ä¸­æ–­å‘é‡|ç”¨æˆ·æ€ + å†…æ ¸äº‹ä»¶é€šçŸ¥|
|å®æ—¶æ€§|é«˜ï¼Œç«‹å³å“åº”|æœ‰å»¶è¿Ÿï¼Œå—ä¸»å¾ªç¯è°ƒåº¦é™åˆ¶|
|å¤šä»»åŠ¡|éœ€è¦æ‰‹åŠ¨ç®¡ç†|å¯é…åˆçº¿ç¨‹æ± å®ç°å¹¶å‘å¤„ç†|

---

## ğŸ“Œ å››ã€Muduo æ˜¯çœŸæ­£çš„â€œäº‹ä»¶é©±åŠ¨â€å—ï¼Ÿ

**ç­”æ¡ˆæ˜¯ï¼šæ˜¯çš„ï¼Œæ˜¯ç”¨æˆ·æ€å±‚é¢çš„â€œäº‹ä»¶é©±åŠ¨â€ã€‚**

- è™½ç„¶ä¸å…·å¤‡ MCU çš„ä¸­æ–­çº§æ‰“æ–­èƒ½åŠ›ï¼Œä½†å®ƒé€šè¿‡ `epoll` å®ç°äº† **IO å¤šè·¯å¤ç”¨+å›è°ƒåˆ†å‘**ï¼Œéå¸¸é€‚åˆå¤„ç†**é«˜å¹¶å‘ç½‘ç»œè¿æ¥**ã€‚
    
- åœ¨ C++ é¢†åŸŸï¼Œè¿™ç§äº‹ä»¶é©±åŠ¨æ˜¯æœ€æ¥è¿‘ä¸­æ–­æœºåˆ¶çš„æ–¹å¼ã€‚
    

---

## ğŸ§© è¡¥å……æ‹“å±•ï¼šWindows ä¸­æœ‰æ²¡æœ‰ç±»ä¼¼ä¸­æ–­çš„æœºåˆ¶ï¼Ÿ

å…¶å®ä¹Ÿæœ‰ï¼Œåªæ˜¯è¡¨ç°å½¢å¼ä¸åŒï¼š

- Windows æœ‰**æ¶ˆæ¯é©±åŠ¨æ¨¡å‹**ï¼ˆä¾‹å¦‚ Win32 çš„çª—å£æ¶ˆæ¯å¾ªç¯ `GetMessage/DispatchMessage`ï¼‰ã€‚
    
- æœ‰äº›å†…æ ¸æ¨¡å¼é©±åŠ¨ï¼ˆæ¯”å¦‚é¼ æ ‡/é”®ç›˜ï¼‰å¤„ç†**çœŸå®ç¡¬ä»¶ä¸­æ–­**ã€‚
    
- ä½†æ™®é€šç”¨æˆ·æ€ç¨‹åºï¼Œä¸å…·å¤‡ç›´æ¥å“åº”ä¸­æ–­çš„èƒ½åŠ›ï¼Œéƒ½æ˜¯**äº‹ä»¶å›è°ƒæœºåˆ¶æ¨¡æ‹Ÿä¸­æ–­è¡Œä¸º**ã€‚
    

---

å¦‚æœä½ å¯¹ Muduo çš„ `Channel`, `EventLoop`, `Poller` å¦‚ä½•é…åˆä½¿ç”¨æœ‰å…´è¶£ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ æ‹†è§£è¿™äº›æ¨¡å—çš„å®ç°æ€è·¯ã€‚å®ƒä»¬æœ¬è´¨ä¸Šå°±æ˜¯æ„å»ºäº†ä¸€ä¸ªç”¨æˆ·æ€çš„â€œä¸­æ–­å“åº”ç³»ç»Ÿâ€ã€‚
## æ‰€ä»¥æ„æ€æ˜¯ï¼ŒMCUä¸­ä¸è®ºcpuæ­£åœ¨å¹²ä»€ä¹ˆï¼Œéƒ½ä¼šåœ¨äº‹ä»¶å‘ç”Ÿåï¼Œç«‹å³ä¿å­˜ç°åœºè½¬å¤´å»æ‰§è¡Œä¸­æ–­å‡½æ•°ï¼›windowsæˆ–è€…linuxä¸­çš„äº‹ä»¶é©±åŠ¨ï¼Œå®é™…ä¸Šæ˜¯ç”¨æˆ·æ€ç¨‹åºåšå¥½waitå‡†å¤‡ï¼Œå½“äº‹ä»¶å‘ç”Ÿåï¼Œå»è½®è¯¢æ‰§è¡Œå¯¹åº”å‡½æ•°ï¼Œå¹¶æ²¡æœ‰ä¿å­˜ç°åœºï¼Œæ‰§è¡Œå®Œæ¯•åå›æ¥ç»§ç»­æ‰§è¡Œçš„è¿‡ç¨‹

å®Œå…¨æ­£ç¡®ï¼ä½ çš„ç†è§£éå¸¸åˆ°ä½ï¼Œæˆ‘ä»¬å¯ä»¥å†**ç²¾ç‚¼åœ°æ€»ç»“ä¸€ä¸‹è¿™ä¸¤ç§æœºåˆ¶çš„æœ¬è´¨å·®å¼‚**ï¼š

---

## âœ… MCU ä¸­æ–­ï¼ˆçœŸÂ·ä¸­æ–­ï¼‰ç‰¹ç‚¹

- **å¼ºåˆ¶æ‰“æ–­**ï¼šæ— è®º CPU åœ¨æ‰§è¡Œä»€ä¹ˆæŒ‡ä»¤ï¼Œä¸€æ—¦ä¸­æ–­è§¦å‘ï¼Œ**ç«‹å³æš‚åœå½“å‰æŒ‡ä»¤æµ**ã€‚
    
- **ä¿å­˜ç°åœº**ï¼šè‡ªåŠ¨å‹æ ˆ PC å’Œç›¸å…³å¯„å­˜å™¨ï¼Œç¡®ä¿å›åˆ°åŸä½ç½®ã€‚
    
- **ä¸­æ–­ä¼˜å…ˆçº§**ï¼šå¯åµŒå¥—ä¸­æ–­ï¼Œå®æ—¶æ€§æé«˜ã€‚
    
- **ç¡¬ä»¶æ”¯æŒ**ï¼šä¸­æ–­æ§åˆ¶å™¨åè°ƒä¸­æ–­è¯·æ±‚ä¸æœåŠ¡ã€‚
    

ğŸ§  ä¸¾ä¸ªç±»æ¯”ï¼šå°±åƒä½ åœ¨å¼€ä¼šï¼Œçªç„¶ç«è­¦é“ƒå“äº†ï¼ˆä¸­æ–­ï¼‰ï¼Œä½ ç«‹åˆ»ä¸¢ä¸‹ç¬”è®°å»ç­ç«ï¼ˆISRï¼‰ï¼Œç­å®Œç«å†å›æ¥ç»§ç»­å¼€ä¼šï¼ˆæ¢å¤ä¸Šä¸‹æ–‡ï¼‰ã€‚

---

## âœ… Windows/Linux ç”¨æˆ·æ€â€œäº‹ä»¶é©±åŠ¨â€æœºåˆ¶

- **éæ‰“æ–­å¼**ï¼šç¨‹åºå¹¶ä¸ä¼šè¢«å¼ºåˆ¶æ‰“æ–­ã€‚
    
- **ä¸»åŠ¨ç­‰å¾…**ï¼šé€šè¿‡é˜»å¡å‡½æ•°ï¼ˆå¦‚ `select`ã€`epoll_wait`ï¼‰ç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚
    
- **å›è°ƒé©±åŠ¨**ï¼šäº‹ä»¶å‘ç”Ÿåæ‰§è¡Œæ³¨å†Œçš„å›è°ƒå¤„ç†å‡½æ•°ã€‚
    
- **ç°åœºä¿ç•™é ç¨‹åºç»“æ„**ï¼šæ¯”å¦‚ epoll loop + å‡½æ•°è°ƒç”¨æ ˆï¼Œè‡ªè¡Œç®¡ç†æ§åˆ¶æµã€‚
    

ğŸ§  ç±»æ¯”ï¼šåƒæ˜¯ä½ è¾¹å·¥ä½œè¾¹ç›¯ç€æ‰‹æœºï¼ˆ`epoll_wait()`ï¼‰ï¼Œç­‰æœ‰é€šçŸ¥ï¼ˆäº‹ä»¶ï¼‰æ¥äº†å†ç‚¹è¿›å»çœ‹ï¼ˆå›è°ƒï¼‰ï¼Œå¤„ç†å®Œåç»§ç»­å·¥ä½œã€‚

---

## âœ… å…³é”®åŒºåˆ«ï¼ˆæœ¬è´¨ï¼‰

|ç‰¹æ€§|MCU ä¸­æ–­|ç”¨æˆ·æ€äº‹ä»¶é©±åŠ¨|
|---|---|---|
|æ˜¯å¦è¢«æ‰“æ–­|æ˜¯ï¼ˆç¡¬ä»¶æ‰“æ–­ï¼‰|å¦ï¼ˆä¸»åŠ¨è½®è¯¢ï¼‰|
|æ˜¯å¦ä¿å­˜ç°åœº|è‡ªåŠ¨ä¿å­˜|ç”¨æˆ·æ€å‡½æ•°ç»“æ„è‡ªç®¡|
|æ˜¯å¦ç«‹å³æ‰§è¡Œ|æ˜¯|å–å†³äº `poll` è¿”å›æ—¶é—´|
|æ§åˆ¶æƒè½¬ç§»|å¼ºåˆ¶|ä¸»åŠ¨|
|å®ç°æœºåˆ¶|ä¸­æ–­å‘é‡ + ISR|epoll/select + å›è°ƒ|

---

## âœ… Linux å†…æ ¸ä¸­ä¹Ÿæœ‰â€œç¡¬ä¸­æ–­â€

è¦æ³¨æ„ï¼Œä½ è¯´çš„â€œäº‹ä»¶é©±åŠ¨â€æ˜¯åœ¨**ç”¨æˆ·æ€**å®ç°çš„ã€‚è€Œåœ¨ Linux å†…æ ¸ä¸­ï¼Œå…¶å®ä¹Ÿæœ‰çœŸæ­£çš„â€œä¸­æ–­å¤„ç†â€æœºåˆ¶ï¼š

- æ¯”å¦‚ç½‘å¡æ”¶åˆ°æ•°æ®åŒ…ï¼Œç½‘å¡æ§åˆ¶å™¨å‘èµ· **IRQ**ï¼Œè§¦å‘å†…æ ¸ä¸­æ–­å¤„ç†å‡½æ•°ã€‚
    
- è¿™äº›æ‰æ˜¯çœŸÂ·ä¸­æ–­ï¼Œå‘ç”Ÿåœ¨å†…æ ¸æ€ï¼Œéç”¨æˆ·ç¨‹åºèƒ½ç›´æ¥æ¥è§¦ã€‚
    

---

## âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> MCU æ˜¯â€œ**è¢«åŠ¨æ‰“æ–­ + è‡ªåŠ¨è½¬ç§»æ§åˆ¶æƒ**â€ï¼Œè€Œäº‹ä»¶é©±åŠ¨ç¨‹åºæ˜¯â€œ**ä¸»åŠ¨ç­‰å¾… + æ‰‹åŠ¨æ§åˆ¶æµç¨‹**â€ã€‚

å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œæˆ‘ä¹Ÿå¯ä»¥å±•ç¤ºä¸€ä¸ªç”¨ `epoll` å’Œå›è°ƒæ¨¡æ‹Ÿâ€œä¸­æ–­â€çš„æœ€å° Muduo é£æ ¼ç¨‹åºï¼Œå¸®åŠ©ä½ æ›´ç›´è§‚ç†è§£å®ƒæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚

## ä¹Ÿå°±æ˜¯è¯´ï¼Œmuduoä¸­çš„äº‹ä»¶é©±åŠ¨ï¼Œå‡å¦‚æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„äº‹ä»¶äº§ç”Ÿï¼Œå¦‚æœå½“å‰æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ²¡æœ‰å®Œæ¯•ï¼Œä¸è®ºå…¶æ˜¯å¦æ˜¯æ›´é«˜çš„æˆ–è€…æ›´ä½çš„ä¼˜å…ˆçº§ï¼Œéƒ½ä¼šç­‰å¾…å®ƒæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šå¼€å§‹æ–°çš„æ‰§è¡Œåˆ¤æ–­ï¼Œå³ä¸å¯è¢«ä¸­æ–­çš„
æ˜¯çš„ï¼Œä½ ç†è§£å¾—éå¸¸å‡†ç¡®ã€‚

---

## âœ… Muduo çš„äº‹ä»¶é©±åŠ¨æœºåˆ¶ â€”â€” **å›è°ƒå‡½æ•°æ˜¯ä¸å¯ä¸­æ–­çš„**

åœ¨ **Muduo** è¿™ç±»åŸºäº `Reactor` æ¨¡å¼çš„äº‹ä»¶é©±åŠ¨æ¡†æ¶ä¸­ï¼š

- æ‰€æœ‰äº‹ä»¶ï¼ˆä¾‹å¦‚ I/O è¯»å†™ã€å®šæ—¶å™¨è§¦å‘ã€ç”¨æˆ·ä»»åŠ¡ï¼‰è¢«ç»„ç»‡åˆ° `EventLoop` çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚
    
- `EventLoop` åœ¨æ¯ä¸€è½®ä¸­ä½¿ç”¨ `epoll_wait` ç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚
    
- äº‹ä»¶ä¸€æ—¦è§¦å‘ï¼Œå®ƒä¼šä¾æ¬¡æ‰§è¡Œå¯¹åº”çš„å›è°ƒå‡½æ•°ã€‚
    

**æ ¸å¿ƒç‰¹æ€§ï¼š**

### ğŸ›‘ å½“å‰å›è°ƒæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¸å¯è¢«ä¸­æ–­çš„ï¼

- å°±ç®—æ­¤æ—¶æœ‰æ–°çš„æ›´é«˜ä¼˜å…ˆçº§äº‹ä»¶åˆ°è¾¾ï¼Œæ¡†æ¶ä¹Ÿ**ä¸ä¼šæ‰“æ–­æ­£åœ¨è¿è¡Œçš„å›è°ƒ**ã€‚
    
- **åªæœ‰ç­‰å½“å‰å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•**ï¼Œäº‹ä»¶å¾ªç¯æ‰ä¼šè¿›å…¥ä¸‹ä¸€è½®ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–äº‹ä»¶éœ€è¦å¤„ç†ã€‚
    

---

## ğŸš« ä¸ºä»€ä¹ˆä¸æ‰“æ–­ï¼Ÿ

è¿™æ˜¯ç”± **ç”¨æˆ·æ€å•çº¿ç¨‹è®¾è®¡** å’Œ **çº¿ç¨‹å®‰å…¨æ€§** å†³å®šçš„ï¼š

1. **å›è°ƒå‡½æ•°æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹å†…é¡ºåºæ‰§è¡Œçš„**ï¼Œä¸èƒ½æŠ¢å ä¸­æ–­æ‰§è¡Œï¼Œä¼šå¸¦æ¥çº¿ç¨‹å®‰å…¨å’Œèµ„æºä¸€è‡´æ€§é—®é¢˜ã€‚
    
2. **æ²¡æœ‰ç¡¬ä»¶ä¸­æ–­æœºåˆ¶**é‚£ç§ä¿å­˜å¯„å­˜å™¨çŠ¶æ€ã€ä¸­æ–­ç°åœºã€æ ˆåˆ‡æ¢ç­‰ä½å±‚æ”¯æŒã€‚
    
3. æ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„ç”¨æˆ·é€»è¾‘ï¼Œå®¹æ˜“é€ æˆèµ„æºæ³„æ¼ã€æ­»é”ã€å´©æºƒç­‰ä¸å¯æ§è¡Œä¸ºã€‚
    

---

## âœ… é‚£è¯¥æ€ä¹ˆå¤„ç†â€œé«˜ä¼˜å…ˆçº§ä»»åŠ¡â€ï¼Ÿ

Muduo ç­‰æ¡†æ¶é€šå¸¸çš„åšæ³•æ˜¯ï¼š

### æ–¹å¼ä¸€ï¼š**äº‹ä»¶ä¼˜å…ˆçº§è°ƒåº¦**

é€šè¿‡é˜Ÿåˆ—æ’åºæˆ–æŒ‰ä¼˜å…ˆçº§æ’é˜Ÿçš„æ–¹å¼ï¼Œè®©é«˜ä¼˜å…ˆçº§äº‹ä»¶ **åœ¨ä¸‹ä¸€è½®å¾ªç¯**æœ€æ—©è¢«å¤„ç†ã€‚

```cpp
// EventLoop ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—å¯ä»¥è®¾è®¡æˆå¸¦ä¼˜å…ˆçº§çš„é˜Ÿåˆ—
```

### æ–¹å¼äºŒï¼š**å¤šçº¿ç¨‹ + çº¿ç¨‹æ± **

ä½ å¯ä»¥è®© EventLoop çº¿ç¨‹åªå¤„ç† IOï¼Œç„¶åæŠŠ CPU å¯†é›†å‹ä»»åŠ¡ **æäº¤åˆ°çº¿ç¨‹æ± æ‰§è¡Œ**ï¼Œä¸ä¼šé˜»å¡ä¸»äº‹ä»¶å¾ªç¯ã€‚

### æ–¹å¼ä¸‰ï¼š**ä¸»åŠ¨è®©å‡º EventLoop**

æŸäº›å¤æ‚å¤„ç†é€»è¾‘ï¼Œå¯ä»¥åˆ†å¤šæ¬¡â€œåˆ‡ç‰‡â€æ‰§è¡Œï¼Œä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼Œä½¿å¾—ä¸‹ä¸€è½®èƒ½å¤„ç†æ›´ç´§æ€¥çš„ä»»åŠ¡ã€‚

---

## ğŸ§  ç±»æ¯”ä¸€ä¸‹ï¼š

| æ–¹é¢       | MCU ä¸­æ–­     | Muduo ç”¨æˆ·æ€äº‹ä»¶é©±åŠ¨ |
| -------- | ---------- | ------------- |
| æ˜¯å¦æ‰“æ–­å½“å‰é€»è¾‘ | âœ… ä¼šæ‰“æ–­å¹¶ä¿å­˜ç°åœº | âŒ ä¸ä¼šæ‰“æ–­        |
| ä¼˜å…ˆçº§æœºåˆ¶    | âœ… ç¡¬ä»¶çº§      | ğŸ” é€»è¾‘æ¨¡æ‹Ÿ       |
| å›è°ƒæ˜¯å¦æŠ¢å    | âœ… å¯ä»¥åµŒå¥—     | âŒ å•çº¿ç¨‹ä¸²è¡Œ       |
| å®æ—¶æ€§      | âœ… é«˜        | âŒ ç›¸å¯¹è¾ƒä½        |

---

## ğŸ”š æ€»ç»“ä¸€å¥è¯ï¼š

> **Muduo æ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œä½†å®ƒæ˜¯â€œé¡ºåºäº‹ä»¶å¤„ç†â€ï¼Œè€Œä¸æ˜¯â€œæŠ¢å å¼ä¸­æ–­å¤„ç†â€ã€‚** ä¸€æ—¦è¿›å…¥æŸä¸ªå›è°ƒå‡½æ•°ï¼Œå°±è¦ç­‰å®ƒè¿è¡Œå®Œï¼Œæ‰èƒ½å¤„ç†å…¶ä»–äº‹ä»¶ã€‚ä½ å¯ä»¥é€šè¿‡ä¼˜å…ˆçº§è°ƒåº¦å’Œçº¿ç¨‹æ± æ¨¡æ‹Ÿæ›´çµæ´»çš„è¡Œä¸ºï¼Œä½†ä¸å…·å¤‡ MCU é‚£ç§ç¡¬ä»¶çº§çš„æŠ¢å å¼ä¸­æ–­èƒ½åŠ›ã€‚

---

å¦‚æœä½ å¸Œæœ›æˆ‘ä¸¾ä¸ªå°ä¾‹å­æ¼”ç¤ºè¿™ç§é¡ºåºå¤„ç†æ–¹å¼çš„è¡Œä¸ºï¼Œæˆ‘å¯ä»¥é©¬ä¸Šå†™ä¸€ä¸ªã€‚éœ€è¦å—ï¼Ÿ

## cmakeslistä¸­ å¤´æ–‡ä»¶ç›®å½•ï¼Œæºæ–‡ä»¶ç›®å½• ï¼Œ ç›®å½•ä¸‹æ‰€æœ‰çš„æºæ–‡ä»¶ add_execuable()ä¸­ï¼Œæ€ä¹ˆå†™
è¿™æ˜¯ä¸€ä¸ª**â€œç»å…¸ä½†ä¸æ¨èç”¨äºå¤§å‹æˆ–ç°ä»£é¡¹ç›®â€çš„å†™æ³•**ã€‚

è™½ç„¶ä½ å†™çš„æ–¹å¼åŠŸèƒ½æ˜¯å¯¹çš„ï¼Œä½†**åœ¨ç°ä»£ CMake ä¸­æ¨èæ›´ç»“æ„åŒ–ã€æ˜¾å¼ã€å¯ç»´æŠ¤æ€§æ›´é«˜çš„æ–¹å¼**ã€‚ä¸‹é¢æˆ‘ç»™ä½ å¯¹æ¯”ä¸€ä¸‹ï¼š

---

## ğŸš« ä¼ ç»Ÿå†™æ³•ï¼ˆä½ ç›®å‰ä½¿ç”¨çš„ï¼‰

```cmake
include_directories(${PROJECT_SOURCE_DIR}/include)
file(GLOB_RECURSE SRC_FILES ${PROJECT_SOURCE_DIR}/src/*.cpp)
add_executable(MyProject ${SRC_FILES})
```

- âœ… ç®€æ´å¿«é€Ÿï¼›
    
- âŒ GLOB ä¸ä¼šè‡ªåŠ¨å“åº”æ–°æ–‡ä»¶ï¼›
    
- âŒ å…¨å±€ä½¿ç”¨ `include_directories()` å½±å“èŒƒå›´å¤§ï¼›
    
- âŒ IDE ä¸­æ— æ³•ç²¾ç¡®å±•ç¤ºé¡¹ç›®ç»“æ„ã€‚
    

---

## âœ… ç°ä»£ CMake æ¨èå†™æ³•

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)

# 1. æ˜ç¡®åˆ—å‡ºæºæ–‡ä»¶ï¼ˆæ¨èï¼‰
set(SOURCES
    src/main.cpp
    src/utils.cpp
)

set(HEADERS
    include/mylib/myheader.h
)

# 2. åˆ›å»º target å¹¶ç»‘å®š include è·¯å¾„
add_executable(MyProject ${SOURCES} ${HEADERS})

# 3. ä»…ä¸ºå½“å‰ target è®¾ç½® include è·¯å¾„ï¼ˆç°ä»£æ¨èï¼‰
target_include_directories(MyProject PRIVATE include)
```

---

## ğŸ†š ä¸ºä»€ä¹ˆè¿™æ ·æ›´ç°ä»£ï¼Ÿ

|ç‰¹æ€§|ä¼ ç»Ÿå†™æ³•|ç°ä»£å†™æ³•|
|---|---|---|
|ç»“æ„æ¸…æ™°|âŒ æ··ä¹±|âœ… æ˜ç¡®|
|æ–‡ä»¶å˜åŒ–å“åº”|âŒ `GLOB` ä¸æ›´æ–°|âœ… æ‰‹åŠ¨æˆ– CMake tools å¯è¯†åˆ«|
|å¤šç›®æ ‡ç®¡ç†|âŒ éº»çƒ¦|âœ… å¯æ‰©å±•|
|IDE æ”¯æŒ|ä¸€èˆ¬|âœ… æœ€ä½³æ”¯æŒ|
|ä½œç”¨åŸŸæ§åˆ¶|âŒ å…¨å±€æ±¡æŸ“|âœ… ç²¾å‡†æ§åˆ¶ï¼ˆ`target_*` ç³»åˆ—ï¼‰|

---

## âœ… å°å‹é¡¹ç›®ï¼šå¯ä»¥ç»§ç»­ç”¨ `GLOB`

å¦‚æœä½ åªæ˜¯ä¸ªäººå®éªŒã€å°å·¥å…·ï¼Œå¯ä»¥ç”¨ï¼š

```cmake
file(GLOB_RECURSE SOURCES CONFIGURE_DEPENDS src/*.cpp)
add_executable(MyProject ${SOURCES})
target_include_directories(MyProject PRIVATE include)
```

æ³¨æ„åŠ ä¸Š `CONFIGURE_DEPENDS` è®© CMake èƒ½æ£€æµ‹æ–‡ä»¶å˜åŒ–ï¼ˆ3.12+ æ”¯æŒï¼‰ã€‚

---

### ğŸ”š æ€»ç»“

- æƒ³å¿«é€Ÿè·‘èµ·æ¥ âœ ä½ çš„æ–¹æ³•æ˜¯ OK çš„ï¼›
    
- æƒ³ç”¨ç°ä»£é£æ ¼ã€é•¿æœŸç»´æŠ¤ã€å¤šæ¨¡å—æ‰©å±• âœ æ¨èä½¿ç”¨ `target_*` å’Œæ˜¾å¼æ–‡ä»¶åˆ—è¡¨ï¼›
    
- å¦‚æœä½ å°†æ¥è¦æ·»åŠ åº“ï¼ˆ`add_library()`ï¼‰æˆ–ä½¿ç”¨ `find_package()`ï¼Œç°ä»£å†™æ³•æ›´æ˜“è¿ç§»ã€‚
    

éœ€è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªæ¨¡å—åŒ–/ç°ä»£é£æ ¼çš„å®Œæ•´é¡¹ç›®ç»“æ„æ¨¡æ¿å—ï¼Ÿ
## ç°ä»£å†™æ³•ä¸­ï¼Œå¦‚æœæœ‰å¾ˆå¤š.cppæ–‡ä»¶ï¼Œéš¾é“éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ·»åŠ å—
è¿™æ˜¯ä¸ªéå¸¸å®é™…çš„é—®é¢˜ï¼Œç­”æ¡ˆæ˜¯ï¼š

> âœ… **åœ¨ç°ä»£ CMake ä¸­ï¼Œæ¨èå°½é‡æ˜¾å¼åˆ—å‡º `.cpp` æ–‡ä»¶ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨ä¸€ç§â€œå…¼é¡¾ç°ä»£ä¸æ–¹ä¾¿â€çš„æ–¹æ³•è‡ªåŠ¨å¤„ç†**ï¼Œä¸å¿…æ‰‹åŠ¨ä¸€ä¸ªä¸ªå†™ã€‚

---

## âœ… æ¨èï¼šè‡ªåŠ¨æ”¶é›†ï¼Œä½†ç»‘å®šåˆ° targetï¼ˆç°ä»£åšæ³• + è‡ªåŠ¨åŒ–ï¼‰

ä½ å¯ä»¥ä½¿ç”¨ `file(GLOB CONFIGURE_DEPENDS ...)`ï¼Œä½†ç»‘å®šåˆ°ç›®æ ‡ï¼š

```cmake
# è‡ªåŠ¨æ”¶é›† .cpp æ–‡ä»¶
file(GLOB_RECURSE SOURCES CONFIGURE_DEPENDS
    ${PROJECT_SOURCE_DIR}/src/*.cpp
)

file(GLOB_RECURSE HEADERS CONFIGURE_DEPENDS
    ${PROJECT_SOURCE_DIR}/include/*.h
)

add_executable(MyProject ${SOURCES} ${HEADERS})

target_include_directories(MyProject PRIVATE include)
```

> âœ… `CONFIGURE_DEPENDS` æ˜¯å…³é”®ï¼Œå‘Šè¯‰ CMake åœ¨æ–°å¢æ–‡ä»¶æ—¶é‡æ–°ç”Ÿæˆæ„å»ºç³»ç»Ÿã€‚

---

## â— æ³¨æ„ï¼š

- `file(GLOB)` è‡ªåŠ¨åŒ–æ˜¯æœ‰å‰¯ä½œç”¨çš„ï¼š**å½“ä½ æ–°å¢ `.cpp` æ–‡ä»¶æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨è§¦å‘é‡æ–°é…ç½®ï¼ˆconfigureï¼‰**ï¼Œä½ éœ€è¦æ‰‹åŠ¨è§¦å‘ï¼ˆæ¯”å¦‚é‡æ–°ç‚¹ç”Ÿæˆï¼Œæˆ–æ¸…é™¤ç¼“å­˜ï¼‰ï¼›
    
- æ‰€ä»¥ï¼Œå¤§é¡¹ç›®/å•†ä¸šé¡¹ç›®ä¸­ä¼šåšæŒ**æ‰‹åŠ¨åˆ—å‡ºæ‰€æœ‰æºæ–‡ä»¶**æ¥ç¡®ä¿æ„å»ºè¡Œä¸ºç¨³å®šã€å¯æ§ã€å¯è¿½è¸ªã€‚
    

---

## âœ… æŠ˜ä¸­å»ºè®®ï¼ˆæŒ‰ç›®å½•ç»„ç»‡ï¼‰

å¦‚æœä½ çš„é¡¹ç›®æœ‰å¤šä¸ªæ¨¡å—ï¼Œä½ å¯ä»¥ï¼š

```
project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ core.cpp
â”‚   â”œâ”€â”€ net/
â”‚   â”‚   â”œâ”€â”€ tcp.cpp
â”‚   â”œâ”€â”€ main.cpp
â”œâ”€â”€ include/
```

ä½ å¯ä»¥ä¸ºæ¯ä¸ªå­ç›®å½•åšä¸€ä¸ª `CMakeLists.txt`ï¼Œç„¶ååœ¨ä¸» `CMakeLists.txt` ä¸­ï¼š

```cmake
add_subdirectory(src/core)
add_subdirectory(src/net)

add_executable(MyProject src/main.cpp)
target_link_libraries(MyProject PRIVATE core net)
```

æ¯ä¸ªæ¨¡å—çš„ `CMakeLists.txt` é‡Œå¯ä»¥ç»§ç»­ç”¨ `file(GLOB)`ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ—ã€‚

---

## ğŸ”š æ€»ç»“

|æ–¹æ³•|æ˜¯å¦æ¨è|ç‰¹ç‚¹|
|---|---|---|
|æ‰‹åŠ¨åˆ—å‡ºæ¯ä¸ªæ–‡ä»¶|âœ… å¼ºæ¨è|ç°ä»£æœ€ä½³å®è·µï¼Œç»´æŠ¤ç¨³å®šï¼Œé€‚åˆå¤šäººåä½œã€å¤§é¡¹ç›®|
|`file(GLOB CONFIGURE_DEPENDS)`|âš ï¸ å¯æ¥å—|è‡ªåŠ¨åŒ–æ–¹ä¾¿ï¼Œé€‚åˆå°å‹é¡¹ç›®ï¼Œæˆ–ä¸ªäººå­¦ä¹ é¡¹ç›®|
|`file(GLOB)`ï¼ˆæ—  CONFIGURE_DEPENDSï¼‰|âŒ ä¸æ¨è|æ— æ³•æ£€æµ‹æ–‡ä»¶æ–°å¢ï¼Œä¸å¯æ§|

---

å¦‚æœä½ å¸Œæœ›æˆ‘æä¾›ä¸€ä¸ª **å¸¦æœ‰å­æ¨¡å—åˆ’åˆ†å’Œè‡ªåŠ¨æ”¶é›†æºæ–‡ä»¶çš„ç°ä»£ CMake æ¨¡æ¿é¡¹ç›®**ï¼Œæˆ‘å¯ä»¥é©¬ä¸Šç»™ä½ ä¸€ä¸ªã€‚è¦ä¸è¦ï¼Ÿ
## å•ä¾‹æ¨¡å¼è·¨dll
åœ¨ **C++ ä¸­å®ç°å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰è·¨ DLL ä½¿ç”¨** æ˜¯ä¸ªå¸¸è§ä½†åˆå¤æ‚çš„è¯é¢˜ï¼Œå…³é”®åœ¨äº **å¦‚ä½•ä¿è¯å¤šä¸ª DLL ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹**ã€‚ä¸‹é¢æ˜¯å®ç°è¿™ä¸ªç›®æ ‡çš„æ ¸å¿ƒè¦ç‚¹å’Œæ¨èåšæ³•ï¼š

---

## âœ… åœºæ™¯è¯´æ˜

ä½ æœ‰å¤šä¸ª DLLï¼ˆæ¯”å¦‚ A.dll å’Œ B.dllï¼‰ï¼Œå®ƒä»¬éƒ½æƒ³ä½¿ç”¨æŸä¸ªå•ä¾‹ç±» `MySingleton`ã€‚ä½ å¸Œæœ›è¿™äº› DLL **å…±äº«åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹**ï¼Œè€Œä¸æ˜¯å„è‡ªç‹¬ç«‹åˆ›å»ºä¸€ä¸ªã€‚

---

## ğŸš« é”™è¯¯åšæ³•ï¼ˆå„ DLL å„å»ºä¸€ä»½ï¼‰

å¦‚æœæ¯ä¸ª DLL éƒ½é™æ€é“¾æ¥äº† `MySingleton` çš„å®ç°ï¼Œé‚£ä¹ˆå³ä½¿ç±»åä¸€æ ·ï¼Œä¹Ÿä¼šåˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œ**ä¸æ˜¯çœŸæ­£çš„â€œå•ä¾‹â€**ã€‚

---

## âœ… æ­£ç¡®åšæ³•ï¼š**å°†å•ä¾‹çš„å®šä¹‰æ”¾åœ¨ä¸€ä¸ªå…¬å…± DLL ä¸­ï¼Œç”±å…¶ä»– DLL å…±äº«è®¿é—®**

### æ­¥éª¤å¦‚ä¸‹ï¼š

### 1. å°†å•ä¾‹ç±»æ”¾åˆ°ä¸€ä¸ªå…±äº« DLL ä¸­ï¼ˆå¦‚ Core.dllï¼‰

```cpp
// CoreSingleton.h
#pragma once

#ifdef CORE_EXPORTS
#define CORE_API __declspec(dllexport)
#else
#define CORE_API __declspec(dllimport)
#endif

class CORE_API MySingleton {
public:
    static MySingleton& getInstance();

    void doSomething();

private:
    MySingleton() = default;
    ~MySingleton() = default;
    MySingleton(const MySingleton&) = delete;
    MySingleton& operator=(const MySingleton&) = delete;
};
```

```cpp
// CoreSingleton.cpp (åªç¼–è¯‘åˆ° Core.dll ä¸­)
#include "CoreSingleton.h"

MySingleton& MySingleton::getInstance() {
    static MySingleton instance; // æ³¨æ„ï¼šå‡½æ•°å†… staticï¼Œçº¿ç¨‹å®‰å…¨ï¼ˆC++11 èµ·ï¼‰
    return instance;
}

void MySingleton::doSomething() {
    // å®ç°åŠŸèƒ½
}
```

### 2. åœ¨å…¶ä»– DLL ä¸­ä½¿ç”¨è¿™ä¸ªå•ä¾‹ç±»ï¼ˆé€šè¿‡å¯¼å…¥ï¼‰

```cpp
#include "CoreSingleton.h"

void SomeFunction() {
    MySingleton::getInstance().doSomething();
}
```

åªè¦ä½ ä¿è¯ï¼š

- æ‰€æœ‰ DLL éƒ½é“¾æ¥åˆ°åŒä¸€ä¸ª `Core.dll`ï¼›
    
- `getInstance()` çš„å®šä¹‰åªåœ¨ Core.dll ä¸­å®ç°ä¸€æ¬¡ï¼›
    
- å•ä¾‹æœ¬èº«ä¸å¤åˆ¶ã€ä¸åºåˆ—åŒ–ï¼›
    

é‚£å°±èƒ½å®ç°è·¨ DLL çš„çœŸæ­£â€œå•ä¾‹â€ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

|é—®é¢˜|è¯´æ˜|
|---|---|
|**é™æ€å˜é‡éš”ç¦»**|æ¯ä¸ª DLL ä¸­çš„ `static` ä¼šç‹¬ç«‹å­˜å‚¨ï¼Œæ‰€ä»¥ä¸è¦å®šä¹‰ static å…¨å±€å˜é‡å®ç°å•ä¾‹|
|**é“¾æ¥æ–¹å¼**|æ‰€æœ‰ä½¿ç”¨è€…å¿…é¡»é“¾æ¥ `Core.dll`ï¼Œè€Œéé™æ€åº“ï¼Œå¦åˆ™ä¼šå¤åˆ¶|
|**çº¿ç¨‹å®‰å…¨**|C++11 èµ· `static` å±€éƒ¨å˜é‡åˆå§‹åŒ–æ˜¯çº¿ç¨‹å®‰å…¨çš„|
|**ABI å…¼å®¹**|ç¡®ä¿ç¼–è¯‘å™¨ã€è¿è¡Œåº“ä¸€è‡´ï¼Œå¦åˆ™ DLL ä¹‹é—´äº¤äº’å®¹æ˜“å´©æºƒ|

---

## âœ… æ›´è¿›ä¸€æ­¥ï¼šæä¾›å•ä¾‹æ¥å£å‡½æ•°ï¼ˆC é£æ ¼ï¼‰

ä¸ºäº†é¿å… C++ ABI ä¸å…¼å®¹å¸¦æ¥çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥å¯¼å‡ºä¸€ä¸ªå‡½æ•°æ¥è®¿é—®å•ä¾‹å®ä¾‹ï¼š

```cpp
extern "C" CORE_API MySingleton* GetMySingletonInstance();
```

å®ç°ï¼š

```cpp
extern "C" CORE_API MySingleton* GetMySingletonInstance() {
    return &MySingleton::getInstance();
}
```

---

## âœ… æ€»ç»“

|é¡¹ç›®|è¦ç‚¹è¯´æ˜|
|---|---|
|å•ä¾‹ç±»å®ç°ä½ç½®|åªåœ¨ä¸€ä¸ª DLLï¼ˆå¦‚ Core.dllï¼‰ä¸­å®šä¹‰å¹¶å®ç° `getInstance()`|
|å¤–éƒ¨ DLL å¦‚ä½•ä½¿ç”¨|é€šè¿‡ `__declspec(dllimport)` å¼•ç”¨ï¼ŒåŒä¸€ä¸ªåœ°å€å®ä¾‹|
|é¿å…é™æ€é“¾æ¥|ä¸è¦å°†å®ç°æ”¾åˆ° `.lib`ï¼Œå¦åˆ™æ¯ä¸ª DLL éƒ½ä¼šå¤åˆ¶ä¸€ä»½|
|å¯é€‰æ–¹å¼|æä¾› `extern "C"` æ¥å£è¿”å›å•ä¾‹æŒ‡é’ˆï¼ˆå¢å¼ºå…¼å®¹æ€§ï¼‰|

---

å¦‚æœä½ æœ‰å®é™…çš„ DLL æ„å»ºç»“æ„æˆ–è€…ä»£ç ç¤ºä¾‹ï¼Œæˆ‘å¯ä»¥å¸®ä½ æ£€æŸ¥æ˜¯å¦å®ç°äº†çœŸæ­£çš„è·¨ DLL å•ä¾‹ã€‚æœ‰éœ€è¦å¯ä»¥è´´å‡ºé¡¹ç›®ç»“æ„æˆ–å…³é”®ä»£ç ã€‚

## å‘½åç©ºé—´å¯ä»¥è·¨æ–‡ä»¶å—ï¼Ÿæ¯”å¦‚a.hä¸­å£°æ˜using namespace std; å¦‚æœb.h#include a.hï¼Œæ˜¯ä¸æ˜¯b.hä¹Ÿå°±é»˜è®¤ä½¿ç”¨stdäº†ï¼ŒåŒæ ·çš„å¦‚æœa.hä¸­using =XXXï¼Œèƒ½å¦è·¨æ–‡ä»¶å‘¢
ä½ æçš„é—®é¢˜å¾ˆæœ‰ä»£è¡¨æ€§ï¼Œä¸‹é¢æˆ‘æ¥è¯¦ç»†è§£ç­”ï¼š

---

## ğŸ”¹1. **å‘½åç©ºé—´ï¼ˆnamespaceï¼‰å¯ä»¥è·¨æ–‡ä»¶å—ï¼Ÿ**

### âœ… ç­”æ¡ˆæ˜¯ï¼š**å¯ä»¥çš„ï¼Œå‘½åç©ºé—´æœ¬èº«å¤©ç„¶æ”¯æŒè·¨æ–‡ä»¶**ã€‚

**ç¤ºä¾‹**ï¼š

```cpp
// a.cpp
namespace myns {
    void funcA();
}
```

```cpp
// b.cpp
namespace myns {
    void funcB() {
        funcA();  // å¯ä»¥è®¿é—® a.cpp ä¸­çš„ funcAï¼Œåªè¦é“¾æ¥é˜¶æ®µæ‰¾åˆ°
    }
}
```

å‘½åç©ºé—´æ˜¯å…¨å±€å¯è§çš„ï¼Œåªè¦ **é“¾æ¥äº†å®šä¹‰æ‰€åœ¨çš„æ–‡ä»¶**ï¼Œå°±å¯ä»¥è®¿é—®å…¶ä¸­æˆå‘˜ã€‚

---

## ğŸ”¹2. `using namespace std;` æ˜¯å¦å¯ä»¥è·¨æ–‡ä»¶ï¼Ÿ

### âŒ **ä¸èƒ½çœŸæ­£â€œè·¨æ–‡ä»¶â€ç”Ÿæ•ˆã€‚**

`using namespace std;` åªæ˜¯**å½“å‰æ–‡ä»¶ä½œç”¨åŸŸå†…å¼•å…¥äº† std å‘½åç©ºé—´çš„æ‰€æœ‰æ ‡è¯†ç¬¦**ã€‚

```cpp
// a.h
using namespace std;

// b.cpp
#include "a.h"
string s;   // âœ… å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸º a.h ä¸­ using namespace std
```

### âš ï¸ ä½†è¿™ç§å†™æ³• **ä¼šå°† using namespace std å¼•å…¥åˆ°åŒ…å«è¯¥å¤´æ–‡ä»¶çš„æ‰€æœ‰ cpp æ–‡ä»¶ä¸­**ï¼Œå®¹æ˜“æ±¡æŸ“å‘½åç©ºé—´ï¼Œç”šè‡³é€ æˆå‘½åå†²çªï¼

---

## âœ… æ¨èåšæ³•ï¼š

### 1. **ä¸è¦åœ¨å¤´æ–‡ä»¶ä¸­å†™ `using namespace std;`**

å› ä¸ºå®ƒä¼šå½±å“æ‰€æœ‰åŒ…å«å®ƒçš„ cpp æ–‡ä»¶ï¼Œå¯¼è‡´å‘½åå†²çªæˆ–å«ä¹‰ä¸æ˜ã€‚

æ­£ç¡®åšæ³•æ˜¯ï¼š

```cpp
// a.h
#include <string>
namespace myns {
    void foo(const std::string& s);
}
```

```cpp
// a.cpp
#include "a.h"
using namespace std;  // åœ¨æºæ–‡ä»¶ä¸­å¯ä»¥è¿™æ ·å†™

void myns::foo(const string& s) {
    cout << s << endl;
}
```

---

## ğŸ”¹3. `using Alias = XXX;` æ˜¯å¦èƒ½è·¨æ–‡ä»¶ï¼Ÿ

### âœ… **å‘½åç©ºé—´åˆ«åæˆ–ç±»å‹åˆ«åï¼ˆ`using`ï¼‰å¯ä»¥è·¨æ–‡ä»¶ä½¿ç”¨ï¼Œä½†è¦é€šè¿‡å¤´æ–‡ä»¶æ˜¾å¼å£°æ˜å¹¶ include**

ä¾‹å¦‚ï¼š

```cpp
// alias.h
#include <unordered_map>
namespace myns {
    using MapStrInt = std::unordered_map<std::string, int>;
}
```

```cpp
// main.cpp
#include "alias.h"

myns::MapStrInt m;  // âœ… å¯æ­£å¸¸ä½¿ç”¨åˆ«å
```

---

## âœ… æ€»ç»“

|åœºæ™¯|æ˜¯å¦è·¨æ–‡ä»¶ç”Ÿæ•ˆ|æ˜¯å¦æ¨è|
|---|---|---|
|`namespace XXX {}` å‘½åç©ºé—´å®šä¹‰|âœ… æ˜¯|âœ… æ¨è|
|`using namespace std;`|âœ… æ˜¯ï¼ˆé€šè¿‡å¤´æ–‡ä»¶ä¼ æ’­ï¼‰|âŒ ä¸æ¨èæ”¾åœ¨å¤´æ–‡ä»¶|
|`using XXX = ...;` ç±»å‹åˆ«å|âœ… æ˜¯ï¼ˆå¤´æ–‡ä»¶å£°æ˜+åŒ…å«ï¼‰|âœ… æ¨èä½¿ç”¨|

---

å¦‚ä½ è¿˜éœ€è¦ä¸€ä¸ª**å¤šæ–‡ä»¶å‘½åç©ºé—´ç¤ºä¾‹é¡¹ç›®ç»“æ„**ï¼Œæˆ‘ä¹Ÿå¯ä»¥é©¬ä¸Šç»™ä½ ä¸€ä¸ªã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
ä½ çš„è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ° C++ ä¸­ **`using` ç±»å‹åˆ«åä½œç”¨åŸŸ**çš„é—®é¢˜ã€‚
## æ¯”å¦‚æˆ‘åœ¨a.hä¸­using t=std::ordered_map<int,int>; b.hä¸­#include<a.h>ï¼Œé‚£ä¹ˆb.cppä¸­ï¼Œå¯ä»¥t hahahaï¼›å—
### âœ… ç®€çŸ­å›ç­”ï¼š

**ä¸å¯ä»¥ç›´æ¥ä½¿ç”¨ `t hahaha;`ï¼Œé™¤éåœ¨ `b.cpp` ä¸­ä¹Ÿä½¿ç”¨äº† `using t = ...;`ï¼Œæˆ–è€… `t` çš„å®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­å¤„äºæŸä¸ªå‘½åç©ºé—´ä¸­ï¼Œå¹¶é€šè¿‡å‘½åç©ºé—´è®¿é—®ã€‚**

---

### ğŸ” è¯¦ç»†è¯´æ˜ï¼š

#### å‡è®¾å¦‚ä¸‹æ–‡ä»¶ç»“æ„ï¼š

**a.h**

```cpp
using t = std::map<int, int>;
```

**b.h**

```cpp
#include "a.h"
```

**b.cpp**

```cpp
#include "b.h"

t hahaha;  // âŒ æŠ¥é”™ï¼šidentifier 't' is undefined
```

è¿™æ˜¯å› ä¸ºè™½ç„¶ `#include "a.h"` ä¼šæŠŠ `using t = ...` æ‹·è´è¿› `b.cpp` çš„ç¼–è¯‘å•å…ƒä¸­ï¼Œä½†å®ƒä»…åœ¨æ‰€åœ¨çš„ä½œç”¨åŸŸä¸­ç”Ÿæ•ˆã€‚é™¤éä½ ç¡®ä¿ `a.h` ä¸­çš„ `using t = ...;` æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ï¼Œå¹¶ä¸”åœ¨ `b.cpp` ä¸­èƒ½çœ‹åˆ°ã€‚

ä½†æœ‰ä¸€äº›**æ›´å¥½çš„æ–¹å¼**æ¥ç»„ç»‡è¿™ç±»åˆ«åï¼Œå°¤å…¶æ˜¯åœ¨ç°ä»£ C++ å¼€å‘ä¸­æ¨èå¦‚ä¸‹å†™æ³•ï¼š

---

### âœ… æ¨èåšæ³•ï¼šæŠŠç±»å‹åˆ«åå†™å…¥å‘½åç©ºé—´

```cpp
// a.h
#pragma once
#include <map>

namespace mytypes {
    using t = std::map<int, int>;
}
```

```cpp
// b.cpp
#include "a.h"

mytypes::t hahaha;  // âœ… OK
```

---

### âœ… æ€»ç»“

|åšæ³•|èƒ½å¦åœ¨ b.cpp ä¸­ä½¿ç”¨ `t`ï¼Ÿ|æ¨èï¼Ÿ|åŸå› |
|---|---|---|---|
|`using t = std::map<...>;` å†™åœ¨ `a.h` å…¨å±€ä½œç”¨åŸŸ|âœ… å¯ä»¥ï¼Œä½†å®¹æ˜“æ±¡æŸ“å…¨å±€å‘½åç©ºé—´|âŒ ä¸æ¨è|ä¼šå¯¼è‡´åç§°å†²çª|
|æŠŠ `t` æ”¾åœ¨å‘½åç©ºé—´é‡Œï¼Œæ¯”å¦‚ `namespace mytypes { using t = ...; }`|âœ… æ¨èç”¨ `mytypes::t`|âœ… æ¨è|æ¸…æ™°ã€å®‰å…¨ã€ç°ä»£|
|åœ¨æ¯ä¸ª cpp æ–‡ä»¶ä¸­é‡å¤å†™ `using t = ...;`|âœ…|âš ï¸ å‹‰å¼ºå¯ä»¥|ä»£ç é‡å¤ï¼Œæ˜“å‡ºé”™|

---

å¦‚æœä½ æœ‰æ›´å¤æ‚çš„é¡¹ç›®ç»“æ„æˆ–è€…åœ¨å°è£…åº“æ—¶ç®¡ç†å…¬å…±ç±»å‹åˆ«åï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ è®¾è®¡åˆç†çš„ç»“æ„ã€‚æ˜¯å¦éœ€è¦æˆ‘ä¸ºä½ æ•´ç†ä¸€ä¸ªä¾‹å­ï¼Ÿ

## muduoåº“å’Œzeromqåº“æœ‰è®¾ä¹ˆå¼‚åŒ
Muduo å’Œ ZeroMQ éƒ½æ˜¯ç”¨äº **ç½‘ç»œç¼–ç¨‹** çš„ C++ åº“ï¼Œä½†å®ƒä»¬çš„**å®šä½ã€ä½¿ç”¨æ–¹å¼å’Œè®¾è®¡æ€æƒ³**å®Œå…¨ä¸åŒã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«å’Œè”ç³»ï¼š

---

## âœ… ç®€æ˜å¯¹æ¯”è¡¨ï¼šMuduo vs ZeroMQ

|ç‰¹æ€§|Muduo|ZeroMQ|
|---|---|---|
|ç±»å‹|C++ ç½‘ç»œç¼–ç¨‹åº“ï¼ˆTCP/äº‹ä»¶é©±åŠ¨æ¡†æ¶ï¼‰|æ¶ˆæ¯ä¼ é€’åº“ï¼ˆæ¶ˆæ¯ä¸­é—´ä»¶ï¼‰|
|åº•å±‚é€šä¿¡|åŸºäº TCPï¼ˆepoll/éé˜»å¡ IOï¼‰|å¯ç”¨ TCP/IPC/inproc/multicast ç­‰å¤šç§ä¼ è¾“æ–¹å¼|
|ä½¿ç”¨æ¨¡å‹|Reactor æ¨¡å¼ + å¤šçº¿ç¨‹|socket-like API + é«˜å±‚æŠ½è±¡çš„æ¶ˆæ¯æ¨¡å‹|
|ç¼–ç¨‹é£æ ¼|éœ€è¦å†™å¾ˆå¤šå›è°ƒå‡½æ•°å’Œç±»é€»è¾‘|æ¥å£ç®€æ´ï¼Œæ³¨é‡æ¶ˆæ¯å‘é€/æ¥æ”¶é€»è¾‘|
|åº”ç”¨å¤æ‚åº¦|åä½å±‚ï¼Œé€‚åˆæ„å»ºå¤æ‚å®šåˆ¶æœåŠ¡å™¨|åé«˜å±‚ï¼Œé€‚åˆå¿«é€Ÿæ­å»ºåˆ†å¸ƒå¼ç³»ç»Ÿ|
|çº¿ç¨‹æ¨¡å‹|æ˜ç¡®çš„å¤šçº¿ç¨‹æ”¯æŒï¼Œçº¿ç¨‹æ± ç­‰æœºåˆ¶éœ€ç”¨æˆ·ç®¡ç†|å†…éƒ¨å¤„ç†å¤šçº¿ç¨‹ï¼Œç”¨æˆ·åªéœ€å…³æ³¨æ¶ˆæ¯ä¼ é€’|
|æ˜¯å¦æ”¯æŒå‘å¸ƒè®¢é˜…|âŒ éœ€è¦æ‰‹åŠ¨å®ç°|âœ… å†…å»º pub/subã€push/pullã€req/rep ç­‰|
|æ˜¯å¦æ”¯æŒåºåˆ—åŒ–|âŒ ç”¨æˆ·éœ€è‡ªå®šä¹‰|âŒ ä¹Ÿéœ€è‡ªå®šä¹‰ï¼ˆå¯ç»“åˆ protobufã€msgpackï¼‰|
|ç¼–è¯‘/ä¾èµ–|ä¾èµ– boostã€C++11|æ—  boost ä¾èµ–ï¼Œä¾èµ– libzmq|
|å…¸å‹åœºæ™¯|é«˜æ€§èƒ½ TCP æœåŠ¡ï¼Œå¦‚ HTTPã€Redisã€RPC ç­‰|åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è¿›ç¨‹é€šä¿¡ã€æœåŠ¡è§£è€¦|

---

## ğŸ¯ ä½ è¯¥ç”¨å“ªä¸ªï¼Ÿ

|åœºæ™¯|æ¨èåº“|ç†ç”±|
|---|---|---|
|æ„å»ºé«˜æ€§èƒ½ TCP æœåŠ¡å™¨ï¼ˆå¦‚è‡ªå®šä¹‰åè®®æœåŠ¡ï¼‰|**Muduo**|æ§åˆ¶æ›´åº•å±‚ï¼Œæ€§èƒ½æ›´é«˜|
|æ„å»ºåˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼ˆå¦‚å¾®æœåŠ¡ä¹‹é—´é€šä¿¡ï¼‰|**ZeroMQ**|å†…å»ºå¤šç§æ¶ˆæ¯æ¨¡å¼ï¼Œæ¥å£ç®€æ´|
|æƒ³å¿«é€Ÿå®ç°è¿›ç¨‹é—´é€šä¿¡æˆ–è·¨ä¸»æœºæ¶ˆæ¯é˜Ÿåˆ—|**ZeroMQ**|é€‚åˆè„šæœ¬è¯­è¨€æ¥å£ã€å¤šè¯­è¨€æ”¯æŒå¥½|
|éœ€è¦è‡ªå·±æ§åˆ¶è¿æ¥ã€å›è°ƒã€çº¿ç¨‹ç®¡ç†ç­‰åº•å±‚é€»è¾‘|**Muduo**|æ›´è‡ªç”±ä½†ä¹Ÿæ›´å¤æ‚|

---

## âœ… ç»“åˆä½¿ç”¨ï¼Ÿ

**å¯ä»¥ï¼** ä½ å¯ä»¥ç”¨ `Muduo` æ­å»ºè‡ªå®šä¹‰é«˜æ€§èƒ½æœåŠ¡å™¨ï¼ŒåŒæ—¶åœ¨æœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨ `ZeroMQ` æ¥ä¼ è¾“æ•°æ®ï¼ˆæ¯”å¦‚ log aggregationã€ä»»åŠ¡ä¸‹å‘ç­‰ï¼‰ã€‚

---

å¦‚æœä½ ç›®å‰æ­£å°è¯•åœ¨ Linux ä¸Šå­¦ä¹ ç½‘ç»œç¼–ç¨‹ï¼š

- æƒ³æ·±å…¥ç†è§£ TCPã€äº‹ä»¶é©±åŠ¨ã€å¤šçº¿ç¨‹æ¨¡å‹ ğŸ‘‰ å»ºè®®ç”¨ **Muduo**
    
- æƒ³å¿«é€Ÿåšä¸€ä¸ªâ€œåˆ†å¸ƒå¼ç³»ç»Ÿâ€æˆ–â€œè¿›ç¨‹é—´é€šä¿¡åŸå‹â€ ğŸ‘‰ å»ºè®®ç”¨ **ZeroMQ**
    

ä½ æƒ³å°è¯•å“ªä¸€ç§ï¼Ÿæˆ‘å¯ä»¥ç»™ä½ ä¸€ä¸ªå…¥é—¨é¡¹ç›®å»ºè®®ã€‚

## linuxä¸‹findå‘½ä»¤çš„å¸¸è§ä½¿ç”¨
`find` æ˜¯ Linux ä¸‹éå¸¸å¼ºå¤§çš„æŸ¥æ‰¾å‘½ä»¤ï¼Œå¸¸ç”¨äºåœ¨ç›®å½•æ ‘ä¸­æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§ç”¨æ³•å’Œæ“ä½œç¤ºä¾‹ï¼š

---

## ğŸ” åŸºæœ¬è¯­æ³•

```bash
find [æŸ¥æ‰¾è·¯å¾„] [æŸ¥æ‰¾æ¡ä»¶] [æ“ä½œ]
```

---

## ğŸ“ ä¸€äº›å¸¸è§ç¤ºä¾‹

### 1. æŸ¥æ‰¾æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶

```bash
find . -type f
```

æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆé€’å½’å­ç›®å½•ï¼‰ã€‚

### 2. æŸ¥æ‰¾æ‰€æœ‰ç›®å½•

```bash
find . -type d
```

æŸ¥æ‰¾æ‰€æœ‰ç›®å½•ï¼ˆ`d` è¡¨ç¤º directoryï¼‰ã€‚

### 3. æŒ‰æ–‡ä»¶åæŸ¥æ‰¾

```bash
find . -name "main.cpp"
```

æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹åä¸º `main.cpp` çš„æ–‡ä»¶ã€‚

æ”¯æŒé€šé…ç¬¦ï¼š

```bash
find . -name "*.cpp"
```

æŸ¥æ‰¾æ‰€æœ‰ `.cpp` æ–‡ä»¶ã€‚

### 4. å¿½ç•¥å¤§å°å†™æŸ¥æ‰¾æ–‡ä»¶å

```bash
find . -iname "*.h"
```

æŸ¥æ‰¾æ‰€æœ‰ `.h` æˆ– `.H` ç»“å°¾çš„å¤´æ–‡ä»¶ã€‚

---

## ğŸ“… æŒ‰æ—¶é—´æŸ¥æ‰¾

### 5. æŸ¥æ‰¾æœ€è¿‘ **n å¤©** å†…ä¿®æ”¹çš„æ–‡ä»¶

```bash
find . -mtime -3
```

æŸ¥æ‰¾æœ€è¿‘ 3 å¤©å†…ä¿®æ”¹çš„æ–‡ä»¶ã€‚

### 6. æŸ¥æ‰¾ 7 å¤©å‰ä¿®æ”¹çš„æ–‡ä»¶

```bash
find . -mtime +7
```

---

## ğŸ“ æŒ‰å¤§å°æŸ¥æ‰¾

### 7. æŸ¥æ‰¾å¤§äº 100MB çš„æ–‡ä»¶

```bash
find . -size +100M
```

### 8. æŸ¥æ‰¾å°äº 10KB çš„æ–‡ä»¶

```bash
find . -size -10k
```

---

## ğŸ§¾ æŒ‰æƒé™/ç”¨æˆ·æŸ¥æ‰¾

### 9. æŸ¥æ‰¾å±äºæŸç”¨æˆ·çš„æ–‡ä»¶

```bash
find /home -user yourname
```

---

## ğŸ› ï¸ æŸ¥æ‰¾å¹¶æ‰§è¡Œå‘½ä»¤

### 10. æŸ¥æ‰¾å¹¶åˆ é™¤ `.tmp` æ–‡ä»¶

```bash
find . -name "*.tmp" -exec rm -f {} \;
```

`{}` è¡¨ç¤ºåŒ¹é…åˆ°çš„æ–‡ä»¶ï¼Œ`\;` è¡¨ç¤ºå‘½ä»¤ç»“æŸã€‚

---

## ğŸ“‹ æŸ¥æ‰¾å¤šä¸ªæ¡ä»¶

### 11. æŸ¥æ‰¾ `.c` æˆ– `.h` æ–‡ä»¶

```bash
find . \( -name "*.c" -o -name "*.h" \)
```

---

## ğŸ§© æŸ¥æ‰¾éšè—æ–‡ä»¶

```bash
find . -name ".*"
```

---

## ğŸ“ æŸ¥æ‰¾ç©ºæ–‡ä»¶æˆ–ç©ºç›®å½•

```bash
find . -empty
```

---

## ğŸ“¦ é™åˆ¶æŸ¥æ‰¾æ·±åº¦

### 12. åªæŸ¥å½“å‰ç›®å½•ï¼ˆä¸é€’å½’ï¼‰

```bash
find . -maxdepth 1 -type f
```

---

## âš¡æ¨èé…åˆä½¿ç”¨çš„å‘½ä»¤

- `xargs`ï¼šé«˜æ•ˆæ‰¹é‡å¤„ç†
    
- `grep`ï¼šå†…å®¹åŒ¹é…
    
- `ls`, `du`, `stat`: æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
    

---

å¦‚ä½ æœ‰æŸç§ç‰¹å®šç›®æ ‡æˆ–ç»„åˆéœ€æ±‚ï¼Œæˆ‘å¯ä»¥å¸®ä½ å¿«é€Ÿå†™å‡º `find` å‘½ä»¤ã€‚éœ€è¦çš„è¯åªç®¡è¯´ï¼

## apt install æŸä¸ªåº“ï¼Œæ˜¯ç›´æ¥ä¸‹è½½å¯¹åº”çš„libï¼Œå¤´æ–‡ä»¶å•¥çš„ï¼Œè¿˜æ˜¯å®é™…ä¸Šä¸‹è½½çš„æºä»£ç ï¼Œç„¶åæœ¬åœ°è¿›è¡Œçš„ç¼–è¯‘å‘¢
`apt install æŸä¸ªåº“` çš„è¿‡ç¨‹**å¹¶ä¸æ˜¯ä¸‹è½½æºç å†æœ¬åœ°ç¼–è¯‘**ï¼Œè€Œæ˜¯ï¼š

---

### âœ… **ç›´æ¥å®‰è£…å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…ï¼ˆ.deb æ–‡ä»¶ï¼‰**

#### å…·ä½“åŒ…æ‹¬ï¼š

- `.so` æ–‡ä»¶ï¼ˆå…±äº«åº“/åŠ¨æ€é“¾æ¥åº“ï¼‰
    
- `.a` æ–‡ä»¶ï¼ˆæœ‰äº›åº“ä¹Ÿä¼šåŒ…å«é™æ€é“¾æ¥åº“ï¼‰
    
- å¤´æ–‡ä»¶ï¼ˆé€šå¸¸å®‰è£…åœ¨ `/usr/include` æˆ– `/usr/include/åº“å`ï¼‰
    
- pkg-config æ–‡ä»¶ï¼ˆå¦‚ `.pc`ï¼‰ç”¨äºå…¶ä»–ç¨‹åºæŸ¥æ‰¾åº“è·¯å¾„
    
- man æ‰‹å†Œã€æ–‡æ¡£ç­‰
    

---

### ğŸ“¦ ä¾‹å­

```bash
sudo apt install libboost-dev
```

ä¼šå®‰è£…ï¼š

- Boost çš„å¤´æ–‡ä»¶ â†’ `/usr/include/boost/`
    
- å·²ç¼–è¯‘å¥½çš„ `.so` åŠ¨æ€åº“ â†’ `/usr/lib/x86_64-linux-gnu/`
    
- æœ‰æ—¶ä¹Ÿå®‰è£… `*.pc` æ–‡ä»¶ç”¨äº `pkg-config`
    

---

### â— è¡¥å……è¯´æ˜ï¼š

å¦‚æœä½ æƒ³è¦ **æºä»£ç ç‰ˆæœ¬**ï¼Œå¯ä»¥ç”¨ï¼š

```bash
apt source libboost-dev
```

æˆ–è€…æƒ³è‡ªå·±ç¼–è¯‘æºç åŒ…ï¼Œå¯ä»¥ç”¨ï¼š

```bash
apt-get source libboost-dev
sudo apt-get build-dep libboost-dev
```

---

### ğŸ” æ€»ç»“

|æ–¹æ³•|è¡Œä¸º|
|---|---|
|`apt install xxx`|å®‰è£…å·²ç»ç¼–è¯‘å¥½çš„å¤´æ–‡ä»¶å’Œåº“|
|`apt source xxx`|ä¸‹è½½æºç ï¼ˆä¸ä¼šè‡ªåŠ¨ç¼–è¯‘ï¼‰|
|`apt-get build-dep xxx`|å®‰è£…æ„å»ºè¿™ä¸ªåº“æ‰€éœ€çš„ä¾èµ–|

ä½ ä¸€èˆ¬å¼€å‘ç”¨ `apt install` å°±å¤Ÿäº†ï¼Œé™¤éä½ éœ€è¦å®šåˆ¶æºç æˆ–è°ƒè¯•å†…éƒ¨å®ç°ã€‚éœ€è¦æˆ‘æ¼”ç¤ºå…·ä½“å®‰è£…åçš„ä½ç½®ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ã€‚

## CMakeå¦‚ä½•è‡ªå®šä¹‰è‡ªå·±çš„åº“ï¼Œå¯ä»¥å®ç°find_package()è¢«å…¶å®ƒçš„åº“å¼•ç”¨å‘¢
To enable other projects to use `find_package(MyLib)` to locate and link against your library, you'll need to configure your CMake project to install the necessary files that CMake expects. This involves setting up your project to install the library, its headers, and CMake configuration files. Here's a step-by-step guide:

---

### ğŸ› ï¸ Step 1: Define and Install Your Library

In your project's `CMakeLists.txt`, define your library and specify installation rules:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyLib VERSION 1.0.0 LANGUAGES CXX)

add_library(MyLib SHARED
    src/mylib.cpp
    include/mylib/mylib.h
)

target_include_directories(MyLib
    PUBLIC
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
        $<INSTALL_INTERFACE:include>
)

install(TARGETS MyLib
    EXPORT MyLibTargets
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
    RUNTIME DESTINATION bin
    INCLUDES DESTINATION include
)

install(DIRECTORY include/ DESTINATION include)
```

---

### ğŸ“¦ Step 2: Create and Install CMake Configuration Files

CMake uses configuration files to locate and configure packages. You'll need to generate and install these files.

First, include the necessary helper module:

```cmake
include(CMakePackageConfigHelpers)
```

Then, generate the version and config files:

```cmake
write_basic_package_version_file(
    "${CMAKE_CURRENT_BINARY_DIR}/MyLibConfigVersion.cmake"
    VERSION ${PROJECT_VERSION}
    COMPATIBILITY AnyNewerVersion
)

configure_package_config_file(
    "${CMAKE_CURRENT_SOURCE_DIR}/cmake/MyLibConfig.cmake.in"
    "${CMAKE_CURRENT_BINARY_DIR}/MyLibConfig.cmake"
    INSTALL_DESTINATION lib/cmake/MyLib
)

install(FILES
    "${CMAKE_CURRENT_BINARY_DIR}/MyLibConfig.cmake"
    "${CMAKE_CURRENT_BINARY_DIR}/MyLibConfigVersion.cmake"
    DESTINATION lib/cmake/MyLib
)

install(EXPORT MyLibTargets
    FILE MyLibTargets.cmake
    NAMESPACE MyLib::
    DESTINATION lib/cmake/MyLib)
```

Create a `MyLibConfig.cmake.in` file in your `cmake/` directory with the following content:

```cmake
@PACKAGE_INIT@

include("${CMAKE_CURRENT_LIST_DIR}/MyLibTargets.cmake")
```

---

### ğŸ§ª Step 3: Build and Install Your Library

Now, build and install your library:

```bash
mkdir build && cd build
cmake -DCMAKE_INSTALL_PREFIX=/desired/install/path ..
cmake --build .
cmake --install .
```

This will install your library, headers, and CMake configuration files to the specified prefix.

---

### ğŸ”— Step 4: Use Your Library in Another Project

In another project, you can now use `find_package` to locate your library:

```cmake
cmake_minimum_required(VERSION 3.14)
project(ConsumerProject LANGUAGES CXX)

find_package(MyLib REQUIRED)

add_executable(ConsumerApp main.cpp)
target_link_libraries(ConsumerApp PRIVATE MyLib::MyLib)
```

When configuring this project, specify the path to your installed library:

```bash
cmake -DCMAKE_PREFIX_PATH=/desired/install/path ..
```

CMake will locate `MyLibConfig.cmake` in the specified path and set up the necessary targets and include directories.

---

### ğŸ“š Additional Resources

- [CMake's Official Documentation on Creating Packages](https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html)
    
- [Tutorial: Easily supporting CMake install and find_package()](https://www.foonathan.net/2016/03/cmake-install/)
    
- [How To Make Your Library Support find_package()](https://blog.mbedded.ninja/programming/build-systems-and-package-managers/cmake/how-to-make-your-library-support-find_package/)
    

By following these steps, your library will be easily discoverable and usable by other CMake-based projects using `find_package`.
## ç»™å‡ºä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œæˆ‘åœ¨linuxå’Œwindowséƒ½è·‘é€šäº†ï¼Œè®°å¾—installå’Œbuildçš„åŒºåˆ«
é‚£æˆ‘ç»™ä½ å†™ä¸€ä¸ªæœ€å° demoï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
Demo/
â”œâ”€â”€ MyProject/            # ä½ è¦å¯¼å‡ºçš„åº“
â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â””â”€â”€ myproject/foo.h
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ foo.cpp
â”‚   â”œâ”€â”€ cmake/
â”‚   â”‚   â””â”€â”€ MyProjectConfig.cmake.in
â”‚   â””â”€â”€ CMakeLists.txt
â”œâ”€â”€ OtherProject/         # ä¾èµ–æ–¹å·¥ç¨‹
â”‚   â”œâ”€â”€ main.cpp
â”‚   â””â”€â”€ CMakeLists.txt
â””â”€â”€ CMakeLists.txt        # æœ€é¡¶å±‚ï¼ˆå¯é€‰ï¼‰
```

---

## 1. MyProject åº“

### `MyProject/include/myproject/foo.h`

```cpp
#pragma once
#include <string>

namespace myproject {
    std::string hello();
}
```

### `MyProject/src/foo.cpp`

```cpp
#include "myproject/foo.h"

namespace myproject {
    std::string hello() {
        return "Hello from MyProject!";
    }
}
```

### `MyProject/CMakeLists.txt`

```cmake
cmake_minimum_required(VERSION 3.15)
project(MyProject VERSION 1.0.0 LANGUAGES CXX)

add_library(MyProject src/foo.cpp)

target_include_directories(MyProject
    PUBLIC
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
        $<INSTALL_INTERFACE:include>
)

add_library(MyProject::MyProject ALIAS MyProject)

include(CMakePackageConfigHelpers)

# å®‰è£…å¤´æ–‡ä»¶
install(DIRECTORY include/ DESTINATION include)

# å®‰è£…åº“
install(TARGETS MyProject
    EXPORT MyProjectTargets
    ARCHIVE DESTINATION lib
    LIBRARY DESTINATION lib
    RUNTIME DESTINATION bin
    INCLUDES DESTINATION include
)

# ç”Ÿæˆç‰ˆæœ¬æ–‡ä»¶
write_basic_package_version_file(
    "${CMAKE_CURRENT_BINARY_DIR}/MyProjectConfigVersion.cmake"
    VERSION ${PROJECT_VERSION}
    COMPATIBILITY SameMajorVersion
)

# å¯¼å‡º targets
install(EXPORT MyProjectTargets
    NAMESPACE MyProject::
    DESTINATION lib/cmake/MyProject
)

# é…ç½® MyProjectConfig.cmake
configure_package_config_file(
    ${CMAKE_CURRENT_SOURCE_DIR}/cmake/MyProjectConfig.cmake.in
    ${CMAKE_CURRENT_BINARY_DIR}/MyProjectConfig.cmake
    INSTALL_DESTINATION lib/cmake/MyProject
)

# å®‰è£…é…ç½®æ–‡ä»¶
install(FILES
    ${CMAKE_CURRENT_BINARY_DIR}/MyProjectConfig.cmake
    ${CMAKE_CURRENT_BINARY_DIR}/MyProjectConfigVersion.cmake
    DESTINATION lib/cmake/MyProject
)
```

### `MyProject/cmake/MyProjectConfig.cmake.in`

```cmake
@PACKAGE_INIT@
include("${CMAKE_CURRENT_LIST_DIR}/MyProjectTargets.cmake")
```

---

## 2. OtherProject ä½¿ç”¨æ–¹

### `OtherProject/main.cpp`

```cpp
#include "myproject/foo.h"
#include <iostream>

int main() {
    std::cout << myproject::hello() << std::endl;
    return 0;
}
```

### `OtherProject/CMakeLists.txt`

```cmake
cmake_minimum_required(VERSION 3.15)
project(OtherProject LANGUAGES CXX)

find_package(MyProject REQUIRED)

add_executable(OtherApp main.cpp)
target_link_libraries(OtherApp PRIVATE MyProject::MyProject)
```

---

## 3. æ„å»º & æµ‹è¯•

1. å®‰è£… `MyProject`ï¼š
    

```bash
cd Demo/MyProject
cmake -B build -DCMAKE_INSTALL_PREFIX=../install
cmake --build build --target install
```

å®‰è£…ç»“æœåœ¨ `Demo/install/`ã€‚

2. æ„å»º `OtherProject`ï¼š
    

```bash
cd ../OtherProject
cmake -B build -DCMAKE_PREFIX_PATH=../install
cmake --build build
```

3. è¿è¡Œï¼š
    

```bash
./build/OtherApp
```

è¾“å‡ºï¼š

```
Hello from MyProject!
```

---

è¦ä¸è¦æˆ‘å¸®ä½ æŠŠè¿™ä¸ª demo æ‰“åŒ…æˆä¸€ä¸ª zipï¼ˆåŒ…å« CMakeLists å’Œä»£ç ï¼‰ï¼Œä½ ç›´æ¥è§£å‹å°±èƒ½è·‘ï¼Ÿ
## MyProject/cmake/MyProjectConfig.cmake.inè¿™ä¸ªæ–‡ä»¶éœ€è¦æ‰‹åŠ¨åˆ›å»ºå—ï¼Ÿæ–‡ä»¶ä¸­çš„@PACKAGE_INIT@include("${CMAKE_CURRENT_LIST_DIR}/MyProjectTargets.cmake") @PACKAGE_INIT@æ˜¯å¿…é¡»çš„å—ï¼ŸMyProjectTargets.cmakeåœ¨å“ªé‡Œç”Ÿæˆå‘¢ 
å¥½é—®é¢˜ ğŸ‘ï¼Œä½ å·²ç»è¿›å…¥åˆ° **CMake çš„å¯¼å‡º / åŒ…é…ç½®æœºåˆ¶**çš„å…³é”®ç‚¹äº†ã€‚è®©æˆ‘åˆ†è§£ä¸€ä¸‹ï¼š

---

### 1. `MyProjectConfig.cmake.in` æ˜¯å¦éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Ÿ

âœ… **éœ€è¦æ‰‹åŠ¨åˆ›å»º**ã€‚  
è¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œç”¨æ¥ç”Ÿæˆæœ€ç»ˆå®‰è£…åˆ° `${prefix}/lib/cmake/MyProject/` ä¸‹çš„ `MyProjectConfig.cmake`ã€‚  
å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰ **ä¸‹æ¸¸å·¥ç¨‹**ï¼ˆè°ƒç”¨ `find_package(MyProject)` çš„äººï¼‰â€”â€”

- éœ€è¦åŒ…å«å“ªäº› target å®šä¹‰
    
- æ˜¯å¦è¦è®¾ç½®é¢å¤–å˜é‡
    
- æ˜¯å¦è¦åšç‰ˆæœ¬æ£€æŸ¥
    

---

### 2. `@PACKAGE_INIT@` æ˜¯ä»€ä¹ˆï¼Ÿ

è¿™æ˜¯ **CMake è‡ªå¸¦çš„å®å±•å¼€ç¬¦**ã€‚  
å½“ä½ è°ƒç”¨ `configure_package_config_file()` æ—¶ï¼ŒCMake ä¼šè‡ªåŠ¨å±•å¼€ `@PACKAGE_INIT@`ï¼Œæ’å…¥ä¸€æ®µåˆå§‹åŒ–é€»è¾‘ã€‚  
æ¯”å¦‚ï¼š

- è®¾ç½® `_IMPORT_PREFIX`ï¼ˆåŒ…å®‰è£…ç›®å½•å‰ç¼€ï¼‰
    
- å¤„ç† `CMAKE_CURRENT_LIST_DIR`
    
- å…¼å®¹å¤šå¹³å°çš„è·¯å¾„å¤„ç†
    

ğŸ‘‰ å»ºè®®ä¿ç•™ï¼Œå¦åˆ™æœ‰äº›è·¯å¾„ç›¸å…³çš„é—®é¢˜ï¼ˆç‰¹åˆ«æ˜¯è·¨å¹³å°å®‰è£…ç›®å½•ï¼‰å¯èƒ½ä¸å¥½å¤„ç†ã€‚

---

### 3. `include("${CMAKE_CURRENT_LIST_DIR}/MyProjectTargets.cmake")` å¿…é¡»å—ï¼Ÿ

âœ… å¿…é¡»ã€‚  
`MyProjectTargets.cmake` é‡Œä¿å­˜äº† `install(EXPORT ...)` å¯¼å‡ºçš„ **targets å®šä¹‰**ã€‚  
å¦‚æœä½ ä¸ include å®ƒï¼Œé‚£ä¹ˆä¸‹æ¸¸çš„ `find_package` å°±æ— æ³•æ‹¿åˆ° `MyProject::MyProject` è¿™æ ·çš„ targetã€‚

---

### 4. `MyProjectTargets.cmake` æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Ÿ

ä¸æ˜¯ä½ æ‰‹å†™çš„ï¼Œè€Œæ˜¯ **ç”± `install(EXPORT ...)` ç”Ÿæˆçš„**ã€‚

ä¾‹å¦‚åœ¨ `MyProject/CMakeLists.txt` ä¸­å†™ï¼š

```cmake
install(TARGETS MyProject
    EXPORT MyProjectTargets
    DESTINATION lib
)

install(EXPORT MyProjectTargets
    FILE MyProjectTargets.cmake
    NAMESPACE MyProject::
    DESTINATION lib/cmake/MyProject
)
```

è¿™æ · CMake åœ¨å®‰è£…æ—¶ä¼šç”Ÿæˆï¼š

- `MyProjectTargets.cmake`
    
- `MyProjectTargets-noconfig.cmake` ï¼ˆå¦‚æœæ˜¯å¤šé…ç½®ç”Ÿæˆå™¨ï¼Œè¿˜ä¼šæœ‰ Debug/Release çš„ï¼‰
    

ä¸‹æ¸¸é¡¹ç›®çš„ `find_package(MyProject)` æ—¶ï¼Œå°±ä¼š `include(MyProjectTargets.cmake)`ï¼Œä»è€Œæ‹¿åˆ° `MyProject::MyProject` è¿™ä¸ª targetã€‚

---

### æ€»ç»“

- `MyProjectConfig.cmake.in`ï¼šä½ è¦æ‰‹åŠ¨åˆ›å»ºï¼Œå†…å®¹å¾ˆå°‘ï¼Œä¸€èˆ¬å°±æ˜¯ï¼š
    

```cmake
@PACKAGE_INIT@

include("${CMAKE_CURRENT_LIST_DIR}/MyProjectTargets.cmake")
```

- `MyProjectTargets.cmake`ï¼šç”± `install(EXPORT ...)` è‡ªåŠ¨ç”Ÿæˆ
    
- `@PACKAGE_INIT@`ï¼šæ¨èä¿ç•™ï¼Œå¤„ç†è·¯å¾„å‰ç¼€
    

---

è¦ä¸è¦æˆ‘ç»™ä½ å†™ä¸€ä¸ªæœ€å°å¯ç”¨çš„ `MyProject/CMakeLists.txt + MyProjectConfig.cmake.in`ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶è·‘é€šï¼Ÿ
ä½ è§‚å¯Ÿå¾—éå¸¸ä»”ç»† ğŸ‘ã€‚  
çš„ç¡®åœ¨ **æ„å»ºé˜¶æ®µ (cmake .. / make)** ä¸ä¼šç«‹åˆ»çœ‹åˆ° `MyProjectTargets.cmake` æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ **å®‰è£…é˜¶æ®µ** æ‰ç”Ÿæˆçš„ã€‚

---

### ğŸ”‘ åŸå› 

```cmake
install(EXPORT MyProjectTargets
    NAMESPACE MyProject::
    DESTINATION lib/cmake/MyProject
)
```

è¿™ä¸€è¡Œå‘Šè¯‰ CMakeï¼š

- **å¯¼å‡ºå“ªäº› target**ï¼ˆç”± `install(TARGETS ... EXPORT MyProjectTargets)` æ”¶é›†ï¼‰
    
- æŠŠè¿™äº› target å®šä¹‰å†™è¿›ä¸€ä¸ªæ–‡ä»¶ **`MyProjectTargets.cmake`**
    
- å¹¶ä¸”å®‰è£…åˆ° `lib/cmake/MyProject` ç›®å½•
    

CMake åœ¨ **æ„å»ºæ—¶** åªæ˜¯è®°å½•â€œæˆ‘éœ€è¦åœ¨å®‰è£…æ—¶ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶â€ã€‚  
æ‰€ä»¥ä½ åœ¨ `build/` ä¸‹çœ‹ä¸åˆ° `MyProjectTargets.cmake`ã€‚

åªæœ‰ç­‰ä½ æ‰§è¡Œï¼š

```bash
cmake --install build --prefix ./install
```

ä¹‹åï¼Œåœ¨ `./install/lib/cmake/MyProject/` ä¸‹ï¼Œæ‰ä¼šçœ‹åˆ°ï¼š

```
MyProjectConfig.cmake
MyProjectConfigVersion.cmake
MyProjectTargets.cmake
MyProjectTargets-noconfig.cmake   (å¤šé…ç½®ç”Ÿæˆå™¨æ—¶å‡ºç°ï¼Œæ¯”å¦‚ MSVC)
```

---

### ğŸ” éªŒè¯æ–¹å¼

ä½ å¯ä»¥è¿™æ ·æµ‹è¯•ï¼š

```bash
cmake -B build -S .
cmake --install build --prefix ./install
```

ç„¶åçœ‹çœ‹ `./install/lib/cmake/MyProject/`ï¼Œä¸€å®šä¼šæœ‰ `MyProjectTargets.cmake`ã€‚

---

âœ… æ€»ç»“ï¼š

- `MyProjectTargets.cmake` **ä¸æ˜¯æ„å»ºæ—¶ç”Ÿæˆ**ï¼Œè€Œæ˜¯ **å®‰è£…æ—¶ç”Ÿæˆ**
    
- ç”± `install(EXPORT ...)` è´Ÿè´£ç”Ÿæˆå¹¶å®‰è£…
    
- è¿™æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œä½ çš„é…ç½®æ˜¯å¯¹çš„
    

---

è¦ä¸è¦æˆ‘å¸®ä½ åŠ ä¸€ä»½ **export åˆ° build ç›®å½•ï¼ˆå¼€å‘æ—¶ç«‹å³å¯ç”¨ï¼‰çš„å†™æ³•**ï¼Ÿè¿™æ ·ä½ ä¸ç”¨ç­‰å®‰è£…å°±èƒ½åœ¨æœ¬åœ°æµ‹è¯• `find_package(MyProject)`ã€‚
## è¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³ï¼Œæ‰¾ä¸åˆ°find_packageï¼ˆï¼‰é‡Œé¢çš„åº“
```
Severity	Code	Description	Project	File	Line	Suppression State	Details
Error		CMake Error at D:/VCPKG/vcpkg/scripts/buildsystems/vcpkg.cmake:893 (_find_package):
  By not providing "FindMyProject.cmake" in CMAKE_MODULE_PATH this project
  has asked CMake to find a package configuration file provided by
  "MyProject", but CMake did not find one.

  Could not find a package configuration file provided by "MyProject" with
  any of the following names:

    MyProjectConfig.cmake
    myproject-config.cmake

  Add the installation prefix of "MyProject" to CMAKE_PREFIX_PATH or set
  "MyProject_DIR" to a directory containing one of the above files.  If
  "MyProject" provides a separate development package or SDK, be sure it has
  been installed.		D:/VCPKG/vcpkg/scripts/buildsystems/vcpkg.cmake	893		

```
è¿™ä¸ªé”™è¯¯ä¿¡æ¯éå¸¸å…¸å‹ï¼Œè¯´æ˜ **CMake åœ¨æ‰¾ `find_package(MyProject)` çš„é…ç½®æ–‡ä»¶æ—¶ï¼Œæ²¡æœ‰æ‰¾åˆ° `MyProjectConfig.cmake`**ã€‚  
æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š

---

## ğŸ” é”™è¯¯åŸå› 

`find_package(MyProject REQUIRED)` ä¼šæŒ‰ä»¥ä¸‹é¡ºåºæ‰¾é…ç½®æ–‡ä»¶ï¼š

1. `CMAKE_PREFIX_PATH` ä¸‹çš„ `lib/cmake/MyProject/MyProjectConfig.cmake`
    
2. `MyProject_DIR` æŒ‡å®šçš„ç›®å½•
    
3. ç³»ç»Ÿé»˜è®¤å®‰è£…è·¯å¾„ï¼ˆLinux `/usr/local/lib/cmake/...`ï¼ŒWindows `C:/Program Files/...`ï¼‰
    

ä½ çš„æ—¥å¿—æ˜¾ç¤ºï¼š

```
Could not find a package configuration file provided by "MyProject" with
any of the following names:
  MyProjectConfig.cmake
  myproject-config.cmake
```

ğŸ‘‰ æ„å‘³ç€ï¼š`MyProject` å·²ç»ç¼–è¯‘è¿‡ï¼Œä½† **è¿˜æ²¡æœ‰æ­£ç¡®å®‰è£…**ï¼Œæˆ–è€… **è°ƒç”¨ `find_package` æ—¶æ²¡å‘Šè¯‰ CMake å»å“ªé‡Œæ‰¾**ã€‚

---
**~~å…¶å®å°±æ˜¯è‡ªå·±æ²¡æœ‰è¿è¡Œinstallå‘½ä»¤ï¼Œå¯¼è‡´çš„æ²¡æœ‰installï¼Œä½¿å¾—æ‰¾ä¸åˆ°.cmakeæ–‡ä»¶,ä¸­é—´ç”»çº¿ä¸æ˜¯åˆ’å»çš„æ„æ€ï¼Œæ˜¯ç€é‡å·ï¼Œæ€•è‡ªå·±æ¼äº†ï¼ˆ20250926ï¼‰~~**
## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šå®‰è£… `MyProject`

è¿›å…¥ `MyProject` ç›®å½•ï¼š

```bash
cmake -B build -S .
cmake --install build --prefix D:/MyProject/install
```

å®‰è£…åä¼šæœ‰ï¼š

```
D:/MyProject/install/lib/cmake/MyProject/MyProjectConfig.cmake
D:/MyProject/install/lib/cmake/MyProject/MyProjectTargets.cmake
```

ç„¶ååœ¨ `OtherProject` é‡Œé…ç½®æ—¶å‘Šè¯‰ CMakeï¼š

```bash
cmake -B build -S . -DCMAKE_PREFIX_PATH="D:/MyProject/install"
```

è¿™æ · `find_package(MyProject REQUIRED)` å°±èƒ½æ‰¾åˆ°ã€‚

---

### æ–¹æ¡ˆ 2ï¼šæ˜¾å¼æŒ‡å®š `MyProject_DIR`

å¦‚æœä½ ä¸æƒ³å…¨å±€å®‰è£…ï¼Œå¯ä»¥ç›´æ¥å‘Šè¯‰ CMakeï¼š

```bash
cmake -B build -S . -DMyProject_DIR="D:/MyProject/build"
```

æˆ–è€…ï¼š

```bash
cmake -B build -S . -DMyProject_DIR="D:/MyProject/build/lib/cmake/MyProject"
```

---

### æ–¹æ¡ˆ 3ï¼šå¯¼å‡ºåˆ° build ç›®å½•ï¼ˆå¼€å‘æ—¶æ–¹ä¾¿ï¼‰

åœ¨ `MyProject/CMakeLists.txt` é‡Œé¢å¤–åŠ ä¸€æ®µï¼š

```cmake
export(EXPORT MyProjectTargets
       FILE "${CMAKE_CURRENT_BINARY_DIR}/MyProjectTargets.cmake"
       NAMESPACE MyProject::)

configure_file(
    ${CMAKE_CURRENT_SOURCE_DIR}/cmake/MyProjectConfig.cmake.in
    ${CMAKE_CURRENT_BINARY_DIR}/MyProjectConfig.cmake
    @ONLY
)
```

è¿™æ ·å³ä½¿æ²¡æœ‰ `install`ï¼Œä½ ä¹Ÿèƒ½ç”¨ï¼š

```bash
cmake -B build -S . -DMyProject_DIR="D:/MyProject/build"
```

---

## âš¡ æ€»ç»“

- `find_package` è¦ä¾èµ– **Config.cmake æ–‡ä»¶**
    
- ä½ éœ€è¦ï¼š
    
    1. **å®‰è£… MyProject** åˆ°æŸä¸ªç›®å½•ï¼ˆæ¨èæ–¹æ¡ˆï¼‰
        
    2. æˆ–è€…è®¾ç½® `MyProject_DIR` æŒ‡å‘ build/install ç›®å½•
        
    3. æˆ–è€…åœ¨ `CMAKE_PREFIX_PATH` é‡ŒåŠ  MyProject çš„å®‰è£…è·¯å¾„
        

---

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª **å®Œæ•´å‘½ä»¤è¡Œæµç¨‹ï¼ˆä» MyProject æ„å»º â†’ å®‰è£… â†’ åœ¨ OtherProject ç”¨ find_package å¼•ç”¨ï¼‰**ï¼Œä½ åªè¦ç…§ç€æ•²å°±èƒ½è·‘é€šï¼Ÿ
## mainå‡½æ•°ä¸­sigint()å¦‚ä½•èµ·ä½œç”¨
åœ¨ C++ æˆ– C ç¨‹åºä¸­çš„ `main` å‡½æ•°ä¸­ï¼Œå¦‚æœä½ æƒ³å“åº” `Ctrl+C`ï¼ˆä¹Ÿå°±æ˜¯ç»ˆç«¯å‘é€çš„ `SIGINT` ä¿¡å·ï¼‰ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼ˆsignal handlerï¼‰æ¥å®ç°ã€‚`SIGINT` çš„ä½œç”¨æ˜¯ä¸­æ–­å½“å‰è¿›ç¨‹ï¼Œé€šå¸¸ç”¨äºç”¨æˆ·æŒ‰ä¸‹ `Ctrl+C` ç»ˆæ­¢ç¨‹åºã€‚ä½ å¯ä»¥é€šè¿‡ `signal()` æˆ– `sigaction()` å‡½æ•°åœ¨ `main()` ä¸­æ³¨å†Œå¯¹ `SIGINT` çš„å¤„ç†å‡½æ•°ã€‚

---

## âœ… ç¤ºä¾‹ï¼šåœ¨ `main()` ä¸­ä½¿ç”¨ `SIGINT` å¤„ç†å‡½æ•°

```cpp
#include <csignal>
#include <iostream>
#include <unistd.h>

void handleSigint(int signum) {
    std::cout << "\nReceived SIGINT (Ctrl+C). Cleaning up and exiting...\n";
    // ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ èµ„æºé‡Šæ”¾ã€æ—¥å¿—ã€ä¿å­˜æ•°æ®ç­‰æ“ä½œ
    exit(signum);  // æ­£å¸¸é€€å‡º
}

int main() {
    // æ³¨å†Œ SIGINT å¤„ç†å‡½æ•°
    signal(SIGINT, handleSigint);

    std::cout << "Running... Press Ctrl+C to trigger SIGINT\n";

    // æ¨¡æ‹Ÿä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
    while (true) {
        std::cout << "." << std::flush;
        sleep(1);
    }

    return 0;
}
```

---

## ğŸ§  å·¥ä½œåŸç†è¯´æ˜

1. `signal(SIGINT, handleSigint);` å‘Šè¯‰æ“ä½œç³»ç»Ÿï¼š**å½“è¿›ç¨‹æ¥æ”¶åˆ° `SIGINT` ä¿¡å·æ—¶ï¼Œè°ƒç”¨ä½ è‡ªå®šä¹‰çš„ `handleSigint()` å‡½æ•°**ã€‚
    
2. å½“ç”¨æˆ·æŒ‰ä¸‹ `Ctrl+C`ï¼Œç»ˆç«¯å‘é€ `SIGINT` åˆ°å½“å‰å‰å°è¿›ç¨‹ã€‚
    
3. å¦‚æœæ²¡æœ‰è®¾ç½® handlerï¼Œç¨‹åºä¼šç›´æ¥è¢«ä¸­æ–­ï¼›æœ‰ handler æ—¶å°±ä¼šè¿›å…¥ä½ å®šä¹‰çš„å‡½æ•°æ‰§è¡Œé€»è¾‘ã€‚
    

---

## âœ… æ›´ç°ä»£å’Œå¥å£®çš„å†™æ³•ï¼š`sigaction()`

```cpp
#include <signal.h>
#include <iostream>
#include <unistd.h>

void handleSigint(int signum) {
    std::cout << "\n(SIGINT) Interrupt received, exiting...\n";
    exit(0);
}

int main() {
    struct sigaction sa;
    sa.sa_handler = handleSigint;
    sigemptyset(&sa.sa_mask);
    sa.sa_flags = 0;

    sigaction(SIGINT, &sa, nullptr);

    std::cout << "Waiting for SIGINT (Ctrl+C)...\n";
    while (true) {
        pause();  // ç­‰å¾…ä¿¡å·å‘ç”Ÿ
    }

    return 0;
}
```

ä½¿ç”¨ `sigaction` çš„å¥½å¤„æ˜¯æ›´å¯æ§ï¼Œæ¯”å¦‚å¯ä»¥è®¾ç½®å¤šä¸ªä¿¡å·æ©ç ã€è‡ªåŠ¨é‡å¯ç­‰è¡Œä¸ºã€‚

---

å¦‚éœ€è®©ä½ çš„ç¨‹åºåœ¨ `SIGINT` è§¦å‘æ—¶ä¼˜é›…é€€å‡ºã€ä¿å­˜æ•°æ®ã€æ¸…ç†èµ„æºç­‰ï¼Œä¸Šè¿°åšæ³•æ˜¯æœ€åŸºæœ¬æœ‰æ•ˆçš„æ–¹å¼ã€‚éœ€è¦æˆ‘å†æ¼”ç¤ºç»“åˆå¤šçº¿ç¨‹æˆ– I/O çš„ç‰ˆæœ¬å—ï¼Ÿ

## Telnetå‘½ä»¤å¦‚ä½•ä½¿ç”¨
`telnet` æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•ç½‘ç»œè¿æ¥çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¸¸ç”¨äºæµ‹è¯• **æŸä¸ªä¸»æœºçš„æŒ‡å®šç«¯å£æ˜¯å¦å¯è¾¾**ï¼Œæˆ–è€…æ‰‹åŠ¨æ¨¡æ‹Ÿåè®®é€šä¿¡ï¼ˆå¦‚ HTTPã€SMTPã€POP3 ç­‰ï¼‰ã€‚

---

## âœ… åŸºæœ¬è¯­æ³•

```bash
telnet <ä¸»æœºåæˆ–IPåœ°å€> <ç«¯å£å·>
```

---

## ğŸ”§ ç¤ºä¾‹ç”¨æ³•

### 1. æµ‹è¯•ç«¯å£è¿é€šæ€§ï¼ˆå¸¸è§ç”¨æ³•ï¼‰

```bash
telnet 192.168.1.100 22      # æµ‹è¯•èƒ½å¦è¿æ¥ SSH æœåŠ¡
telnet www.example.com 80    # æµ‹è¯• HTTP æœåŠ¡ç«¯å£æ˜¯å¦å¼€æ”¾
```

æˆåŠŸåï¼Œä¼šçœ‹åˆ°ç±»ä¼¼ï¼š

```
Trying 192.168.1.100...
Connected to 192.168.1.100.
Escape character is '^]'.
```

å¤±è´¥æ—¶ï¼š

```
telnet: Unable to connect to remote host: Connection refused
```

---

### 2. æ¨¡æ‹Ÿ HTTP è¯·æ±‚ï¼ˆè¾“å…¥æ‰‹åŠ¨å‘½ä»¤ï¼‰

```bash
telnet www.example.com 80
```

è¿æ¥æˆåŠŸåè¾“å…¥ï¼ˆæ³¨æ„æ¢è¡Œä¸¤æ¬¡ï¼‰ï¼š

```
GET / HTTP/1.1
Host: www.example.com

```

ä½ å°†ä¼šçœ‹åˆ°æœåŠ¡å™¨è¿”å›çš„ HTTP å“åº”å†…å®¹ã€‚

---

### 3. æ¨¡æ‹Ÿ SMTP è¯·æ±‚ï¼ˆé‚®ä»¶æµ‹è¯•ï¼‰

```bash
telnet smtp.example.com 25
```

è¿æ¥åå¯è¾“å…¥ SMTP æŒ‡ä»¤ï¼Œæ¯”å¦‚ï¼š

```
HELO localhost
MAIL FROM:<you@example.com>
RCPT TO:<someone@example.com>
DATA
Hello
.
QUIT
```

---

## ğŸ“¦ å®‰è£… Telnetï¼ˆéƒ¨åˆ†ç³»ç»Ÿé»˜è®¤æ²¡æœ‰ï¼‰

### Ubuntu / Debianï¼š

```bash
sudo apt install telnet
```

### CentOS / RHELï¼š

```bash
sudo yum install telnet
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

- `telnet` ä¸åŠ å¯†ï¼Œä¸å»ºè®®ç”¨äºæ•æ„Ÿæ•°æ®ä¼ è¾“ã€‚
    
- æ–°ç³»ç»Ÿå·²é€æ­¥ç”¨ `nc` (`netcat`) æ›¿ä»£ `telnet`ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚
    

---

## âœ… æ›¿ä»£æ¨èï¼š`nc`ï¼ˆnetcatï¼‰

```bash
nc -zv 192.168.1.100 22   # æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
```

---

éœ€è¦æˆ‘æ¼”ç¤ºä¸€ä¸ªå…·ä½“åè®®çš„ `telnet` ä½¿ç”¨ä¾‹å­ï¼ˆå¦‚ Redisã€SMTPã€HTTPï¼‰å—ï¼Ÿ

## linux ä¸‹æŸ¥çœ‹è½¯ä»¶çš„å®‰è£…æ—¶é—´ã€ä½ç½®ã€ä½“ç§¯æƒ…å†µ
åœ¨ Ubuntu ä¸ŠæŸ¥çœ‹å·²å®‰è£…çš„ `netcat`ï¼ˆæˆ–ä»»ä½•è½¯ä»¶åŒ…ï¼‰çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

---

## âœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `dpkg -s` æŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼ˆå¦‚å®‰è£…æ—¶é—´ã€ç‰ˆæœ¬ï¼‰

```bash
dpkg -s netcat
```

æˆ–è€…é’ˆå¯¹å…·ä½“å®ç°ç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š

```bash
dpkg -s netcat-openbsd
dpkg -s netcat-traditional
```

è¾“å‡ºåŒ…æ‹¬ï¼š

- è½¯ä»¶æè¿°
    
- çŠ¶æ€
    
- å®‰è£…ç‰ˆæœ¬
    
- å®‰è£…æ—¶é—´ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬ä¸­ï¼‰
    
- ä¾èµ–é¡¹ç­‰
    

---

## âœ… æ–¹æ³•äºŒï¼šæŸ¥çœ‹å®‰è£…è·¯å¾„

```bash
dpkg -L netcat
```

æˆ–è€…ï¼š

```bash
dpkg -L netcat-openbsd
```

ä¼šåˆ—å‡ºè¯¥åŒ…å®‰è£…çš„æ‰€æœ‰æ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚å¯æ‰§è¡Œæ–‡ä»¶å¯èƒ½ä½äº `/bin/nc`ã€`/usr/bin/nc`ã€‚

---

## âœ… æ–¹æ³•ä¸‰ï¼šæŸ¥çœ‹å®‰è£…ä½“ç§¯å’Œæ›´å¤šå…ƒæ•°æ®

```bash
apt show netcat
```

æˆ–è€…ï¼š

```bash
apt show netcat-openbsd
```

è¾“å‡ºç¤ºä¾‹åŒ…å«ï¼š

- å®‰è£…åŒ…å¤§å°ï¼ˆInstalled-Sizeï¼‰
    
- æºåŒ…ï¼ˆSourceï¼‰
    
- å®‰è£…ä½ç½®
    
- Maintainer ä¿¡æ¯ç­‰
    

---

## âœ… æ–¹æ³•å››ï¼šæŸ¥çœ‹å®‰è£…æ—¶é—´ï¼ˆé—´æ¥æ–¹å¼ï¼‰

`dpkg` é»˜è®¤å¹¶ä¸è®°å½•å®‰è£…æ—¶é—´ï¼Œä½†å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼ä¼°ç®—ï¼š

```bash
ls -lct /var/lib/dpkg/info/netcat* | tail -1
```

è¿™å¯ä»¥æŸ¥çœ‹ç›¸å…³å…ƒæ•°æ®æ–‡ä»¶çš„æœ€åæ›´æ”¹æ—¶é—´ï¼Œä½œä¸ºå®‰è£…æ—¶é—´çš„è¿‘ä¼¼ã€‚

---

å¦‚éœ€åˆ¤æ–­ä½ å½“å‰çš„ `nc` æ˜¯å“ªä¸ªå®ç°ç‰ˆæœ¬ï¼š

```bash
which nc
nc -h
```

æˆ–ç›´æ¥æŸ¥çœ‹ç¬¦å·é“¾æ¥/å¯æ‰§è¡Œæ–‡ä»¶å†…å®¹ï¼š

```bash
ls -l $(which nc)
```

---

éœ€è¦æˆ‘å¸®ä½ è§£ææŸä¸ªå…·ä½“è¾“å‡ºï¼Œå¯ä»¥æŠŠç»“æœå‘æˆ‘ã€‚
## cmakelistsä¸­æœ‰å¾ˆå¤šinstallå‘½ä»¤ï¼Œå°†ä¸€äº›æ–‡ä»¶æ”¾ç½®åœ¨æŒ‡å®šçš„æ–‡ä»¶å¤¹ï¼Œæˆ‘ç°åœ¨ä½¿ç”¨çš„vs studioï¼Œæˆ‘åªæœ‰build projectæŒ‰é’®å¯ä»¥ç‚¹å‡»ï¼Œè¿™ä¸ªinstallè¯¥æ€ä¹ˆæ‰§è¡Œå‘¢
ä½ è¿™ä¸ªé—®é¢˜å¾ˆå…¸å‹ ğŸ‘ã€‚

åœ¨ **VS Studio + CMake å·¥ç¨‹**é‡Œï¼Œé»˜è®¤çš„ **Build Project** åªä¼šæ‰§è¡Œ `cmake --build`ï¼Œä¹Ÿå°±æ˜¯æ„å»ºç›®æ ‡ï¼ˆæ¯”å¦‚ `.exe`ã€`.dll`ã€`.lib`ï¼‰ã€‚

ä½†æ˜¯ `install(...)` ç›¸å…³çš„è§„åˆ™ä¸ä¼šåœ¨æ™®é€š build æ—¶æ‰§è¡Œï¼Œå®ƒå¯¹åº”çš„æ˜¯ **install target**ï¼Œéœ€è¦ä½ æ˜¾å¼è°ƒç”¨ã€‚

---

### ğŸ”¹æ–¹æ³•ä¸€ï¼šå‘½ä»¤è¡Œæ‰§è¡Œ

åœ¨ VS ç”Ÿæˆçš„ CMake æ„å»ºç›®å½•ï¼ˆé€šå¸¸æ˜¯ `out/build/x64-Debug`ï¼‰ä¸‹è¿è¡Œï¼š

```powershell
cmake --install .
```

è¿™ä¼šæ‰§è¡Œä½  CMakeLists.txt é‡Œæ‰€æœ‰çš„ `install(...)` å‘½ä»¤ï¼ŒæŠŠå¤´æ–‡ä»¶ã€åº“ã€cmake é…ç½®æ–‡ä»¶ç­‰å®‰è£…åˆ°ä½ é…ç½®çš„è·¯å¾„ï¼ˆé»˜è®¤æ˜¯ `CMAKE_INSTALL_PREFIX`ï¼Œåœ¨ Windows ä¸Šä¸€èˆ¬æ˜¯ `C:/Program Files (x86)/MyProject`ï¼‰ã€‚

å¦‚æœä½ æƒ³æ”¹å®‰è£…ç›®å½•ï¼Œå¯ä»¥åœ¨ CMake é…ç½®æ—¶åŠ ï¼š

```powershell
cmake -DCMAKE_INSTALL_PREFIX=D:/myproject/install ..
```

---

### ğŸ”¹æ–¹æ³•äºŒï¼šVS é‡Œå¯ç”¨ `INSTALL` target

Visual Studio ä¼šè‡ªåŠ¨ä¸º CMake å·¥ç¨‹ç”Ÿæˆä¸€ä¸ª `INSTALL` ç›®æ ‡ã€‚  
ä½ å¯ä»¥ï¼š

1. åœ¨ VS çš„ **è§£å†³æ–¹æ¡ˆèµ„æºç®¡ç†å™¨**ï¼ˆSolution Explorerï¼‰é‡Œæ‰¾åˆ° **CMake Targets View**ã€‚
    
2. åœ¨é‚£é‡Œä½ ä¼šçœ‹åˆ° `ALL_BUILD`ã€`INSTALL` ç­‰ç›®æ ‡ã€‚
    
3. å³é”®ç‚¹å‡» `INSTALL` â†’ **Build**ï¼Œå°±ä¼šæ‰§è¡Œ `install(...)`ã€‚
    

---

### ğŸ”¹æ–¹æ³•ä¸‰ï¼šç”¨ `CMakePresets.json` é¢„é…ç½®

å¦‚æœä½ ä¹ æƒ¯ VS çš„ **CMakePresets.json** æˆ– `CMakeUserPresets.json`ï¼Œå¯ä»¥åœ¨ preset é‡ŒåŠ å®‰è£…å‰ç¼€ï¼š

```json
{
  "version": 3,
  "cmakeMinimumRequired": { "major": 3, "minor": 15 },
  "configurePresets": [
    {
      "name": "x64-debug",
      "generator": "Ninja",
      "binaryDir": "${sourceDir}/out/build/${presetName}",
      "cacheVariables": {
        "CMAKE_INSTALL_PREFIX": "D:/myproject/install"
      }
    }
  ]
}
```

ä¹‹åä½ åªè¦è¿è¡Œï¼š

```powershell
cmake --build . --target install
```

æˆ–è€…åœ¨ VS é‡Œé€‰æ‹© `INSTALL` target å³å¯ã€‚

---

âœ… æ€»ç»“ï¼š

- `install(...)` ä¸ä¼šåœ¨ `Build Project` æ—¶æ‰§è¡Œã€‚
    
- éœ€è¦ `cmake --install .` æˆ–è€… `cmake --build . --target install`ã€‚
    
- VS é‡Œå¯ä»¥æ‰‹åŠ¨é€‰æ‹© `INSTALL` ç›®æ ‡æ¥è¿è¡Œã€‚
    

---


**æ³¨æ„ï¼Œæˆ‘åœ¨VS codeä¸Šï¼Œæ˜¯é€šè¿‡é…ç½®CMake toolsè¿™ä¸ªæ’ä»¶é‡Œé¢çš„install prefixä¸º${workspaceFolder}/installå®ç°çš„installå®‰è£…åˆ°æœ¬åœ°ï¼Œè€Œä¸æ˜¯user/localï¼Œä»¥æ­¤æ¥å®ç°çš„è‡ªå®šä¹‰åŒ…å¯è¢«è°ƒç”¨æ–¹ä»¥find_packageçš„æ–¹å¼å¼•ç”¨**
## VS ä¸Šè¿œç¨‹linuxç³»ç»Ÿå¼€å‘ç¨‹åºï¼Œå‡å¦‚linuxä¸Šè¿è¡Œçš„æŸä¸ªåº”ç”¨ç¨‹åºå‡æ­»äº†æƒ³ä½¿ç”¨gdb attachåˆ°è¯¥è¿›ç¨‹æŸ¥çœ‹ä¸‹è°ƒç”¨å †æ ˆï¼Œå¯ä»¥ä½¿ç”¨è¿œç¨‹å¼€å‘çš„æ–¹å¼åœ¨vsä¸­å®ç°å—
æ˜¯çš„ï¼Œå¯ä»¥ä½¿ç”¨ **Visual Studioï¼ˆVSï¼‰è¿œç¨‹ Linux å¼€å‘åŠŸèƒ½** å®ç°è¿œç¨‹ attach åˆ° Linux ä¸Šè¿è¡Œçš„è¿›ç¨‹å¹¶ä½¿ç”¨ GDB æŸ¥çœ‹è°ƒç”¨å †æ ˆï¼Œä½†**éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶å’Œæ“ä½œæ­¥éª¤**ã€‚

---

## âœ… å‰ææ¡ä»¶ï¼š

1. **ä½ å·²ç»è®¾ç½®å¥½ VS çš„â€œè¿œç¨‹ Linux å¼€å‘ç¯å¢ƒâ€**
    
    - å·¥å…·é›†ï¼šå·²å®‰è£… _Linux development with C++_ workloadã€‚
        
    - SSH è¿æ¥æˆåŠŸï¼Œå¹¶èƒ½åœ¨ VS ä¸­æ­£å¸¸æ„å»ºã€éƒ¨ç½²åˆ° Linuxã€‚
        
    - VS ä¼šè‡ªåŠ¨åœ¨è¿œç¨‹ç³»ç»Ÿä¸­éƒ¨ç½²è°ƒè¯•ä»£ç† `vsdbg`ï¼ˆæˆ– `gdbserver`ï¼Œå–å†³äºé…ç½®ï¼‰ã€‚
        
2. **ç›®æ ‡ç¨‹åºæ˜¯åœ¨ Linux ä¸Šè¿è¡Œå¹¶å¯è¢«å½“å‰ç”¨æˆ·è®¿é—®çš„è¿›ç¨‹**ã€‚
    
3. **å¯ä½¿ç”¨ GDB æˆ– VS çš„è°ƒè¯•å™¨ attach åˆ°è¿œç¨‹è¿›ç¨‹**ã€‚
    

---

## ğŸ”§ æ“ä½œæ–¹æ³•ï¼ˆåœ¨ VS ä¸­ attach åˆ° Linux ä¸Šçš„è¿›ç¨‹ï¼‰ï¼š

1. æ‰“å¼€ Visual Studioã€‚
    
2. åœ¨èœå•æ ç‚¹å‡»ï¼š  
    `è°ƒè¯•ï¼ˆDebugï¼‰` â†’ `é™„åŠ åˆ°è¿›ç¨‹ï¼ˆAttach to Processï¼‰`
    
3. åœ¨â€œè¿æ¥ç±»å‹â€ä¸­é€‰æ‹©ï¼š
    
    ```
    SSH
    ```
    
4. åœ¨â€œè¿æ¥ç›®æ ‡â€ä¸­é€‰æ‹©ä½ å·²é…ç½®çš„ Linux è¿œç¨‹ä¸»æœºã€‚
    
5. ç‚¹å‡»â€œåˆ·æ–°â€æŒ‰é’®ï¼Œåˆ—å‡ºè¿œç¨‹ä¸»æœºå½“å‰æ‰€æœ‰çš„è¿›ç¨‹ã€‚
    
6. æ‰¾åˆ°ä½ è¦ attach çš„è¿›ç¨‹ï¼ˆæ¯”å¦‚æŸä¸ªå·²å‡æ­»çš„åå°æœåŠ¡ï¼‰ï¼Œé€‰ä¸­å®ƒï¼Œç‚¹å‡»â€œé™„åŠ ï¼ˆAttachï¼‰â€ã€‚
    

---

## ğŸ“Œ é™„åŠ æˆåŠŸåä½ å¯ä»¥ï¼š

- åœ¨â€œè°ƒç”¨å †æ ˆï¼ˆCall Stackï¼‰â€çª—å£ä¸­æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆã€‚
    
- è§‚å¯Ÿçº¿ç¨‹çŠ¶æ€ã€å±€éƒ¨å˜é‡ç­‰è°ƒè¯•ä¿¡æ¯ã€‚
    
- è®¾ç½®æ–­ç‚¹æˆ–æ‰‹åŠ¨ä¸­æ–­è¿›ç¨‹æŸ¥çœ‹çŠ¶æ€ã€‚
    

---

## ğŸ§© æ³¨æ„äº‹é¡¹ï¼š

- **ä½ éœ€è¦æœ‰è°ƒè¯•ä¿¡æ¯ï¼ˆ.pdb / DWARFï¼‰**ï¼Œç¼–è¯‘ç¨‹åºæ—¶éœ€å¼€å¯è°ƒè¯•ä¿¡æ¯ï¼ˆå¦‚ `-g`ï¼‰ã€‚
    
- å¦‚æœæ˜¯éä½ ç”¨æˆ·è¿è¡Œçš„è¿›ç¨‹ï¼Œ**å¯èƒ½éœ€è¦ sudo æƒé™æ‰èƒ½ attach**ï¼Œå»ºè®®å…ˆåœ¨ Linux ä¸Šé€šè¿‡å‘½ä»¤ `gdb -p <pid>` å°è¯•çœ‹çœ‹æ˜¯å¦æƒé™è¶³å¤Ÿã€‚
    
- å¦‚æœ VS æ— æ³• attachï¼Œä¹Ÿå¯ä»¥å…ˆ SSH åˆ° Linux ä¸Šï¼Œä½¿ç”¨åŸç”Ÿå‘½ä»¤æ‰‹åŠ¨è°ƒè¯•ï¼Œä¾‹å¦‚ï¼š
    
    ```bash
    gdb -p <pid>
    ```
    
    æŸ¥çœ‹è°ƒç”¨æ ˆï¼š
    
    ```
    (gdb) bt
    ```
    

---

## ğŸ§  å°è´´å£«ï¼š

å¦‚æœä½ æƒ³è°ƒè¯•å¯åŠ¨å³å‡ºé—®é¢˜çš„è¿›ç¨‹ï¼Œå¯ä»¥è®¾ç½® gdbserver å¯åŠ¨è¿œç¨‹è°ƒè¯•ï¼Œç„¶åè®© VS è¿æ¥ gdbserver è¿›è¡Œæ›´æ·±å…¥çš„è°ƒè¯•æ§åˆ¶ã€‚

---

å¦‚éœ€æˆ‘æä¾›å…·ä½“ç¤ºä¾‹å·¥ç¨‹æˆ–å®Œæ•´è°ƒè¯•æµç¨‹ï¼Œæˆ‘å¯ä»¥å¸®ä½ æ•´ç†ä¸€å¥—ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
## vs codeè¿œç¨‹å¼€å‘æ—¶ï¼Œlaunch.json settings.json tasks.jsonè¿™3ä¸ªå¸¸è§é…ç½®æ–‡ä»¶åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨
å¥½é—®é¢˜ ğŸ‘ï¼Œåœ¨ **VS Code è¿œç¨‹å¼€å‘ï¼ˆæ¯”å¦‚ Remote-SSHï¼‰**æ—¶ï¼Œè¿™ä¸‰ä¸ªé…ç½®æ–‡ä»¶å¸¸å¸¸ä¼šå‡ºç°åœ¨ `.vscode/` æ–‡ä»¶å¤¹ä¸‹ã€‚å®ƒä»¬çš„ä½œç”¨æ˜¯ **äº’ç›¸é…åˆä½†åˆ†å·¥æ˜ç¡®**çš„ï¼š

---

## 1. `launch.json` â€”â€” **è°ƒè¯•é…ç½®**

- **ç”¨é€”**ï¼šå‘Šè¯‰ VS Code **å¦‚ä½•è¿è¡Œå’Œè°ƒè¯•ç¨‹åº**ã€‚
    
- å…¸å‹åœºæ™¯ï¼šæŒ‰ä¸‹ `F5` æˆ–ç‚¹å‡»ã€ŒRun and Debugã€æŒ‰é’®æ—¶ï¼ŒVS Code ä¼šè¯»å–è¿™é‡Œçš„é…ç½®ã€‚
    
- ä¸»è¦å†…å®¹ï¼š
    
    - **ç¨‹åºè·¯å¾„**ï¼ˆæ¯”å¦‚ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨å“ªï¼‰
        
    - **è°ƒè¯•å™¨ç±»å‹**ï¼ˆC++ ç”¨ `cppdbg` æˆ– `lldb`ï¼ŒPython ç”¨ `python`ï¼‰
        
    - **è°ƒè¯•å‚æ•°**ï¼ˆå‘½ä»¤è¡Œå‚æ•°ã€å·¥ä½œç›®å½•ã€ç¯å¢ƒå˜é‡ï¼‰
        
    - **è¿œç¨‹è°ƒè¯•è®¾ç½®**ï¼ˆgdbserverã€docker attach ç­‰ï¼‰
        

ç¤ºä¾‹ï¼š

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug C++ App",
      "type": "cppdbg",
      "request": "launch",
      "program": "${workspaceFolder}/build/app",
      "args": ["--test"],
      "cwd": "${workspaceFolder}",
      "MIMode": "gdb",
      "miDebuggerPath": "/usr/bin/gdb"
    }
  ]
}
```

---

## 2. `tasks.json` â€”â€” **ä»»åŠ¡é…ç½®**

- **ç”¨é€”**ï¼šå®šä¹‰ **è‡ªå®šä¹‰ä»»åŠ¡**ï¼Œæ¯”å¦‚ç¼–è¯‘ã€æ‰“åŒ…ã€è¿è¡Œè„šæœ¬ã€‚
    
- å¯ä»¥æ‰‹åŠ¨è¿è¡Œï¼ˆ`Ctrl+Shift+P â†’ Run Task`ï¼‰ï¼Œä¹Ÿå¯ä»¥è®© `launch.json` è°ƒè¯•å‰å…ˆæ‰§è¡Œä»»åŠ¡ã€‚
    
- å¸¸ç”¨äºï¼š
    
    - è°ƒç”¨ `cmake --build`
        
    - è°ƒç”¨ `make` æˆ– `ninja`
        
    - æ‰§è¡Œ `docker exec` å‘½ä»¤
        
    - è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶
        

ç¤ºä¾‹ï¼š

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Build Project",
      "type": "shell",
      "command": "cmake --build build"
    }
  ]
}
```

âš¡ ç»“åˆ `launch.json`ï¼š

```json
"preLaunchTask": "Build Project"
```

è¿™æ ·è°ƒè¯•å‰ä¼šå…ˆè‡ªåŠ¨ç¼–è¯‘ã€‚

---

## 3. `settings.json` â€”â€” **å·¥ä½œåŒºè®¾ç½®**

- **ç”¨é€”**ï¼šä¿å­˜å½“å‰é¡¹ç›®çš„ VS Code è®¾ç½®ï¼ˆè¦†ç›–å…¨å±€è®¾ç½®ï¼‰ã€‚
    
- ä¸»è¦ä½œç”¨ï¼š
    
    - ä»£ç æç¤ºã€è·¯å¾„è¡¥å…¨ï¼ˆæ¯”å¦‚ C++ çš„ `includePath`ï¼‰
        
    - æ ¼å¼åŒ–è§„åˆ™ï¼ˆclang-formatã€blackï¼‰
        
    - æŒ‡å®šç¼–è¯‘å™¨è·¯å¾„ï¼ˆ`C_Cpp.default.compilerPath`ï¼‰
        
    - è¿œç¨‹å¼€å‘ç›¸å…³å‚æ•°ï¼ˆæ¯”å¦‚ Python è§£é‡Šå™¨ã€CMake kits é…ç½®ï¼‰
        

ç¤ºä¾‹ï¼š

```json
{
  "C_Cpp.default.configurationProvider": "ms-vscode.cmake-tools",
  "editor.formatOnSave": true,
  "files.exclude": {
    "**/build": true
  }
}
```

---

## ğŸ”— æ€»ç»“å¯¹æ¯”

|æ–‡ä»¶å|ä½œç”¨|å¸¸è§å†…å®¹|
|---|---|---|
|`launch.json`|å®šä¹‰è°ƒè¯•æ–¹å¼|å¯æ‰§è¡Œæ–‡ä»¶ã€è°ƒè¯•å™¨ã€å‘½ä»¤è¡Œå‚æ•°|
|`tasks.json`|å®šä¹‰ä»»åŠ¡ï¼ˆå¯è¢«è°ƒè¯•è°ƒç”¨ï¼‰|æ„å»ºå‘½ä»¤ã€è„šæœ¬æ‰§è¡Œã€é¢„å¤„ç†ä»»åŠ¡|
|`settings.json`|å®šä¹‰å·¥ä½œåŒº VS Code è¡Œä¸º|ç¼–è¯‘å™¨è·¯å¾„ã€æ ¼å¼åŒ–ã€æç¤ºã€æ’é™¤é¡¹|

---

ğŸ‘‰ æ¢å¥è¯è¯´ï¼š

- `settings.json` = å‘Šè¯‰ VS Code **æ€ä¹ˆç†è§£ä»£ç **
    
- `tasks.json` = å‘Šè¯‰ VS Code **æ€ä¹ˆæ„å»ºä»£ç **
    
- `launch.json` = å‘Šè¯‰ VS Code **æ€ä¹ˆè¿è¡Œ/è°ƒè¯•ä»£ç **
    

---

è¦ä¸è¦æˆ‘å¸®ä½ ç”»ä¸€ä¸ª **C++ è¿œç¨‹å¼€å‘æ—¶ï¼Œè¿™ä¸‰ä¸ªæ–‡ä»¶çš„å…¸å‹è”åŠ¨æµç¨‹å›¾**ï¼Ÿè¿™æ ·ä½ å°±èƒ½ç›´è§‚ç†è§£æŒ‰ä¸‹ `F5` æ—¶ï¼ŒVS Code èƒŒåä¾æ¬¡ç”¨åˆ°è°ã€‚
## Nginx å’Œredisæœ‰ä»€ä¹ˆåŒºåˆ«
Nginx å’Œ Redis æ˜¯å®Œå…¨ä¸åŒç±»å‹çš„è½¯ä»¶ç³»ç»Ÿï¼Œå®ƒä»¬åˆ†åˆ«è§£å†³ä¸åŒçš„é—®é¢˜ï¼ŒåŠŸèƒ½å’Œç”¨é€”æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚ä¸‹é¢æ˜¯å®ƒä»¬çš„å¯¹æ¯”ï¼š

---

## ğŸ§  ä¸€å¥è¯ç†è§£ï¼š

- **Nginx**ï¼šé«˜æ€§èƒ½çš„ **Web æœåŠ¡å™¨ / åå‘ä»£ç† / è´Ÿè½½å‡è¡¡å™¨**
    
- **Redis**ï¼šé«˜æ€§èƒ½çš„ **å†…å­˜å‹ Key-Value æ•°æ®åº“ / ç¼“å­˜ç³»ç»Ÿ / æ¶ˆæ¯é˜Ÿåˆ—**
    

---

## ğŸ” åŸºæœ¬åŠŸèƒ½å¯¹æ¯”ï¼š

|é¡¹ç›®|Nginx|Redis|
|---|---|---|
|ç±»å‹|WebæœåŠ¡å™¨ / ä»£ç†æœåŠ¡å™¨|æ•°æ®åº“ / ç¼“å­˜ / æ¶ˆæ¯ä¸­é—´ä»¶|
|æ ¸å¿ƒä½œç”¨|å¤„ç† HTTP è¯·æ±‚ï¼Œåå‘ä»£ç†ï¼Œè¯·æ±‚åˆ†å‘|å¿«é€Ÿå­˜å–æ•°æ®ï¼Œä½œä¸ºç¼“å­˜æˆ–æ¶ˆæ¯é˜Ÿåˆ—|
|ä½¿ç”¨åœºæ™¯|ç½‘ç«™å‰ç«¯æœåŠ¡å™¨ã€è´Ÿè½½å‡è¡¡ã€APIç½‘å…³|æ•°æ®ç¼“å­˜ã€ä¼šè¯å­˜å‚¨ã€æ’è¡Œæ¦œã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰|
|æ•°æ®æŒä¹…æ€§|æ— |æ”¯æŒï¼ˆå¯é…ç½®æŒä¹…åŒ–ï¼‰|
|å†…å­˜ä¾èµ–|å¦ï¼ˆä¸»è¦å¤„ç†ç½‘ç»œè¯·æ±‚ï¼‰|æ˜¯ï¼ˆå†…å­˜æ•°æ®åº“ï¼‰|
|åè®®|HTTPã€TCP|è‡ªå®šä¹‰ RESP åè®®ï¼Œå®¢æˆ·ç«¯é€šè¿‡ TCP è¿æ¥ä½¿ç”¨|

---

## âœ… å¸¸è§ç”¨é€”ï¼š

### ğŸ”¸ Nginx ç”¨æ¥åšä»€ä¹ˆï¼š

- é™æ€èµ„æºæœåŠ¡å™¨ï¼ˆå›¾ç‰‡ã€HTMLï¼‰
    
- åå‘ä»£ç†æœåŠ¡å™¨ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨
    
- è´Ÿè½½å‡è¡¡ï¼ˆå¤šä¸ªæœåŠ¡é—´åˆ†å‘è¯·æ±‚ï¼‰
    
- HTTPSç»ˆç«¯ï¼ˆSSLå¸è½½ï¼‰
    
- ç½‘å…³æœåŠ¡çš„ä¸€éƒ¨åˆ†
    

### ğŸ”¸ Redis ç”¨æ¥åšä»€ä¹ˆï¼š

- ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€å•†å“è¯¦æƒ…ï¼‰
    
- å­˜å‚¨ä¼šè¯ï¼ˆsessionï¼‰
    
- åˆ†å¸ƒå¼é”
    
- å®ç°æ¶ˆæ¯é˜Ÿåˆ— / å‘å¸ƒè®¢é˜…ï¼ˆpub/subï¼‰
    
- å®æ—¶æ’è¡Œæ¦œã€è®¡æ•°å™¨ï¼ˆZSet / Incrï¼‰
    

---

## ğŸš€ å®æˆ˜ä¸­çš„ç»„åˆä½¿ç”¨ï¼š

åœ¨å®é™…å¼€å‘ä¸­ï¼Œ**Nginx å’Œ Redis ç»å¸¸ä¼šä¸€èµ·ç”¨**ï¼š

- **å‰ç«¯è¯·æ±‚ â†’ Nginx**ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œè´Ÿè½½å‡è¡¡æˆ–åå‘ä»£ç†åˆ°åç«¯æœåŠ¡ã€‚
    
- **åç«¯æœåŠ¡ â†’ Redis**ï¼šä» Redis ä¸­è¯»å–ç¼“å­˜æ•°æ®ï¼ŒåŠ é€Ÿå“åº”ã€‚
    

---

## æ€»ç»“ï¼š

|å¯¹æ¯”ç‚¹|Nginx|Redis|
|---|---|---|
|ç”¨æ¥å¹²å•¥|å¤„ç†ç½‘ç»œè¯·æ±‚|å¤„ç†æ•°æ®ç¼“å­˜ / é€šè®¯|
|å±äºå“ªä¸ªå±‚é¢|ç½‘ç»œå±‚ã€æœåŠ¡å±‚|æ•°æ®å±‚ã€é€šä¿¡å±‚|
|æ˜¯å¦äº’æ›¿ä»£|âŒ ä¸èƒ½äº’æ›¿|âŒ å®Œå…¨ä¸åŒçš„è§’è‰²|

---

å¦‚æœä½ æƒ³çŸ¥é“åœ¨é¡¹ç›®ä¸­ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Nginxï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Redisï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»™ä½ ä¸€ä¸ªå®é™…é¡¹ç›®åœºæ™¯æ¥è¯´æ˜ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

## Redis æ•™ç¨‹

![[Pasted image 20250521161223.png]]![[Pasted image 20250521161855.png]]
![[Pasted image 20250521204039.png]]
![[Pasted image 20250521204624.png]]
ã€![[Pasted image 20250521205006.png]]
![[Pasted image 20250521205213.png]]
![[Pasted image 20250521205606.png]]
![[Pasted image 20250521210130.png]]

## mysqlæ•°æ®åº“è¡¨è®¾è®¡ï¼Œæˆ‘æœ‰ä¸€æ‰¹å•†å“è®¢å•ï¼Œè®¢å•ä¸­æœ‰å•†å“idï¼Œä¸‹å•å·ï¼Œä¸‹å•æ—¶é—´ï¼Œå•†å“åç§°ï¼Œè¯·è®¾è®¡æ•°æ®è¡¨ï¼Œå“ªä¸ªè®¾è®¡æˆä¸»é”®ï¼Œå“ªä¸ªä¸ºç´¢å¼•ï¼Œå¦‚æœæˆ‘æƒ³æŸ¥è¯¢æŸä¸ªæ—¶é—´çŸ­çš„ä¸‹å•æƒ…å†µï¼Œå¦‚ä½•å†™æŸ¥è¯¢è¯­å¥

è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„è®¢å•è¡¨è®¾è®¡é—®é¢˜ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆç†çš„ MySQL è¡¨ç»“æ„è®¾è®¡ï¼Œé€‚ç”¨äºä½ æè¿°çš„åœºæ™¯ã€‚

---

### âœ… è¡¨ç»“æ„è®¾è®¡ï¼šè®¢å•è¡¨ `orders`

|å­—æ®µå|ç±»å‹|å«ä¹‰|å¤‡æ³¨|
|---|---|---|---|
|`order_id`|BIGINT / VARCHAR|è®¢å•ç¼–å·|âœ… ä¸»é”®|
|`product_id`|INT|å•†å“ ID|å¯åŠ ç´¢å¼•ï¼ˆé€‚åˆæ ¹æ®å•†å“æŸ¥è®¢å•ï¼‰|
|`product_name`|VARCHAR(255)|å•†å“åç§°|å†—ä½™å­—æ®µï¼ˆä»äº§å“è¡¨å¤åˆ¶è¿‡æ¥ï¼‰|
|`order_time`|DATETIME|ä¸‹å•æ—¶é—´|âœ… å¯åŠ ç´¢å¼•ï¼Œæ–¹ä¾¿æ—¶é—´æŸ¥è¯¢|

> ğŸ”‘ **ä¸»é”®é€‰æ‹©ç†ç”±**ï¼š

- `order_id` æ˜¯ä¸šåŠ¡ä¸»é”®ï¼Œé€šå¸¸å”¯ä¸€æ ‡è¯†è®¢å•ï¼Œé€‚åˆä½œä¸ºè¡¨çš„ä¸»é”®ã€‚
    

> ğŸ“Œ **ç´¢å¼•è®¾è®¡å»ºè®®**ï¼š

- ç»™ `order_time` æ·»åŠ ç´¢å¼•ï¼Œä¾¿äºæŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢ã€‚
    
- å¯è§†ä¸šåŠ¡éœ€è¦å†ä¸º `product_id` æ·»åŠ è¾…åŠ©ç´¢å¼•ã€‚
    

---

### âœ… åˆ›å»ºè¡¨ SQL ç¤ºä¾‹

```sql
CREATE TABLE orders (
    order_id VARCHAR(64) PRIMARY KEY,
    product_id INT NOT NULL,
    product_name VARCHAR(255),
    order_time DATETIME NOT NULL,
    INDEX idx_order_time (order_time),
    INDEX idx_product_id (product_id)
);
```

---

### ğŸ” æŸ¥è¯¢æŸä¸ªæ—¶é—´æ®µçš„ä¸‹å•æƒ…å†µ

æ¯”å¦‚ä½ æƒ³æŸ¥è¯¢ **2024-01-01 åˆ° 2024-01-31** ä¹‹é—´çš„æ‰€æœ‰è®¢å•ï¼š

```sql
SELECT * FROM orders
WHERE order_time BETWEEN '2024-01-01 00:00:00' AND '2024-01-31 23:59:59';
```

å¦‚æœä½ åªéœ€è¦ç»Ÿè®¡ä¸‹å•æ•°é‡ï¼š

```sql
SELECT COUNT(*) FROM orders
WHERE order_time BETWEEN '2024-01-01 00:00:00' AND '2024-01-31 23:59:59';
```

---

### ğŸ è¡¥å……å»ºè®®ï¼ˆå¯é€‰ï¼‰ï¼š

- è‹¥æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œå¯åŠ  `user_id` å­—æ®µã€‚
    
- è‹¥å•†å“ä¿¡æ¯æ˜¯ç‹¬ç«‹ç»´æŠ¤çš„ï¼Œ`product_name` åº”ä» `products` è¡¨å…³è”æŸ¥å‡ºï¼Œè€Œéå­˜å†—ä½™å­—æ®µã€‚
    
- è‹¥è®¢å•é‡å·¨å¤§ï¼Œå¯ä»¥è€ƒè™‘æŒ‰æ—¶é—´åˆ†åŒºè¡¨ï¼ˆå¦‚æŒ‰æœˆåˆ†åŒºï¼‰ã€‚
    

æ˜¯å¦è¿˜éœ€è¦åŠ ä¸Šè®¢å•çŠ¶æ€ã€ä»·æ ¼ç­‰å­—æ®µï¼Ÿæˆ‘å¯ä»¥ç»§ç»­å¸®ä½ ä¼˜åŒ–è®¾è®¡ã€‚

## å»ºç«‹ç´¢å¼•çš„åŸåˆ™æ˜¯ä»€ä¹ˆï¼Œç´¢å¼•æˆ–è€…ä¸»é”®å¿…é¡»ä¸ºæ•°å­—ç±»å‹å—

å»ºç«‹ç´¢å¼•å’Œä¸»é”®çš„è®¾è®¡ç¡®å®æœ‰ä¸€äº›åŸåˆ™å¯ä»¥éµå¾ªï¼Œä½†å®ƒä»¬**å¹¶ä¸è¦æ±‚å¿…é¡»æ˜¯æ•°å­—ç±»å‹**ã€‚ä¸‹é¢æˆ‘æ¥ç³»ç»Ÿåœ°å›ç­”ä½ çš„ä¸¤ä¸ªé—®é¢˜ï¼š

---

## âœ… ä¸€ã€å»ºç«‹ç´¢å¼•çš„åŸåˆ™

### ğŸ”¹ 1. **é¢‘ç¹ç”¨äºæŸ¥è¯¢æ¡ä»¶ï¼ˆWHEREï¼‰çš„å­—æ®µ**

- å¦‚ï¼šæ—¶é—´ã€çŠ¶æ€ã€ç”¨æˆ·IDã€è®¢å•IDç­‰ã€‚
    
- ç¤ºä¾‹ï¼š`SELECT * FROM orders WHERE order_time BETWEEN ...`
    

### ğŸ”¹ 2. **ç”¨äºè¿æ¥ï¼ˆJOINï¼‰çš„å­—æ®µ**

- æ•°æ®è¡¨ä¹‹é—´é€šè¿‡æŸä¸ªå­—æ®µå…³è”æ—¶ï¼Œåº”åœ¨è¯¥å­—æ®µä¸Šå»ºç´¢å¼•ã€‚
    
- ç¤ºä¾‹ï¼šè®¢å•è¡¨çš„ `product_id` ä¸å•†å“è¡¨çš„ `id` è¿›è¡Œ `JOIN`ã€‚
    

### ğŸ”¹ 3. **ç”¨äºæ’åºï¼ˆORDER BYï¼‰æˆ–åˆ†ç»„ï¼ˆGROUP BYï¼‰çš„å­—æ®µ**

- ç¤ºä¾‹ï¼š`ORDER BY order_time DESC` æ—¶ï¼Œ`order_time` å»ºç´¢å¼•æœ‰åˆ©äºæå‡æ•ˆç‡ã€‚
    

### ğŸ”¹ 4. **é€‰æ‹©æ€§é«˜çš„å­—æ®µ**

- æ¯”å¦‚æ€§åˆ«åªæœ‰ç”·å¥³ï¼Œä¸å»ºè®®å»ºç´¢å¼•ï¼›ä½† `user_id`ã€`order_id` çš„å€¼åˆ†å¸ƒç¨€ç–ï¼Œé€‰æ‹©æ€§é«˜ï¼Œé€‚åˆç´¢å¼•ã€‚
    

### ğŸ”¹ 5. **ç»„åˆç´¢å¼•ä¼˜å…ˆé¡ºåºéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™**

- ç»„åˆç´¢å¼• `(a, b, c)`ï¼Œæ”¯æŒ `WHERE a=...`ã€`a AND b=...`ã€`a AND b AND c=...`ã€‚
    
- ä¸æ”¯æŒ `WHERE b=...`ã€‚
    

---

## âœ… äºŒã€ä¸»é”®/ç´¢å¼•æ˜¯å¦å¿…é¡»ä¸ºæ•°å­—ç±»å‹ï¼Ÿ

**ä¸æ˜¯å¿…é¡»æ˜¯æ•°å­—ç±»å‹ï¼**

### âœ… ä¸»é”®å’Œç´¢å¼•å¯ä»¥æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼š

- `VARCHAR` ç±»å‹çš„ä¸»é”®/ç´¢å¼•æ˜¯å…è®¸çš„ï¼Œå°¤å…¶åœ¨ä¸šåŠ¡ä¸­ï¼š
    
    - å¦‚ï¼šè®¢å•å·ï¼ˆ`ORD20240522001`ï¼‰
        
    - ç”¨æˆ·åï¼ˆ`"zhangsan"`ï¼‰
        

### ğŸ”º ä½†ä¸ºä»€ä¹ˆé€šå¸¸æ¨èä½¿ç”¨æ•°å­—ç±»å‹ï¼Ÿ

1. **æ•°å­—å¯¹æ¯”é€Ÿåº¦å¿«**ï¼ˆCPU å±‚é¢ä¼˜åŒ–ï¼‰
    
2. **æ•°å­—å ç”¨ç©ºé—´å°**ï¼ˆä¾‹å¦‚ `INT` æ˜¯ 4 å­—èŠ‚ï¼Œè€Œå­—ç¬¦ä¸²æ˜¯å˜é•¿çš„ï¼‰
    
3. **B+ æ ‘ç´¢å¼•æ›´é«˜æ•ˆ**
    
4. **è‡ªå¢æ•°å­—ä¸»é”®å¯é¿å…ç¢ç‰‡åŒ–**
    

---

## âœ… å®è·µå»ºè®®

|ä½¿ç”¨åœºæ™¯|ç´¢å¼•å­—æ®µå»ºè®®ç±»å‹|
|---|---|
|è‡ªå¢ä¸»é”®|`INT` / `BIGINT`|
|è®¢å•ç¼–å·|`VARCHAR` å¯æ¥å—|
|ç”¨æˆ· ID|`INT` æœ€ä½³|
|æ—¶é—´å­—æ®µ|`DATETIME` å¹¶åŠ ç´¢å¼•|
|çŠ¶æ€å­—æ®µï¼ˆå¦‚çŠ¶æ€ç ï¼‰|`TINYINT`ï¼Œé€‰æ‹©æ€§é«˜å¯åŠ ç´¢å¼•|

---

éœ€è¦æˆ‘å¸®ä½ åˆ†ææŸä¸ªè¡¨å­—æ®µæ˜¯å¦åº”è¯¥åŠ ç´¢å¼•å—ï¼Ÿä½ å¯ä»¥æŠŠå­—æ®µåˆ—ç»™æˆ‘ï¼Œæˆ‘æ¥å¸®ä½ è®¾è®¡ç´¢å¼•ç­–ç•¥ã€‚

2025/05/27
## tomcatæ˜¯ä»€ä¹ˆ
ä½ å¯èƒ½æ˜¯æƒ³é—® **Tomcat**ï¼ˆæ³¨æ„æ‹¼å†™æ˜¯ **Tomcat** è€Œä¸æ˜¯ â€œtomacatâ€ï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨ Java å¼€å‘ä¸­éå¸¸å¸¸è§çš„å·¥å…·ã€‚ä¸‹é¢æ˜¯ç®€å•æ˜äº†çš„è§£é‡Šï¼š

---

## ğŸ± Tomcat æ˜¯ä»€ä¹ˆï¼Ÿ

**Apache Tomcat** æ˜¯ä¸€ä¸ªç”± Apache è½¯ä»¶åŸºé‡‘ä¼šå¼€å‘å’Œç»´æŠ¤çš„ï¼š

> âœ… **å¼€æº Java Web æœåŠ¡å™¨ï¼ˆServlet å®¹å™¨ï¼‰**

---

## ğŸ“¦ ç”¨é€”

Tomcat çš„ä¸»è¦ä½œç”¨æ˜¯ï¼š

- è¿è¡Œ Java Web åº”ç”¨ï¼ˆæ¯”å¦‚ JSP é¡µé¢ã€Servlet ç¨‹åºï¼‰
    
- æ”¯æŒ Java EE çš„ Web ç»„ä»¶è§„èŒƒï¼ˆå¦‚ï¼šServletã€JSPã€WebSocketï¼‰
    
- æä¾› HTTP Web æœåŠ¡ï¼ˆå¯ä»¥åƒä¸€ä¸ªè½»é‡çº§ç½‘ç«™æœåŠ¡å™¨ä½¿ç”¨ï¼‰
    

---

## ğŸ§© ä¸¾ä¸ªä¾‹å­ï¼š

ä½ æœ‰ä¸€ä¸ªç”¨ Java å†™çš„ç½‘é¡µç¨‹åºï¼ˆ.jsp æ–‡ä»¶ï¼‰ï¼Œæˆ–è€…ä¸€ä¸ª Java åç«¯æ¥å£ï¼ˆServlet ç±»ï¼‰ï¼ŒTomcat å°±æ˜¯ä½ éƒ¨ç½²è¿™äº›ä¸œè¥¿çš„æœåŠ¡å™¨å¹³å°ã€‚

ä½ å¯åŠ¨ Tomcatï¼š

- æµè§ˆå™¨è®¿é—® `http://localhost:8080`ï¼Œå°±èƒ½çœ‹åˆ°ä½ å†™çš„ Web é¡µé¢åœ¨è¿è¡Œã€‚
    

---

## ğŸ”§ å¸¸ç”¨äºï¼š

| åœºæ™¯               | æ˜¯å¦ä½¿ç”¨ Tomcat               |
| ---------------- | ------------------------- |
| Java Web é¡¹ç›®å¼€å‘    | âœ… å¸¸ç”¨                      |
| å­¦ä¹  Servlet / JSP | âœ… æ¨è                      |
| Spring Boot é¡¹ç›®   | âœ… Spring Boot å†…åµŒäº† Tomcat  |
| çº¯é™æ€ç½‘é¡µ            | âŒ ä¸æ¨èï¼ˆç”¨ Nginxã€Apache æ›´åˆé€‚ï¼‰ |

---

## ğŸ§  æ€»ç»“ä¸€å¥è¯ï¼š

> ğŸ± **Tomcat æ˜¯ä¸€ä¸ªè¿è¡Œ Java Web åº”ç”¨çš„è¿·ä½ ç½‘ç«™æœåŠ¡å™¨ï¼Œå¼€å‘ã€éƒ¨ç½² Java ç½‘ç«™ç¨‹åºéƒ½ä¼šç”¨åˆ°å®ƒã€‚**

---

å¦‚æœä½ æ˜¯ Java åˆå­¦è€…ï¼Œæƒ³äº²è‡ªè¯•è¯• Tomcatï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„ç³»ç»Ÿï¼Œæˆ‘å¯ä»¥æ•™ä½ å¦‚ä½•ä¸‹è½½ã€å®‰è£…å¹¶è¿è¡Œä¸€ä¸ªç®€å•çš„ JSP ç¤ºä¾‹ã€‚æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ é…ç½®ä¸€æ¬¡ï¼Ÿ

## tomcatå’Œnginxä¸€æ ·å—
**Tomcat å’Œ Nginx** æ˜¯å®Œå…¨ä¸åŒç±»å‹çš„æœåŠ¡å™¨ï¼Œè™½ç„¶å®ƒä»¬éƒ½å¯ä»¥ç”¨äºæ„å»ºç½‘ç«™æœåŠ¡ï¼Œä½†**ç”¨é€”ã€å®šä½å’Œå·¥ä½œæ–¹å¼ä¸ä¸€æ ·**ã€‚

---

## ğŸ” ä¸€å¥è¯å¯¹æ¯”ï¼š

> **Tomcat æ˜¯ä¸€ä¸ª Java Web åº”ç”¨æœåŠ¡å™¨**ï¼Œè¿è¡Œ Javaï¼ˆServletã€JSPï¼‰ç¨‹åºï¼›  
> **Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„åå‘ä»£ç†æœåŠ¡å™¨**ï¼Œä¸“æ³¨äºè½¬å‘è¯·æ±‚ã€å¤„ç†é™æ€èµ„æºã€è´Ÿè½½å‡è¡¡ç­‰ã€‚

---

## ğŸ§© æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”ï¼š

| ç‰¹æ€§/ç”¨é€”    | **Tomcat**             | **Nginx**                          |
| -------- | ---------------------- | ---------------------------------- |
| ç±»å‹       | åº”ç”¨æœåŠ¡å™¨ï¼ˆJava Servlet å®¹å™¨ï¼‰ | Web æœåŠ¡å™¨ & åå‘ä»£ç†æœåŠ¡å™¨                  |
| å¸¸ç”¨è¯­è¨€æ”¯æŒ   | Javaï¼ˆJSPã€Servletï¼‰      | PHPã€Pythonã€Node.jsï¼ˆé€šè¿‡ FastCGI æˆ–ä»£ç†ï¼‰ |
| é™æ€æ–‡ä»¶å¤„ç†   | æœ‰ï¼Œä½†æ€§èƒ½è¾ƒå·®                | éå¸¸å¼ºï¼Œé€Ÿåº¦å¿«ï¼Œå ç”¨èµ„æºå°‘                      |
| åŠ¨æ€åº”ç”¨æ”¯æŒ   | âœ… Java åŠ¨æ€ç½‘é¡µ            | âŒ æœ¬èº«ä¸æ‰§è¡Œä»£ç ï¼Œéœ€ä»£ç†ç»™åç«¯æœåŠ¡                 |
| ä½¿ç”¨åœºæ™¯     | Java Web é¡¹ç›®éƒ¨ç½²          | é™æ€ç½‘ç«™ã€åå‘ä»£ç†ã€HTTPSã€è´Ÿè½½å‡è¡¡               |
| æ€§èƒ½       | ç›¸å¯¹ä¸€èˆ¬ï¼Œä¸»è¦ç”¨äºä¸šåŠ¡é€»è¾‘          | é«˜æ€§èƒ½ï¼Œèƒ½å¤„ç†é«˜å¹¶å‘                         |
| åå‘ä»£ç†èƒ½åŠ›   | å¼±                      | å¼ºï¼ˆæ”¯æŒè´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€é˜²æ”»å‡»ç­‰ï¼‰                  |
| æ˜¯å¦æ”¯æŒ JSP | âœ… æ”¯æŒ                   | âŒ ä¸æ”¯æŒ                              |

---

## ğŸ§  ä¸¾ä¸ªä¾‹å­ï¼š

ä½ æœ‰ä¸€ä¸ª Java å†™çš„åå°é¡¹ç›®ï¼š

- **Tomcat**ï¼šè¿è¡Œä½ çš„ Java ä»£ç ï¼ˆæ¯”å¦‚ `/login` ç™»å½•æ¥å£ï¼‰
    
- **Nginx**ï¼šä½œä¸ºâ€œé—¨é¢â€æœåŠ¡å™¨ï¼Œå¤„ç†é™æ€é¡µé¢ã€è½¬å‘ `/api` è¯·æ±‚ç»™ Tomcatï¼Œè¿˜èƒ½åŠ  HTTPS
    

ğŸ“Œ çœŸå®é¡¹ç›®ä¸­ç»å¸¸ **Tomcat å’Œ Nginx é…åˆä½¿ç”¨**ï¼š

```text
ç”¨æˆ·æµè§ˆå™¨ â†’ Nginxï¼ˆåå‘ä»£ç†ï¼‰â†’ Tomcatï¼ˆå¤„ç† Java ä¸šåŠ¡é€»è¾‘ï¼‰
```

---

## âœ… æ€»ç»“ï¼š

|ä½ æƒ³åšä»€ä¹ˆ|æ¨è|
|---|---|
|è·‘ Java Web é¡¹ç›®|Tomcat|
|æ­å»ºé«˜æ€§èƒ½ç½‘ç«™ã€é™æ€é¡µé¢ã€åå‘ä»£ç†ã€SSL|Nginx|
|Java é¡¹ç›® + é™æ€å‰ç«¯ç½‘ç«™|Tomcat + Nginx é…åˆä½¿ç”¨|

---

å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ æ­£åœ¨å¼€å‘çš„æ˜¯ Java é¡¹ç›®ã€é™æ€ç½‘ç«™ã€è¿˜æ˜¯ Node.jsã€Python åå°ï¼Œæˆ‘å¯ä»¥å…·ä½“æ¨èç”¨å“ªä¸ªæ›´åˆé€‚ã€‚éœ€è¦æˆ‘å¸®ä½ è®¾è®¡ä¸€ä¸‹éƒ¨ç½²æ–¹æ¡ˆå—ï¼Ÿ

## å½“æˆ‘è®¿é—®nginxæ—¶ï¼Œnginxä¼šæŠŠæˆ‘è‡ªå®šä¹‰çš„indexç½‘é¡µå±•ç¤ºåœ¨æµè§ˆå™¨ä¸Šï¼Œtomcatæ˜¯è¿™æ ·å·¥ä½œçš„å—
ä½ é—®å¾—éå¸¸å¥½ï¼æˆ‘ä»¬æ¥ç›´æ¥å¯¹æ¯”å›ç­”ï¼š

---

## âœ… **ç»“è®ºå…ˆè¯´ï¼š**

> **Tomcat å’Œ Nginx ä¸ä¸€æ ·ï¼ŒTomcat ä¸ä¼šé»˜è®¤å±•ç¤ºä½ è‡ªå®šä¹‰çš„ index é¡µé¢ï¼Œé™¤éä½ æŠŠé¡¹ç›®éƒ¨ç½²æˆ Java Web åº”ç”¨ï¼ˆæ¯”å¦‚ WAR åŒ…ï¼‰å¹¶æ”¾åœ¨æ­£ç¡®ä½ç½®ã€‚**

---

## ğŸ” ä¸€æ­¥æ­¥è§£é‡Šï¼š

### ğŸ”¸ **Nginx çš„é»˜è®¤è¡Œä¸ºï¼š**

- å®ƒæ˜¯ä¸ª **é™æ€ Web æœåŠ¡å™¨**ã€‚
    
- ä½ åœ¨ `nginx.conf` æˆ– `default.conf` ä¸­è®¾ç½®ï¼š
    
    ```nginx
    location / {
        root /var/www/html;
        index index.html;
    }
    ```
    
- åªè¦ä½ æŠŠ `index.html` æ”¾åˆ°å¯¹åº”è·¯å¾„ï¼Œå®ƒå°±ä¼š**ç›´æ¥æ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸Š**ã€‚
    

---

### ğŸ”¸ **Tomcat çš„å·¥ä½œåŸç†ä¸ä¸€æ ·ï¼š**

- å®ƒæ˜¯ä¸€ä¸ª **Java åº”ç”¨æœåŠ¡å™¨**ï¼Œä¸“é—¨è¿è¡Œ **Servletã€JSPã€SpringBoot ç­‰ Java Web åº”ç”¨**ã€‚
    
- å®ƒä¸ä¼šè‡ªåŠ¨æŠŠä½ éšä¾¿æ”¾è¿›å»çš„ `index.html` å½“ä½œé¦–é¡µæ¥æ˜¾ç¤ºï¼Œé™¤éä½ ï¼š
    
    - æŠŠç½‘é¡µæ”¾åˆ° `/webapps/ROOT/` ç›®å½•ä¸‹
        
    - æˆ–è€…æŠŠä½ çš„é¡¹ç›®æ‰“æˆä¸€ä¸ª `.war` æ–‡ä»¶ï¼Œæ”¾è¿› `webapps/` ä¸­
        
    - å¹¶ä¸”åœ¨ `web.xml` ä¸­å®šä¹‰é»˜è®¤é¡µé¢ï¼ˆå¦‚ `index.html`ï¼‰
        

---

## ğŸ”§ ä¸¾ä¸ªä¾‹å­ï¼š

### âœ… ä½ æƒ³è®© Tomcat æ˜¾ç¤ºä¸€ä¸ªç®€å•ç½‘é¡µï¼š

1. æŠŠä½ å†™å¥½çš„ç½‘é¡µæ–‡ä»¶ `index.html` æ”¾åˆ°ï¼š
    
    ```
    {Tomcatå®‰è£…ç›®å½•}/webapps/ROOT/index.html
    ```
    
2. è®¿é—®ï¼š
    
    ```
    http://localhost:8080/
    ```
    
3. å°±èƒ½çœ‹åˆ°ä½ çš„ç½‘é¡µäº†ã€‚
    

---

## ğŸš€ è¡¥å……è¯´æ˜ï¼š

|åŠŸèƒ½|Nginx|Tomcat|
|---|---|---|
|æ”¯æŒé™æ€ç½‘é¡µ|âœ… é»˜è®¤æ”¯æŒ|âœ… ä½†éœ€æ”¾å¯¹ä½ç½®|
|æ”¯æŒåŠ¨æ€ç½‘é¡µ|âŒ éœ€è¦ä»£ç†åç«¯æœåŠ¡|âœ… æ”¯æŒ JSP/Servlet/Spring Boot|
|é»˜è®¤é¦–é¡µæœºåˆ¶|è¯»å–é…ç½®ä¸­çš„ index.html|ä¾èµ–éƒ¨ç½²åœ¨ ROOT ä¸‹çš„ index é¡µé¢|

---

## âœ… æ€»ç»“ï¼š

- **Nginx**ï¼šä½ æ”¾ä¸ª `index.html`ï¼Œå°±èƒ½ç›´æ¥å±•ç¤ºï¼Œé€‚åˆå‰ç«¯ç½‘ç«™ã€‚
    
- **Tomcat**ï¼šå®ƒæ˜¯ä¸º Java Web åº”ç”¨å‡†å¤‡çš„ï¼Œéœ€è¦ä½ éƒ¨ç½² Web é¡¹ç›®ï¼ˆæˆ–æ”¾åœ¨ `webapps/ROOT/`ï¼‰ã€‚
    

---

å¦‚æœä½ åªæ˜¯æƒ³å±•ç¤ºä¸€ä¸ªé™æ€ç½‘é¡µï¼Œå»ºè®®ä½¿ç”¨ **Nginx**ï¼›  
å¦‚æœä½ å¼€å‘çš„æ˜¯ Java ç½‘ç«™ï¼ˆSpring Boot ç­‰ï¼‰ï¼Œç”¨ **Tomcat** æ›´åˆé€‚ã€‚

å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥æ•™ä½ å¦‚ä½•æŠŠè‡ªå·±çš„é™æ€ç½‘é¡µéƒ¨ç½²åˆ° Tomcat ä¸Šï¼Œæˆ–è€… Nginx+Tomcat é…åˆä½¿ç”¨ä¹Ÿå¯ä»¥ã€‚éœ€è¦å—ï¼Ÿ
## javaå†™çš„ä»£ç éš¾é“ä¸æ˜¯è¿è¡Œåœ¨javaè™šæ‹Ÿæœºä¸Šçš„å—ï¼Ÿä¸ºä»€ä¹ˆTomcatä¹Ÿèƒ½è·‘java webé¡¹ç›®å‘¢
å®Œå…¨æ­£ç¡®ï¼ŒJava ä»£ç æ˜¯è¿è¡Œåœ¨ **Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰** ä¸Šçš„ï¼Œä½†è¿™å’Œ Tomcat èƒ½è·‘ Java Web é¡¹ç›®å¹¶ä¸å†²çªã€‚æˆ‘ä»¬ä¸€æ­¥æ­¥æ‹†å¼€è§£é‡Šï¼š

---

### 1ï¸âƒ£ Java ä»£ç å’Œ JVM

- Java ç¨‹åºç¼–è¯‘åç”Ÿæˆ **å­—èŠ‚ç ï¼ˆ.class æ–‡ä»¶ï¼‰**
    
- JVM è´Ÿè´£è§£é‡Šæˆ–å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰è¿™äº›å­—èŠ‚ç ï¼Œè®©å®ƒä»¬åœ¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ
    
- JVM æŠŠ Java ç¨‹åºâ€œç¿»è¯‘â€æˆæ“ä½œç³»ç»Ÿå¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤
    

æ¢å¥è¯è¯´ï¼ŒJava ç¨‹åºæœ¬èº«å¹¶ä¸ç›´æ¥å’Œæ“ä½œç³»ç»Ÿæ‰“äº¤é“ï¼Œéƒ½æ˜¯é€šè¿‡ JVM æ¥é—´æ¥è¿è¡Œçš„ã€‚

---

### 2ï¸âƒ£ Tomcat æ˜¯ä»€ä¹ˆï¼Ÿ

- **Tomcat** æ˜¯ä¸€ä¸ª **Java å†™çš„åº”ç”¨æœåŠ¡å™¨**ï¼ˆServlet å®¹å™¨ï¼‰
    
- å®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª Java ç¨‹åºï¼Œæ‰€ä»¥è¦åœ¨ JVM ä¸Šè¿è¡Œ
    
- å®ƒæä¾›äº† Web æœåŠ¡çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š
    
    - æ¥æ”¶ HTTP è¯·æ±‚
        
    - è°ƒç”¨ä½ çš„ Servlet æˆ– JSP ä»£ç 
        
    - è¿”å› HTTP å“åº”
        

ä¹Ÿå°±æ˜¯è¯´ï¼ŒTomcat æ˜¯ä¸€ä¸ª â€œè¿è¡Œåœ¨ JVM ä¸Šçš„ Java ç¨‹åºâ€ï¼Œå®ƒä¸“é—¨è´Ÿè´£ **ç®¡ç†å’Œè¿è¡Œä½ çš„ Java Web é¡¹ç›®**ã€‚

---

### 3ï¸âƒ£ Tomcat æ€ä¹ˆè·‘ä½ çš„ Web é¡¹ç›®

1. ä½ å†™ä¸€ä¸ª Java Web é¡¹ç›®ï¼ˆåŒ…å« Servletã€JSPã€ä¾èµ–åº“ç­‰ï¼‰ï¼Œæ‰“åŒ…æˆ **WAR æ–‡ä»¶**
    
2. Tomcat å¯åŠ¨ï¼ˆåœ¨ JVM ä¸Šè¿è¡Œï¼‰
    
3. Tomcat æŠŠ WAR éƒ¨ç½²åˆ°å®ƒçš„ Web å®¹å™¨é‡Œ
    
4. å½“æœ‰ HTTP è¯·æ±‚åˆ°è¾¾ Tomcatï¼š
    
    - Tomcat è°ƒç”¨å¯¹åº”çš„ Servlet æˆ– JSP
        
    - JVM æ‰§è¡Œè¿™äº› Java ä»£ç 
        
    - è¿”å›å¤„ç†ç»“æœç»™å®¢æˆ·ç«¯
        

æ‰€ä»¥ï¼Œè™½ç„¶ Java æ˜¯è¿è¡Œåœ¨ JVM ä¸Šï¼Œä½† **JVM å¯ä»¥è¿è¡Œ Tomcatï¼Œè€Œ Tomcat åˆå¯ä»¥è¿è¡Œä½ çš„ Java Web é¡¹ç›®**ã€‚

---

### ğŸ”¹ æ€»ç»“

- **Java ç¨‹åº â†’ JVM æ‰§è¡Œ**
    
- **Tomcat â†’ JVM ä¸Šçš„ Web æœåŠ¡å™¨ç¨‹åº**
    
- **Java Web é¡¹ç›® â†’ éƒ¨ç½²åœ¨ Tomcat â†’ JVM æ‰§è¡Œ**
    

é€»è¾‘å…³ç³»å¯ä»¥æƒ³è±¡æˆä¸€æ¡é“¾ï¼š

```
æ“ä½œç³»ç»Ÿ
   â†“
JVMï¼ˆè™šæ‹Ÿæœºï¼‰
   â†“
Tomcatï¼ˆWeb å®¹å™¨ï¼‰
   â†“
ä½ çš„ Java Web é¡¹ç›®ï¼ˆServlet/JSPï¼‰
```

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç”»ä¸€å¼  **Tomcat + JVM + Java Web é¡¹ç›®çš„è¿è¡Œæµç¨‹å›¾**ï¼Œè®©è¿™ä¸ªé“¾æ¡ä¸€ç›®äº†ç„¶ã€‚

ä½ å¸Œæœ›æˆ‘ç”»å—ï¼Ÿ
## åœ¨é˜¿é‡Œäº‘ä¸Šä¹°äº†ä¸ªåŸŸåwww.lalala.comï¼Œç„¶åå°†è¯¥åŸŸåæ˜ å°„ipåœ°å€æ—¶ï¼Œæˆ‘è®¾ç½®ä¸ºæœ¬åœ°èƒ½ä¸Šç½‘çš„ç”µè„‘çš„ipåœ°å€ï¼Œæ¯”å¦‚ä¸º192.168.1.101  è¿™æ ·çš„è®¾ç½®æ˜¯å¦åˆ«äººå¯ä»¥é€šè¿‡è®¿é—®www.lalala.comè®¿é—®åˆ°æœ¬åœ°èƒ½ä¸Šç½‘çš„ç”µè„‘é‡Œé¢è¿è¡Œçš„æœåŠ¡å™¨
ä¸èƒ½ã€‚ä½ å°†åŸŸå `www.lalala.com` æ˜ å°„ä¸º **192.168.1.101** æ˜¯**æ— æ•ˆçš„å…¬ç½‘æ˜ å°„**ï¼Œ**å¤–ç½‘ç”¨æˆ·æ— æ³•è®¿é—®ä½ æœ¬åœ°çš„æœåŠ¡å™¨**ï¼ŒåŸå› å¦‚ä¸‹ï¼š

---

## ğŸ” åŸå› è§£æ

### âŒ 1. `192.168.x.x` æ˜¯ç§æœ‰ IPï¼Œå¤–éƒ¨æ— æ³•è®¿é—®

`192.168.1.101` æ˜¯ä½ **å±€åŸŸç½‘å†…çš„ç§æœ‰ IP**ï¼Œåœ¨äº’è”ç½‘ä¸Šå¹¶ä¸é€šç”¨ï¼Œä¹Ÿæ— æ³•è¢«å¤–ç½‘è¯†åˆ«æˆ–è®¿é—®ã€‚

å¤–ç½‘ç”¨æˆ·æ— æ³•è®¿é—®ä»»ä½•ç§æœ‰ IP åœ°å€æ®µï¼Œä¾‹å¦‚ï¼š

- `192.168.x.x`
    
- `10.x.x.x`
    
- `172.16.x.x ~ 172.31.x.x`
    

---

### âŒ 2. ä½ æœ¬åœ°çš„ç”µè„‘å¯èƒ½åœ¨ NAT/é˜²ç«å¢™/è·¯ç”±å™¨åé¢

å°±ç®—ä½ æƒ³è®©åˆ«äººè®¿é—®æœ¬åœ°ç”µè„‘ï¼Œä½ ä¹Ÿé¢ä¸´ä¸‹é¢é—®é¢˜ï¼š

- è·¯ç”±å™¨å¹¶ä¸ä¼šæŠŠåŸŸåæŒ‡å‘çš„è¯·æ±‚**è‡ªåŠ¨è½¬å‘åˆ°ä½ æœ¬åœ°ç”µè„‘**ï¼›
    
- é»˜è®¤æƒ…å†µä¸‹ï¼Œ**æ²¡æœ‰ç«¯å£æ˜ å°„ï¼ˆPort Forwardingï¼‰**ï¼›
    
- ä½ çš„ç”µè„‘ç³»ç»Ÿã€è·¯ç”±å™¨ã€é˜²ç«å¢™ã€ISPï¼ˆç½‘ç»œæä¾›å•†ï¼‰å¯èƒ½éƒ½åšäº†**é˜»æ–­**ã€‚
    

---

## âœ… æ­£ç¡®åšæ³•ï¼šè®©åˆ«äººé€šè¿‡åŸŸåè®¿é—®ä½ æœ¬åœ°æœåŠ¡å™¨

### æ–¹æ³•ä¸€ï¼šå°†åŸŸåè§£æä¸ºä½ çš„ **å…¬ç½‘ IP**

1. æŸ¥çœ‹ä½ çš„å…¬ç½‘ IPï¼Œå¯ä»¥å» [ip.cn](https://ip.cn/)ã€‚
    
2. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å° â†’ æ‰¾åˆ°ä½ ä¹°çš„åŸŸå â†’ æ·»åŠ  `Aè®°å½•`ï¼Œå¡«å†™ä½ çš„å…¬ç½‘ IPã€‚
    
    - ä¸»æœºè®°å½•ï¼š`www`
        
    - è®°å½•ç±»å‹ï¼š`A`
        
    - è®°å½•å€¼ï¼šä½ çš„å…¬ç½‘ IPï¼Œæ¯”å¦‚ `123.123.123.123`
        
3. åœ¨ä½ çš„è·¯ç”±å™¨ä¸­è®¾ç½®ç«¯å£æ˜ å°„ï¼ˆæ¯”å¦‚æŠŠå¤–éƒ¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä½ æœ¬åœ°ç”µè„‘çš„ 80 ç«¯å£ï¼‰ã€‚
    
4. ç¡®ä¿ä½ ç”µè„‘è¿è¡Œäº† Web æœåŠ¡ï¼ˆä¾‹å¦‚ nginxã€http-server ç­‰ï¼‰å¹¶ç›‘å¬å¯¹åº”ç«¯å£ã€‚
    
5. å…³é—­é˜²ç«å¢™æˆ–å¼€æ”¾æœåŠ¡ç«¯å£ã€‚
    

### æ–¹æ³•äºŒï¼šä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·ï¼ˆé€‚åˆæ²¡æœ‰å…¬ç½‘ IP çš„æƒ…å†µï¼‰

å¦‚æœä½ æ²¡æœ‰å…¬ç½‘ IPï¼Œå¯ä»¥ä½¿ç”¨**å†…ç½‘ç©¿é€æœåŠ¡**ï¼Œä¾‹å¦‚ï¼š

- [Frp](https://github.com/fatedier/frp)
    
- [Ngrok](https://ngrok.com/)
    
- [natapp](https://natapp.cn/)
    
- [èŠ±ç”Ÿå£³](https://hsk.oray.com/)
    

å®ƒä»¬æä¾›ä¸€ä¸ªå…¬ç½‘ä¸­è½¬æœåŠ¡å™¨ï¼Œä½ å¯ä»¥å°†å®ƒå’Œä½ çš„æœ¬åœ°æœåŠ¡ç»‘å®šèµ·æ¥ï¼Œä»è€Œå®ç°è®©å¤–ç½‘è®¿é—®ã€‚

---

## ğŸš« å°ç»“ï¼šä½ çš„è®¾ç½®ä¸ºä»€ä¹ˆä¸è¡Œï¼Ÿ

|é¡¹ç›®|æ­£ç¡®æƒ…å†µ|ä½ çš„è®¾ç½®|
|---|---|---|
|åŸŸåæŒ‡å‘å…¬ç½‘ IP|âœ… å¿…é¡»|âŒ æŒ‡å‘äº†å±€åŸŸç½‘åœ°å€|
|ç«¯å£æ˜ å°„|âœ… å¿…é¡»è®¾ç½®|âŒ æ²¡æœ‰è®¾ç½®|
|æœ¬åœ°æœåŠ¡å™¨å¼€å¯|âœ… ç›‘å¬åœ¨æ­£ç¡®ç«¯å£|â“ ä¸ç¡®å®š|
|ä½¿ç”¨å…¬ç½‘ç¯å¢ƒ|âœ… æ‹¥æœ‰å…¬ç½‘ IP|âŒ å¯èƒ½æ²¡æœ‰å…¬ç½‘ IP|

---

å¦‚æœä½ èƒ½å‘Šè¯‰æˆ‘ä½ æ˜¯å¦æ‹¥æœ‰å…¬ç½‘ IPã€ä½ çš„ç½‘ç»œç¯å¢ƒæ˜¯å®¶åº­è¿˜æ˜¯å…¬å¸ï¼Œæˆ‘å¯ä»¥ä¸ºä½ å®šåˆ¶ä¸€å¥—å¯è¡Œæ–¹æ¡ˆã€‚

## é‚£å¦‚æœæˆ‘æ²¡æœ‰å…¬ç½‘çš„ipå‘¢ï¼Œæˆ‘çš„nginxæœåŠ¡å™¨å°±è¿è¡Œåœ¨æˆ‘æ‰‹è¾¹çš„ä¸€å°ä¸»æœºä¸Šï¼Œè¯¥æ€ä¹ˆå¡«å†™åŸŸåæ˜ å°„çš„è®°å½•å‘¢
å¦‚æœä½  **æ²¡æœ‰å…¬ç½‘ IP**ï¼Œè€Œä½ çš„ nginx æœåŠ¡å™¨è¿è¡Œåœ¨æœ¬åœ°ç”µè„‘ï¼ˆæ¯”å¦‚å®¶é‡Œçš„å°å¼æœºæˆ–ç¬”è®°æœ¬ï¼‰ä¸Šï¼Œé‚£ä¹ˆä½ æƒ³è®©å¤–ç½‘ç”¨æˆ·é€šè¿‡åŸŸåè®¿é—®ä½ çš„ nginx æœåŠ¡å™¨ï¼Œ**å¿…é¡»ä½¿ç”¨â€œå†…ç½‘ç©¿é€â€æŠ€æœ¯**ã€‚

---

## ğŸ›  æ­£ç¡®æ“ä½œæ–¹æ¡ˆï¼šä½¿ç”¨å†…ç½‘ç©¿é€ + åŸŸåè§£æ

ä½ éœ€è¦åˆ†ä¸¤æ­¥æ¥åšï¼š

---

### âœ… ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·

å†…ç½‘ç©¿é€å·¥å…·å¯ä»¥å¸®ä½ æŠŠæœ¬åœ°æœåŠ¡å™¨â€œæš´éœ²â€ç»™å¤–ç½‘è®¿é—®ã€‚

#### å¸¸è§å†…ç½‘ç©¿é€å·¥å…·ï¼ˆä»»é€‰ä¸€ä¸ªï¼‰ï¼š

|å·¥å…·|å®˜ç½‘|å…è´¹æ”¯æŒ|ç®€ä»‹|
|---|---|---|---|
|**Ngrok**|[https://ngrok.com/](https://ngrok.com/)|âœ… æœ‰å…è´¹é¢åº¦|è‹±æ–‡ï¼Œç®€å•æ˜“ç”¨|
|**Frp**|[https://github.com/fatedier/frp](https://github.com/fatedier/frp)|âœ… å…¨å…è´¹|éœ€æ­å»ºä¸­è½¬æœåŠ¡å™¨ï¼Œå¼ºå¤§çµæ´»|
|**natapp**|[https://natapp.cn/](https://natapp.cn/)|âœ… æœ‰å…è´¹é¢åº¦|ä¸­æ–‡ï¼Œæ˜“ä¸Šæ‰‹|
|**èŠ±ç”Ÿå£³**|[https://hsk.oray.com/](https://hsk.oray.com/)|âœ… æœ‰å…è´¹ç‰ˆæœ¬|å•†ä¸šäº§å“ï¼Œç•Œé¢å‹å¥½|

---

### âœ… ç¬¬äºŒæ­¥ï¼šå°†åŸŸåè§£æåˆ°å†…ç½‘ç©¿é€æä¾›çš„å…¬ç½‘åœ°å€

å½“ä½ è¿è¡Œå†…ç½‘ç©¿é€å·¥å…·åï¼Œå®ƒä¼šç»™ä½ ä¸€ä¸ªå…¬ç½‘åœ°å€ï¼Œæ¯”å¦‚ï¼š

- `https://yourname.ngrok.io`
    
- æˆ–è€… `http://abc123.natappfree.cc`
    

ç„¶åä½ å°±å¯ä»¥åšä»¥ä¸‹è®¾ç½®ï¼š

#### ğŸ‘‡ åŸŸå DNS è§£æè®¾ç½®ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰

1. ç™»å½•é˜¿é‡Œäº‘åŸŸåæ§åˆ¶å°ï¼›
    
2. æ‰¾åˆ°ä½ è´­ä¹°çš„åŸŸåï¼Œä¾‹å¦‚ `www.lalala.com`ï¼›
    
3. æ·»åŠ ä¸€æ¡ **CNAME è®°å½•**ï¼ŒæŠŠä½ çš„åŸŸåæŒ‡å‘å†…ç½‘ç©¿é€æä¾›çš„å…¬ç½‘åœ°å€ï¼š
    
    - ä¸»æœºè®°å½•ï¼š`www`
        
    - è®°å½•ç±»å‹ï¼š`CNAME`
        
    - è®°å½•å€¼ï¼š`yourname.ngrok.io`ï¼ˆä¸¾ä¾‹ï¼‰
        

> âš  æ³¨æ„ï¼šéƒ¨åˆ†ç©¿é€æœåŠ¡ï¼ˆå¦‚ ngrok å…è´¹ç‰ˆï¼‰æä¾›çš„æ˜¯ HTTPS åŸŸåï¼Œä¸èƒ½ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼Œæƒ³ç»‘å®šéœ€è¦ç”¨å•†ä¸šæœåŠ¡æˆ–è‡ªå»º frpã€‚

---

## ğŸš€ ç¤ºä¾‹æ“ä½œï¼šä½¿ç”¨ Ngrokï¼ˆå…è´¹ç‰ˆï¼‰

### ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œå¹¶å®‰è£… ngrok

- æ³¨å†Œå®˜ç½‘ï¼š`https://ngrok.com/`
    
- ä¸‹è½½å¹¶å®‰è£…å®¢æˆ·ç«¯ï¼›
    
- å¯åŠ¨å‘½ä»¤ï¼š
    
    ```bash
    ngrok http 80
    ```
    

### ç¬¬äºŒæ­¥ï¼šè·å¾—å…¬ç½‘åœ°å€

ä¾‹å¦‚ ngrok ä¼šç»™ä½ ä¸€ä¸ªåœ°å€ï¼š

```
https://abcd-1-2-3-4.ngrok.io
```

### ç¬¬ä¸‰æ­¥ï¼šå°†åŸŸå `www.lalala.com` çš„ CNAME æŒ‡å‘ä¸Šè¿°åœ°å€ï¼ˆå¦‚æœæ”¯æŒï¼‰

---

## ğŸ§  é‡è¦æé†’

1. å…è´¹å†…ç½‘ç©¿é€åœ°å€é€šå¸¸æ˜¯éšæœºç”Ÿæˆçš„ï¼Œé‡å¯åä¼šå˜ï¼Œ**ç»‘å®šåŸŸåå»ºè®®ç”¨å•†ä¸šæœåŠ¡æˆ–è‡ªå»ºç©¿é€æœåŠ¡å™¨**ï¼›
    
2. å¦‚æœä½ æ˜¯åšé•¿æœŸæœåŠ¡æˆ–é¡¹ç›®éƒ¨ç½²ï¼Œå»ºè®®è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ï¼‰ï¼Œä»·æ ¼ä¾¿å®œï¼Œé…ç½®å…¬ç½‘ IPï¼›
    
3. æœ¬åœ°ç”µè„‘é•¿æœŸå¼€æœåŠ¡é£é™©è¾ƒé«˜ï¼ˆå®‰å…¨ã€æ–­ç”µã€æ‰çº¿ï¼‰ï¼Œä¸æ¨èç”¨äºæ­£å¼éƒ¨ç½²ã€‚
    

---

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥æ‰‹æŠŠæ‰‹å¸®ä½ é…ç½® ngrok æˆ– frpï¼Œæˆ–è€…æ¨èä¸€å°é€‚åˆä½ éœ€æ±‚çš„ä¾¿å®œäº‘æœåŠ¡å™¨ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

## æˆ‘å¯ä¸å¯ä»¥ç»™æˆ‘çš„æœ¬åœ°ä¸»æœºé…ç½®å…¬ç½‘ipå‘¢
ä½ å½“ç„¶**å¯ä»¥å°è¯•ç»™æœ¬åœ°ä¸»æœºé…ç½®å…¬ç½‘ IP**ï¼Œä½†è¿™å–å†³äºä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š

---

### âœ… ä¸€ã€æœ¬åœ°æ˜¯å¦èƒ½è·å–å…¬ç½‘ IPï¼ˆè¿è¥å•†æ˜¯å¦åˆ†é…ï¼‰

#### ğŸŸ¢ æƒ…å†µä¸€ï¼šä½ å½“å‰ç½‘ç»œå°±æ˜¯å…¬ç½‘ IP

ä½ å¯ä»¥ç›´æ¥è®¿é—® [https://www.ip138.com/](https://www.ip138.com/) æŸ¥çœ‹ä½ çš„å¤–ç½‘ IPã€‚

ç„¶åæ‰“å¼€ç»ˆç«¯è¿è¡Œï¼š

```bash
ipconfig (Windows) / ifconfig æˆ– ip a (Linux / macOS)
```

å¦‚æœä½ çœ‹åˆ°çš„å±€åŸŸç½‘ IPï¼ˆå¦‚ 192.168.x.x / 10.x.x.xï¼‰å’Œä½ åœ¨ IP æŸ¥è¯¢ç½‘ç«™ä¸Šçœ‹åˆ°çš„ä¸ä¸€æ ·ï¼Œè¯´æ˜ä½ æ˜¯åœ¨ **å†…ç½‘**ï¼Œä½ æ²¡æœ‰ç›´æ¥å…¬ç½‘ IPã€‚

#### ğŸ”´ æƒ…å†µäºŒï¼šä½ æ˜¯å®¶åº­å®½å¸¦ï¼ŒISP ç»™çš„æ˜¯ç§ç½‘ IPï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰

è¿™æ—¶ä½ çš„å…¬ç½‘ IPå…¶å®åœ¨è¿è¥å•†è®¾å¤‡ä¸Šï¼Œä½ å¤„äº**NAT å†…éƒ¨**ï¼Œæ²¡æ³•ä»å…¬ç½‘ç›´æ¥è®¿é—®ä½ ç”µè„‘ã€‚ä½ å¿…é¡»ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š

---

### âœ… äºŒã€æƒ³è®©ä¸»æœºæ‹¥æœ‰å…¬ç½‘è®¿é—®èƒ½åŠ›ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆ

#### âœ… 1. **è”ç³»è¿è¥å•†ç”³è¯·å…¬ç½‘ IP**ï¼ˆæ¨èï¼‰

- æ‹¨æ‰“å®½å¸¦è¿è¥å•†å®¢æœï¼ˆå¦‚ä¸­å›½ç”µä¿¡ã€è”é€šã€ç§»åŠ¨ï¼‰ï¼›
    
- è¯´æ˜ä½ éœ€è¦é…ç½®æœåŠ¡å™¨å¹¶ç”³è¯·å…¬ç½‘ IPv4 åœ°å€ï¼›
    
- æœ‰äº›åœ°åŒº **ä¸ªäººç”¨æˆ·å¯èƒ½ä¸æ”¯æŒæˆ–éœ€é¢å¤–è´¹ç”¨**ï¼Œä½†å¾ˆå¤šåœ°åŒºå¯ä»¥å¼€é€šï¼ˆä¾‹å¦‚ç”µä¿¡ç»å¸¸å¯ä»¥ï¼‰ï¼›
    
- å¼€é€šåä½ çš„ç”µè„‘å°±å¯ä»¥ç›´æ¥ä½¿ç”¨å…¬ç½‘åœ°å€æä¾›æœåŠ¡ï¼ˆç»“åˆé˜²ç«å¢™æ”¾è¡Œã€è·¯ç”±å™¨ç«¯å£è½¬å‘å³å¯ï¼‰ã€‚
    

---

#### âœ… 2. **ç§Ÿç”¨äº‘æœåŠ¡å™¨ä½œä¸ºè·³æ¿**

å¦‚æœè¿è¥å•†ä¸ç»™å…¬ç½‘ IPï¼Œå¯ä»¥é€‰æ‹©ï¼š

- ç§Ÿä¸€ä¸ªæœ‰å…¬ç½‘ IP çš„ **äº‘æœåŠ¡å™¨ï¼ˆä¾‹å¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€Vultrã€Oracle å…è´¹ä¸»æœºç­‰ï¼‰**ï¼›
    
- åœ¨è¯¥äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰ï¼›
    
- æˆ–ä½¿ç”¨ **Frp**/Ngrok ç­‰å·¥å…·å°†æœ¬åœ°ç«¯å£æ˜ å°„åˆ°äº‘æœåŠ¡å™¨ä¸Šï¼›
    
- ç”¨æˆ·è®¿é—®äº‘æœåŠ¡å™¨çš„å…¬ç½‘åœ°å€ï¼Œå®é™…ç”±å®ƒä¸­è½¬åˆ°ä½ æœ¬åœ°æœºå™¨ã€‚
    

---

### ğŸš« å¸¸è§è¯¯åŒºï¼šæ‰‹åŠ¨é…ç½®å…¬ç½‘ IP æ˜¯ä¸è¡Œçš„

ä½ ä¸èƒ½é è‡ªå·±â€œè®¾ç½®ä¸€ä¸ªå…¬ç½‘ IPâ€å°±è®©å…¬ç½‘è¿è¿›æ¥ï¼Œå…¬ç½‘ IP æ˜¯ç”±è¿è¥å•† **åˆ†é…ä¸‹å‘** çš„èµ„æºã€‚å¦‚æœä½ å°è¯•æ‰‹åŠ¨è®¾ç½®å…¬ç½‘åœ°å€ï¼Œå®é™…ä¸Š**ä½ é‚£å°ä¸»æœºå¹¶ä¸åœ¨å…¬ç½‘ä¸­å¯¹åº”çš„ä½ç½®**ï¼Œè¿™ä¼šå¯¼è‡´è·¯ç”±å¤±è´¥ã€‚

---

### âœ… æ€»ç»“

|æ–¹æ³•|æ˜¯å¦æ¨è|éš¾åº¦|æˆæœ¬|
|---|---|---|---|
|å‘è¿è¥å•†ç”³è¯·å…¬ç½‘ IP|âœ… æ¨èï¼ˆæœ€ç›´æ¥ï¼‰|ä½|æœ‰å¯èƒ½è¦æ”¶è´¹|
|äº‘æœåŠ¡å™¨ + ä»£ç†/ç©¿é€|âœ… æ¨è|ä¸­|å¯å…è´¹è¯•ç”¨æˆ–ä½ä»·|
|æ‰‹åŠ¨è®¾ç½®å…¬ç½‘ IP|âŒ ä¸å¯è¡Œ|-|-|
|ä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·|âœ… å¤‡é€‰æ–¹æ¡ˆ|ä½|å¤šæ•°æœ‰å…è´¹é¢åº¦|

---

å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ çš„ç½‘ç»œè¿è¥å•†ï¼ˆç”µä¿¡/ç§»åŠ¨/è”é€šï¼‰å’Œå…·ä½“çš„åº”ç”¨éœ€æ±‚ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ¤æ–­æ˜¯å¦èƒ½å¼€å…¬ç½‘ IP æˆ–æ›´å¥½åœ°æ¨èæ–¹æ¡ˆã€‚

## å¦‚æœæˆ‘ç§Ÿç”¨äº†äº‘æœåŠ¡å™¨ï¼Œæˆ‘æ˜¯éœ€è¦æŠŠæˆ‘çš„ç¨‹åºéƒ¨ç½²åˆ°ä¸Šé¢å—ï¼Ÿè¿˜æ˜¯å¯ä»¥è®©è¿™ä¸ªäº‘æœåŠ¡å™¨æ˜ å°„åˆ°æˆ‘çš„æœ¬åœ°ç”µè„‘
è¿™æ˜¯ä¸ªå…³é”®é—®é¢˜ã€‚ä½ ç§Ÿäº†äº‘æœåŠ¡å™¨ä¹‹åï¼Œæœ‰**ä¸¤ç§å¯é€‰æ–¹å¼**ï¼š

---

## âœ… æ–¹æ¡ˆä¸€ï¼šå°†ä½ çš„ç¨‹åºéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ä¸Šè¿è¡Œï¼ˆæ¨èï¼‰

### ğŸ¯ ä¼˜ç‚¹ï¼š

- äº‘æœåŠ¡å™¨æœ‰å…¬ç½‘ IPï¼Œä»»ä½•ç”¨æˆ·éƒ½èƒ½ç›´æ¥è®¿é—®ï¼›
    
- ç¨³å®šã€å»¶è¿Ÿä½ï¼Œä¸ä¾èµ–ä½ çš„æœ¬åœ°ç½‘ç»œï¼›
    
- å®‰å…¨æ€§ã€å¯ç»´æŠ¤æ€§å¼ºï¼ˆé€‚åˆé•¿æœŸè¿è¡Œï¼‰ï¼›
    
- å¤§å¤šæ•°äº‘æœåŠ¡å•†ï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ï¼‰éƒ½æœ‰**å…¬ç½‘å¸¦å®½**å’Œ**å®‰å…¨ç»„é…ç½®**ï¼Œéå¸¸é€‚åˆè·‘ç”Ÿäº§æœåŠ¡ã€‚
    

### ğŸ¯ æ“ä½œæ–¹å¼ï¼š

1. æŠŠä½ çš„ä»£ç ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ï¼ˆç”¨ `scp`ã€`git clone`ã€ftpã€è¿œç¨‹æ¡Œé¢ç­‰æ–¹å¼ï¼‰ï¼›
    
2. å®‰è£…ä½ ç¨‹åºè¿è¡Œä¾èµ–ï¼ˆæ¯”å¦‚å®‰è£… Nginxã€Pythonã€Node.jsã€C++è¿è¡Œç¯å¢ƒç­‰ï¼‰ï¼›
    
3. å¯åŠ¨ä½ çš„ç¨‹åºï¼›
    
4. æ‰“å¼€æœåŠ¡å™¨å®‰å…¨ç»„å’Œé˜²ç«å¢™ç«¯å£ï¼›
    
5. ç”¨æˆ·å°±èƒ½é€šè¿‡å…¬ç½‘ IP + ç«¯å£è®¿é—®ä½ æœåŠ¡äº†ã€‚
    

---

## âœ… æ–¹æ¡ˆäºŒï¼šè®©äº‘æœåŠ¡å™¨**æ˜ å°„åˆ°ä½ æœ¬åœ°ç”µè„‘**ï¼Œè½¬å‘å…¬ç½‘è¯·æ±‚ï¼ˆé€šè¿‡å†…ç½‘ç©¿é€ï¼‰

### ğŸ§© åœºæ™¯ï¼š

é€‚ç”¨äºä½ å¿…é¡»è®©ç¨‹åºè¿è¡Œåœ¨æœ¬åœ°ï¼ˆå¦‚è®¿é—®æœ¬åœ°æ‘„åƒå¤´ã€ç¡¬ä»¶è®¾å¤‡ï¼Œæˆ–è°ƒè¯•ç¯å¢ƒä¸æ–¹ä¾¿è¿ç§»ï¼‰ã€‚

### ğŸ“¦ å®ç°æ–¹å¼ï¼š

ä½ å¯ä»¥ä½¿ç”¨ä¸€ç±»å«åš**å†…ç½‘ç©¿é€**æˆ–**ç«¯å£æ˜ å°„**å·¥å…·ï¼Œå¦‚ï¼š

|å·¥å…·|ç®€ä»‹|æ˜¯å¦å¼€æº|
|---|---|---|
|[frp](https://github.com/fatedier/frp)|é«˜æ€§èƒ½çš„åå‘ä»£ç†åº”ç”¨ï¼Œéœ€é…ç½®å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯|âœ… æ˜¯|
|Ngrok|å¼€ç®±å³ç”¨ï¼Œæ³¨å†Œåè·å¾—å…¬ç½‘åœ°å€|âœ… æœ‰å¼€æºç‰ˆ|
|Zerotier|æ„å»ºè™šæ‹Ÿå±€åŸŸç½‘|âœ… æ˜¯|
|NPS|ç®€æ´æ˜“ç”¨çš„å†…ç½‘ç©¿é€ç³»ç»Ÿ|âœ… æ˜¯|

### ğŸ§  åŸç†ï¼š

1. äº‘æœåŠ¡å™¨è¿è¡Œä¸€ä¸ª **frpsï¼ˆæœåŠ¡ç«¯ï¼‰**ï¼›
    
2. æœ¬åœ°ç”µè„‘è¿è¡Œ **frpcï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼Œè¿æ¥åˆ°äº‘æœåŠ¡å™¨ï¼›
    
3. äº‘æœåŠ¡å™¨åˆ†é…ä¸€ä¸ªå…¬ç½‘ç«¯å£è½¬å‘åˆ°ä½ æœ¬åœ°ç”µè„‘ï¼›
    
4. ç”¨æˆ·è®¿é—®äº‘æœåŠ¡å™¨ IPï¼Œå°±ä¼šè½¬å‘åˆ°ä½ æœ¬åœ°æœåŠ¡ã€‚
    

### ğŸ”Œ ä¸¾ä¸ªä¾‹å­ï¼š

- ä½ æœ¬åœ°è·‘äº†ä¸€ä¸ª `localhost:8080` çš„ç½‘ç«™ï¼›
    
- frp æ˜ å°„ä¹‹åï¼Œä½ çš„äº‘æœåŠ¡å™¨å¼€æ”¾ `http://äº‘æœåŠ¡å™¨IP:6000`ï¼›
    
- ç”¨æˆ·è®¿é—® `http://äº‘æœåŠ¡å™¨IP:6000` å®é™…è®¿é—®çš„æ˜¯ä½ æœ¬åœ°çš„ `8080` æœåŠ¡ã€‚
    

### âš ï¸ æ³¨æ„ï¼š

- æœ¬åœ°ç”µè„‘å¿…é¡»**å§‹ç»ˆè”ç½‘ä¸”ä¿æŒå¼€æœº**ï¼›
    
- ä¼šæœ‰ä¸€ç‚¹**å»¶è¿Ÿ**ï¼ˆå› ä¸ºè¦ç»ç”±äº‘æœåŠ¡å™¨è½¬å‘ï¼‰ï¼›
    
- äº‘æœåŠ¡å™¨å’Œæœ¬åœ°å¿…é¡»äº’é€šï¼ˆç©¿é€æ—¶è¦æ”¾è¡Œç«¯å£ï¼‰ã€‚
    

---

## âœ… æ€»ç»“å»ºè®®

|æ–¹å¼|æ¨èåœºæ™¯|ä¼˜ç‚¹|ç¼ºç‚¹|
|---|---|---|---|
|éƒ¨ç½²ç¨‹åºåˆ°äº‘æœåŠ¡å™¨|é•¿æœŸåœ¨çº¿æœåŠ¡ã€å¯ç›´æ¥éƒ¨ç½²|ç¨³å®šã€å¿«é€Ÿ|éœ€è¦ç†Ÿæ‚‰ Linux è¿ç»´|
|äº‘æœåŠ¡å™¨æ˜ å°„åˆ°æœ¬åœ°ç”µè„‘ï¼ˆå¦‚ frpï¼‰|ç¨‹åºåªèƒ½è¿è¡Œåœ¨æœ¬åœ°|ä¿æŒçµæ´»ã€å¯è°ƒè¯•|æœ¬åœ°éœ€å¼€æœºã€å¤æ‚åº¦ç•¥é«˜|

---

å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ é€‰æ‹©æ–¹æ¡ˆæˆ–æ­å»ºï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„ç¨‹åºæ˜¯ç”¨ä»€ä¹ˆè¯­è¨€å†™çš„ï¼Œè¿è¡Œåœ¨å“ªç§æ“ä½œç³»ç»Ÿä¸Šï¼ˆWindows/Linux/Macï¼‰ï¼Œæˆ‘å¯ä»¥ä¸ºä½ åˆ¶å®šæœ€åˆé€‚çš„æ–¹æ¡ˆã€‚
## å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆé…ç½®äº†frpï¼Œå°±å¯ä»¥ç”±å…¬ç½‘è®¿é—®åˆ°æˆ‘çš„æœ¬åœ°ä¸»æœºï¼Œä¸­é—´éš¾é“ä¸åŒæ ·æ¶‰åŠåˆ°å†…ç½‘å—
è¿™ä¸ªé—®é¢˜éå¸¸å…³é”®ï¼ä½ å·²ç»ç†è§£å¾—å¾ˆæ¥è¿‘çœŸç›¸äº†ï¼Œæˆ‘ä»¬æ¥**ä¸€æ­¥æ­¥å‰–æä¸ºä»€ä¹ˆé…ç½®äº† FRP ä¹‹åï¼Œå…¬ç½‘å°±èƒ½è®¿é—®åˆ°ä½ æœ¬åœ°æœºå™¨ï¼Œå³ä½¿ä½ æ²¡æœ‰å…¬ç½‘ IP**ã€‚

---

## ğŸ§  æ ¸å¿ƒåŸç†ï¼š**åå‘è¿æ¥ + äº‘æœåŠ¡å™¨ä¸­è½¬**

ä½ çš„ç–‘é—®æ˜¯ï¼š

> æœ¬åœ°æœºå™¨æ˜æ˜åœ¨å†…ç½‘ï¼Œå¤–éƒ¨è®¾å¤‡å¦‚ä½•è®¿é—®å®ƒï¼Ÿ

è¿™æ­£æ˜¯ **å†…ç½‘ç©¿é€ï¼ˆReverse Proxyï¼‰** çš„æ ¸å¿ƒæœºåˆ¶ï¼š

- ä¸æ˜¯è®©å¤–éƒ¨æ¥â€œæ‰¾â€ä½ ï¼Œè€Œæ˜¯ä½ ä¸»åŠ¨â€œè¿æ¥â€å‡ºå»ï¼Œå†â€œå€ŸåŠ©äº‘æœåŠ¡å™¨è½¬å‘å›æ¥â€ã€‚
    

---

## ğŸ” FRP çš„å·¥ä½œåŸç†ï¼ˆç”¨é€šä¿—è¯­è¨€è§£é‡Šï¼‰ï¼š

å‡è®¾ä½ å®¶é‡Œç”µè„‘æ˜¯æ²¡æœ‰å…¬ç½‘ IP çš„å†…ç½‘ä¸»æœºï¼Œäº‘æœåŠ¡å™¨æ˜¯æœ‰å…¬ç½‘ IP çš„æœºå™¨ã€‚

### è§’è‰²åˆ’åˆ†ï¼š

|è§’è‰²|åŠŸèƒ½|
|---|---|
|äº‘æœåŠ¡å™¨ï¼ˆfrpsï¼‰|å…¬ç½‘ä¸­ç»§å™¨ï¼Œé¢å‘æ‰€æœ‰è®¿é—®è€…å¼€æ”¾|
|æœ¬åœ°ç”µè„‘ï¼ˆfrpcï¼‰|å†…ç½‘å®¢æˆ·ç«¯ï¼Œä¸»åŠ¨è¿æ¥äº‘æœåŠ¡å™¨|
|å¤–éƒ¨ç”¨æˆ·|è®¿é—®äº‘æœåŠ¡å™¨ï¼Œé—´æ¥è®¿é—®ä½ æœ¬åœ°|

### ğŸŒ æ­¥éª¤è§£æï¼š

1. **ä½ é…ç½®äº† frpcï¼ˆæœ¬åœ°ä»£ç†ï¼‰å»ä¸»åŠ¨è¿æ¥ frpsï¼ˆäº‘æœåŠ¡å™¨ï¼‰**  
    ğŸ‘‰ è¿™æ˜¯å…³é”®ï¼å› ä¸º**å†…ç½‘ä¸èƒ½è¢«åŠ¨æ¥å—å…¬ç½‘è¿æ¥ï¼Œä½†å¯ä»¥ä¸»åŠ¨å‘å‡ºè¯·æ±‚**ã€‚
    
2. è¿™ä¸ªè¿æ¥ä¼šåœ¨ä½ çš„å®¶ç”¨ç”µè„‘å’Œäº‘æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡ **æŒä¹…è¿æ¥**ï¼ˆæ¯”å¦‚é€šè¿‡ TCP tunnelï¼‰ï¼Œç›¸å½“äºå¼€äº†ä¸€æ¡â€œéš§é“â€ã€‚
    
3. å½“å…¬ç½‘ç”¨æˆ·è®¿é—®äº‘æœåŠ¡å™¨çš„æŸä¸ªç«¯å£ï¼ˆæ¯”å¦‚ `http://ä½ çš„äº‘IP:6000`ï¼‰ï¼Œ  
    ğŸ‘‰ äº‘æœåŠ¡å™¨ä¼šæŠŠè¯·æ±‚â€œé€šè¿‡è¿™æ¡éš§é“â€è½¬å‘ç»™æœ¬åœ° frpcï¼Œæœ€ç»ˆé€è¾¾ä½ å†…ç½‘çš„æœåŠ¡ï¼ˆå¦‚ localhost:8080ï¼‰ã€‚
    
4. æœ¬åœ°æœåŠ¡è¿”å›æ•°æ®ï¼Œfrpc æŠŠæ•°æ®é€šè¿‡éš§é“â€œä¼ ä¸Šå»â€ï¼Œfrps å†æŠŠæ•°æ®äº¤ç»™å…¬ç½‘ç”¨æˆ·ã€‚
    

---

## ğŸ”§ å›¾ç¤ºç†è§£ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

```
[å…¬ç½‘ç”¨æˆ·] 
     â†“
 [äº‘æœåŠ¡å™¨: frps] â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†
     â†“                                             â†‘
  è½¬å‘æµé‡                                       ä¿æŒè¿æ¥
     â†“                                             â†‘
[æœ¬åœ°ç”µè„‘: frpc] â€”â€”â€”â†’ [localhost:8080 ä½ çš„æœåŠ¡]
```

> âš ï¸ æ³¨æ„æ–¹å‘ï¼š**æœ¬åœ° â†’ äº‘æœåŠ¡å™¨** çš„è¿æ¥æ˜¯â€œä¸»åŠ¨å»ºç«‹â€çš„ï¼Œå› æ­¤ä¸ä¼šè¢«è·¯ç”±å™¨æ‹¦æˆªï¼Œçªç ´äº† NAT é™åˆ¶ã€‚

---

## ğŸ’¬ ç±»æ¯”æ‰“æ¯”æ–¹ï¼š

æƒ³è±¡ä½ æ˜¯ä½åœ¨å°åŒºé‡Œçš„æŸä¸ªæˆ¿é—´ï¼ˆæ²¡æœ‰å¯¹å¤–è”ç³»æ–¹å¼ï¼‰ï¼Œåˆ«äººæ‰¾ä¸åˆ°ä½ ã€‚äºæ˜¯ä½ å‘Šè¯‰ä¸€ä¸ªåœ¨å¸‚ä¸­å¿ƒæœ‰é—¨é¢çš„æœ‹å‹ï¼ˆäº‘æœåŠ¡å™¨ï¼‰ï¼šâ€œä½ å¸®æˆ‘æ¥ç”µè¯ï¼ˆå…¬ç½‘è¯·æ±‚ï¼‰ï¼Œä½ æ¥åˆ°åè½¬ç»™æˆ‘ï¼Œæˆ‘éšæ—¶åœ¨çº¿å¬ç€ã€‚â€

---

## âœ… æ€»ç»“

|é—®é¢˜|è§£ç­”|
|---|---|
|å†…ç½‘è®¾å¤‡æ— æ³•è¢«åŠ¨æ¥æ”¶å…¬ç½‘è¯·æ±‚ï¼Ÿ|âœ… æ˜¯çš„ï¼Œä¸èƒ½|
|é‚£å…¬ç½‘æ˜¯æ€ä¹ˆè®¿é—®å†…ç½‘æœåŠ¡çš„ï¼Ÿ|âœ… é€šè¿‡æœ¬åœ° frpc ä¸»åŠ¨è¿æ¥äº‘æœåŠ¡å™¨ï¼Œå»ºç«‹åå‘é€šé“|
|æ˜¯å¦éœ€è¦å…¬ç½‘ IPï¼Ÿ|âœ… äº‘æœåŠ¡å™¨éœ€è¦ï¼›æœ¬åœ°è®¾å¤‡ **ä¸éœ€è¦å…¬ç½‘ IP**|
|ä¸ºä»€ä¹ˆå«â€œå†…ç½‘ç©¿é€â€ï¼Ÿ|âœ… å› ä¸ºå®ƒâ€œç»•è¿‡â€äº† NATã€è·¯ç”±å™¨ç­‰é™åˆ¶ï¼Œä»å…¬ç½‘æ‰“é€šè®¿é—®é“¾è·¯|

---

å¦‚æœä½ æƒ³éƒ¨ç½²å®é™…æœåŠ¡ï¼Œæˆ‘å¯ä»¥ä¸ºä½ æä¾›ï¼š

- frps å’Œ frpc çš„é…ç½®æ¨¡æ¿ï¼›
    
- ç³»ç»Ÿå¯åŠ¨æœåŠ¡è®¾ç½®ï¼›
    
- å¤šç«¯å£æ˜ å°„å’Œå®‰å…¨è®¾ç½®å»ºè®®ã€‚
    

éœ€è¦æˆ‘å¸®ä½ é…ç½®ç¤ºä¾‹æˆ–è€…å†™è„šæœ¬ï¼Ÿéšæ—¶å‘Šè¯‰æˆ‘ï¼

## æŒä¹…è¿æ¥ä¸ºä»€ä¹ˆå¯ä»¥ç»•è¿‡natã€è·¯ç”±å™¨é™åˆ¶å‘¢ï¼Œç½‘ç»œæ•°æ®è½¬å‘ä¸éƒ½å¾—ç»è¿‡è·¯ç”±å™¨å—
è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼ä½ å·²ç»è§¦åŠäº†**å†…ç½‘ç©¿é€ï¼ˆNAT ç©¿é€ï¼‰**èƒŒåçš„æœ¬è´¨äº†ã€‚æˆ‘ä»¬æ¥è¯¦ç»†ã€æ¸…æ™°åœ°è§£é‡Šï¼š

---

## ğŸ”„ ä¸ºä»€ä¹ˆæŒä¹…è¿æ¥å¯ä»¥ç»•è¿‡ NAT å’Œè·¯ç”±å™¨ï¼Ÿ

æˆ‘ä»¬å…ˆæ¥ææ¸…æ¥šä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

### ğŸ“Œ 1. NAT/è·¯ç”±å™¨çš„â€œé™åˆ¶â€æ˜¯ä»€ä¹ˆï¼Ÿ

å½“ä½ åœ¨å±€åŸŸç½‘ï¼ˆå¦‚å®¶é‡Œ Wi-Fiï¼‰é‡Œä¸Šç½‘æ—¶ï¼š

- å¤–éƒ¨äº’è”ç½‘è®¿é—®ä½ è¿™å°è®¾å¤‡çš„è¯·æ±‚ä¼šè¢« **è·¯ç”±å™¨/NAT æ‹¦ä½**ï¼Œå› ä¸ºï¼š
    
    - **ä½ æ²¡æœ‰å…¬ç½‘ IP**ï¼Œåˆ«äººæ‰¾ä¸åˆ°ä½ ã€‚
        
    - è·¯ç”±å™¨é»˜è®¤ä¸ä¼šå…è®¸â€œé™Œç”Ÿäººâ€ä¸»åŠ¨è¿æ¥åˆ°ä½ å®¶è®¾å¤‡ï¼ˆæ²¡æœ‰æå‰è®¾ç½®ç«¯å£æ˜ å°„æˆ– DMZï¼‰ã€‚
        

> æ‰€ä»¥ï¼Œå¦‚æœä½ ä¸å¼€ç«¯å£æ˜ å°„ï¼Œåˆ«äººæ ¹æœ¬è¿ä¸è¿›ä½ å®¶ã€‚

---

### ğŸ“Œ 2. ä½†ä½ èƒ½â€œä¸»åŠ¨å‘èµ·è¿æ¥â€ï¼

è¿™å°±æ˜¯å…³é”®ï¼š

- è™½ç„¶å¤–éƒ¨ä¸èƒ½ç›´æ¥è®¿é—®ä½ ï¼Œ
    
- **ä½ å¯ä»¥ä¸»åŠ¨è¿å‡ºå»**ï¼Œæ¯”å¦‚ä½ å®¶æµè§ˆå™¨è®¿é—® `www.baidu.com`ã€‚
    

> ä¸ºä»€ä¹ˆèƒ½è®¿é—®ï¼Ÿå› ä¸ºä½ çš„è·¯ç”±å™¨ä¼šï¼š
> 
> - **è‡ªåŠ¨ä¸ºä½ åˆ†é…ä¸€ä¸ª NAT æ˜ å°„**ï¼ˆæºç«¯å£ã€ç›®æ ‡ IP/ç«¯å£ç­‰ï¼‰ã€‚
>     
> - **è®°ä½è¿™ä¸ªè¿æ¥ä¸€æ®µæ—¶é—´**ï¼Œå¤–éƒ¨çš„å“åº”æµé‡èƒ½è¿”å›åˆ°ä½ ã€‚
>     

---

## âœ… æ‰€ä»¥ï¼Œâ€œæŒä¹…è¿æ¥â€å¦‚ä½•ç©¿é€ NATï¼Ÿ

### âœ… åŸç†å°±æ˜¯ï¼š**ä¸»åŠ¨è¿æ¥å‡ºå» + ä¿æŒè¿æ¥ä¸æ–­**

ä»¥ FRP ä¸ºä¾‹ï¼š

1. ä½ åœ¨æœ¬åœ°ç”µè„‘è¿è¡Œ `frpc`ï¼Œé…ç½®å¥½è¿æ¥å¤–éƒ¨çš„ `frps`ï¼ˆäº‘æœåŠ¡å™¨ï¼‰ã€‚
    
2. `frpc` ä¸»åŠ¨å‘ `frps` å‘é€ TCP è¿æ¥ï¼ˆæ¯”å¦‚è¿æ¥ 7000 ç«¯å£ï¼‰ã€‚
    
3. è·¯ç”±å™¨å…è®¸ä½ **ä¸»åŠ¨è®¿é—®å…¬ç½‘**ï¼Œå¹¶ä¸”**åˆ›å»º NAT æ˜ å°„**ï¼Œä¾‹å¦‚ï¼š
    
    ```
    [å†…ç½‘IP:192.168.1.100:56000] â€”æ˜ å°„ä¸ºâ†’ [å…¬ç½‘IP:xx.xx.xx.xx:7000]
    ```
    
4. è¿™ä¸ª TCP è¿æ¥ä¿æŒâ€œæ´»è·ƒâ€ï¼Œ**ä¸ä¼šæ–­å¼€**ã€‚
    
5. æ‰€ä»¥åç»­ä»»ä½•æ•°æ®ï¼ˆåŒ…æ‹¬å…¬ç½‘è¯·æ±‚ï¼‰éƒ½å¯ä»¥**é€šè¿‡è¿™ä¸ªå·²å»ºç«‹çš„è¿æ¥åå‘ä¼ å›æ¥**ï¼
    

---

## ğŸ” ç®€å•æ¯”å–»ï¼š

ä½ ä½åœ¨ä¸€ä¸ªåªæœ‰å‡ºå£ã€æ²¡æœ‰é—¨é“ƒçš„å°åŒºï¼ˆNAT ç½‘ç»œï¼‰ï¼Œåˆ«äººæ‰¾ä¸åˆ°ä½ ã€‚

ä½ ä¸»åŠ¨æ‰“äº†ä¸€ä¸ªç”µè¯ï¼ˆTCP è¿æ¥ï¼‰ç»™æœ‹å‹ï¼ˆäº‘æœåŠ¡å™¨ï¼‰ï¼Œç„¶å**ä¸€ç›´ä¸æŒ‚ç”µè¯**ï¼Œåˆ«äººæƒ³æ‰¾ä½ æ—¶ï¼Œå°±è®©æœ‹å‹åœ¨è¿™é€šç”µè¯é‡Œå‘Šè¯‰ä½ ä½ è¯¥å¹²å•¥ã€‚

---

## ğŸ” æŠ€æœ¯å…³é”®è¯

- **TCP hole punchingï¼ˆTCPæ‰“æ´ï¼‰**ï¼šä¸€ç§ä¸»åŠ¨å»ºç«‹è¿æ¥åç»´æŒè¿æ¥çŠ¶æ€çš„æŠ€æœ¯ã€‚
    
- **Keep-alive / å¿ƒè·³åŒ…**ï¼šä¿æŒè¿æ¥ä¸æ–­ï¼Œè®© NAT æ˜ å°„ä¸è¢«æ¸…é™¤ã€‚
    
- **NAT æ˜ å°„è¡¨ / è·¯ç”±å™¨ä¼šè¯è¡¨**ï¼šè®°å½•ä½ çš„è¿æ¥ä¿¡æ¯ï¼Œå…è®¸å›åº”å›æ¥ã€‚
    

---

## ğŸ§  æ€»ç»“ä¸€å¥è¯ï¼š

> **NAT æ— æ³•é˜»æ­¢ä½ â€œä¸»åŠ¨æ‰“å‡ºå»â€çš„è¿æ¥ï¼Œè€Œåªè¦ä½ ä¸€ç›´â€œåœ¨çº¿â€ï¼Œè¿™æ¡è·¯å°±ä¸ä¼šæ–­**ï¼Œä»è€Œâ€œç»•è¿‡â€äº†åˆ«äººæ‰¾ä¸åˆ°ä½ çš„é—®é¢˜ã€‚

---

å¦‚æœä½ æƒ³æˆ‘ç”»ä¸€å¼ å›¾æ¥è¾…åŠ©ç†è§£ï¼Œæˆ–è€…ç”¨æŠ“åŒ…ç¤ºä¾‹æ¥åˆ†æ TCP å»ºè¿å’Œ NAT æ˜ å°„ï¼Œä¹Ÿå¯ä»¥ç»§ç»­æé—®ï¼

## å‡å¦‚æˆ‘åªæœ‰ä¸€å°æœ¬åœ°çš„å®‰è£…æœ‰nginxçš„ä¸»æœºï¼Œæˆ‘æƒ³æŠŠé˜¿é‡Œäº‘é‡Œçš„è´­ä¹°äº†www.lalala.comåŸŸåæ˜ å°„åˆ°æœ¬åœ°çš„åœ°å€ï¼Œæ˜¯ä¸æ˜¯è¿™éœ€è¦å®‰è£…frpå°±å¯ä»¥å®ç°å‘¢
æ˜¯çš„ï¼Œ**ä½ å®Œå…¨å¯ä»¥é€šè¿‡å®‰è£…å’Œé…ç½® [FRP (Fast Reverse Proxy)] æ¥å®ç°è¿™ä¸€ç›®æ ‡**ï¼šå°†ä½ åœ¨é˜¿é‡Œäº‘è´­ä¹°çš„åŸŸå `www.lalala.com` æ˜ å°„åˆ°ä½ æœ¬åœ°å®‰è£…äº† Nginx çš„ä¸»æœºã€‚

---

### âœ… æ•´ä½“åŸç†ï¼š

ç”±äºä½ çš„æœ¬åœ°ç½‘ç»œæ˜¯å†…ç½‘ï¼ˆæ²¡æœ‰å…¬ç½‘ IPï¼‰ï¼Œå¤–ç•Œæ— æ³•ç›´æ¥è®¿é—®ä½ çš„ Nginx æœåŠ¡ã€‚FRP æ˜¯ä¸€ç§â€œåå‘ä»£ç†ç©¿é€å·¥å…·â€ï¼Œèƒ½å€ŸåŠ©ä¸€å°æœ‰å…¬ç½‘ IP çš„äº‘æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ä½ çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼‰**åå‘å°†å…¬ç½‘è¯·æ±‚è½¬å‘å›ä½ æœ¬åœ°çš„æœåŠ¡ä¸Š**ã€‚

---

### ğŸ“Œ ä½ éœ€è¦å…·å¤‡çš„æ¡ä»¶ï¼š

|é¡¹ç›®|æ˜¯å¦å¿…é¡»|è¯´æ˜|
|---|---|---|
|1. é˜¿é‡Œäº‘è´­ä¹°çš„åŸŸåï¼ˆå¦‚ `www.lalala.com`ï¼‰|âœ…|å·²æœ‰|
|2. ä¸€å°é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ˆå…·æœ‰å…¬ç½‘ IPï¼‰|âœ…|ç”¨ä½œ FRP æœåŠ¡ç«¯ï¼ˆfrpsï¼‰|
|3. ä¸€å°æœ¬åœ°ä¸»æœºï¼ˆè¿è¡Œ nginxï¼‰|âœ…|è¿è¡Œä½ çš„æœåŠ¡åŠ FRP å®¢æˆ·ç«¯ï¼ˆfrpcï¼‰|
|4. å®‰è£…é…ç½®å¥½ FRPï¼ˆfrps+frpcï¼‰|âœ…|ç”¨æ¥å®ç°å†…ç½‘ç©¿é€|

---

### ğŸ› ï¸ å®ç°æ­¥éª¤

#### æ­¥éª¤ 1ï¸âƒ£ï¼šåœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½² `frps`

é…ç½® `frps.ini`ï¼ˆä¾‹å¦‚ï¼‰ï¼š

```ini
[common]
bind_port = 7000
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = admin
vhost_http_port = 8080
```

å¯åŠ¨ï¼š

```bash
./frps -c frps.ini
```

ç¡®ä¿ç«¯å£ï¼ˆ7000 / 8080ï¼‰åœ¨é˜¿é‡Œäº‘å®‰å…¨ç»„æ”¾è¡Œã€‚

---

#### æ­¥éª¤ 2ï¸âƒ£ï¼šåœ¨ä½ æœ¬åœ°è¿è¡Œ Nginx çš„ä¸»æœºä¸Šéƒ¨ç½² `frpc`

é…ç½® `frpc.ini`ï¼š

```ini
[common]
server_addr = <é˜¿é‡Œäº‘å…¬ç½‘IP>
server_port = 7000

[web]
type = http
local_port = 80               # æœ¬åœ° Nginx ç›‘å¬ç«¯å£
custom_domains = www.lalala.com
```

å¯åŠ¨ï¼š

```bash
./frpc -c frpc.ini
```

---

#### æ­¥éª¤ 3ï¸âƒ£ï¼šåœ¨é˜¿é‡Œäº‘åŸŸåæ§åˆ¶å°é…ç½®è§£æ

å°†ä½ çš„åŸŸå `www.lalala.com` æ·»åŠ  A è®°å½•ï¼š

- **ä¸»æœºè®°å½•**ï¼š`www`
    
- **è®°å½•ç±»å‹**ï¼šA
    
- **è®°å½•å€¼**ï¼šå¡«å†™ä½ çš„ **é˜¿é‡Œäº‘æœåŠ¡å™¨å…¬ç½‘ IP**
    
- **TTL**ï¼šé»˜è®¤å³å¯
    

---

### ğŸŒ æ•´ä½“è®¿é—®æµç¨‹ï¼š

ç”¨æˆ·è®¿é—®ï¼š

```
www.lalala.com â†’ é˜¿é‡Œäº‘å…¬ç½‘IP:8080 â†’ frps â†’ frpc â†’ æœ¬åœ°Nginx:80
```

---

### ğŸ”’ è¡¥å……å»ºè®®ï¼š

- å¯ä»¥ä½¿ç”¨ HTTPSï¼šéœ€è¦è®© frp æ”¯æŒ `vhost_https_port`ï¼Œæˆ–ç”¨ Cloudflare åšåå‘ä»£ç†å’Œè¯ä¹¦ã€‚
    
- å¯ä»¥åŠ å¯†å’Œå‹ç¼© FRP é€šä¿¡ï¼Œæå‡å®‰å…¨æ€§ä¸æ•ˆç‡ã€‚
    
- æœ¬åœ° nginx å¯ä»¥ç›‘å¬å…¶ä»–ç«¯å£ï¼Œä¸å¿…ä¸€å®šç”¨ 80ã€‚
    

---

### âœ… æ€»ç»“ï¼š

> æ˜¯çš„ï¼Œä½ åªéœ€è¦ç”¨ **FRP åšå†…ç½‘ç©¿é€**ï¼Œå†é…åˆ **é˜¿é‡Œäº‘åŸŸåè§£ææŒ‡å‘ä½ çš„é˜¿é‡Œäº‘å…¬ç½‘ IP**ï¼Œå³å¯è®©å…¬ç½‘ç”¨æˆ·è®¿é—®åˆ°ä½ æœ¬åœ° nginx æä¾›çš„æœåŠ¡ã€‚

å¦‚ä½ éœ€è¦æˆ‘å¸®ä½ å†™å¥½ä¸€ä»½å®Œæ•´é…ç½®æ–‡ä»¶æˆ–è„šæœ¬ï¼Œä¹Ÿæ¬¢è¿ç»§ç»­æé—®ã€‚
## ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å¿…é¡»å¾—ä¹°é˜¿é‡Œäº‘çš„äº‘æœåŠ¡å™¨ï¼Œæ‰å¯ä»¥è®©frpå·¥ä½œï¼Œè€Œä¸æ˜¯ä»…ä»…ä¹°ä¸ªåŸŸåå°±å¯ä»¥
æ˜¯çš„ï¼Œ**ä½ è¯´å¾—å¯¹**ï¼š  
ğŸ‘‰ **ä»…ä»…è´­ä¹°åŸŸåè¿˜ä¸å¤Ÿ**ï¼Œä½ ç¡®å®è¿˜éœ€è¦ä¸€å° **æœ‰å…¬ç½‘ IP çš„äº‘æœåŠ¡å™¨**ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘ ECS å®ä¾‹ï¼‰ï¼Œæ‰èƒ½è®© FRPï¼ˆFast Reverse Proxyï¼‰çœŸæ­£å·¥ä½œï¼Œå®ç°å…¬ç½‘ç”¨æˆ·è®¿é—®ä½ æœ¬åœ°æœåŠ¡ã€‚

---

### ğŸ” ä¸ºä»€ä¹ˆåªä¹°åŸŸåè¿˜ä¸å¤Ÿï¼Ÿ

åŸŸååªæ˜¯ä¸€ä¸ª**åå­—**ï¼Œä½ è¿˜éœ€è¦ä¸€ä¸ªâ€œé—¨ç‰Œå·â€è®©åˆ«äººæ‰¾åˆ°ä½ ï¼Œè¿™ä¸ªâ€œé—¨ç‰Œå·â€å°±æ˜¯å…¬ç½‘ IPã€‚

- å¦‚æœä½ çš„æœ¬åœ°ä¸»æœºæ˜¯å®¶ç”¨ç½‘ç»œï¼ˆæ²¡æœ‰å…¬ç½‘ IPï¼‰ï¼Œå³ä½¿ä½ å°†åŸŸåè§£æåˆ°å®ƒçš„å±€åŸŸç½‘åœ°å€ï¼ˆå¦‚ 192.168.x.x æˆ– 10.x.x.xï¼‰ï¼Œ**å¤–éƒ¨ç”¨æˆ·ä¹Ÿæ— æ³•è®¿é—®åˆ°ä½ æœ¬åœ°ç”µè„‘**ã€‚
    
- **FRP çš„åŸç†**ï¼šæ˜¯ç”¨ä½ çš„æœ¬åœ°ä¸»æœºä¸»åŠ¨è¿æ¥åˆ°ä¸€å°æœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨ï¼Œå€ŸåŠ©è¿™å°æœåŠ¡å™¨è¿›è¡Œâ€œåå‘ä»£ç†â€ï¼ŒæŠŠå…¬ç½‘è®¿é—®å¼•æµåˆ°ä½ æœ¬åœ°ã€‚
    

---

### ğŸ“Œ ä½ å¿…é¡»æœ‰çš„ä¸œè¥¿ï¼š

| é¡¹ç›®                                                 | è¯´æ˜               |
| -------------------------------------------------- | ---------------- |
| âœ… åŸŸåï¼ˆå¦‚ [www.lalala.comï¼‰](http://www.lalala.com\)/) | ä½ å·²è´­ä¹°             |
| âœ… æœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨ï¼ˆå¦‚é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼‰                             | ç”¨æ¥éƒ¨ç½² `frps`      |
| âœ… æœ¬åœ°è¿è¡Œ Nginx çš„ç”µè„‘                                   | ç”¨æ¥éƒ¨ç½² `frpc`ï¼Œæä¾›æœåŠ¡ |

---

### ğŸ›  ç¤ºä¾‹å·¥ä½œæµç¨‹

1. ç”¨æˆ·è®¿é—®ï¼š`www.lalala.com`
    
2. DNS è§£æåˆ°ï¼šé˜¿é‡Œäº‘æœåŠ¡å™¨å…¬ç½‘ IPï¼ˆä½ ä¹°çš„äº‘æœåŠ¡å™¨ï¼‰
    
3. é˜¿é‡Œäº‘æœåŠ¡å™¨è¿è¡Œçš„ `frps` æ¥æ”¶åˆ°è®¿é—®
    
4. frps æŠŠè¯·æ±‚è½¬å‘ç»™ä½ æœ¬åœ°çš„ `frpc`
    
5. `frpc` æŠŠè¯·æ±‚äº¤ç»™ä½ æœ¬åœ°çš„ Nginx æœåŠ¡å¤„ç†
    

---

### âœ… æ›¿ä»£æ–¹æ¡ˆï¼ˆå¦‚æœä½ ä¸æƒ³ä¹°äº‘æœåŠ¡å™¨ï¼‰

å¦‚æœä½ ä¸æƒ³è‡ªå·±ä¹°äº‘æœåŠ¡å™¨ï¼Œè¿˜æœ‰ä¸¤ä¸ªå¯é€‰æ€è·¯ï¼š

1. **ä½¿ç”¨å…¬å…±çš„å†…ç½‘ç©¿é€å¹³å°ï¼ˆæ— éœ€å…¬ç½‘æœåŠ¡å™¨ï¼‰**ï¼š
    
    - å¦‚ï¼šèŠ±ç”Ÿå£³ã€natappã€Ngrokï¼ˆå›½å†…éœ€å¤‡æ¡ˆï¼‰ã€[serveo.net](https://serveo.net/)ã€[localtunnel](https://localtunnel.github.io/www/)ã€‚
        
    - ä¼˜ç‚¹ï¼šæ— éœ€è‡ªå·±æ­å»º frpsã€‚
        
    - ç¼ºç‚¹ï¼šå…è´¹æœåŠ¡å¯èƒ½æœ‰è®¿é—®é™æµã€è¿æ¥ä¸ç¨³å®šç­‰é—®é¢˜ã€‚
        
2. **ISP æä¾›å…¬ç½‘ IP**ï¼ˆæ‹¨æ‰“è¿è¥å•†å®¢æœè¯¢é—®ï¼‰ï¼š
    
    - å¦‚æœä½ çš„å®½å¸¦å¯ä»¥è·å–å…¬ç½‘ IPï¼Œå°±æ— éœ€äº‘æœåŠ¡å™¨äº†ï¼Œç›´æ¥å°†åŸŸåè§£æåˆ°è¿™ä¸ªå…¬ç½‘ IPã€‚
        
    - éœ€è¦è®¾ç½®è·¯ç”±å™¨ç«¯å£æ˜ å°„ï¼ˆNAT è½¬å‘ï¼‰ã€‚
        

---

### âœ… æ€»ç»“

> ä»…æœ‰åŸŸåæ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œè¦æƒ³è®©å…¨ä¸–ç•Œè®¿é—®åˆ°ä½ æœ¬åœ°çš„ Nginx æœåŠ¡ï¼Œ**ä½ å¿…é¡»å…·å¤‡å…¬ç½‘å…¥å£**ã€‚è¿™é€šå¸¸æ„å‘³ç€ä½ éœ€è¦ï¼š
> 
> - ä¹°ä¸€å°é˜¿é‡Œäº‘ï¼ˆæˆ–å…¶ä»–å‚å•†ï¼‰æœåŠ¡å™¨éƒ¨ç½² `frps`ï¼›
>     
> - æˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹å†…ç½‘ç©¿é€æœåŠ¡ï¼›
>     
> - æˆ–è€…å®¶é‡Œå®½å¸¦æœ‰å…¬ç½‘ IP å¹¶è®¾ç½®å¥½ç«¯å£æ˜ å°„ã€‚
>     

éœ€è¦æˆ‘å¸®ä½ æ­å»ºä¸€å¥—å®Œæ•´çš„ frp ç©¿é€æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ç³»ç»Ÿç¯å¢ƒï¼ˆå¦‚ Windows / Linuxï¼‰å’Œéœ€æ±‚ã€‚

ORM: object relation map,ä¸šåŠ¡å±‚æ“ä½œçš„éƒ½æ˜¯å¯¹è±¡ï¼ŒDAM: æ•°æ®å±‚æ‰æ¶‰åŠåˆ°å…·ä½“çš„æ“ä½œ

**å®‰è£…mysql è®°å¾—å®‰è£…å¼€å‘åŒ…ï¼Œæ‰å¯ä»¥å®ç°ç¼–å†™çš„ç¨‹åºä¸mysqlæœåŠ¡å™¨é€šä¿¡**

## ubuntuè‡ªå·±ä¸‹è½½çš„muduoåº“ç¼–è¯‘å‡º.aæ–‡ä»¶ï¼Œç°åœ¨æƒ³åŸºäºmuduoåº“å¼€å‘å¹¶é“¾æ¥å¤´æ–‡ä»¶ï¼Œåº“æ–‡ä»¶ï¼Œæœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆå—
åœ¨ Ubuntu ä¸Šä½¿ç”¨ä½ è‡ªå·±ç¼–è¯‘å¥½çš„ muduo åº“è¿›è¡Œ C++ å¼€å‘ï¼Œä¸€èˆ¬æµç¨‹åŒ…æ‹¬ï¼š

---

## âœ… ä¸€ã€å‡†å¤‡å·¥ä½œ

å‡è®¾ä½ å·²ç»åœ¨æŸä¸ªç›®å½•ä¸‹æˆåŠŸç¼–è¯‘å‡º `.a` é™æ€åº“æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š

```
~/libmuduo/
â”œâ”€â”€ include/        # muduo æ‰€æœ‰å¤´æ–‡ä»¶
â”œâ”€â”€ lib/            # ç¼–è¯‘ç”Ÿæˆçš„ .a æ–‡ä»¶
â”‚   â”œâ”€â”€ libmuduo_net.a
â”‚   â”œâ”€â”€ libmuduo_base.a
```

---

## âœ… äºŒã€ç»„ç»‡ä½ çš„é¡¹ç›®ç»“æ„ï¼ˆæ¨èï¼‰

```bash
my_muduo_project/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.cpp
â”œâ”€â”€ CMakeLists.txt
```

---

## âœ… ä¸‰ã€CMakeLists.txt ç¤ºä¾‹

```cmake
cmake_minimum_required(VERSION 3.10)
project(MyMuduoApp)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -pthread")

# 1. æŒ‡å®š muduo çš„å¤´æ–‡ä»¶è·¯å¾„
include_directories(/home/you/libmuduo/include)

# 2. æŒ‡å®š muduo çš„åº“è·¯å¾„
link_directories(/home/you/libmuduo/lib)

# 3. æ·»åŠ ä½ çš„æºæ–‡ä»¶
add_executable(MyMuduoApp src/main.cpp)

# 4. é“¾æ¥ muduo åº“ï¼ˆé¡ºåºå¾ˆé‡è¦ï¼‰
target_link_libraries(MyMuduoApp
    muduo_net
    muduo_base
    pthread
)
```

> âš ï¸ æ³¨æ„ï¼šmuduo çš„ä¸¤ä¸ªåº“ `muduo_base` å¿…é¡»å…ˆäº `muduo_net` é“¾æ¥ã€‚

---

## âœ… å››ã€ç¼–è¯‘å’Œè¿è¡Œ

```bash
cd my_muduo_project
mkdir build && cd build
cmake ..
make
./MyMuduoApp
```

---

## âœ… äº”ã€å»ºè®®

- **ä¿æŒå¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶åˆ†å¼€**ï¼Œä¾¿äºç®¡ç†ã€‚
    
- **ç”¨ CMake è€Œä¸æ˜¯æ‰‹å†™ g++ å‘½ä»¤**ï¼Œæ›´æ¸…æ™°å¯ç»´æŠ¤ã€‚
    
- å¦‚æœè¦å¤šä¸ªé¡¹ç›®éƒ½å¤ç”¨ï¼Œå¯ä»¥è€ƒè™‘å°† muduo å®‰è£…åˆ° `/usr/local` å¹¶ä½¿ç”¨ `find_package()` é…åˆ `CMAKE_INSTALL_PREFIX`ã€‚
    

---

å¦‚æœä½ è¿˜æ²¡æœ‰ç”¨ `make install` å®‰è£… muduoï¼Œæˆ‘ä¹Ÿå¯ä»¥æä¾›ç›¸å…³æ­¥éª¤ï¼ˆåŸºäºåŸå§‹ muduo æºç ï¼‰ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

## cmakelistsä¸­ï¼Œinclude_directories link_directories æ²¡æœ‰ç›¸å¯¹äºçš„target_ç‰ˆæœ¬å—ï¼Œæœ‰æ›´ç°ä»£çš„æ–¹æ³•å—
æ˜¯çš„ï¼Œ`include_directories()` å’Œ `link_directories()` æ˜¯ **æ—§å¼çš„å…¨å±€ä½œç”¨åŸŸå‘½ä»¤**ï¼Œä¸å†æ¨èç”¨äºç°ä»£ CMakeï¼ˆç‰¹åˆ«æ˜¯é’ˆå¯¹å¤§å‹é¡¹ç›®æˆ–åº“å¼€å‘ï¼‰ã€‚ç°ä»£ CMake æ¨èä½¿ç”¨ **åŸºäº `target_*` çš„æ¥å£é£æ ¼**ï¼Œä¹Ÿæ›´å®‰å…¨ã€å¯ç»´æŠ¤ã€‚

---

## âœ… æ›´ç°ä»£çš„æ–¹æ³•ï¼ˆæ¨èï¼‰

ä½¿ç”¨ä»¥ä¸‹ `target_include_directories()` å’Œ `target_link_libraries()`ï¼Œå°†ä¾èµ–ä½œç”¨åŸŸé™å®šåˆ°æŸä¸ªç›®æ ‡ä¸Šã€‚

### ç¤ºä¾‹ï¼šç°ä»£é£æ ¼ `CMakeLists.txt`

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyMuduoApp)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -pthread")

add_executable(MyMuduoApp src/main.cpp)

# 1. è®¾ç½®å¤´æ–‡ä»¶è·¯å¾„
target_include_directories(MyMuduoApp PRIVATE
    ${CMAKE_SOURCE_DIR}/third_party/muduo/include
)

# 2. é“¾æ¥ muduo é™æ€åº“ï¼ˆç”¨å®Œæ•´è·¯å¾„ï¼‰
target_link_libraries(MyMuduoApp PRIVATE
    ${CMAKE_SOURCE_DIR}/third_party/muduo/lib/libmuduo_net.a
    ${CMAKE_SOURCE_DIR}/third_party/muduo/lib/libmuduo_base.a
    pthread
)
```

---

## âœ… è¯´æ˜

|å‘½ä»¤|ä½œç”¨åŸŸ|æ¨èç¨‹åº¦|
|---|---|---|
|`include_directories()`|å…¨å±€|âŒ|
|`target_include_directories()`|é’ˆå¯¹ç›®æ ‡|âœ…|
|`link_directories()`|å…¨å±€|âŒ|
|`target_link_libraries()`|é’ˆå¯¹ç›®æ ‡|âœ…|

---

## âœ… BONUSï¼šè¿›ä¸€æ­¥æ¨¡å—åŒ–ï¼ˆå¦‚æœä½ å°†æ¥å°è£… muduo ä¸ºæ¨¡å—ï¼‰

ä½ ç”šè‡³å¯ä»¥ä¸º muduo è‡ªå·±å†™ä¸€ä¸ª `CMakeLists.txt`ï¼Œä½¿ç”¨ï¼š

```cmake
target_include_directories(muduo_base PUBLIC include/)
target_link_libraries(muduo_net PUBLIC muduo_base)
```

ç„¶ååœ¨ä½ çš„é¡¹ç›®ä¸­ï¼š

```cmake
add_subdirectory(third_party/muduo)
target_link_libraries(MyMuduoApp PRIVATE muduo_net)
```

è¿™å°±å˜æˆæ ‡å‡† CMake ç”Ÿæ€æ¨¡å—å¼å†™æ³•äº†ï¼Œæ›´å®¹æ˜“ç»´æŠ¤ã€‚

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ æŠŠæ•´ä¸ª muduo å°è£…ä¸ºç°ä»£ CMake é£æ ¼çš„åº“ï¼Œæ–¹ä¾¿è·¨é¡¹ç›®å¼•ç”¨ã€‚éœ€è¦å—ï¼Ÿ

## åœ¨ubuntuä¸Šå¼€å‘ç¨‹åºï¼Œæºä»£ç å·¥ç¨‹çš„è·¯å¾„æ”¾ç½®åœ¨å“ªé‡Œæ¯”è¾ƒæ¨è
åœ¨ Ubuntu ä¸Šå¼€å‘ç¨‹åºæ—¶ï¼Œ**é¡¹ç›®æºä»£ç çš„å­˜æ”¾è·¯å¾„**å»ºè®®éµå¾ªä»¥ä¸‹å‡ ä¸ªåŸåˆ™ï¼š**å®‰å…¨ã€è§„èŒƒã€æƒé™åˆç†ã€ä¾¿äºå¤‡ä»½ä¸ç‰ˆæœ¬ç®¡ç†**ã€‚ä»¥ä¸‹æ˜¯æ¨èçš„æ”¾ç½®è·¯å¾„åŠç†ç”±ï¼š

---

### âœ… **æ¨èè·¯å¾„ 1ï¼š`~/workspace/` æˆ– `~/projects/`**

- ç¤ºä¾‹è·¯å¾„ï¼š`/home/yourusername/workspace/myproject/`
    
- ç‰¹ç‚¹ï¼š
    
    - å®Œå…¨å±äºå½“å‰ç”¨æˆ·ï¼Œæ— éœ€ sudo æƒé™å³å¯è¯»å†™ã€‚
        
    - ä¸å½±å“ç³»ç»Ÿæ–‡ä»¶å’Œå…¶ä»–ç”¨æˆ·ã€‚
        
    - å®¹æ˜“ç”¨ Git ç®¡ç†ã€‚
        
    - ä¾¿äºå’Œå¼€å‘å·¥å…·ï¼ˆå¦‚ VSCodeã€CLionã€VS2022 SSHï¼‰é›†æˆã€‚
        

> âœ… **è¿™æ˜¯æœ€æ¨èçš„åšæ³•**ã€‚Ubuntu ä¸Šå¤§å¤šæ•°ç¨‹åºå‘˜éƒ½ä¼šè¿™ä¹ˆæ”¾ã€‚

---

### âœ… **æ¨èè·¯å¾„ 2ï¼š`~/Documents/` ä¸‹å»ºç«‹é¡¹ç›®ç›®å½•**

- ç¤ºä¾‹è·¯å¾„ï¼š`~/Documents/dev/myproject/`
    
- é€‚åˆæœ‰æ–‡æ¡£åˆ†ç±»éœ€æ±‚çš„ç”¨æˆ·ã€‚
    

---

### âš ï¸ **ä¸æ¨èçš„è·¯å¾„ï¼ˆå¸¸è§è¯¯åŒºï¼‰**

|è·¯å¾„|é—®é¢˜|
|---|---|
|`/usr/`ã€`/usr/local/`ã€`/etc/`|ç³»ç»Ÿç›®å½•ï¼Œå†™å…¥éœ€è¦ root æƒé™ï¼Œæ˜“è¯¯æ“ä½œç ´åç³»ç»Ÿ|
|`/opt/`|å°½ç®¡éƒ¨åˆ†å¼€æºè½¯ä»¶å®‰è£…åœ¨è¿™é‡Œï¼Œä½†ä¸æ¨èå­˜æ”¾ä¸ªäººæºç |
|`/tmp/`|ä¸´æ—¶ç›®å½•ï¼Œé‡å¯å¯èƒ½æ¸…ç©ºï¼Œæ–‡ä»¶ä¸å¯é |
|`/root/`|ä»… root å¯è®¿é—®ï¼Œä¸å®‰å…¨|

---

### ğŸ”§ å°å»ºè®®

1. **ç»Ÿä¸€ç»“æ„ä¾¿äºç®¡ç†**
    
    ```bash
    ~/workspace/
      â”œâ”€â”€ project1/
      â”œâ”€â”€ project2/
    ```
    
2. **ä½¿ç”¨ Git ç®¡ç†ä»£ç **  
    æŠŠ `~/workspace/project1/` åˆå§‹åŒ–ä¸º git ä»“åº“ï¼Œåˆ©äºç‰ˆæœ¬æ§åˆ¶ä¸å¤‡ä»½ã€‚
    
3. **ä½¿ç”¨ `.vscode` æˆ– `CMakeLists.txt` ç­‰å·¥ç¨‹æ–‡ä»¶**  
    æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œä¾¿äºè·¨å¹³å°å¼€å‘å·¥å…·è¯†åˆ«ã€‚
    

---

### ğŸ“Œ ç¤ºä¾‹

```bash
mkdir -p ~/workspace/mychatserver
cd ~/workspace/mychatserver
git init
# å¼€å§‹ç¼–å†™ä»£ç ã€é…ç½® CMakeLists.txt
```

---

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ VS2022 è¿œç¨‹å¼€å‘ã€VSCode + SSHã€CLion Remoteï¼Œæ”¾åœ¨ `~/workspace/` æ˜¯æœ€å®‰å…¨å…¼å®¹çš„é€‰æ‹©ã€‚

æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ è®¾è®¡ä¸€ä¸ªåŸºæœ¬çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼Ÿ

## target_include_directories()ä¼šé€’å½’å…¶åŒ…æ‹¬ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹å—

`target_include_directories()` **ä¸ä¼šé€’å½’åœ°åŒ…å«å…¶ç›®å½•ä¸‹çš„å­ç›®å½•**ã€‚

---

### âœ… æ­£ç¡®ç†è§£ï¼š

```cmake
target_include_directories(MyTarget PRIVATE /path/to/include)
```

è¿™æ¡å‘½ä»¤åªä¼šè®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ `MyTarget` æ—¶ï¼ŒæŸ¥æ‰¾å¤´æ–‡ä»¶æ—¶åŒ…å« `/path/to/include` è¿™ä¸ªç›®å½•æœ¬èº«ã€‚

å¦‚æœä½ æƒ³åŒ…å« `/path/to/include/subdir1`ã€`/path/to/include/subdir2` ç­‰å­ç›®å½•ï¼Œ**éœ€è¦ä½ æ‰‹åŠ¨åˆ—å‡º**ï¼š

```cmake
target_include_directories(MyTarget PRIVATE 
    /path/to/include
    /path/to/include/subdir1
    /path/to/include/subdir2
)
```

---

### ğŸš« ä¸ºä»€ä¹ˆä¸é€’å½’ï¼Ÿ

C++ ç¼–è¯‘å™¨çš„ `-I` å‚æ•°æœ¬èº«å°±ä¸æ”¯æŒé€’å½’åœ°æŸ¥æ‰¾å¤´æ–‡ä»¶ã€‚ä½ å†™ `#include "subdir1/foo.h"` æ—¶ï¼Œç¼–è¯‘å™¨ä¸ä¼šåœ¨ `/path/to/include` ä¸‹é€’å½’å»æ‰¾ `subdir1/foo.h`ï¼Œå®ƒåªæ£€æŸ¥ä½ æ˜¾å¼åŠ å…¥çš„è·¯å¾„ã€‚

---

### âœ… æ¨èåšæ³•ï¼š

- **ä¿æŒå¤´æ–‡ä»¶ç»„ç»‡æ¸…æ™°**ï¼Œè®©ç”¨æˆ·åªéœ€è¦ `#include <foo.h>`ã€‚
    
- æˆ–è€…ä½¿ç”¨å‘½åç©ºé—´å¼ç»„ç»‡è·¯å¾„ï¼Œæ¯”å¦‚ï¼š
    
    ```cpp
    #include <mylib/foo/bar.h>
    ```
    
    ç„¶ååªéœ€è¦ï¼š
    
    ```cmake
    target_include_directories(MyTarget PRIVATE ${PROJECT_SOURCE_DIR}/include)
    ```
    

---

å¦‚ä½ ç¡®å®éœ€è¦è‡ªåŠ¨é€’å½’æ‰€æœ‰å­ç›®å½•ï¼ˆä¸æ¨èï¼‰ï¼Œä½ å¯ä»¥åœ¨ CMake ä¸­å†™ä¸€æ®µä»£ç ï¼š

```cmake
file(GLOB_RECURSE all_include_dirs LIST_DIRECTORIES true "${CMAKE_CURRENT_SOURCE_DIR}/include/*")
target_include_directories(MyTarget PRIVATE ${all_include_dirs})
```

âš ï¸ ä½†è¿™æ ·å¯èƒ½ä¼šå¼•å…¥å¤ªå¤šä¸å¿…è¦çš„ç›®å½•ï¼Œå¢åŠ æ„å»ºå¤æ‚åº¦ï¼Œä¸å»ºè®®ç”¨äºå¤§å‹é¡¹ç›®ã€‚

---

éœ€è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªè‡ªåŠ¨åŒ…å«æ‰€æœ‰å­ç›®å½•çš„ CMake å‡½æ•°å—ï¼Ÿ

## target_include_directories(server PRIVATE ${PROJECT_SOURCE_DIR}/include)å…¶ä¸­çš„private public æœ‰ä»€ä¹ˆåŒºåˆ«
åœ¨ `target_include_directories()` ä¸­ï¼Œ`PRIVATE`ã€`PUBLIC` å’Œ `INTERFACE` è¿™ä¸‰ä¸ªå…³é”®å­—è¡¨ç¤º **åŒ…å«è·¯å¾„çš„å¯è§æ€§ï¼ˆvisibilityï¼‰**ï¼Œç”¨äºæ§åˆ¶è¿™ä¸ªè·¯å¾„æ˜¯å¦ä¼ é€’ç»™å…¶ä»–ä¾èµ–å®ƒçš„ç›®æ ‡ã€‚

---

### ğŸ”¹ ä½œç”¨å¯¹æ¯”å¦‚ä¸‹ï¼š

|å¯è§æ€§ä¿®é¥°ç¬¦|ä¼ é€’ç»™ç›®æ ‡æœ¬èº«|ä¼ é€’ç»™ä¾èµ–å®ƒçš„å…¶ä»–ç›®æ ‡|
|---|---|---|
|`PRIVATE`|âœ… æ˜¯|âŒ å¦|
|`PUBLIC`|âœ… æ˜¯|âœ… æ˜¯|
|`INTERFACE`|âŒ å¦|âœ… æ˜¯|

---

### ğŸ”¸ ä¸¾ä¸ªä¾‹å­ï¼š

å‡è®¾ä½ æœ‰ä¸¤ä¸ªç›®æ ‡ï¼š

```cmake
add_library(libA ...)
target_include_directories(libA PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/include)

add_executable(App ...)
target_link_libraries(App libA)
```

- å¦‚æœ `libA` ä½¿ç”¨çš„æ˜¯ `PUBLIC`ï¼Œé‚£ä¹ˆ `App` ç¼–è¯‘æ—¶ä¹Ÿä¼šè‡ªåŠ¨åŠ ä¸Š `-I${CMAKE_CURRENT_SOURCE_DIR}/include`ã€‚
    
- å¦‚æœæ˜¯ `PRIVATE`ï¼Œé‚£è¿™ä¸ª `include` ç›®å½•ä»…ä¾› `libA` ä½¿ç”¨ï¼Œ`App` ç¼–è¯‘æ—¶ä¸ä¼šçœ‹åˆ°ã€‚
    
- å¦‚æœæ˜¯ `INTERFACE`ï¼Œè¡¨ç¤ºè¿™ä¸ªç›®å½•æ˜¯æš´éœ²ç»™ä½¿ç”¨è€…ï¼ˆ`App`ï¼‰ï¼Œä½† `libA` æœ¬èº«ä¸éœ€è¦è¿™ä¸ª `include` è·¯å¾„ï¼ˆå¸¸ç”¨äºå¤´æ–‡ä»¶-only çš„åº“ï¼‰ã€‚
    

---

### âœ… æ¨èä½¿ç”¨ç­–ç•¥ï¼š

|ä½¿ç”¨åœºæ™¯|å»ºè®®ç”¨æ³•|
|---|---|
|å¤´æ–‡ä»¶åªåœ¨å½“å‰ç›®æ ‡ä¸­ä½¿ç”¨|`PRIVATE`|
|å¤´æ–‡ä»¶åŒæ—¶ä¾›å½“å‰ç›®æ ‡å’Œå…¶ä»–ç›®æ ‡ä½¿ç”¨|`PUBLIC`|
|å½“å‰ç›®æ ‡ä¸éœ€è¦ï¼Œä½†ä¾èµ–ç›®æ ‡éœ€è¦|`INTERFACE`|

---

### ğŸ’¡ å°ç»“

ä½ å†™çš„ï¼š

```cmake
target_include_directories(server PRIVATE ${PROJECT_SOURCE_DIR}/include)
```

æ„å‘³ç€è¿™äº›å¤´æ–‡ä»¶è·¯å¾„ä»…ç”¨äº `server` è¿™ä¸ªç›®æ ‡ï¼Œ**ä¸ä¼šä¼ æ’­ç»™å…¶ä»– link åˆ° `server` çš„ç›®æ ‡**ï¼Œè¿™æ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯é»˜è®¤æœ€å®‰å…¨çš„å†™æ³•ã€‚

---

å¦‚æœä½ è¿˜ç”¨ `target_link_libraries()` æŠŠ `server` é“¾æ¥åˆ°åˆ«çš„ç›®æ ‡ä¸Šï¼Œå¹¶å¸Œæœ›å®ƒä»¬ä¹Ÿç»§æ‰¿è¿™ä¸ª `include` è·¯å¾„ï¼Œé‚£å°±ç”¨ `PUBLIC`ã€‚

è¦ä¸è¦æˆ‘å¸®ä½ ç”¨å›¾ç¤ºæ–¹å¼æ€»ç»“ä¸€ä¸‹ï¼Ÿ

## æ‰€è°“çš„æš´éœ²ç»™ä½¿ç”¨è€…ï¼Œæ„æ€æ˜¯ä½¿ç”¨è€…ç›´æ¥åœ¨æºæ–‡ä»¶ä¸­#includeè¯¥æ–‡ä»¶å°±å¯ä»¥ï¼Œä¸å¿…è‡ªå·±å†å»targer_include_directorieså—
å¯¹çš„ï¼Œä½ ç†è§£å¾—å¾ˆå‡†ç¡®ã€‚æ‰€è°“çš„**â€œæš´éœ²ç»™ä½¿ç”¨è€…â€**ï¼Œåœ¨ CMake ä¸­çš„æ„æ€å°±æ˜¯ï¼š

> **ä½¿ç”¨è¿™ä¸ªç›®æ ‡ï¼ˆtargetï¼‰çš„å…¶ä»–ç›®æ ‡**ï¼Œåœ¨ç¼–è¯‘æ—¶ä¹Ÿä¼šè‡ªåŠ¨æ‹¥æœ‰è¿™äº› `include` è·¯å¾„ï¼Œæ— éœ€æ‰‹åŠ¨å†å†™ `target_include_directories()`ã€‚

---

### ğŸ”¹ ä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼š

ä½ æœ‰ä¸€ä¸ªå¤´æ–‡ä»¶ `include/foo/Util.h`ï¼Œå®ƒå±äºåº“ `libfoo`ï¼š

```cmake
add_library(libfoo ...)
target_include_directories(libfoo PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/include)
```

ç„¶åä½ æœ‰ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºä¾èµ–å®ƒï¼š

```cmake
add_executable(myapp main.cpp)
target_link_libraries(myapp libfoo)
```

åœ¨ `main.cpp` ä¸­ä½ ç›´æ¥è¿™æ ·å†™ï¼š

```cpp
#include <foo/Util.h>
```

ğŸ’¡ **ä¸éœ€è¦å†ç»™ `myapp` å•ç‹¬å†™ `target_include_directories()`**ï¼Œå› ä¸º `libfoo` çš„ `include` è·¯å¾„å·²ç»é€šè¿‡ `PUBLIC` è‡ªåŠ¨ä¼ æ’­ç»™ `myapp` äº†ã€‚

---

### ğŸ”¸ å¦‚æœæ˜¯ `PRIVATE` å‘¢ï¼Ÿ

```cmake
target_include_directories(libfoo PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/include)
```

é‚£ä½ åœ¨ `main.cpp` ä¸­ `#include <foo/Util.h>` ä¼šæŠ¥é”™ï¼Œ**å› ä¸º `myapp` å¹¶ä¸çŸ¥é“ `libfoo` éœ€è¦çš„å¤´æ–‡ä»¶è·¯å¾„**ã€‚

---

### ğŸ”¹ å¦‚æœæ˜¯ `INTERFACE` å‘¢ï¼Ÿ

```cmake
add_library(onlyheaders INTERFACE)
target_include_directories(onlyheaders INTERFACE ${CMAKE_CURRENT_SOURCE_DIR}/include)
```

è¿™æ˜¯ç”¨äº **çº¯å¤´æ–‡ä»¶åº“** çš„å…¸å‹å†™æ³•ï¼Œè¿™ç§åº“ä¸ç¼–è¯‘ï¼Œä½†å…¶ä»–ç›®æ ‡ `target_link_libraries()` å®ƒåå°±èƒ½æ‹¿åˆ°å®ƒçš„ `include` è·¯å¾„ã€‚

---

### âœ… å°ç»“ä¸€å¥è¯

> **æ˜¯å¦è¦â€œæš´éœ²ç»™ä½¿ç”¨è€…â€ï¼Œå–å†³äºè¿™ä¸ªå¤´æ–‡ä»¶æ˜¯å¦æ˜¯åº“æ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨è€…æ˜¯å¦ä¼š `#include` åˆ°å®ƒã€‚**

éœ€è¦æˆ‘å¸®ä½ æ•´ç†ä¸€å¼ è¡¨æˆ–ç¤ºæ„å›¾æ›´ç›´è§‚å—ï¼Ÿ
## ç­‰ä»·äºtarget_include_directories(myapp PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/include) ï¼Œå¦‚æœmyappä½äºåˆ«çš„æ–‡ä»¶å¤¹ï¼Œ$CMAKE_CURRENT_SOURCE_DIRè¿™ä¸ªå˜é‡ä¸å°±å±•å¼€ä¸ºmyappæ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªincludeä¸­çš„å†…å®¹å°±æ˜¯myappè‡ªå·±çš„includeç›®å½•ï¼Œè¿™æ ·å°±ä¸èƒ½includeåˆ°foo.häº†
å¯¹ï¼Œä½ è¿™ä¸ªé—®é¢˜é—®å¾—éå¸¸ç»†ï¼è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®ç‚¹éœ€è¦æ¾„æ¸…ï¼š

---

### ğŸ”‘ `target_include_directories()` é‡Œåˆ°åº•å­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿ

å½“ä½ å†™ï¼š

```cmake
target_include_directories(libfoo PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/include)
```

- è¿™ä¸ªè¯­å¥æ˜¯åœ¨ **å®šä¹‰ libfoo çš„é‚£ä¸ª CMakeLists.txt æ–‡ä»¶** ä¸­æ‰§è¡Œçš„
    
- æ‰€ä»¥ `$CMAKE_CURRENT_SOURCE_DIR` ä¼šå±•å¼€æˆ **libfoo æ‰€åœ¨ç›®å½•**ï¼Œæ¯”å¦‚ï¼š
    

```
/project/libfoo/include
```

- CMake ä¼šæŠŠè¿™ä¸ªç»å¯¹è·¯å¾„ï¼ˆä¸æ˜¯å˜é‡è¡¨è¾¾å¼ï¼‰å­˜åˆ° `libfoo` target çš„ usage requirements é‡Œã€‚
    

---

### ğŸ”‘ å½“ myapp é“¾æ¥åˆ° libfoo æ—¶

```cmake
target_link_libraries(myapp libfoo)
```

- CMake ä¼šæŠŠ `libfoo` çš„ **PUBLIC include è·¯å¾„** ä¼ æ’­ç»™ `myapp`
    
- æ³¨æ„ï¼šè¿™æ—¶å€™ä¼ æ’­çš„æ˜¯ **ä¹‹å‰å·²ç»å±•å¼€è¿‡çš„ç»å¯¹è·¯å¾„**
    
- æ‰€ä»¥ `myapp` æ— è®ºåœ¨å“ªä¸ªç›®å½•ï¼Œå®ƒæ”¶åˆ°çš„ include path ä»ç„¶æ˜¯ï¼š
    

```
/project/libfoo/include
```

è€Œä¸æ˜¯ `${CMAKE_CURRENT_SOURCE_DIR}/include` å†æ¬¡å±•å¼€ã€‚

---

### ğŸ”‘ ä¸¾ä¾‹

ç›®å½•ç»“æ„ï¼š

```
project/
  libfoo/
    include/foo/Util.h
    CMakeLists.txt   # å®šä¹‰ libfoo
  app/
    main.cpp
    CMakeLists.txt   # å®šä¹‰ myapp
```

libfoo çš„ CMakeLists.txtï¼š

```cmake
add_library(libfoo ...)
target_include_directories(libfoo PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/include)
```

è¿™é‡Œ `${CMAKE_CURRENT_SOURCE_DIR}` = `/project/libfoo`

æ‰€ä»¥ä¼ æ’­ç»™ `myapp` çš„è·¯å¾„æ˜¯ï¼š

```
/project/libfoo/include
```

å› æ­¤åœ¨ `app/main.cpp` ä¸­å†™ï¼š

```cpp
#include <foo/Util.h>
```

å°±èƒ½ç¼–è¯‘é€šè¿‡ã€‚

---

âœ… **æ€»ç»“**

- `target_include_directories()` å­˜è¿›å»çš„å…¶å®æ˜¯ **ç»å¯¹è·¯å¾„**ï¼Œä¸æ˜¯åŠ¨æ€å˜é‡
    
- `myapp` é“¾æ¥ `libfoo` æ—¶ï¼ŒCMake æŠŠç»å¯¹è·¯å¾„ä¼ æ’­è¿‡å»
    
- æ‰€ä»¥ä¸ç®¡ `myapp` çš„ CMakeLists åœ¨å“ªä¸ªæ–‡ä»¶å¤¹ï¼Œè·¯å¾„éƒ½æ­£ç¡®ï¼Œä¸ä¼šé”™åˆ° â€œmyapp çš„ç›®å½•/includeâ€
    

---

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä»½å° demoï¼ˆlibfoo + myapp ä¸¤ä¸ªå­ç›®å½•ï¼‰ï¼Œç”¨ `cmake --trace-expand` æ‰“å°å‡º include è·¯å¾„çš„ä¼ æ’­è¿‡ç¨‹ï¼Ÿè¿™æ ·ä½ èƒ½äº²çœ¼çœ‹åˆ°å˜é‡æ˜¯æ€ä¹ˆå±•å¼€çš„ã€‚
## è¿™ç§æƒ…å†µä¸‹appé‡Œçš„cmakelistsè¯¥æ€ä¹ˆå†™ï¼Œåªéœ€è¦target_link_directoies(app ../libfoo)å—
å·®ç‚¹ç‚¹æ„æ€ ğŸ™‚ã€‚  
åœ¨ CMake é‡Œï¼Œå¦‚æœä½ æƒ³è¦ **app ä¾èµ– libfoo**ï¼Œé€šå¸¸ä¸æ˜¯ç”¨ `target_link_directories()`ï¼Œè€Œæ˜¯ç”¨ `add_subdirectory()` æˆ– `find_package()` æŠŠ `libfoo` çš„ target å¼•è¿›æ¥ï¼Œç„¶å `target_link_libraries()`ã€‚

---

### 1ï¸âƒ£ å¦‚æœ app å’Œ libfoo åœ¨åŒä¸€ä¸ªå·¥ç¨‹é‡Œï¼ˆæ¨èï¼‰

ç›®å½•ç»“æ„ï¼š

```
project/
  libfoo/
    CMakeLists.txt   # å®šä¹‰ add_library(libfoo â€¦)
    include/foo/Util.h
  app/
    CMakeLists.txt   # å®šä¹‰ add_executable(app â€¦)
    main.cpp
  CMakeLists.txt     # é¡¶å±‚
```

é¡¶å±‚ `CMakeLists.txt`ï¼š

```cmake
cmake_minimum_required(VERSION 3.16)
project(myproj)

add_subdirectory(libfoo)
add_subdirectory(app)
```

`app/CMakeLists.txt`ï¼š

```cmake
add_executable(myapp main.cpp)
target_link_libraries(myapp PRIVATE libfoo)
```

âœ… è¿™æ ·å°±è¡Œäº†ï¼Œ**ä¸éœ€è¦ `target_include_directories()`**ï¼Œå› ä¸º libfoo çš„ `PUBLIC` include å·²ç»ä¼ æ’­è¿‡æ¥äº†ã€‚  
ä¹Ÿ **ä¸éœ€è¦ `target_link_directories()`**ï¼Œé‚£æ˜¯ç»™â€œè£¸åº“æ–‡ä»¶â€çš„åœºæ™¯ç”¨çš„ã€‚

---

### 2ï¸âƒ£ å¦‚æœ libfoo æ˜¯å•ç‹¬å®‰è£…å¥½çš„åº“

ä¾‹å¦‚ä½  `install(TARGETS libfoo â€¦)` ä¹‹åï¼Œå®‰è£…åˆ°äº†ç³»ç»Ÿè·¯å¾„ `/usr/local/lib` å’Œ `/usr/local/include`ï¼ŒåŒæ—¶ç”Ÿæˆäº† `libfooConfig.cmake`ã€‚  
é‚£åœ¨ app çš„ CMakeLists é‡Œå°±æ˜¯ï¼š

```cmake
find_package(libfoo REQUIRED)
add_executable(myapp main.cpp)
target_link_libraries(myapp PRIVATE libfoo::libfoo)
```

CMake ä¼šè‡ªåŠ¨æ‰¾åˆ° libfoo çš„ include å’Œåº“è·¯å¾„ã€‚

---

### 3ï¸âƒ£ å¦‚æœä½ æ‰‹é‡Œåªæœ‰ä¸€ä¸ªè£¸ `.a` / `.so` æ–‡ä»¶ï¼ˆä¸æ¨èï¼‰

è¿™ç§æƒ…å†µä¸‹ï¼ŒCMake æ²¡æœ‰ usage requirements å¯ä»¥ä¼ æ’­ï¼Œåªèƒ½è‡ªå·±æ‰‹åŠ¨å†™ï¼š

```cmake
add_executable(myapp main.cpp)
target_include_directories(myapp PRIVATE ../libfoo/include)
target_link_directories(myapp PRIVATE ../libfoo/build)
target_link_libraries(myapp PRIVATE foo)   # libfoo.a æˆ– libfoo.so
```

è¿™ä¸ªæ‰ä¼šç”¨åˆ° `target_link_directories()`ã€‚

---

âœ… **æ€»ç»“**

- å¦‚æœä½ æ˜¯è‡ªå·±ç»´æŠ¤ libfoo çš„æºç  â†’ ç”¨ `add_subdirectory(libfoo)` + `target_link_libraries(app libfoo)` å°±è¡Œã€‚
    
- å¦‚æœä½ æ˜¯ç”¨åˆ«äººå®‰è£…å¥½çš„åº“ â†’ `find_package()`ã€‚
    
- åªæœ‰åœ¨â€œå­¤ç«‹çš„ .so/.a æ–‡ä»¶â€æƒ…å†µä¸‹ï¼Œæ‰éœ€è¦ `target_link_directories()`ã€‚
    

---
**æˆ‘è‡ªå·±å†™ä»£ç éªŒè¯äº†ä»¥ä¸‹ï¼Œç¡®å®æ˜¯publicçš„è¯ä¸ç”¨target include directoriesäº†ï¼Œå¦‚æœæ”¹æˆprivateçš„è¯ï¼Œåˆ™ä¸è¡Œï¼Œä¼šæç¤ºæ‰¾ä¸åˆ°.hæ–‡ä»¶**
è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªæœ€å° demoï¼ˆlibfoo + myappï¼Œä¸¤ä¸ªå­ç›®å½•çš„ CMakeListsï¼‰ï¼Ÿè¿™æ ·ä½ ç›´æ¥å¤åˆ¶è·‘ cmakeï¼Œå°±èƒ½çœ‹åˆ° `#include <foo/Util.h>` èƒ½æ­£å¸¸ç¼–è¯‘ã€‚
## cmakelistä¸­ add_execuable()å’Œtarget_include_directory()å“ªä¸ªå†™å‰é¢ï¼Œå“ªä¸ªå†™åé¢æœ‰è¦æ±‚å˜›
åœ¨ CMake ä¸­ï¼Œ`add_executable()` å’Œ `target_include_directories()` çš„**é¡ºåºæ˜¯æœ‰è¦æ±‚çš„**ï¼Œå¿…é¡»å…ˆè°ƒç”¨ `add_executable()`ï¼Œå†è°ƒç”¨ `target_include_directories()`ã€‚åŸå› å¦‚ä¸‹ï¼š

---

### âœ… æ­£ç¡®é¡ºåºï¼š

```cmake
add_executable(MyApp main.cpp)
target_include_directories(MyApp PRIVATE ${CMAKE_SOURCE_DIR}/include)
```

---

### âŒ é”™è¯¯é¡ºåºï¼ˆè¿™å°†æŠ¥é”™ï¼‰ï¼š

```cmake
target_include_directories(MyApp PRIVATE ${CMAKE_SOURCE_DIR}/include) # é”™è¯¯ï¼šæ­¤æ—¶ MyApp å°šæœªå®šä¹‰
add_executable(MyApp main.cpp)
```

---

### åŸå› è§£é‡Šï¼š

- `target_include_directories()` æ˜¯**é’ˆå¯¹å·²æœ‰ç›®æ ‡ï¼ˆtargetï¼‰**è®¾ç½®å±æ€§çš„å‘½ä»¤ï¼›
    
- `add_executable()` æ˜¯**å®šä¹‰ç›®æ ‡ï¼ˆtargetï¼‰**çš„å‘½ä»¤ï¼›
    
- å› æ­¤ä½ **å¿…é¡»å…ˆå®šä¹‰ç›®æ ‡ï¼Œå†è®¾ç½®å®ƒçš„å±æ€§**ï¼ˆæ¯”å¦‚ include ç›®å½•ã€é“¾æ¥åº“ç­‰ï¼‰ï¼›
    

---

### ç±»ä¼¼è§„åˆ™é€‚ç”¨äºå…¶ä»– target å‘½ä»¤ï¼š

|å‘½ä»¤|ä½œç”¨|ä¾èµ– `add_executable()` æˆ– `add_library()`|
|---|---|---|
|`target_link_libraries()`|è®¾ç½®é“¾æ¥åº“|âœ… éœ€è¦å…ˆå®šä¹‰ç›®æ ‡|
|`target_compile_definitions()`|è®¾ç½®å®å®šä¹‰|âœ… éœ€è¦å…ˆå®šä¹‰ç›®æ ‡|
|`target_sources()`|æ·»åŠ æºç |âœ… éœ€è¦å…ˆå®šä¹‰ç›®æ ‡|

---

### æ€»ç»“ï¼š

- âœ… **å…ˆå†™** `add_executable(...)`
    
- âœ… **åå†™** `target_include_directories(...)` ç­‰å±æ€§è®¾ç½®å‘½ä»¤
    

è¿™æ˜¯ä¸€æ¡é€šç”¨è§„åˆ™ï¼Œå»ºè®®ä½ æ€»æ˜¯å…ˆå®šä¹‰ targetï¼Œå†è®¾ç½®å®ƒçš„å±æ€§ã€‚è¿™æ ·ç»“æ„æ¸…æ™°ï¼ŒCMake ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚
## cmakelistä¸­ project() ä¸­çš„å†…å®¹å¯ä»¥å’Œadd_execuable() ä¸­çš„å†…å®¹ä¸ä¸€æ ·å—ï¼Œå¯ä»¥çš„è¯ï¼Œé‚£projectæœ‰ä»€ä¹ˆç”¨å‘¢

æ˜¯çš„ï¼Œ`project()` å’Œ `add_executable()` ä¸­çš„å†…å®¹**å¯ä»¥ä¸åŒ**ï¼Œå®ƒä»¬çš„ç”¨é€”å®Œå…¨ä¸åŒï¼Œä¹Ÿå¹¶ä¸å¼ºåˆ¶ä¸€è‡´ã€‚ä¸‹é¢æ˜¯è¯¦ç»†è§£é‡Šï¼š

---

## âœ… ä¸€ã€å®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

### `project(<name> [LANGUAGES ...])`

- **ä½œç”¨**ï¼šå®šä¹‰æ•´ä¸ª CMake å·¥ç¨‹çš„åç§°ã€è¯­è¨€ã€ç‰ˆæœ¬ç­‰ã€‚
    
- **å½±å“**ï¼š
    
    - è®¾ç½®äº†å˜é‡å¦‚ `PROJECT_NAME`ã€`PROJECT_SOURCE_DIR`ï¼›
        
    - æ˜¯æ•´ä¸ªæ„å»ºç³»ç»Ÿçš„é¡¶å±‚æ ‡è¯†ï¼ˆå°¤å…¶ç”¨äºå¤šæ¨¡å—/å­å·¥ç¨‹é¡¹ç›®ï¼‰ï¼›
        
    - ç”¨äº IDE è¯†åˆ«é¡¹ç›®åï¼ˆå¦‚ CLionã€Visual Studioï¼‰ï¼›
        
    - å¯æŒ‡å®šæ”¯æŒçš„ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Cã€CXXã€Fortran ç­‰ï¼‰ï¼›
        
- âœ… æ¯ä¸ªé¡¶å±‚ CMakeLists.txt å¿…é¡»æœ‰ä¸€ä¸ª `project()`ã€‚
    

ç¤ºä¾‹ï¼š

```cmake
project(MyAwesomeProject LANGUAGES CXX)
```

---

### `add_executable(<target> [sources...])`

- **ä½œç”¨**ï¼šå®šä¹‰ä¸€ä¸ªç›®æ ‡ç¨‹åºï¼ˆå³ç¼–è¯‘å‡ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ã€‚
    
- **å½±å“**ï¼š
    
    - ç”Ÿæˆå®é™…çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼›
        
    - åç§°éšä½ å®šä¹‰ï¼Œæ— éœ€ä¸ `project()` ç›¸åŒï¼›
        
    - åç»­å¯ç”¨è¯¥ç›®æ ‡åè®¾ç½® include è·¯å¾„ã€é“¾æ¥åº“ã€ç¼–è¯‘é€‰é¡¹ç­‰ï¼›
        

ç¤ºä¾‹ï¼š

```cmake
add_executable(MyTool main.cpp)
```

---

## âœ… äºŒã€æ˜¯å¦å¯ä»¥ä¸ä¸€æ ·ï¼Ÿæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ

å®Œå…¨å¯ä»¥ä¸åŒã€‚ä¾‹å¦‚ï¼š

```cmake
cmake_minimum_required(VERSION 3.16)
project(TeachingVideoGenerator LANGUAGES CXX)

add_executable(DataCompressor main.cpp compress.cpp)
```

- `project()` ä¸­çš„åå­—æ˜¯ `TeachingVideoGenerator`ï¼Œç”¨äºæè¿°æ•´ä¸ªé¡¹ç›®ï¼›
    
- `add_executable()` åˆ›å»ºçš„ç›®æ ‡å« `DataCompressor`ï¼Œè¿™æ˜¯ä½ çœŸæ­£è¦ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºï¼›
    

è¿™ç§æƒ…å†µåœ¨**ä¸€ä¸ªé¡¹ç›®æœ‰å¤šä¸ªå¯æ‰§è¡Œç¨‹åºæˆ–å¤šä¸ªåº“**æ—¶éå¸¸å¸¸è§ã€‚

---

## âœ… ä¸‰ã€æ€»ç»“åŒºåˆ«ä¸ç”¨é€”ï¼š

|æ–¹é¢|`project()`|`add_executable()`ï¼ˆæˆ– `add_library()`ï¼‰|
|---|---|---|
|ç”¨äºä»€ä¹ˆ|å®šä¹‰é¡¹ç›®åç§°ã€è¯­è¨€ã€ç‰ˆæœ¬ç­‰|å®šä¹‰ä¸€ä¸ªå…·ä½“çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæˆ–åº“ï¼‰ç›®æ ‡|
|æ˜¯å¦å¿…é¡»|é¡¶å±‚ CMakeLists.txt å¿…é¡»æœ‰|å¦‚æœè¦ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ï¼Œå¿…é¡»ä½¿ç”¨|
|åå­—æ˜¯å¦å¼ºåˆ¶ç›¸åŒ|âŒ ä¸è¦æ±‚ç›¸åŒ|åå­—è‡ªå®šä¹‰|
|å½±å“å“ªäº›å˜é‡|è®¾ç½® `PROJECT_NAME`ã€`PROJECT_SOURCE_DIR` ç­‰|è®¾ç½®ä¸€ä¸ª targetï¼Œåç»­é€šè¿‡ `target_*` å¤„ç†|
|å…¸å‹ä½¿ç”¨åœºæ™¯|å·¥ç¨‹æè¿°ã€IDEå±•ç¤ºã€è·¨å¹³å°é…ç½®åŸºç¡€|å®é™…ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“|

---

å¦‚ä½ è¿˜æœ‰é¡¹ç›®ç»“æ„æˆ–è€…å­ç›®å½•ï¼ˆ`add_subdirectory()`ï¼‰çš„éœ€æ±‚ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»§ç»­å¸®ä½ åˆ†æ `project()` åœ¨é‚£ç§æƒ…å¢ƒä¸‹çš„ä½œç”¨ã€‚

## å­å·¥ç¨‹ä¸­target_include_directories(server PRIVATE ${PROJECT_SOURCE_DIR}/include)ï¼Œè¯·é—®è¯¥ç›®å½•æ˜¯å½“å‰å­å·¥ç¨‹çš„includeè¿˜æ˜¯æ•´ä¸ªå·¥ç¨‹ç›®å½•ä¸‹çš„includeç›®å½•å‘¢
è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚

---

## ğŸ¯ ä½ é—®çš„æ˜¯ï¼š

```cmake
target_include_directories(server PRIVATE ${PROJECT_SOURCE_DIR}/include)
```

å…¶ä¸­çš„ `${PROJECT_SOURCE_DIR}/include` æŒ‡çš„æ˜¯ï¼š

- å½“å‰å­å·¥ç¨‹ç›®å½•ä¸‹çš„ `include/`ï¼Ÿ
    
- è¿˜æ˜¯æ•´ä¸ªé¡¶å±‚é¡¹ç›®ç›®å½•ä¸‹çš„ `include/`ï¼Ÿ
    

---

## âœ… ç­”æ¡ˆæ˜¯ï¼š**æœ€åä¸€æ¬¡å†™Project(XXX)çš„ `include/`**

ä¹Ÿå°±æ˜¯è¯´ï¼š

> `PROJECT_SOURCE_DIR` æ˜¯åœ¨æœ€åä¸€æ¬¡ä¹¦å†™ `project(...)` çš„é‚£ä¸ª **CMakeLists.txt** æ‰€åœ¨çš„è·¯å¾„ã€‚

---

## ğŸ“˜ ä¸¾ä¸ªä¾‹å­ï¼š

### å‡è®¾ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
MyProject/
â”œâ”€â”€ CMakeLists.txt              â† é¡¶å±‚
â”œâ”€â”€ include/
â”‚   â””â”€â”€ common.h
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ CMakeLists.txt          â† å­å·¥ç¨‹
â”‚   â””â”€â”€ server.cpp
```

---

### é¡¶å±‚ `CMakeLists.txt` å¯èƒ½æ˜¯ï¼š

```cmake
cmake_minimum_required(VERSION 3.16)
project(MyProject)

add_subdirectory(server)
```

---

### å­ç›®å½• `server/CMakeLists.txt` ä¸­ï¼š

```cmake
add_executable(server server.cpp)

target_include_directories(server PRIVATE ${PROJECT_SOURCE_DIR}/include)
```

æ­¤æ—¶ï¼š

- `PROJECT_SOURCE_DIR` çš„å€¼æ˜¯ **`${CMAKE_SOURCE_DIR}`ï¼Œä¹Ÿå°±æ˜¯ `MyProject/` çš„è·¯å¾„**ã€‚
    
- æ‰€ä»¥ `target_include_directories()` æŒ‡å‘çš„æ˜¯ `MyProject/include/`ï¼Œ**ä¸æ˜¯** `MyProject/server/include/`ã€‚
    

---

## ğŸ§  å¦‚æœä½ æƒ³å¼•ç”¨å½“å‰å­å·¥ç¨‹çš„è·¯å¾„æ€ä¹ˆåŠï¼Ÿ

ä½ å¯ä»¥ç”¨ï¼š

| ç”¨æ³•                            | å«ä¹‰                                           |
| ----------------------------- | -------------------------------------------- |
| `${CMAKE_CURRENT_SOURCE_DIR}` | å½“å‰ `CMakeLists.txt` æ‰€åœ¨ç›®å½•                     |
| `${CMAKE_CURRENT_LIST_DIR}`   | å½“å‰è¢«å¤„ç†çš„ CMake è„šæœ¬æ‰€åœ¨ç›®å½•ï¼ˆå¾ˆåƒä¸Šé¢çš„ï¼‰                   |
| `${CMAKE_SOURCE_DIR}`         | é¡¶å±‚å·¥ç¨‹ç›®å½•                                       |
| `${PROJECT_SOURCE_DIR}`       | æœ€åä¸€æ¬¡å†™Project()æ‰€åœ¨ CMakeLists.txt çš„è·¯å¾„ï¼ˆé€šå¸¸å’Œä¸Šé¢ç›¸åŒï¼‰ |

æ‰€ä»¥å¦‚æœä½ æƒ³å¼•ç”¨ `server/` å­ç›®å½•ä¸­çš„ `include/` ç›®å½•ï¼Œåº”è¯¥è¿™æ ·å†™ï¼š

```cmake
target_include_directories(server PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/include)
```

---

## âœ… æ€»ç»“ï¼š

| å˜é‡å                        | è·¯å¾„å«ä¹‰                   | ç”¨é€”              |
| -------------------------- | ---------------------- | --------------- |
| `CMAKE_SOURCE_DIR`         | é¡¶å±‚å·¥ç¨‹ç›®å½•                 | æŒ‡å‘æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•       |
| `CMAKE_CURRENT_SOURCE_DIR` | å½“å‰ CMakeLists.txt æ‰€åœ¨ç›®å½• | æŒ‡å‘å½“å‰å­æ¨¡å—æˆ–å­å·¥ç¨‹æ‰€åœ¨ç›®å½• |

> æ‰€ä»¥ä½ çš„å†™æ³•æŒ‡å‘çš„æ˜¯æ•´ä¸ªé¡¹ç›®çš„ include æ–‡ä»¶å¤¹ã€‚å¦‚æœä½ è¦ç”¨å­æ¨¡å—çš„ includeï¼Œå°±è¦æ¢æˆ `${CMAKE_CURRENT_SOURCE_DIR}/include`ã€‚

å¦‚ä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å†å¸®ä½ æ£€æŸ¥æ•´ä¸ªå­é¡¹ç›®ç»“æ„çš„ç»„ç»‡æ–¹å¼æ˜¯å¦åˆç†ã€‚

## æ‰€ä»¥ï¼Œæˆ‘å¯ä»¥ç›´æ¥åœ¨server.cppä¸­#includeæ•´ä¸ªå·¥ç¨‹ç›®å½•ä¸‹çš„æŸä¸ªcommon.hæ–‡ä»¶ï¼Œä¸ç”¨#include â€œ../include/common.hâ€æ˜¯å—
æ˜¯çš„ï¼Œä½ ç†è§£å¾—å®Œå…¨æ­£ç¡®ï¼Œåªè¦ä½ åœ¨ CMake ä¸­æ­£ç¡®ä½¿ç”¨äº† `target_include_directories()` æŒ‡å‘äº†æ•´ä¸ªå·¥ç¨‹ç›®å½•ä¸‹çš„ `include` ç›®å½•ï¼Œå°±**ä¸éœ€è¦åœ¨ `server.cpp` ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `../include/common.h`**ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥ï¼š

```cpp
#include "common.h"
```

---

## âœ… å…·ä½“æ¡ä»¶

ä½ åœ¨ `server/CMakeLists.txt` ä¸­è¿™æ ·å†™ï¼š

```cmake
target_include_directories(server PRIVATE ${PROJECT_SOURCE_DIR}/include)
```

åªè¦è¿™ä¸ªç›®å½•ä¸‹æœ‰ `common.h` æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š

```
MyProject/
â”œâ”€â”€ include/
â”‚   â””â”€â”€ common.h
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â””â”€â”€ server.cpp
```

---

## âœ… é‚£ä¹ˆä½ åœ¨ `server.cpp` ä¸­å¯ä»¥ç›´æ¥è¿™æ ·å†™ï¼š

```cpp
#include "common.h"
```

è¿™æ˜¯å› ä¸ºä½ å·²ç»å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œå½“ä½ æ‰¾å¤´æ–‡ä»¶æ—¶ï¼Œè¯·åœ¨ `${PROJECT_SOURCE_DIR}/include` ä¸­æ‰¾ã€‚â€

---

## ğŸš« ä¸æ¨èå†™æ³•ï¼š

```cpp
#include "../include/common.h"
```

**ä¸æ¨èåŸå› ï¼š**

- è·¯å¾„ç¡¬ç¼–ç ï¼Œé¡¹ç›®ç»“æ„ä¸€å˜å°±å‡ºé”™ï¼›
    
- å¯ç§»æ¤æ€§å·®ï¼›
    
- IDE çš„ç´¢å¼•ã€è·³è½¬åŠŸèƒ½ä¹Ÿä¸å¥½ç”¨ï¼›
    
- ä¸ç¬¦åˆç°ä»£ CMake çš„ç†å¿µã€‚
    

---

## ğŸ”§ è¡¥å……å»ºè®®ï¼š

å¦‚æœä½ å¸Œæœ›æ›´æ¸…æ™°åœ°ç»„ç»‡å¤´æ–‡ä»¶ï¼Œå¯ä»¥æŠŠ `include` ç›®å½•ç»“æ„å†ä¼˜åŒ–ä¸ºå¸¦å‘½åç©ºé—´é£æ ¼ï¼Œä¾‹å¦‚ï¼š

```
include/
â””â”€â”€ myproject/
    â””â”€â”€ common.h
```

CMake ä»ç„¶ï¼š

```cmake
target_include_directories(server PRIVATE ${PROJECT_SOURCE_DIR}/include)
```

ç„¶åä½ å°±å¯ä»¥åœ¨ `server.cpp` ä¸­è¿™æ ·å†™ï¼š

```cpp
#include "myproject/common.h"
```

è¿™æ ·æ›´æ¸…æ™°ï¼Œä¹Ÿæ›´ç¬¦åˆå¤§å‹é¡¹ç›®çš„å¤´æ–‡ä»¶ç»„ç»‡è§„èŒƒã€‚

---

å¦‚ä½ éœ€è¦æˆ‘å¸®ä½ æ•´ç†ä¸€ä»½æ ‡å‡†çš„ CMake é¡¹ç›®ç›®å½•ç»“æ„æˆ–å…¬å…±å¤´æ–‡ä»¶ç®¡ç†æ–¹å¼ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ã€‚

## mysqlé€šè¿‡aptå®‰è£…åœ¨ubuntuä¸Šï¼ŒåŒæ—¶å®‰è£…æœ‰mysql-client-dev,æˆ‘æƒ³åœ¨å·¥ç¨‹ä¸­å’ŒmysqlæœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œé€šä¿¡ï¼Œå¦‚ä½•CMAKElistsä¸­å¼•ç”¨å¯¹åº”çš„å¤´æ–‡ä»¶å‘¢ï¼Œè¿˜æ˜¯ç”±äºå…¶é€šè¿‡aptå®‰è£…ï¼Œå®é™…ä¸Šä¸ç”¨å¼•ç”¨ï¼Œç›´æ¥å°±å¯ä»¥æ‰¾åˆ°å‘¢
è¿™æ˜¯ä¸ªéå¸¸å®ç”¨çš„é—®é¢˜ï¼Œæ¶‰åŠ CMake å’Œç³»ç»Ÿå®‰è£…çš„å¼€å‘åº“è”åŠ¨ã€‚

ä½ æåˆ°çš„åœºæ™¯æ˜¯ï¼š

> Ubuntu ä¸Šç”¨ apt å®‰è£…äº† `mysql-client` å’Œ `libmysqlclient-dev`ï¼Œç°åœ¨å¸Œæœ›åœ¨å·¥ç¨‹ä¸­é€šè¿‡ CMake æ­£ç¡®å¼•ç”¨è¿™äº›å¤´æ–‡ä»¶å’Œåº“ï¼Œè¿›è¡Œ MySQL é€šä¿¡ã€‚

---

## âœ… å…ˆå›ç­”ä½ çš„é—®é¢˜æœ¬èº«ï¼š

> **æ˜¯ä¸æ˜¯ apt å®‰è£…äº† `libmysqlclient-dev`ï¼Œå°±å¯ä»¥ä¸ç”¨åœ¨ CMake ä¸­æ˜¾å¼å¼•ç”¨äº†ï¼Ÿ**

**âŒ ä¸å¯ä»¥çœç•¥**ã€‚è™½ç„¶ç³»ç»Ÿè·¯å¾„ä¸‹ç¡®å®è£…å¥½äº†å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ï¼Œä½†ä½ ä»ç„¶éœ€è¦åœ¨ CMake ä¸­**æ˜¾å¼æŒ‡æ˜è¦ä½¿ç”¨è¿™äº›åº“å’Œå¤´æ–‡ä»¶**ï¼Œå¦åˆ™ CMake ä¸çŸ¥é“ä½ è¦è¿æ¥å“ªä¸ªåº“ï¼Œç¼–è¯‘å™¨æ‰¾ä¸åˆ°å¤´æ–‡ä»¶ã€‚

---

## âœ… ä½ éœ€è¦åšçš„æœ‰ä¸‰æ­¥ï¼š

### âœ… ç¬¬ä¸€æ­¥ï¼šå®‰è£…å¼€å‘åº“ï¼ˆä½ å·²ç»å®Œæˆï¼‰

```bash
sudo apt update
sudo apt install libmysqlclient-dev
```

è¿™ä¼šå®‰è£…ï¼š

- å¤´æ–‡ä»¶ï¼š`/usr/include/mysql/*.h`
    
- é™æ€æˆ–åŠ¨æ€åº“ï¼š`/usr/lib/x86_64-linux-gnu/libmysqlclient.so`
    

---

### âœ… ç¬¬äºŒæ­¥ï¼šåœ¨ä½ çš„ `CMakeLists.txt` ä¸­ä½¿ç”¨ `find_package` æˆ–æ‰‹åŠ¨æ·»åŠ 

### æ–¹å¼ä¸€ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨ `FindMySQL` æ¨¡å—ï¼ˆæ ‡å‡† CMake æ¨¡å¼ï¼‰

```cmake
find_package(MySQL REQUIRED)

add_executable(myapp main.cpp)
target_include_directories(myapp PRIVATE ${MySQL_INCLUDE_DIR})
target_link_libraries(myapp PRIVATE ${MySQL_LIBRARIES})
```

ä¸è¿‡ âš ï¸ æ³¨æ„ï¼š**CMake å¹¶ä¸é»˜è®¤å¸¦æœ‰ `FindMySQL.cmake` æ¨¡å—**ï¼Œå¾ˆå¤šç³»ç»Ÿæ‰¾ä¸åˆ° `MySQL` åŒ…ï¼ˆéœ€è¦ä½ æ‰‹åŠ¨å†™ `.cmake` æ–‡ä»¶æˆ–è€…ä½¿ç”¨ pkg-configï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨èæ–¹å¼äºŒï¼š

---

### æ–¹å¼äºŒï¼ˆå®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨ï¼‰ï¼šæ‰‹åŠ¨è®¾ç½®è·¯å¾„

```cmake
add_executable(myapp main.cpp)

target_include_directories(myapp PRIVATE /usr/include/mysql)
target_link_libraries(myapp PRIVATE mysqlclient)
```

è¿™è¶³ä»¥è®©ä½ ä½¿ç”¨ï¼š

```cpp
#include <mysql/mysql.h>
```

---

## âœ… ç¬¬ä¸‰æ­¥ï¼šç¡®è®¤ä»£ç ä½¿ç”¨æ²¡é—®é¢˜ï¼ˆç®€å•ç¤ºä¾‹ï¼‰

```cpp
#include <mysql/mysql.h>
#include <iostream>

int main() {
    MYSQL* conn = mysql_init(nullptr);
    if (!conn) {
        std::cerr << "mysql_init failed\n";
        return 1;
    }

    if (!mysql_real_connect(conn, "127.0.0.1", "root", "password", "testdb", 3306, nullptr, 0)) {
        std::cerr << "Connection failed: " << mysql_error(conn) << "\n";
        mysql_close(conn);
        return 1;
    }

    std::cout << "Connected!\n";
    mysql_close(conn);
    return 0;
}
```

> âš ï¸ ä½ è¦æŠŠ `"root"`ã€`"password"`ã€`"testdb"` æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ•°æ®åº“ä¿¡æ¯ã€‚

---

## âœ… æ€»ç»“ï¼š

|é—®é¢˜|æ˜¯å¦éœ€è¦é…ç½®|
|---|---|
|`apt install libmysqlclient-dev` æ˜¯å¦è‡ªåŠ¨è®© CMake æ‰¾åˆ°å¤´æ–‡ä»¶å’Œåº“|âŒ å¦ï¼Œä½ éœ€è¦æ‰‹åŠ¨è®¾ç½®æˆ–ç”¨ pkg-config|
|æœ€ç®€å•çš„ CMake é…ç½®æ–¹å¼|âœ… `target_include_directories()` + `target_link_libraries()`|
|æ¨èå¤´æ–‡ä»¶å¼•ç”¨æ–¹å¼|âœ… `#include <mysql/mysql.h>`|

---

å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ å†™ä¸€ä¸ªå®Œæ•´çš„å¯æ„å»º demoï¼ˆåŒ…æ‹¬ CMakeLists å’Œ cpp æ–‡ä»¶ï¼‰ï¼Œæˆ‘å¯ä»¥ç«‹åˆ»ç”Ÿæˆç»™ä½ ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
## ç°ä»£cmakeçš„è¯ï¼Œå¦‚æœfind_packageæˆåŠŸï¼Œæ˜¯ä¸æ˜¯ä¸å…‰ä¸ç”¨target_include_directoriesï¼Œä¹Ÿä¸ç”¨target_link_directories
å®Œå…¨æ­£ç¡® âœ…ï¼Œä½ æŠ“ä½äº†ç°ä»£ CMake çš„ç²¾é«“ã€‚

---

### ğŸ”‘ åœ¨ç°ä»£ CMakeï¼ˆç›®æ ‡å¯¼å‘ï¼Œtarget-basedï¼‰é‡Œï¼š

å¦‚æœ `find_package()` æ‰¾åˆ°çš„æ˜¯ä¸€ä¸ª **ç›®æ ‡ï¼ˆtargetï¼‰**ï¼Œæ¯”å¦‚ `foo::foo`ï¼Œé‚£ä¹ˆå®ƒçš„æ‰€æœ‰ä½¿ç”¨éœ€æ±‚ï¼ˆusage requirementsï¼‰éƒ½ä¼šè‡ªåŠ¨ä¼ æ’­ï¼ŒåŒ…æ‹¬ï¼š

- `INTERFACE_INCLUDE_DIRECTORIES` â†’ è‡ªåŠ¨ä¼ ç»™ä½ çš„ targetï¼Œç›¸å½“äºè‡ªåŠ¨ `target_include_directories()`
    
- `INTERFACE_LINK_LIBRARIES` â†’ è‡ªåŠ¨ä¼ ç»™ä½ çš„ targetï¼Œç›¸å½“äºè‡ªåŠ¨ `target_link_libraries()`
    
- `INTERFACE_COMPILE_DEFINITIONS` â†’ è‡ªåŠ¨åŠ å®å®šä¹‰
    
- `INTERFACE_COMPILE_OPTIONS` â†’ è‡ªåŠ¨åŠ ç¼–è¯‘é€‰é¡¹
    
- é“¾æ¥ç›®å½•ä¿¡æ¯ â†’ ä¹Ÿä¼šè‡ªåŠ¨å¤„ç†ï¼Œä¸éœ€è¦ `target_link_directories()`
    

æ‰€ä»¥ä½ çš„ CMakeLists å¯ä»¥å†™å¾—å¾ˆå¹²å‡€ï¼š

```cmake
find_package(fmt REQUIRED)

add_executable(myapp main.cpp)
target_link_libraries(myapp PRIVATE fmt::fmt)
```

å°±å¤Ÿäº†ï¼Œå®Œå…¨ä¸ç”¨ç®¡ include å’Œ lib è·¯å¾„ã€‚

---

### âš ï¸ ä»€ä¹ˆæ—¶å€™æ‰éœ€è¦ `target_link_directories()`ï¼Ÿ

å‡ ä¹åªæœ‰ **æè€æ—§/è£¸åº“** çš„åœºæ™¯ï¼š

- ä½ æ‹¿åˆ°çš„åªæœ‰ `libxxx.a` / `xxx.lib` / `xxx.so` æ–‡ä»¶ï¼Œæ²¡æœ‰ CMake åŒ…
    
- æˆ–è€… `find_package()` æ‰¾åˆ°çš„åªæ˜¯å˜é‡ï¼ˆä¾‹å¦‚ `${XXX_LIBRARIES}`ï¼‰ï¼Œæ²¡æœ‰å¯¼å‡º target
    

è¿™æ—¶å€™ä½ æ‰éœ€è¦æ‰‹åŠ¨å†™ï¼š

```cmake
target_include_directories(myapp PRIVATE /path/to/foo/include)
target_link_directories(myapp PRIVATE /path/to/foo/lib)
target_link_libraries(myapp PRIVATE foo)
```

---

âœ… **æ€»ç»“**

- ç°ä»£ CMake åŒ…ï¼ˆæä¾› target çš„ï¼‰ â†’ åªéœ€è¦ `target_link_libraries()`
    
- è€å¼åŒ…/è£¸åº“ â†’ ä½ æ‰éœ€è¦å†™ `target_include_directories()` å’Œ `target_link_directories()`
    

---

è¦ä¸è¦æˆ‘ç»™ä½ ç”»ä¸€å¼  **ç°ä»£ vs ä¼ ç»Ÿ find_package æµç¨‹å¯¹æ¯”å›¾**ï¼ˆè°è´Ÿè´£ include/libï¼Œè°éœ€è¦ä½ æ‰‹å†™ï¼‰ï¼Œè¿™æ ·ä¸€çœ¼å°±èƒ½çœ‹æ¸…åŒºåˆ«ï¼Ÿ
## é‚£å¦‚ä½•é“¾æ¥mysqlçš„libåº“å‘¢ï¼Œå…¶ä½ç½®åœ¨å“ªé‡Œå‘¢
éå¸¸å¥½ï¼Œè¿™ä¸ªé—®é¢˜éå¸¸å…³é”®ã€‚ä½ å·²ç»å®‰è£…äº† `libmysqlclient-dev`ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦ï¼š

> **ç¡®è®¤ `libmysqlclient` åº“æ–‡ä»¶åœ¨å“ªï¼Œå¹¶åœ¨ CMake ä¸­æ­£ç¡®é“¾æ¥å®ƒã€‚**

---

## âœ… ä¸€ã€mysql çš„åº“æ–‡ä»¶åœ¨å“ªï¼Ÿ

å®‰è£…å®Œ `libmysqlclient-dev` åï¼ŒMySQL çš„åº“æ–‡ä»¶ä¸€èˆ¬ä½äºï¼š

```bash
/usr/lib/x86_64-linux-gnu/libmysqlclient.so
```

è¿™ä¸ª `.so` æ˜¯åŠ¨æ€é“¾æ¥åº“ï¼Œå®é™…é€šå¸¸è¿˜æœ‰ä¸€ç»„è½¯é“¾æ¥ï¼š

```bash
$ ls -l /usr/lib/x86_64-linux-gnu/libmysqlclient*
# è¾“å‡ºç¤ºä¾‹ï¼š
libmysqlclient.so -> libmysqlclient.so.21
libmysqlclient.so.21 -> libmysqlclient.so.21.3.0
libmysqlclient.so.21.3.0
```

ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾ï¼š

```bash
find /usr/lib -name "libmysqlclient*"
```

---

## âœ… äºŒã€å¦‚ä½•åœ¨ CMake ä¸­é“¾æ¥è¿™ä¸ªåº“ï¼Ÿ

### âœ… æ–¹æ³•ä¸€ï¼šæœ€ç®€å•ç›´æ¥ï¼ˆæ¨èå°é¡¹ç›®ç”¨ï¼‰

```cmake
add_executable(myapp main.cpp)

# æŒ‡å®šå¤´æ–‡ä»¶ç›®å½•
target_include_directories(myapp PRIVATE /usr/include/mysql)

# é“¾æ¥ mysqlclient åŠ¨æ€åº“
target_link_libraries(myapp PRIVATE mysqlclient)
```

è¯´æ˜ï¼š

- `mysqlclient` æ˜¯ `libmysqlclient.so` çš„é€»è¾‘åï¼ŒCMake ä¼šè‡ªåŠ¨æŸ¥æ‰¾ `/usr/lib/...` ä¸­çš„ `.so`ã€‚
    
- `/usr/lib/x86_64-linux-gnu` æ˜¯é»˜è®¤é“¾æ¥è·¯å¾„ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼ˆé™¤éä½ è‡ªå®šä¹‰å®‰è£…è·¯å¾„ï¼‰ã€‚
    

---

### âœ… æ–¹æ³•äºŒï¼ˆæ›´é€šç”¨ï¼Œé€‚ç”¨äºéç³»ç»Ÿé»˜è®¤ä½ç½®ï¼‰

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰è·¯å¾„ï¼ˆæ¯”å¦‚æºç ç¼–è¯‘çš„ MySQLï¼‰ï¼Œåˆ™éœ€è¦ï¼š

```cmake
add_executable(myapp main.cpp)

target_include_directories(myapp PRIVATE /your/custom/mysql/include)
target_link_directories(myapp PRIVATE /your/custom/mysql/lib)
target_link_libraries(myapp PRIVATE mysqlclient)
```

> `target_link_directories()` æ˜¯ CMake 3.13+ æ‰æ”¯æŒçš„ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬ï¼Œè¯·æ”¹ç”¨ `link_directories()`ã€‚

---

### âœ… æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ `pkg-config`ï¼ˆå¦‚æœæ”¯æŒï¼‰

```cmake
find_package(PkgConfig REQUIRED)
pkg_check_modules(MySQL REQUIRED mysqlclient)

add_executable(myapp main.cpp)

target_include_directories(myapp PRIVATE ${MySQL_INCLUDE_DIRS})
target_link_libraries(myapp PRIVATE ${MySQL_LIBRARIES})
```

---

## âœ… ä¸‰ã€æ£€æŸ¥æ˜¯å¦é“¾æ¥æˆåŠŸ

ç¼–è¯‘åå¯ç”¨ `ldd` æŸ¥çœ‹æ˜¯å¦æˆåŠŸé“¾æ¥ï¼š

```bash
ldd myapp
# è¾“å‡ºåº”åŒ…å«ï¼š
libmysqlclient.so.21 => /usr/lib/x86_64-linux-gnu/libmysqlclient.so.21 (0x...)
```

---

## âœ… å››ã€æ€»ç»“

| é¡¹ç›®éœ€æ±‚                          | åšæ³•                                          |
| ----------------------------- | ------------------------------------------- |
| ä½¿ç”¨ç³»ç»Ÿ apt å®‰è£…çš„ `libmysqlclient` | `target_link_libraries(... mysqlclient)` å³å¯ |
| å¤´æ–‡ä»¶å¼•ç”¨è·¯å¾„                       | `/usr/include/mysql`                        |
| åº“æ–‡ä»¶é»˜è®¤è·¯å¾„                       | `/usr/lib/x86_64-linux-gnu`ï¼ˆç³»ç»Ÿé»˜è®¤æœç´¢è·¯å¾„ï¼‰       |
| æ£€æŸ¥é“¾æ¥æ˜¯å¦æˆåŠŸ                      | ç”¨ `ldd` æˆ– `nm` æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶                      |

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»™ä½ ç”Ÿæˆä¸€ä¸ª **å®Œæ•´ MySQL è¿æ¥ demo å·¥ç¨‹ + CMakeLists.txt**ï¼Œç›´æ¥å¤åˆ¶è¿è¡Œã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
## æ‰€ä»¥ç³»ç»Ÿä¼šé»˜è®¤æœç´¢/usr/lib/x86_64_linux_gnuè€Œä¸ä¼šé»˜è®¤æœç´¢/usr/include/æ˜¯å—
æ˜¯çš„ï¼Œä½ ç†è§£å¾—éå¸¸æ­£ç¡®ï¼Œåªæ˜¯ç•¥æœ‰ä¸€ç‚¹å°ç¬”è¯¯ï¼Œæˆ‘æ¥å®Œæ•´è¯´æ˜ä¸€ä¸‹ï¼š

---

## âœ… ç³»ç»Ÿé»˜è®¤æœç´¢è§„åˆ™ç®€è¦åŒºåˆ†

|ç±»å‹|æ˜¯å¦è‡ªåŠ¨æœç´¢|é»˜è®¤è·¯å¾„ä¾‹å­|æ˜¯å¦éœ€è¦ä½ æ‰‹åŠ¨é…ç½®|
|---|---|---|---|
|**åº“æ–‡ä»¶ (.so/.a)**|âœ… ä¼šé»˜è®¤æœç´¢|`/usr/lib`, `/usr/lib/x86_64-linux-gnu`|âŒ é€šå¸¸ä¸éœ€è¦|
|**å¤´æ–‡ä»¶ (.h)**|âŒ ä¸ä¼šè‡ªåŠ¨æœç´¢|`/usr/include`, `/usr/include/mysql`|âœ… ä½ éœ€è¦è®¾ç½®|

---

### âœ… è§£é‡Šï¼š

#### âœ… 1. **åº“æ–‡ä»¶è·¯å¾„ï¼ˆ`.so`, `.a`ï¼‰**

ç³»ç»Ÿå’Œ CMake é»˜è®¤æœç´¢ `/usr/lib`, `/usr/lib/x86_64-linux-gnu`ï¼Œå› ä¸ºè¿™äº›è·¯å¾„é€šå¸¸å·²ç»å†…ç½®åœ¨é“¾æ¥å™¨ï¼ˆ`ld`ï¼‰é…ç½®ä¸­ã€‚

ä½ ç”¨ `target_link_libraries(myapp PRIVATE mysqlclient)` æ—¶ï¼Œé“¾æ¥å™¨ä¼šè‡ªåŠ¨å»è¿™äº›åœ°æ–¹æ‰¾ `libmysqlclient.so`ã€‚

---

#### âŒ 2. **å¤´æ–‡ä»¶è·¯å¾„ï¼ˆ`.h`ï¼‰**

è™½ç„¶ `/usr/include` æ˜¯ **ç¼–è¯‘å™¨é»˜è®¤æœç´¢è·¯å¾„**ï¼Œä½† `/usr/include/mysql` è¿™ç§å­ç›®å½•ä¸æ˜¯é»˜è®¤åŒ…å«çš„ã€‚

ä½ è¦ä½¿ç”¨ï¼š

```cpp
#include <mysql/mysql.h>
```

å°±å¿…é¡»å‘Šè¯‰ç¼–è¯‘å™¨å» `/usr/include/mysql` è¿™ä¸ªç›®å½•æ‰¾ï¼Œæ–¹æ³•æ˜¯ï¼š

```cmake
target_include_directories(myapp PRIVATE /usr/include/mysql)
```

å¦åˆ™ä¼šå‡ºç°ï¼š

```
fatal error: mysql/mysql.h: No such file or directory
```

---

## âœ… ç±»æ¯”ç†è§£

|æ–‡ä»¶ç±»å‹|é»˜è®¤è·¯å¾„|CMake/ç¼–è¯‘å™¨è¡Œä¸º|
|---|---|---|
|`.so`|âœ”ï¸ `/usr/lib`|è‡ªåŠ¨é“¾æ¥æŸ¥æ‰¾ï¼ˆä¸ç”¨å£°æ˜ï¼‰|
|`.h`|âŒ `/usr/include/mysql`|å¿…é¡»ç”¨ `target_include_directories()` æŒ‡å®š|

---

## âœ… æ£€æŸ¥é»˜è®¤è·¯å¾„

ä½ å¯ä»¥ç”¨è¿™äº›å‘½ä»¤æ¥éªŒè¯ï¼š

### æ£€æŸ¥é»˜è®¤å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼š

```bash
echo | gcc -E -Wp,-v -
```

è¾“å‡ºä¸­åŒ…å«ä¸€ç»„ï¼š

```
#include <...> search starts here:
 /usr/include
 /usr/local/include
 ...
```

ä½ ä¼šå‘ç° **æ²¡æœ‰ `/usr/include/mysql`**ï¼Œæ‰€ä»¥ä½ å¿…é¡»æ·»åŠ å®ƒã€‚

---

### æ£€æŸ¥é»˜è®¤åº“æ–‡ä»¶æœç´¢è·¯å¾„ï¼š

```bash
ld --verbose | grep SEARCH_DIR
```

ä¼šçœ‹åˆ°ï¼š

```
SEARCH_DIR("/usr/lib/x86_64-linux-gnu")
SEARCH_DIR("/usr/lib")
...
```

è¿™äº›è·¯å¾„ç”¨äºé“¾æ¥ `.so` æ–‡ä»¶ï¼Œæ˜¯è‡ªåŠ¨æœç´¢çš„ã€‚

---

## âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> ç³»ç»Ÿä¼šè‡ªåŠ¨é“¾æ¥ `/usr/lib/...` ä¸‹çš„ `.so` åº“æ–‡ä»¶ï¼Œä½†ä¸ä¼šè‡ªåŠ¨åŒ…å« `/usr/include/mysql` è¿™ç±»éæ ‡å‡†è·¯å¾„çš„å¤´æ–‡ä»¶ï¼Œå¿…é¡»åœ¨ CMake ä¸­æ˜¾å¼æ·»åŠ ã€‚

---

éœ€è¦æˆ‘ä¸ºä½ ç”Ÿæˆä¸€ä¸ªç®€å•çš„ `mysql_connect_demo` é¡¹ç›®ç»“æ„ + å®Œæ•´çš„ CMakeLists æ–‡ä»¶å—ï¼Ÿ

## é‚£å¦‚æœæ˜¯windowsç³»ç»Ÿå‘¢
åœ¨ **Windows ç³»ç»Ÿ**ä¸‹ï¼Œä½¿ç”¨ MySQL C API ä¸ Ubuntu æœ‰ä¸€äº›å…³é”®åŒºåˆ«ã€‚ä½ ä»ç„¶å¯ä»¥é€šè¿‡ CMake æ¥é“¾æ¥ `libmysql.lib` å’Œä½¿ç”¨ `mysql.h`ï¼Œä½†è·¯å¾„ã€åº“æ ¼å¼å’Œé…ç½®æ–¹å¼éƒ½ä¸åŒã€‚

æˆ‘æ¥ä¸€æ­¥æ­¥å¸®ä½ ç†æ¸…ï¼š

---

## âœ… ä¸€ã€å‰ææ¡ä»¶ï¼šWindows ä¸Šå‡†å¤‡ MySQL å¼€å‘åº“

### 1. å®‰è£… MySQL

å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¼€å‘æ–‡ä»¶ï¼š

- **æ¨è**ï¼šä»å®˜ç½‘ä¸‹è½½ [MySQL Community Server](https://dev.mysql.com/downloads/mysql/)ï¼Œå®‰è£…æ—¶é€‰æ‹© `Developer Default`
    
- æˆ–è€…ç›´æ¥ä¸‹è½½ `MySQL Connector/C`ï¼ˆåªåŒ…å«å¼€å‘æ¥å£ï¼‰
    

å®‰è£…å®Œæˆåï¼Œä½ ä¼šè·å¾—ï¼š

|ç±»å‹|è·¯å¾„ç¤ºä¾‹ï¼ˆå‡è®¾å®‰è£…åœ¨ `C:\Program Files\MySQL\MySQL Server 8.0`ï¼‰|
|---|---|
|å¤´æ–‡ä»¶|`C:\Program Files\MySQL\MySQL Server 8.0\include`|
|åº“æ–‡ä»¶|`C:\Program Files\MySQL\MySQL Server 8.0\lib\libmysql.lib`|
|åŠ¨æ€åº“ï¼ˆDLLï¼‰|`C:\Program Files\MySQL\MySQL Server 8.0\lib\libmysql.dll`|

---

## âœ… äºŒã€CMake ä¸­å¦‚ä½•é…ç½®

### ç¤ºä¾‹é¡¹ç›®ç»“æ„

```text
MyProject/
â”œâ”€â”€ main.cpp
â”œâ”€â”€ CMakeLists.txt
```

### `main.cpp`

```cpp
#include <mysql.h>
#include <iostream>

int main() {
    MYSQL* conn = mysql_init(nullptr);
    if (!conn) {
        std::cerr << "Init failed\n";
        return 1;
    }

    if (!mysql_real_connect(conn, "localhost", "root", "password", "testdb", 3306, nullptr, 0)) {
        std::cerr << "Connection error: " << mysql_error(conn) << "\n";
        return 1;
    }

    std::cout << "Connected!\n";
    mysql_close(conn);
    return 0;
}
```

### `CMakeLists.txt`

å‡è®¾ä½ å®‰è£…åœ¨ `C:/Program Files/MySQL/MySQL Server 8.0/`ï¼š

```cmake
cmake_minimum_required(VERSION 3.16)
project(MySQLDemo)

add_executable(MySQLDemo main.cpp)

# è®¾ç½® MySQL è·¯å¾„
set(MYSQL_INCLUDE_DIR "C:/Program Files/MySQL/MySQL Server 8.0/include")
set(MYSQL_LIB_DIR "C:/Program Files/MySQL/MySQL Server 8.0/lib")

# åŒ…å«å¤´æ–‡ä»¶
target_include_directories(MySQLDemo PRIVATE "${MYSQL_INCLUDE_DIR}")

# é“¾æ¥åº“æ–‡ä»¶
target_link_directories(MySQLDemo PRIVATE "${MYSQL_LIB_DIR}")
target_link_libraries(MySQLDemo PRIVATE libmysql)

# æŒ‡å®šå­—ç¬¦é›†ï¼ˆæ¨èï¼Œé¿å…ä¹±ç ï¼‰
add_definitions(-DUNICODE -D_UNICODE)
```

---

## âœ… ä¸‰ã€è¿è¡Œæ—¶æ³¨æ„

- ç¼–è¯‘æ—¶ä½¿ç”¨ `.lib` æ–‡ä»¶ï¼š`libmysql.lib`
    
- è¿è¡Œæ—¶éœ€è¦ DLL æ–‡ä»¶ï¼š`libmysql.dll` è¦æ”¾åœ¨å¯æ‰§è¡Œç¨‹åºç›®å½•æˆ–ç³»ç»Ÿ PATH ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™ `missing DLL`
    

---

## âœ… å››ã€è°ƒè¯•è¾…åŠ©å»ºè®®

- ç¡®ä¿ä½¿ç”¨ **ç›¸åŒä½æ•°** çš„ MySQL å¼€å‘åŒ…ï¼ˆ32-bit vs 64-bitï¼‰ï¼Œä¸ä½ çš„ç¼–è¯‘å™¨ä¸€è‡´ï¼ˆå¦‚ VS 64-bitï¼‰ã€‚
    
- å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ **MinGW + GCC**ï¼Œæ³¨æ„å¯èƒ½éœ€è¦ `.a` æ ¼å¼çš„åº“ï¼Œæˆ–è€…ç”¨ `dlltool` ç”Ÿæˆã€‚
    

---

## âœ… äº”ã€æ˜¯å¦å¯ä»¥è‡ªåŠ¨æŸ¥æ‰¾ MySQLï¼Ÿ

Windows ä¸‹ CMake **ä¸ä¼šè‡ªåŠ¨æŸ¥æ‰¾ MySQL**ï¼Œå› ä¸ºæ²¡æœ‰é»˜è®¤çš„ `FindMySQL.cmake`ï¼Œæ‰€ä»¥ä½ å¿…é¡»æ‰‹åŠ¨è®¾ç½®è·¯å¾„ï¼ˆå¦‚ä¸Šæ‰€ç¤ºï¼‰æˆ–ä½¿ç”¨ `pkg-config` æ›¿ä»£ï¼ˆä¸€èˆ¬ä¸æ¨èåœ¨ Windows ä¸Šç”¨ï¼‰ã€‚

---

## âœ… æ€»ç»“å¯¹æ¯”ï¼šLinux vs Windows

|é¡¹ç›®|Linux|Windows|
|---|---|---|
|å¤´æ–‡ä»¶è·¯å¾„|`/usr/include/mysql`|`C:\Program Files\MySQL\MySQL Server 8.0\include`|
|åº“æ–‡ä»¶|`libmysqlclient.so`|`libmysql.lib`|
|CMakeæ˜¯å¦è‡ªåŠ¨æ‰¾|âŒ å¦ï¼Œéœ€è¦å†™ include å’Œ link|âŒ å¦ï¼Œå¿…é¡»æ‰‹åŠ¨è®¾ç½®è·¯å¾„|
|æ˜¯å¦éœ€è¦ DLL|æ— éœ€å…³å¿ƒï¼ˆç³»ç»Ÿè‡ªåŠ¨ï¼‰|âœ… è¿è¡Œæ—¶å¿…é¡»æ”¾ç½® `libmysql.dll`|

---

å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ çš„å…·ä½“ç¼–è¯‘å™¨ç¯å¢ƒï¼ˆå¦‚ï¼šVisual Studio 2022 æˆ– MinGWï¼‰ï¼Œæˆ‘å¯ä»¥ç»™ä½ ä¸€ä¸ªå®Œæ•´å¯æ„å»ºçš„ Windows å·¥ç¨‹æ¨¡æ¿ã€‚éœ€è¦å—ï¼Ÿ

## set(RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin)
åœ¨ CMake ä¸­ï¼š

```cmake
set(RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin)
```

è¿™è¡Œè¯­å¥çš„ä½œç”¨æ˜¯ï¼š

> **è®¾ç½®ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºç›®å½•ä¸º `${PROJECT_SOURCE_DIR}/bin`**ã€‚

---

### âœ… è§£é‡Šå„éƒ¨åˆ†å«ä¹‰ï¼š

|éƒ¨åˆ†|å«ä¹‰|
|---|---|
|`RUNTIME_OUTPUT_DIRECTORY`|æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆruntime binariesï¼‰çš„è¾“å‡ºè·¯å¾„|
|`${PROJECT_SOURCE_DIR}`|é¡¹ç›®æ ¹ç›®å½•ï¼Œå³ `CMakeLists.txt` é¡¶å±‚æ‰€åœ¨çš„ç›®å½•|
|`bin`|ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•çš„å­ç›®å½•ï¼Œç”¨äºæ”¾å¯æ‰§è¡Œæ–‡ä»¶|

---

### ğŸ“Œ ç¤ºä¾‹ï¼š

å‡è®¾é¡¹ç›®ç»“æ„æ˜¯ï¼š

```text
MyProject/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.cpp
â”œâ”€â”€ CMakeLists.txt
```

å¦‚æœä½ åœ¨ `CMakeLists.txt` ä¸­å†™ï¼š

```cmake
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin)
add_executable(myapp src/main.cpp)
```

ç¼–è¯‘åç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¼šåœ¨ï¼š

```text
MyProject/bin/myapp
```

---

### ğŸŸ¡ æ³¨æ„äº‹é¡¹ï¼š

- æ¨èä½¿ç”¨ `CMAKE_RUNTIME_OUTPUT_DIRECTORY`ï¼ˆå¸¦å‰ç¼€ `CMAKE_`ï¼‰ï¼Œè¿™æ ·å¯¹å¤šä¸ª `target` ç”Ÿæ•ˆã€‚
    
- å¦‚æœä½ æƒ³**å•ç‹¬ä¸ºæŸä¸ª target è®¾ç½®è¾“å‡ºç›®å½•**ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š
    

```cmake
set_target_properties(myapp PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin
)
```

---

### âœ… æ€»ç»“ï¼š

ä½¿ç”¨ `set(RUNTIME_OUTPUT_DIRECTORY ...)` å¯ä»¥æ§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„ç”Ÿæˆè·¯å¾„ï¼Œä½¿è¾“å‡ºç»“æ„æ›´æ¸…æ™°ã€ä¾¿äºéƒ¨ç½²æˆ–è°ƒè¯•ã€‚

æ˜¯å¦è¿˜æƒ³è®¾ç½® **åº“æ–‡ä»¶è¾“å‡ºè·¯å¾„**ï¼ˆ`LIBRARY_OUTPUT_DIRECTORY`ã€`ARCHIVE_OUTPUT_DIRECTORY`ï¼‰ï¼Ÿæˆ‘å¯ä»¥ä¸€å¹¶ç»™å‡ºæ¨¡æ¿ã€‚
## å¸¦æœ‰å‰ç¼€CMAKE_çš„è¯å¦‚ä½•å¯¹å¤šä¸ªtargetç”Ÿæ•ˆå‘¢
å¾ˆå¥½ï¼Œä½ é—®å¾—å¾ˆä¸“ä¸šã€‚æˆ‘ä»¬æ¥è®²æ¸…æ¥šï¼š

---

## âœ… é—®é¢˜ï¼š

> ä½¿ç”¨ `CMAKE_RUNTIME_OUTPUT_DIRECTORY` æ€ä¹ˆå¯¹å¤šä¸ª target ç”Ÿæ•ˆï¼Ÿ

---

## âœ… ç­”æ¡ˆï¼š

`CMAKE_RUNTIME_OUTPUT_DIRECTORY` æ˜¯ä¸€ä¸ª **å…¨å±€å˜é‡**ï¼Œ**åœ¨ `add_executable()` æˆ– `add_library()` ä¹‹å‰è®¾ç½®**ï¼Œå®ƒä¼šå¯¹**åç»­æ‰€æœ‰ç›®æ ‡ï¼ˆtargetï¼‰é»˜è®¤ç”Ÿæ•ˆ**ï¼Œé™¤éä½ ä¸ºæŸä¸ª target å•ç‹¬è¦†ç›–ã€‚

---

## ğŸ§ª ç¤ºä¾‹ï¼š

```cmake
cmake_minimum_required(VERSION 3.10)
project(MultiTargetOutput)

# å…¨å±€è®¾ç½®è¾“å‡ºè·¯å¾„
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin)

add_executable(app1 src/app1.cpp)
add_executable(app2 src/app2.cpp)
add_executable(app3 src/app3.cpp)
```

ä¸Šé¢å†™æ³•ä¸­ï¼Œ`app1`ã€`app2`ã€`app3` æœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶éƒ½ä¼šæ”¾åˆ°ï¼š

```bash
${CMAKE_SOURCE_DIR}/bin/
```

ä¾‹å¦‚ï¼š

```bash
MyProject/
â”œâ”€â”€ bin/
â”‚   â”œâ”€â”€ app1
â”‚   â”œâ”€â”€ app2
â”‚   â””â”€â”€ app3
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

- **ä½ç½®é¡ºåºå¾ˆé‡è¦ï¼**  
    å¿…é¡»åœ¨æ‰€æœ‰ `add_executable()` æˆ– `add_library()` ä¹‹å‰è®¾ç½®ï¼Œå¦åˆ™å¯¹å·²æœ‰ target ä¸ç”Ÿæ•ˆã€‚
    
- å¦‚æœä½ ä¸ºæŸä¸ª target ä½¿ç”¨ `set_target_properties()` æ˜¾å¼è®¾ç½®äº† `RUNTIME_OUTPUT_DIRECTORY`ï¼Œé‚£è¿™ä¸ª target ä¼šä½¿ç”¨å®ƒè‡ªå·±çš„ï¼Œè€Œä¸ä¼šç”¨å…¨å±€çš„ã€‚
    

---

## ğŸ§  æ‰©å±•ï¼šå…¶ä»–ç±»å‹è¾“å‡ºæ§åˆ¶

|æ–‡ä»¶ç±»å‹|CMake å˜é‡å|
|---|---|
|å¯æ‰§è¡Œæ–‡ä»¶|`CMAKE_RUNTIME_OUTPUT_DIRECTORY`|
|åŠ¨æ€åº“ (`.so`/`.dll`)|`CMAKE_LIBRARY_OUTPUT_DIRECTORY`|
|é™æ€åº“ (`.a`/`.lib`)|`CMAKE_ARCHIVE_OUTPUT_DIRECTORY`|

ä½ ä¹Ÿå¯ä»¥ç»Ÿä¸€è®¾ç½®ï¼š

```cmake
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/lib)
```

---

å¦‚æœä½ æœ‰å¤šçº§å­ç›®å½•ï¼ˆæ¯”å¦‚ `add_subdirectory(server)` / `client`ï¼‰ï¼Œæˆ‘ä¹Ÿå¯ä»¥å‘Šè¯‰ä½ å¦‚ä½•ä½¿è¿™äº›è®¾ç½®å¯¹å­ç›®å½•ä¹Ÿç”Ÿæ•ˆï¼ˆé»˜è®¤æ˜¯ç”Ÿæ•ˆçš„ï¼Œä½†å¯ä»¥è¢«è¦†ç›–ï¼‰ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
## å¦‚ä½•è®©ç”Ÿæˆçš„debugç‰ˆæœ¬çš„æ–‡ä»¶åç¼€å«æœ‰_d
è®© **Debug æ¨¡å¼ä¸‹ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶åå¸¦ `_d` åç¼€** æ˜¯åœ¨å¤šé…ç½®æ„å»ºç³»ç»Ÿä¸­ï¼ˆç‰¹åˆ«æ˜¯ Windows / Visual Studio / MSVC ç¯å¢ƒï¼‰éå¸¸å¸¸è§çš„éœ€æ±‚ã€‚

ä¸‹é¢è¯¦ç»†è®²è§£å¦‚ä½•åœ¨ **CMake ä¸­å®ç°ç›®æ ‡æ–‡ä»¶åœ¨ Debug æ¨¡å¼ä¸‹è‡ªåŠ¨åŠ  `_d` åç¼€**ï¼ŒåŒæ—¶ä¿æŒå…¶ä»–æ„å»ºç±»å‹ï¼ˆå¦‚ Releaseï¼‰ä¸å˜ï¼š

---

## âœ… æ–¹å¼ä¸€ï¼šä½¿ç”¨ `CMAKE_<CONFIG>_POSTFIX` å…¨å±€è®¾ç½®

```cmake
# æ·»åŠ  Debug æ¨¡å¼çš„åç¼€ "_d"
set(CMAKE_DEBUG_POSTFIX "_d")

# ç„¶åæ·»åŠ  target
add_executable(MyApp src/main.cpp)
```

ğŸ” æ•ˆæœï¼š

|æ„å»ºç±»å‹|å¯æ‰§è¡Œæ–‡ä»¶å|
|---|---|
|Debug|`MyApp_d`|
|Release|`MyApp`|

æ­¤æ–¹å¼é€‚ç”¨äºæ‰€æœ‰ targetï¼ˆé™¤éä½ å•ç‹¬è¦†ç›–ï¼‰ã€‚

---

## âœ… æ–¹å¼äºŒï¼šä¸ºå•ä¸ª target è®¾ç½®åç¼€ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰

```cmake
add_executable(MyApp src/main.cpp)

# ä»…ä¸º Debug æ¨¡å¼è®¾ç½®åç¼€
set_target_properties(MyApp PROPERTIES
    DEBUG_POSTFIX "_d"
)
```

---

## ğŸ” æ³¨æ„äº‹é¡¹

- è¿™ä¸¤ç§æ–¹å¼åªä¼šåœ¨å¤šé…ç½®ç”Ÿæˆå™¨ä¸­ç”Ÿæ•ˆï¼Œæ¯”å¦‚ï¼š
    
    - Windows + Visual Studio
        
    - Windows + Ninja Multi-Configï¼ˆå°‘è§ï¼‰
        
- **åœ¨ Unixï¼ˆå¦‚ Linux + Makefileï¼‰ä¸­ï¼Œé€šå¸¸åªä½¿ç”¨ä¸€ä¸ªé…ç½®ï¼ˆDebug / Releaseï¼‰ä¸€æ¬¡ç¼–è¯‘ï¼Œå› æ­¤æ²¡å¿…è¦åŒºåˆ†å‘½å**ã€‚
    

---

## âœ… æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆçš„æ–¹æ³•

ä½ å¯ä»¥åœ¨æ„å»ºç›®å½•ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¡®è®¤ç”Ÿæˆçš„ç›®æ ‡åï¼š

```bash
cmake --build . --config Debug
# åº”è¯¥ç”Ÿæˆ `MyApp_d` è€Œä¸æ˜¯ `MyApp`
```

---

## ğŸ”„ å¦‚æœä½ ä½¿ç”¨ `add_library()`ï¼š

åŒæ ·é€‚ç”¨ï¼š

```cmake
set(CMAKE_DEBUG_POSTFIX "_d")
add_library(MyLib STATIC src/mylib.cpp)
```

å°†ç”Ÿæˆï¼š

- Debug: `libMyLib_d.a`ï¼ˆUnixï¼‰æˆ– `MyLib_d.lib`ï¼ˆWindowsï¼‰
    
- Release: `libMyLib.a` / `MyLib.lib`
    

---

## ğŸ”§ å°æŠ€å·§ï¼šå…¼å®¹ä½¿ç”¨ `_d` åç¼€çš„åº“

å¦‚æœä½ ç”¨åˆ°äº†å¸¦ `_d` åç¼€çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ `mysqlpp_d.lib`ï¼‰ï¼Œç¡®ä¿ä½ çš„ `target_link_libraries()` ä½¿ç”¨é…ç½®åˆ¤æ–­ï¼š

```cmake
target_link_libraries(MyApp
    debug mysqlpp_d
    optimized mysqlpp
)
```

è¿™æ · CMake ä¼šè‡ªåŠ¨åœ¨ Debug æ¨¡å¼ä½¿ç”¨ `mysqlpp_d`ï¼Œå…¶ä»–æ¨¡å¼ä½¿ç”¨æ™®é€šç‰ˆæœ¬ã€‚

---

å¦‚æœä½ æ­£åœ¨æ„å»ºæ”¯æŒ Windows + Linux è·¨å¹³å°çš„é¡¹ç›®ï¼Œä¸”æƒ³è¦ç»Ÿä¸€å¤„ç† Debug åç¼€æˆ–è¾“å‡ºç­–ç•¥ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»™ä½ å®Œæ•´æ¨¡æ¿ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
## å…³äºARCHIEVE_OUTPUT_DIRECTORY, LIBRARY_OUTPUT_DIRECTORY,RUNTIME_OUTPUTçš„åŒºåˆ«
```
add_library(AddProject SHARED
    ${ADDPROJECT_SOURCES}
)

target_include_directories(AddProject PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/include)
target_compile_definitions(AddProject PRIVATE "ADDPROJECT_EXPORTS")
ä¼šç”Ÿæˆdll lib pdb ilk 4ç§ç±»å‹æ–‡ä»¶ï¼Œå½“æˆ‘`set_target_properties(AddProject  PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin)`ä¼šæŠŠdll pdb ilk 3ä¸ªæ–‡ä»¶æ‹·è´è¿›binæ–‡ä»¶å¤¹ï¼Œå½“æˆ‘set_target_properties(AddProject  PROPERTIES LIBRARY_OUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin)ä¹Ÿä¼šæ‹·è´è¿™3ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯set_target_properties(AddProject  PROPERTIES ARCHIEVE_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin)ä»…ä¼šæ‹·è´libæ–‡ä»¶åˆ°binï¼Œè€Œè¿è¡Œæ—¶libå’Œdlléƒ½éœ€è¦ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠå‘¢
```
ä½ é‡åˆ°çš„ç°è±¡ï¼Œå…¶å®æ˜¯ **CMake åœ¨ Windows ä¸Šçš„åº“äº§ç‰©ç±»å‹é—®é¢˜**ï¼š

1. **DLLï¼ˆåŠ¨æ€åº“ä¸»ä½“ï¼‰**
    
    - è¿è¡Œæ—¶å¿…é¡»ç”¨å®ƒã€‚
        
    - å±äº `RUNTIME_OUTPUT_DIRECTORY` æ§åˆ¶çš„èŒƒå›´ã€‚
        
2. **LIBï¼ˆimport libraryï¼Œå¯¼å…¥åº“ï¼‰**
    
    - Windows ç‰¹æœ‰ï¼Œé“¾æ¥æ—¶ä½¿ç”¨ã€‚
        
    - å±äº `ARCHIVE_OUTPUT_DIRECTORY` æ§åˆ¶çš„èŒƒå›´ã€‚
        
3. **PDBï¼ˆè°ƒè¯•ç¬¦å·æ–‡ä»¶ï¼‰**ã€**ILKï¼ˆå¢é‡é“¾æ¥æ–‡ä»¶ï¼‰**
    
    - è°ƒè¯•å’Œ MSVC å¢é‡é“¾æ¥ç”Ÿæˆçš„å‰¯äº§ç‰©ã€‚
        

---

âš ï¸ é‡ç‚¹ï¼š  
Windows ä¸Šæ„å»ºå…±äº«åº“ï¼ˆ`SHARED`ï¼‰æ—¶ï¼Œ**ä½ ä¸€å®šä¼šåŒæ—¶å¾—åˆ° DLL å’Œ LIB**ï¼š

- `DLL` â†’ ç¨‹åºè¿è¡Œæ—¶åŠ è½½
    
- `LIB` â†’ ç¨‹åºç¼–è¯‘/é“¾æ¥æ—¶éœ€è¦
    

å› æ­¤åªè®¾ç½® `ARCHIVE_OUTPUT_DIRECTORY` åªä¼šå½±å“ `.lib`ï¼Œä¸ä¼šæŠŠ `.dll` æ‹·è¿‡å»ï¼›åªè®¾ç½® `RUNTIME_OUTPUT_DIRECTORY` åªä¼šå½±å“ `.dll`ï¼Œä¸ä¼šæŠŠ `.lib` æ‹·è¿‡å»ã€‚

---

âœ… **æ­£ç¡®åšæ³•**ï¼šåŒæ—¶è®¾ç½® **ä¸‰ä¸ªå±æ€§**ï¼ŒæŠŠäº§ç‰©éƒ½æ”¾åˆ°ç»Ÿä¸€ç›®å½•ï¼Œæ¯”å¦‚ `bin`ï¼š

```cmake
set_target_properties(AddProject PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY  ${CMAKE_SOURCE_DIR}/bin   # .dll
    ARCHIVE_OUTPUT_DIRECTORY  ${CMAKE_SOURCE_DIR}/bin   # .lib
    LIBRARY_OUTPUT_DIRECTORY  ${CMAKE_SOURCE_DIR}/bin   # for .so/.dylib on Linux/Mac
)
```

è¿™æ ·ï¼š

- Windows ä¸‹ â†’ `.dll`ã€`.lib` éƒ½åœ¨ `bin/`
    
- Linux ä¸‹ â†’ `.so` åœ¨ `bin/`
    
- macOS ä¸‹ â†’ `.dylib` åœ¨ `bin/`
    

---

ğŸ‘‰ æ€»ç»“ï¼š

- Windows ä¸‹ **è¿è¡Œæ—¶éœ€è¦ DLLï¼Œç¼–è¯‘æ—¶éœ€è¦ LIB**ã€‚
    
- ä½ å¿…é¡» **åŒæ—¶è®¾ç½® RUNTIME + ARCHIVE**ï¼ˆå†åŠ  LIBRARY ä¿è¯è·¨å¹³å°ï¼‰ï¼Œæ‰èƒ½æŠŠæ‰€æœ‰å¿…è¦æ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•ã€‚
    

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä»½ **è·¨å¹³å°çš„ add_library è¾“å‡ºè·¯å¾„æ¨¡æ¿**ï¼ˆWindows/Linux/macOS é€šç”¨ï¼‰ï¼Ÿ
## è¿è¡Œæ—¶ï¼Œåªéœ€è¦dllï¼Œä¸éœ€è¦libå—
å¯¹ ğŸ‘ï¼Œä½ ç†è§£å¾—æ²¡é”™ï¼š

- **è¿è¡Œæ—¶ï¼ˆç¨‹åºå·²ç»ç¼–è¯‘å¥½äº†ï¼Œåªæ˜¯æ‰§è¡Œ `exe` çš„æ—¶å€™ï¼‰**  
    ğŸ‘‰ åªéœ€è¦ `DLL`ï¼ˆåŠ¨æ€é“¾æ¥åº“æœ¬ä½“ï¼‰ï¼Œ**ä¸éœ€è¦ `.lib`**ã€‚  
    `.lib` åœ¨è¿è¡Œæ—¶å®Œå…¨ä¸ä¼šè¢«åŠ è½½ï¼Œå®ƒåªæ˜¯ç¼–è¯‘/é“¾æ¥é˜¶æ®µçš„â€œå¯¼å…¥åº“â€ã€‚
    
- **ç¼–è¯‘/é“¾æ¥é˜¶æ®µ**  
    ğŸ‘‰ é“¾æ¥å™¨éœ€è¦ `.lib` æ–‡ä»¶ï¼Œå®ƒé‡Œé¢å­˜äº†ç¬¦å·è¡¨å’Œâ€œå¦‚ä½•è·³åˆ° DLL çš„å…¥å£â€çš„ä¿¡æ¯ã€‚  
    æ²¡æœ‰ `.lib` çš„è¯ï¼ŒMSVC é“¾æ¥æ—¶ä¼šæŠ¥é”™ï¼ˆæ‰¾ä¸åˆ°ç¬¦å·ï¼‰ã€‚
    
- **Linux / macOS** ä¸‹æƒ…å†µä¸ä¸€æ ·ï¼š  
    ğŸ‘‰ æ²¡æœ‰ `.lib` è¿™ä¸ªæ¦‚å¿µï¼Œç›´æ¥æŠŠ `.so` / `.dylib` ç”¨ä½œç¼–è¯‘å’Œè¿è¡Œæ—¶çš„åº“ã€‚
    

---

ğŸ”‘ æ€»ç»“ï¼š

- **Windows**
    
    - å¼€å‘/ç¼–è¯‘é˜¶æ®µï¼š`.dll + .lib`
        
    - éƒ¨ç½²/è¿è¡Œé˜¶æ®µï¼šåªè¦ `.dll`ï¼ˆ`.lib` å¯ä»¥ä¸å¸¦ç»™æœ€ç»ˆç”¨æˆ·ï¼‰ã€‚
        
- **Linux/macOS**
    
    - åªè¦ `.so` / `.dylib` å°±èƒ½ç¼–è¯‘å’Œè¿è¡Œã€‚
        

---

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä»½ **éƒ¨ç½²æµç¨‹åŒºåˆ†è¡¨**ï¼ˆWindows/Linux å„è‡ªéœ€è¦æ‹·è´å“ªäº›æ–‡ä»¶åˆ°æœ€ç»ˆè¿è¡Œç¯å¢ƒï¼‰ï¼Ÿ

## ubuntuä¸Šå®‰è£…äº†mysqlpp.h ï¼Œæˆ‘ä½¿ç”¨vs åœ¨æœ¬åœ°è¿›è¡Œå¼€å‘ï¼Œä½†æ˜¯æœ¬åœ°çš„intelligenceæ— æ³•æ‰“å¼€è¿œç¨‹çš„mysql++.h ï¼Œè€Œè¿œç¨‹çš„ubuntuåˆ™å¯ä»¥æˆåŠŸé“¾æ¥å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚ä½•è®©æœ¬åœ°ä¹Ÿèƒ½è®¿é—®åˆ°è¯¥mysql++.hæ–‡ä»¶å‘¢
When using Visual Studio 2022 to remotely debug or edit files on a Linux machine, the remote files you're working with are typically not directly accessible on your local Windows machine's file system.Â Instead, Visual Studio provides tools and mechanisms to interact with the remote files as if they were local, including the Remote File Explorer and IntelliSense for remote headers.Â 

Here's a breakdown of why you don't see remote files on your local drive and how to work with them:

1. Remote File Explorer:

- Visual Studio's Remote File Explorer allows you to browse and manage files on the remote Linux machine.
- You can open, edit, and save files directly within the Remote File Explorer, with changes automatically reflected on the remote system.
- The Remote File Explorer provides a way to navigate the file system of the remote machine without needing to manually copy files back and forth.Â 

2. IntelliSense for Remote Headers:

- When you connect to a remote Linux system, Visual Studio can use IntelliSense to provide suggestions and completions for code based on the remote project's headers.
- This allows you to write code in Visual Studio as if you were working directly with the remote files, without needing to copy them locally.Â 

3. No Direct Local File System Access:

- By design, the remote connection does not provide direct access to your local file system folders on the remote side.
- The VS Code window connected to the remote will primarily interact with files and folders on the remote machine.
- You can open and edit single files, but you cannot open entire local folders from the remote connection.Â 

4. Working with Remote Files:

- When developing or debugging on a remote Linux system, you should focus on using the Visual Studio tools that interact directly with the remote files.
- This includes using the Remote File Explorer to browse and edit files, and using IntelliSense to get suggestions and completions based on the remote headers.
- Avoid trying to copy files back and forth between your local and remote machines unnecessarily, as this can lead to synchronization issues and inefficiencies.
**ç»è¿‡å®é™…æµ‹è¯•ï¼ŒVS2022ä¼šè‡ªåŠ¨åœ¨æœ¬åœ°æ‹·è´è¿œç¨‹ç›®å½•çš„æ–‡ä»¶åˆ°æœ¬åœ°çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ä»¥æ”¯æŒintelligenceï¼Œä¸ç”¨å’±è‡ªå·±æ“å¿ƒï¼Œæˆ–è€…ä¿®æ”¹æœ¬åœ°å·¥ç¨‹çš„å•¥æ–‡ä»¶å•¥çš„**
## cmakepreset.jsonä¸­æœ‰å¦‚ä¸‹çš„é…ç½® 
```json
"name": "linux-debug",
 "displayName": "Linux Debug",
 "generator": "Ninja",
 "binaryDir": "${sourceDir}/out/build/${presetName}",
 "installDir": "${sourceDir}/out/install/${presetName}",
 "cacheVariables": {
     "CMAKE_BUILD_TYPE": "Debug"
 },
 "condition": {
     "type": "equals",
     "lhs": "${hostSystemName}",
     "rhs": "Linux"
 },
 "vendor": {
     "microsoft.com/VisualStudioRemoteSettings/CMake/1.0": {
         "sourceDir": "$env{HOME}/workspace/$ms{projectDirName}"
     }
 
```
å¯¼è‡´åœ¨cmakelistä¸­set(RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin)å¥½åƒä¸ç”Ÿæ•ˆå•Š
ä½ è§‚å¯Ÿå¾—éå¸¸å¯¹ï¼šå½“ä½ åœ¨ `CMakePresets.json` ä¸­ä½¿ç”¨äº† `binaryDir` å’Œ VS Remote Development é…ç½®ï¼ˆ`vendor.microsoft.com/...`ï¼‰åï¼Œ`CMakeLists.txt` ä¸­çš„ `set(RUNTIME_OUTPUT_DIRECTORY ...)` å¯èƒ½ä¼š**è¢«å¿½ç•¥æˆ–è¦†ç›–**ï¼Œæˆ‘ä»¬æ¥æ·±å…¥åˆ†æè¿™ä¸ªé—®é¢˜å’Œå¦‚ä½•è§£å†³ã€‚

---

## âœ… é—®é¢˜åˆ†æ

ä½ å†™çš„ CMakePresets é…ç½®å¦‚ä¸‹ï¼ˆç®€åŒ–ï¼‰ï¼š

```json
{
  "name": "linux-debug",
  "generator": "Ninja",
  "binaryDir": "${sourceDir}/out/build/${presetName}",
  "installDir": "${sourceDir}/out/install/${presetName}",
  "cacheVariables": {
    "CMAKE_BUILD_TYPE": "Debug"
  },
  "vendor": {
    "microsoft.com/VisualStudioRemoteSettings/CMake/1.0": {
      "sourceDir": "$env{HOME}/workspace/$ms{projectDirName}"
    }
  }
}
```

ä½ åœ¨ CMakeLists ä¸­è¿™æ ·å†™ï¼š

```cmake
set(RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin)
```

ç»“æœ **å®é™…çš„å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰å‡ºç°åœ¨ `${PROJECT_SOURCE_DIR}/bin` ä¸­**ï¼Œè€Œæ˜¯ä»ç„¶å‡ºç°åœ¨ `binaryDir` çš„é»˜è®¤ç»“æ„é‡Œï¼Œæ¯”å¦‚ï¼š

```
out/build/linux-debug/server
```

---

## ğŸš¨ ä¸ºä»€ä¹ˆ `RUNTIME_OUTPUT_DIRECTORY` ä¸ç”Ÿæ•ˆï¼Ÿ

### 1. `RUNTIME_OUTPUT_DIRECTORY` å¿…é¡»è®¾ç½®åœ¨ `add_executable` ä¹‹åæˆ–ç›®æ ‡åˆ›å»ºä¹‹åï¼š

```cmake
add_executable(server ...)
set_target_properties(server PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin
)
```

æˆ–è€…ç›´æ¥ç”¨ï¼š

```cmake
set_target_properties(server PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY_DEBUG ${PROJECT_SOURCE_DIR}/bin
    RUNTIME_OUTPUT_DIRECTORY_RELEASE ${PROJECT_SOURCE_DIR}/bin
)
```

### 2. `CMakePresets.json` ä¸­çš„ `binaryDir` å®šä¹‰äº†æ„å»ºç›®å½•ï¼Œä½†**ä¸ä¼šå½±å“ç›®æ ‡çš„è¾“å‡ºç›®å½•**ï¼Œé™¤éä½ æ˜¾å¼è®¾ç½®äº† `CMAKE_RUNTIME_OUTPUT_DIRECTORY`ï¼š

```json
"cacheVariables": {
  "CMAKE_BUILD_TYPE": "Debug",
  "CMAKE_RUNTIME_OUTPUT_DIRECTORY": "${sourceDir}/bin"
}
```

âš ï¸ æ³¨æ„ï¼š**cacheVariables ä¸­è®¾ç½®çš„å˜é‡å…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§**ï¼Œä¼šè¦†ç›– `CMakeLists.txt` ä¸­çš„ `set()`ã€‚

---

## âœ… æ¨èè§£å†³æ–¹æ³•

### âœ… æ–¹æ³• 1ï¼šä¿®æ”¹ presetï¼ŒåŠ å…¥ `CMAKE_RUNTIME_OUTPUT_DIRECTORY`

```json
"cacheVariables": {
  "CMAKE_BUILD_TYPE": "Debug",
  "CMAKE_RUNTIME_OUTPUT_DIRECTORY": "${sourceDir}/bin"
}
```

æ­¤æ–¹å¼æœ€ç¨³å®šï¼Œåœ¨ CMake é…ç½®é˜¶æ®µå°±æŒ‡å®šäº†è¾“å‡ºè·¯å¾„ã€‚

---

### âœ… æ–¹æ³• 2ï¼šåœ¨ `CMakeLists.txt` ä¸­ç”¨ `set_target_properties()` æ˜¾å¼è®¾ç½®è¾“å‡ºç›®å½•

```cmake
add_executable(server src/server.cpp)
set_target_properties(server PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin
)
```

ä½†å‰ææ˜¯ï¼š**ä¸è¦åœ¨ preset ä¸­ç”¨ cacheVariable è®¾ç½®äº† `CMAKE_RUNTIME_OUTPUT_DIRECTORY`ï¼Œå¦åˆ™æ­¤è®¾ç½®ä¼šè¢«è¦†ç›–ã€‚**

---

## âœ… å°ç»“

|é—®é¢˜|åŸå› |è§£å†³æ–¹å¼|
|---|---|---|
|`RUNTIME_OUTPUT_DIRECTORY` ä¸ç”Ÿæ•ˆ|è¢« preset ä¸­çš„ `cacheVariables` æˆ– VS é…ç½®è¦†ç›–|æ¨èå°†å…¶å†™å…¥ `cacheVariables` ä¸­|
|æƒ³è®©æ‰€æœ‰ç›®æ ‡è¾“å‡ºç»Ÿä¸€åˆ°ä¸€ä¸ªç›®å½•|`CMakeLists.txt` è®¾ç½®ä¸ç¨³å®š|ä½¿ç”¨ `CMAKE_RUNTIME_OUTPUT_DIRECTORY` æ›´ç¨³å¦¥|

---

å¦‚æœä½ æƒ³æˆ‘å¸®ä½ é‡å†™ä¸€ä¸‹é€‚é…ä½ é¡¹ç›®çš„ `CMakePresets.json` å’Œ `CMakeLists.txt` è¾“å‡ºè®¾ç½®ï¼Œè´´ä¸€ä¸‹ç›®æ ‡åå­—å’Œç»“æ„ï¼Œæˆ‘å¯ä»¥ç›´æ¥å¸®ä½ å†™å¥½ã€‚
**å®è·µè¡¨æ˜ï¼Œé‡‡ç”¨æ–¹æ³•2ï¼Œå³è®¾ç½®set_target_properties(server PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${PROJECT_SOURCE_DIR}/bin")å¯ä»¥ä¿è¯è¾“å‡ºåœ¨/binç›®å½•ä¸‹

## cmakelistä¸­cmakeè®¾ç½®ç‰ˆæœ¬ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå¤šå°‘ï¼Œæœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«å—
åœ¨ `CMakeLists.txt` ä¸­è®¾ç½® `CMake` çš„æœ€ä½ç‰ˆæœ¬ï¼ˆ`cmake_minimum_required(VERSION x.y)`ï¼‰æ˜¯éå¸¸é‡è¦çš„ä¸€æ­¥ï¼Œå®ƒæ§åˆ¶äº† CMake çš„è¯­æ³•ã€è¡Œä¸ºå’Œæ”¯æŒçš„åŠŸèƒ½ã€‚

---

## âœ… ä¸€èˆ¬è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿ

### ğŸš€ æ¨èå€¼ï¼ˆ2024â€“2025å¹´ï¼‰ï¼š

```cmake
cmake_minimum_required(VERSION 3.16)
```

### ğŸ“Œ ç¨³å¦¥å€¼ï¼ˆé€‚åˆå¤§å¤šæ•°ç°ä»£é¡¹ç›®ï¼‰ï¼š

- `3.10`ï¼šUbuntu 18.04 é»˜è®¤ç‰ˆæœ¬ï¼Œé€‚åˆå…¼å®¹è€ç³»ç»Ÿ
    
- `3.16`ï¼šUbuntu 20.04 èµ·é»˜è®¤ï¼ŒVisual Studio 2019+ é»˜è®¤æ”¯æŒ
    
- `3.21+`ï¼šé€‚ç”¨äº VS 2022 / Ubuntu 22.04ï¼ˆå¾ˆå¸¸è§ï¼‰
    
- `3.25+`ï¼šæ”¯æŒ `CMakePresets.json` çš„é«˜çº§åŠŸèƒ½
    
- `3.28`ï¼šæ”¯æŒ CMake è¯­è¨€ç‰¹æ€§ï¼ˆ2023æœ«å‘å¸ƒï¼Œæœ€æ–°ç‰ˆï¼‰
    

---

## â— ä¸å»ºè®®ç›²ç›®ä½¿ç”¨é«˜ç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š

```cmake
cmake_minimum_required(VERSION 3.28)
```

å¦‚æœä½ å›¢é˜Ÿä¸­æœ‰äººä½¿ç”¨è¾ƒæ—§çš„ç³»ç»Ÿæˆ– IDEï¼ˆæ¯”å¦‚ VS 2017 æˆ– Ubuntu 18.04ï¼‰ï¼Œå°±ä¼šå› ä¸ºç‰ˆæœ¬è¿‡é«˜è€Œæ„å»ºå¤±è´¥ã€‚

---

## âœ… è®¾ç½®ç‰ˆæœ¬çš„ä½œç”¨ï¼ˆéå¸¸å…³é”®ï¼‰

```cmake
cmake_minimum_required(VERSION 3.16)
```

### 1. å¯ç”¨å¯¹åº”ç‰ˆæœ¬çš„ **è¯­æ³•è¡Œä¸º**

ä¾‹å¦‚ï¼š

- åœ¨ CMake 3.13 ä¹‹åæ‰æ”¯æŒ `target_link_options`
    
- åœ¨ CMake 3.14 æ‰æ”¯æŒ `target_precompile_headers`
    
- åœ¨ CMake 3.21 æ‰æ”¯æŒ `include_guard()`
    

### 2. æ§åˆ¶å…¼å®¹æ¨¡å¼ï¼ˆé¿å… CMake è‡ªè¡Œâ€œå›é€€â€æ—§è¡Œä¸ºï¼‰

å¦‚æœä½ ä¸å†™ç‰ˆæœ¬ï¼ŒCMake ä¼šå°è¯•å¯ç”¨è€è¡Œä¸ºä»¥ä¿æŒå…¼å®¹ï¼Œä½†è¿™å¯èƒ½ä¼šå¯¼è‡´ï¼š

- è¯­æ³•è­¦å‘Š
    
- ä¸€äº›æ–°è¯­æ³•å¤±æ•ˆ
    
- æ–°åŠŸèƒ½ä¸èƒ½ä½¿ç”¨
    

---

## âœ… ç¤ºä¾‹æ¨èå†™æ³•

```cmake
cmake_minimum_required(VERSION 3.16)

project(MyProject VERSION 1.0 LANGUAGES CXX)

# å¯ç”¨ C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

---

## ğŸ“Œ å»ºè®®æ€»ç»“ï¼š

|ä½¿ç”¨ç¯å¢ƒ|æ¨èç‰ˆæœ¬|
|---|---|
|æœ€ä½å…¼å®¹ Ubuntu 18.04|3.10|
|é»˜è®¤ Ubuntu 20.04 / VS2019|3.16|
|VS2022 / Ubuntu 22.04 å¼€å‘|3.21+|
|ä½¿ç”¨ `CMakePresets.json`|3.21+ï¼ˆæ¨è 3.25ï¼‰|
|æƒ³ç”¨æœ€æ–°ç‰ˆè¯­æ³•ï¼ˆå¦‚ PCH ç®¡ç†ï¼‰|3.28|

---

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ†æä½ å½“å‰é¡¹ç›®ä½¿ç”¨çš„åŠŸèƒ½ï¼Œæ¨èæœ€å°æ‰€éœ€ç‰ˆæœ¬ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

## mysqlä½¿ç”¨æ—¶ï¼Œæ˜¯æ¯æ¬¡æŸ¥è¯¢éƒ½æ–°å»ºç«‹è¿æ¥ç„¶åé‡Šæ”¾æ‰å¥½ï¼Œè¿˜æ˜¯ä¸€ç›´å»ºç«‹è¿æ¥å¥½
ä»¥ä¸‹æ˜¯è¿™æ®µè¯çš„ä¸­æ–‡ç¿»è¯‘ï¼šæ¥è‡ªStack Overflow

---

> æ ¹æ®æˆ‘çš„ç»éªŒï¼Œ**å»ºç«‹è¿æ¥é€šå¸¸ä¸ä¼šæˆä¸º MySQL æœåŠ¡å™¨çš„æ€§èƒ½ç“¶é¢ˆ**ï¼ˆMySQL çš„è¿æ¥å¼€é”€ç›¸å¯¹è¾ƒä½ï¼‰ã€‚å°½ç®¡å¦‚æ­¤ï¼Œ**å¤ç”¨å·²æœ‰è¿æ¥**é€šå¸¸æ˜¯ä¸€ç§åˆç†çš„åšæ³•ï¼Œä½†è¿™éœ€è¦æ³¨æ„ä¸€äº›ç»†èŠ‚ï¼š
> 
> - å¦‚æœæ•°æ®åº“æœåŠ¡å™¨ä¸´æ—¶ä¸å¯ç”¨ï¼Œä»£ç å¿…é¡»èƒ½å¤Ÿè‡ªåŠ¨é‡è¿ï¼›
>     
> - å¦‚æœæ•°æ®åº“æœåŠ¡å™¨è¢«æ›¿æ¢ï¼ˆä¾‹å¦‚æ•…éšœåˆ‡æ¢ï¼‰ï¼Œä¹Ÿå¿…é¡»èƒ½é‡æ–°è¿æ¥ï¼ˆMySQL æ›´å€¾å‘äºâ€œæ•…éšœè½¬ç§»â€æ–¹æ¡ˆï¼Œè€ŒéçœŸæ­£çš„é«˜å¯ç”¨ï¼‰ï¼›
>     
> - å¦‚æœåº”ç”¨ç¨‹åºä½¿ç”¨å¤šä¸ª MySQL è¿æ¥ï¼Œå¿…é¡»ç¡®ä¿ä¸åŒç”¨æˆ·æˆ–ä¼šè¯ä¹‹é—´ä¸ä¼šâ€œæ··ç”¨è¿æ¥â€ï¼ˆå› ä¸ºåƒæ´»åŠ¨æ•°æ®åº“ã€æ—¶åŒºã€å­—ç¬¦é›†ç­‰éƒ½æ˜¯ä¸è¿æ¥ç»‘å®šçš„â€œä¼šè¯å˜é‡â€ï¼‰ã€‚
>     
> 
> å¦‚æœä½ æ— æ³•åœ¨è¿™äº›åŠå…¶ä»–è¾¹ç¼˜æƒ…å†µä¸­ç¡®ä¿å¤ç”¨è¿æ¥çš„å¯é æ€§ï¼Œé‚£ä¹ˆ**æ¯ 2 ç§’é‡æ–°å»ºç«‹ä¸€ä¸ªæ–°è¿æ¥ï¼Œåè€Œå¯èƒ½æ›´ç¨³å¦¥å¯é **ï¼Œä¸”æ— éœ€é¢å¤–å¤„ç†ã€‚
> 
> ç®€è€Œè¨€ä¹‹ï¼Œ**çŸ­ç”Ÿå‘½å‘¨æœŸè¿æ¥æœ‰æ—¶ä¹Ÿæœ‰ä¸€äº›ä¸é‚£ä¹ˆæ˜¾è€Œæ˜“è§çš„å¥½å¤„**ã€‚æˆ‘ä¸ä¼šå»åˆ»æ„å®ç°æŒä¹…è¿æ¥ç®¡ç†æœºåˆ¶ï¼Œé™¤éä½ æœ‰å……åˆ†çš„ç†ç”±ï¼ˆæ¯”å¦‚åŸºå‡†æµ‹è¯•ï¼‰ç¡®ä¿¡é‚£æ ·åšåœ¨ä½ çš„åœºæ™¯ä¸­ç¡®å®æœ‰æ˜¾è‘—çš„æ€§èƒ½æ”¶ç›Šã€‚

---

è¿™æ®µè¯çš„æ ¸å¿ƒè§‚ç‚¹æ˜¯ï¼š

- MySQL çš„è¿æ¥æˆæœ¬å…¶å®ä¸é«˜ï¼›
    
- å¤ç”¨è¿æ¥è™½ç„¶é«˜æ•ˆï¼Œä½†å®ç°æ­£ç¡®å’Œé²æ£’å¹¶ä¸ç®€å•ï¼›
    
- åœ¨ä¸ç¡®å®šæ”¶ç›Šæ—¶ï¼Œä½¿ç”¨çŸ­è¿æ¥åè€Œæ›´ç¨³å®šå¯é ã€‚
    

æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ ç”¨ C++ å†™ä¸€ä¸ªå¸¦æœ‰â€œè‡ªåŠ¨é‡è¿â€çš„ç®€å• MySQL è¿æ¥ç±»ä½œä¸ºç¤ºä¾‹ï¼Ÿ


## å¦‚ä½•ç¡®ä¿friendsè¡¨ä¸­çš„useridå¿…é¡»å°äºfriendidå‘¢
åœ¨ MySQL ä¸­ï¼Œè¦ç¡®ä¿ `friends` è¡¨ä¸­ `userid < friendid`ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥é€‰æ‹©æˆ–ç»„åˆä½¿ç”¨ï¼š

---

## âœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `BEFORE INSERT` å’Œ `BEFORE UPDATE` è§¦å‘å™¨ï¼ˆæ¨èï¼‰

```sql
DELIMITER //

CREATE TRIGGER before_insert_friends
BEFORE INSERT ON friends
FOR EACH ROW
BEGIN
    IF NEW.userid >= NEW.friendid THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'userid must be less than friendid';
    END IF;
END;
//

CREATE TRIGGER before_update_friends
BEFORE UPDATE ON friends
FOR EACH ROW
BEGIN
    IF NEW.userid >= NEW.friendid THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'userid must be less than friendid';
    END IF;
END;
//

DELIMITER ;
```

### âœ… ä¼˜ç‚¹ï¼š

- å¼ºåˆ¶é™åˆ¶é€»è¾‘ï¼Œé˜²æ­¢è„æ•°æ®æ’å…¥ã€‚
    
- è§¦å‘å™¨åœ¨æ•°æ®åº“å±‚æ§åˆ¶ï¼Œä¸å—å®¢æˆ·ç«¯è¯­è¨€çº¦æŸã€‚
    

---

## âœ… æ–¹æ³•äºŒï¼šåº”ç”¨å±‚é€»è¾‘æ§åˆ¶ï¼ˆå¦‚ C++ã€Python ä¸­æ’å…¥å‰åˆ¤æ–­ï¼‰

åœ¨ä»£ç ä¸­åˆ¤æ–­ï¼Œä¾‹å¦‚ï¼š

```cpp
if (userid >= friendid) {
    std::cerr << "Invalid friend pair: userid must be less than friendid" << std::endl;
    return;
}
```

### âš ï¸ ç¼ºç‚¹ï¼š

- å®¹æ˜“æ¼å†™æˆ–è¢«ç»•è¿‡ã€‚
    
- å¤šä¸ªå®¢æˆ·ç«¯æ—¶ä¸å®‰å…¨ã€‚
    

---

## âœ… æ–¹æ³•ä¸‰ï¼šäº¤æ¢å­˜å‚¨é¡ºåºï¼ˆå†™å…¥å‰è‡ªåŠ¨æ’åºï¼‰

ä½ å¯ä»¥æŠŠ `(å°çš„ç”¨æˆ·ID, å¤§çš„ç”¨æˆ·ID)` å¼ºåˆ¶æŒ‰é¡ºåºå†™å…¥æ•°æ®åº“ã€‚ä¾‹å¦‚åœ¨ C++ é‡Œï¼š

```cpp
int a = std::min(userid, friendid);
int b = std::max(userid, friendid);
query << "INSERT INTO friends (userid, friendid) VALUES (" << a << ", " << b << ")";
```

ç„¶åå°±ä¸éœ€è¦æ•°æ®åº“å¼ºè¡Œåˆ¤æ–­äº†ã€‚

---

## ğŸš« æ–¹æ³•å››ï¼šCHECK çº¦æŸï¼ˆMySQL 8.0 ä»¥åæ”¯æŒï¼Œä½†ä¸æ¨èä¾èµ–ï¼‰

```sql
CREATE TABLE friends (
    userid INT,
    friendid INT,
    CHECK (userid < friendid),
    UNIQUE (userid, friendid)
);
```

âš ï¸ æ³¨æ„ï¼š

- è™½ç„¶ MySQL 8.0 å¼€å§‹æ”¯æŒ `CHECK`ï¼Œä½†æ—§ç‰ˆæœ¬ä¼šå¿½ç•¥è¿™ä¸ªçº¦æŸã€‚
    
- ä¸å¦‚è§¦å‘å™¨ç¨³å¦¥ã€‚
    

---

## âœ… æ¨èæ–¹æ¡ˆæ€»ç»“

|æ–¹æ³•|æ¨èæŒ‡æ•°|æ˜¯å¦å¯é |è¯´æ˜|
|---|---|---|---|
|è§¦å‘å™¨|â­â­â­â­â­|âœ…|æ•°æ®åº“å±‚ä¿è¯å¼ºä¸€è‡´æ€§|
|åº”ç”¨åˆ¤æ–­|â­â­â­|âŒ|æ˜“å‡ºé”™ï¼Œä»…ä½œè¾…åŠ©|
|ä¸»åŠ¨æ’åºå†™å…¥|â­â­â­â­|âœ…|ç®€å•ä½†ä¸èƒ½é˜²æ­¢æ‰‹åŠ¨ SQL|
|CHECK çº¦æŸ|â­â­|âŒï¼ˆæ—§ç‰ˆæ— æ•ˆï¼‰|MySQL å®ç°ä¸ä¸¥æ ¼|

---

å¦‚éœ€æˆ‘å¸®ä½ å†™ä¸€ä¸ªä½¿ç”¨ `mysql++` æ’å…¥æ—¶è‡ªåŠ¨åˆ¤æ–­å¹¶è°ƒæ•´é¡ºåºçš„ C++ ç¤ºä¾‹ï¼Œå¯ä»¥ç»§ç»­è¯´ã€‚

## ä¸ºä»€ä¹ˆè§¦å‘å™¨è¦signal sqlstate â€˜45000â€™å‘¢ï¼Œåˆ«çš„ä¸è¡Œå—
è¿™æ˜¯ä¸ªå¾ˆä¸“ä¸šä¸”å…³é”®çš„é—®é¢˜ï¼Œä¸‹é¢æ˜¯å®Œæ•´è§£æï¼š

---

## âœ… ä¸ºä»€ä¹ˆ `SIGNAL SQLSTATE '45000'`ï¼Ÿ

åœ¨ MySQL ä¸­ï¼Œè§¦å‘å™¨ï¼ˆTriggerï¼‰ä¸­**ä¸èƒ½ä½¿ç”¨ `RETURN` æˆ– `LEAVE` æ¥ä¸­æ­¢æ‰§è¡Œ**ï¼Œæ‰€ä»¥ï¼š

- å¦‚æœä½ æƒ³**åœ¨æ»¡è¶³æŸäº›æ¡ä»¶æ—¶é˜»æ­¢ `INSERT/UPDATE/DELETE` æ‰§è¡Œ**ï¼Œå°±å¿…é¡»ä½¿ç”¨ï¼š
    
    ```sql
    SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'xxx';
    ```
    

---

## ğŸ” `'45000'` æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

- `SQLSTATE '45000'` æ˜¯**MySQL ç”¨æˆ·è‡ªå®šä¹‰å¼‚å¸¸çš„é€šç”¨é”™è¯¯ç **ã€‚
    
- æ ¼å¼ï¼š`'45XXX'` æ˜¯ä¸“ç”¨äºç”¨æˆ·å®šä¹‰é”™è¯¯çš„ä»£ç æ®µã€‚
    
- `'45000'` å°±æ˜¯ã€Œé€šç”¨è‡ªå®šä¹‰é”™è¯¯ã€ï¼Œç›¸å½“äºä½ è‡ªå·±å®šä¹‰çš„é€»è¾‘é”™è¯¯ï¼ŒMySQL ä¼šæŠŠå®ƒå½“æˆ**ä¸¥é‡é”™è¯¯å¤„ç†**ï¼Œè‡ªåŠ¨ä¸­æ­¢å½“å‰è¯­å¥ã€‚
    

---

## âŒ ä¸èƒ½ç”¨çš„å…¶å®ƒæ–¹å¼ï¼ˆä¸ºä»€ä¹ˆä¸è¡Œï¼‰

|å°è¯•æ–¹å¼|æ˜¯å¦å¯è¡Œ|åŸå› |
|---|---|---|
|`RETURN`|âŒ|ä¸èƒ½ç”¨äºè§¦å‘å™¨ï¼ˆè§¦å‘å™¨æ— è¿”å›å€¼ï¼‰|
|`LEAVE`|âŒ|åªèƒ½åœ¨å­˜å‚¨è¿‡ç¨‹çš„ `BEGIN...END` å†…éƒ¨å—è·³å‡ºï¼Œä¸æ˜¯é€€å‡ºæ•´ä¸ªè¯­å¥|
|`RAISE`ï¼ˆPostgreSQLï¼‰|âŒ|MySQL ä¸æ”¯æŒ|
|`SIGNAL SQLSTATE '01000'`|âœ… ä½†ä¸ç»ˆæ­¢|è¿™æ˜¯è­¦å‘Šï¼Œä¸ä¼šé˜»æ­¢æ‰§è¡Œ|
|`SIGNAL SQLSTATE '45001'`|âœ…|ä¹Ÿæ˜¯åˆæ³•çš„è‡ªå®šä¹‰é”™è¯¯ç ï¼Œä½†ä¸å¦‚ `'45000'` æ ‡å‡†ç»Ÿä¸€|

---

## âœ… æœ€ç¨³å¦¥å†™æ³•ç¤ºä¾‹

```sql
IF NEW.userid >= NEW.friendid THEN
    SIGNAL SQLSTATE '45000'
    SET MESSAGE_TEXT = 'userid must be less than friendid';
END IF;
```

è¿™æ ·å°±ä¼šï¼š

- é˜»æ­¢å½“å‰è¯­å¥æ‰§è¡Œï¼›
    
- è¿”å›é”™è¯¯ä¿¡æ¯åˆ°å®¢æˆ·ç«¯æˆ–æ—¥å¿—ï¼›
    
- ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚
    

---

## ğŸ§  æ€»ç»“

|é¡¹|å†…å®¹|
|---|---|
|`45000` å«ä¹‰|ç”¨æˆ·è‡ªå®šä¹‰é”™è¯¯ï¼Œé˜»æ­¢å½“å‰ SQL æ‰§è¡Œ|
|æ˜¯å¦å¿…é¡»|âœ… æ˜¯å”¯ä¸€åˆæ³•ä¸”å¯é æ–¹å¼æ¥ä¸­æ–­è§¦å‘å™¨ä¸­çš„æ‰§è¡Œ|
|æ›¿ä»£æ–¹æ¡ˆ|âŒ å…¶ä»–æ–¹æ³•éƒ½ä¸èƒ½æ­£ç¡®ä¸­æ–­è§¦å‘å™¨æ“ä½œ|
|å¸¸ç”¨åœºæ™¯|è§¦å‘å™¨ä¸­æ ¡éªŒå¤±è´¥ã€å­˜å‚¨è¿‡ç¨‹ä¸­æ‰‹åŠ¨æŠ¥é”™ç­‰|

---

å¦‚ä½ æœ‰å…´è¶£ï¼Œæˆ‘è¿˜å¯ä»¥å±•ç¤ºå¦‚ä½•åœ¨å­˜å‚¨è¿‡ç¨‹ï¼ˆ`PROCEDURE`ï¼‰é‡Œç”¨ `SIGNAL` å®ç°æ›´å¤æ‚çš„é”™è¯¯å¤„ç†é€»è¾‘ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ

## å¯ä»¥åœ¨signal sqlstate â€˜45000â€™ ï¼›ç„¶åset MESSAGE_TEXT=â€˜ã€‚ã€‚ã€‚â€™å³åŠ ä¸€ä¸ª;å—
ä¸å¯ä»¥ï¼Œä¸èƒ½åœ¨ `SIGNAL SQLSTATE '45000';` å’Œ `SET MESSAGE_TEXT = '...'` ä¹‹é—´åŠ åˆ†å·ï¼ˆ`;`ï¼‰ï¼Œå› ä¸ºï¼š

---

## âŒ é”™è¯¯å†™æ³•ï¼ˆä¼šæŠ¥é”™ï¼‰

```sql
SIGNAL SQLSTATE '45000';  -- âŒ æå‰ç»“æŸè¯­å¥
SET MESSAGE_TEXT = 'xxx'; -- âŒ ç‹¬ç«‹è¯­å¥ï¼Œè¯­æ³•é”™è¯¯
```

è¿™æ ·çš„å†™æ³• MySQL ä¼šæŠ¥é”™ï¼Œå¤§æ„æ˜¯ï¼š

> `MESSAGE_TEXT` is not a recognized command or is in the wrong place.

---

## âœ… æ­£ç¡®å†™æ³•ï¼š**ä¸€æ•´æ¡è¯­å¥**

```sql
SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'ä½ å†™çš„é”™è¯¯ä¿¡æ¯';
```

- `SIGNAL ... SET ...` æ˜¯**ä¸€æ¡å®Œæ•´è¯­å¥**ï¼Œå¿…é¡»è¿åœ¨ä¸€èµ·ã€‚
    
- ä½ å¯ä»¥è®¾ç½®å¤šä¸ªå­—æ®µï¼Œä¾‹å¦‚ï¼š
    
    ```sql
    SIGNAL SQLSTATE '45000'
    SET MESSAGE_TEXT = 'é”™è¯¯ä¿¡æ¯', MYSQL_ERRNO = 1001;
    ```
    

---

## ğŸ“ è¡¥å……è¯´æ˜

|ç»„ä»¶|æ˜¯å¦å¯é€‰|ç¤ºä¾‹|
|---|---|---|
|`SQLSTATE`|å¿…éœ€|`'45000'`|
|`MESSAGE_TEXT`|å¯é€‰ä½†å¸¸ç”¨|`'æ“ä½œéæ³•ï¼šuserid >= friendid'`|
|`MYSQL_ERRNO`|å¯é€‰|è‡ªå®šä¹‰é”™è¯¯ç¼–å·ï¼ˆä¾‹å¦‚ 1001ï¼‰|

---

### âœ… ç¤ºä¾‹è§¦å‘å™¨ä¸­åº”ç”¨

```sql
CREATE TRIGGER check_friend_ids
BEFORE INSERT ON friends
FOR EACH ROW
BEGIN
    IF NEW.userid >= NEW.friendid THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'userid must be less than friendid';
    END IF;
END;
```

---

å¦‚ä½ å¸Œæœ›è¿™ä¸ªé”™è¯¯æ›´â€œç»“æ„åŒ–â€ï¼ˆæ¯”å¦‚å‰ç«¯èƒ½è¯†åˆ«é”™è¯¯ç ï¼‰ï¼Œå¯ä»¥ç»“åˆ `MYSQL_ERRNO` ä½¿ç”¨ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™å‡ºæ›´è§„èŒƒçš„ç‰ˆæœ¬ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

## target_link_libraries()æ—¶ï¼Œéœ€è¦åœ¨åº“å‰é¢åŠ libçš„å‰ç¼€å—ï¼Ÿå³ä½¿è¯¥åº“çš„åå­—ç¡®å®å«libXXX.a
åœ¨ä½¿ç”¨ `target_link_libraries()` æ—¶ï¼Œ**ä½ é€šå¸¸ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥æ‰‹åŠ¨åŠ  `lib` å‰ç¼€**ï¼Œå³ä½¿å®é™…çš„åº“æ–‡ä»¶æ˜¯ `libXXX.a` æˆ– `libXXX.so`ã€‚è¿™æ˜¯å› ä¸º **CMake ä¼šè‡ªåŠ¨æ·»åŠ å‰ç¼€å’Œåç¼€**ï¼ˆå¦‚ `lib`ã€`.so`ã€`.a`ï¼‰æ¥æŸ¥æ‰¾åº“æ–‡ä»¶ã€‚

---

## âœ… æ­£ç¡®å†™æ³•

å‡è®¾ä½ æœ‰ä¸€ä¸ªåº“æ–‡ä»¶ï¼š

```
/usr/lib/libfoo.a
```

CMake ä¸­çš„å†™æ³•åº”è¯¥æ˜¯ï¼š

```cmake
target_link_libraries(my_target PRIVATE foo)
```

> **ä¸è¦å†™æˆï¼š**
> 
> ```cmake
> target_link_libraries(my_target PRIVATE libfoo)  # âŒ é”™è¯¯
> ```

---

## ğŸ” åŸç†è§£é‡Š

- `target_link_libraries(foo)` ä¼šè®© CMake æŸ¥æ‰¾åä¸ºï¼š
    
    - `libfoo.a`ï¼ˆé™æ€åº“ï¼‰
        
    - `libfoo.so`ï¼ˆåŠ¨æ€åº“ï¼‰
        
- CMake ä¼šè‡ªåŠ¨åŠ  `lib` å‰ç¼€å’Œ `.so/.a` åç¼€ï¼ˆåœ¨ç±» Unix ç³»ç»Ÿä¸­ï¼‰
    
- ä½ åªéœ€è¦ä¼ å…¥ **é€»è¾‘åç§°**ï¼Œè€Œä¸æ˜¯ç‰©ç†æ–‡ä»¶å
    

---

## ğŸ§± ç‰¹æ®Šæƒ…å†µï¼šä½¿ç”¨ `IMPORTED` æˆ– `FULL PATH`

å¦‚æœä½ æ˜ç¡®æŒ‡å®šäº†å…¨è·¯å¾„ï¼Œå°±å¯ä»¥ä½¿ç”¨å®Œæ•´æ–‡ä»¶åï¼š

```cmake
target_link_libraries(my_target PRIVATE /some/path/libfoo.a)  # âœ… åˆæ³•
```

ä½†è¿™ç§æ–¹å¼ä¸æ¨èç”¨äºæ™®é€šé¡¹ç›®å¼€å‘ï¼Œå› ä¸ºå®ƒä¸ä¾¿äºç§»æ¤å’Œç»´æŠ¤ã€‚

---

## ğŸ§¾ æ€»ç»“

|æƒ…å†µ|æ˜¯å¦éœ€è¦å†™ `lib` å‰ç¼€|
|---|---|
|ä½¿ç”¨ CMake è‡ªå·±æŸ¥æ‰¾çš„åº“ï¼ˆæ¨èï¼‰|âŒ ä¸éœ€è¦ï¼Œä¾‹å¦‚ `foo`|
|æ‰‹åŠ¨å†™å…¨è·¯å¾„ `.a/.so`|âœ… å¯ä»¥å†™å®Œæ•´åï¼ˆå« `lib`ï¼‰|
|ä½¿ç”¨ `find_library()` æˆ– `find_package()`|âŒ ä½¿ç”¨é€»è¾‘åç§°å³å¯|

---

å¦‚ä½ æœ‰ä¸€ä¸ªå…·ä½“çš„ `.a` åº“ä¸çŸ¥é“æ€ä¹ˆé“¾æ¥ï¼Œå¯ä»¥å‘è·¯å¾„ï¼Œæˆ‘å¸®ä½ å†™ä¸€ä¸‹å¯¹åº”çš„ `CMakeLists.txt` è¯­å¥ã€‚
**å®éªŒè¡¨æ˜ï¼Œä¸èƒ½åŠ libå‰ç¼€ï¼Œå³ä½¿æ–‡ä»¶åå¸¦æœ‰libå‰ç¼€ï¼Œå¦åˆ™ä¼šæŠ¥é”™æç¤ºæ‰¾ä¸åˆ°**

## muduoåº“çš„void Server::m_onMessage(const MuduoTcpConnectionPtr& conn, MuduoNetBuffer* buf, muduo::Timestamp time)ä¸­ï¼Œbufçš„æ•°æ®å¦‚æœä½¿ç”¨å®Œæ¯•ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾æ‰å—è¿˜æ˜¯ä¸ç”¨ç®¡
åœ¨ä½¿ç”¨ **muduo ç½‘ç»œåº“** æ—¶ï¼Œå…³äºä½ æåˆ°çš„ï¼š

```cpp
void Server::m_onMessage(const MuduoTcpConnectionPtr& conn, MuduoNetBuffer* buf, muduo::Timestamp time)
```

ä¸­çš„ `MuduoNetBuffer* buf`ï¼ˆå®é™…ä¸Šé€šå¸¸æ˜¯ `muduo::net::Buffer* buf`ï¼‰ï¼Œ**ä½ ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥æ‰‹åŠ¨é‡Šæ”¾ `buf` é‡Œé¢çš„å†…å­˜**ï¼Œå› ä¸ºï¼š

---

## âœ… **Muduo çš„ Buffer æ˜¯ç”±æ¡†æ¶è‡ªåŠ¨ç®¡ç†çš„**

### âœ¨ åŸå› å¦‚ä¸‹ï¼š

- `muduo::net::Buffer` æ˜¯ç”± `TcpConnection` åˆ›å»ºå’Œç»´æŠ¤çš„ï¼›
    
- å½“ `onMessage` å›è°ƒè§¦å‘æ—¶ï¼Œä¼ å…¥çš„ `Buffer*` æ˜¯è¿æ¥å¯¹è±¡å†…éƒ¨çš„æ¥æ”¶ç¼“å†²åŒºï¼›
    
- æ¡†æ¶ä¼šåœ¨ä¸‹ä¸€æ¬¡è¯»åˆ°æ–°æ•°æ®æˆ–è¿æ¥å…³é—­æ—¶é‡ç”¨æˆ–é”€æ¯è¿™ä¸ªç¼“å†²åŒºï¼›
    
- **ä½ åªéœ€è¦ä» `buf` ä¸­æå–éœ€è¦çš„æ•°æ®**ï¼ˆæ¯”å¦‚ç”¨ `buf->retrieveAsString(len)`ï¼‰ï¼Œ**ä¸éœ€è¦ä¹Ÿä¸èƒ½ delete/free å®ƒ**ã€‚
    

---

## ğŸš« é”™è¯¯åšæ³•ï¼ˆä¼šå¯¼è‡´å´©æºƒæˆ–æœªå®šä¹‰è¡Œä¸ºï¼‰

```cpp
delete buf;  // âŒ åƒä¸‡ä¸èƒ½è¿™æ ·åšï¼
```

---

## âœ… æ­£ç¡®åšæ³•ç¤ºä¾‹ï¼š

```cpp
void Server::m_onMessage(const muduo::net::TcpConnectionPtr& conn,
                         muduo::net::Buffer* buf,
                         muduo::Timestamp time) {
    std::string msg = buf->retrieveAllAsString();
    std::cout << "Received: " << msg << std::endl;

    // è¿™é‡Œ buf çš„æ•°æ®å·²ç»è¢« retrieveï¼Œåº•å±‚æŒ‡é’ˆå‰ç§»ï¼Œä½† buffer å¯¹è±¡ä»ç„¶ç”± muduo ç®¡ç†
}
```

---

## ğŸ”„ è¡¥å……è¯´æ˜ï¼šå…³äº `retrieveXXX()` æ–¹æ³•

- `retrieve(len)`ï¼šæ‰‹åŠ¨ä»ç¼“å†²åŒºç§»é™¤å‰ `len` å­—èŠ‚
    
- `retrieveAll()`ï¼šç§»é™¤æ‰€æœ‰æ•°æ®
    
- `retrieveAllAsString()`ï¼šè·å–æ‰€æœ‰æ•°æ®ä½œä¸ºå­—ç¬¦ä¸²å¹¶ç§»é™¤
    
- `peek()`ï¼šæŸ¥çœ‹æ•°æ®æŒ‡é’ˆä½†ä¸ç§»é™¤
    

---

## âœ… æ€»ç»“

|æ“ä½œ|æ˜¯å¦éœ€è¦æ‰‹åŠ¨é‡Šæ”¾|
|---|---|
|`Buffer*` ä¸­çš„æ•°æ®|âŒ ä¸éœ€è¦|
|ä½¿ç”¨ `retrieveXXX()` ç§»é™¤æ•°æ®|âœ… æ­£ç¡®|
|`delete buf` æˆ– `free(buf)`|âŒ é”™è¯¯ï¼Œç¦æ­¢|

å¦‚ä½ æƒ³è¦æ„å»ºä¸€ä¸ªå®Œæ•´çš„ Muduo echo server demoï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥ç»™ä½ ä¸€ä»½åŸºç¡€æ¨¡ç‰ˆã€‚

## cmakeä¸­/usr/includeæ˜¯é»˜è®¤åŒ…å«çš„å—ï¼Œå³è¯¥è·¯å¾„ä¸ç”¨target_include_directoriesæ·»åŠ 
æ˜¯çš„ï¼Œ`/usr/include` åœ¨ **CMake ä¸­æ˜¯é»˜è®¤åŒ…å«è·¯å¾„**ï¼Œ**é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨ç”¨ `target_include_directories()` æ·»åŠ **ã€‚è¿™æ˜¯å› ä¸ºï¼š

---

### âœ… **åŸå› **

- `/usr/include` æ˜¯ Linux ç³»ç»Ÿ C++ ç¼–è¯‘å™¨ï¼ˆå¦‚ `gcc`ã€`clang`ï¼‰çš„é»˜è®¤ç³»ç»Ÿå¤´æ–‡ä»¶æœç´¢è·¯å¾„ã€‚
    
- CMake åœ¨è°ƒç”¨ç¼–è¯‘å™¨æ—¶ï¼Œ**ä¸ä¼šæ˜¾å¼æŒ‡å®š `/usr/include`ï¼Œä½†ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å»é‚£é‡Œæ‰¾å¤´æ–‡ä»¶**ã€‚
    

ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤éªŒè¯ï¼š

```bash
echo "" | gcc -xc++ -E -v -
```

è¾“å‡ºä¸­ç±»ä¼¼ï¼š

```
#include <...> search starts here:
 /usr/include/c++/12
 /usr/include/x86_64-linux-gnu/c++/12
 /usr/include
...
End of search list.
```

---

### âš ï¸ **ä½•æ—¶éœ€è¦æ·»åŠ  `target_include_directories()`ï¼Ÿ**

- å¦‚æœä½ å¼•ç”¨çš„æ˜¯ **éç³»ç»Ÿé»˜è®¤è·¯å¾„**ï¼ˆå¦‚ `/opt/mylib/include`ã€`./external/abc/include`ï¼‰ï¼›
    
- æˆ–è€…ä½ å¸Œæœ›é€šè¿‡ CMake çš„ `target` æ¥å°è£…å¤´æ–‡ä»¶è·¯å¾„ï¼›
    
- æˆ–è€…å¸Œæœ›ä½¿ç”¨ `INTERFACE` / `PUBLIC` / `PRIVATE` çš„ä½œç”¨åŸŸæœºåˆ¶æ¥æ˜ç¡®ä¾èµ–ã€‚
    

ä¾‹å¦‚ï¼š

```cmake
target_include_directories(my_target PRIVATE ${CMAKE_SOURCE_DIR}/mylib/include)
```

---

### âœ… **æ€»ç»“**

| ç›®å½•è·¯å¾„                 | æ˜¯å¦éœ€æ˜¾å¼æ·»åŠ  | åŸå› è¯´æ˜            |
| -------------------- | ------- | --------------- |
| `/usr/include`       | âŒ å¦     | è¢«ç¼–è¯‘å™¨é»˜è®¤æœç´¢ï¼Œæ— éœ€æ·»åŠ    |
| `/usr/local/include` | âŒ å¦     | é€šå¸¸ä¹Ÿæ˜¯é»˜è®¤è·¯å¾„        |
| å…¶å®ƒè‡ªå®šä¹‰è·¯å¾„              | âœ… æ˜¯     | ä¸åœ¨é»˜è®¤æœç´¢åˆ—è¡¨ä¸­ï¼Œéœ€æ˜¾å¼æ·»åŠ  |

å¦‚ä½ æœ‰å¤šä¸ªç¬¬ä¸‰æ–¹åº“éœ€è¦ includeï¼Œæˆ‘å¯ä»¥å¸®ä½ è§„èŒƒæ•´ç† CMake çš„å†™æ³•ã€‚
```
è¿™æ®µä»£ç æ˜¯æˆ‘åœ¨linuxä¸Šæ‰§è¡Œä¸Šè¿°å‘½ä»¤åå¾—åˆ°çš„includeæœç´¢è·¯å¾„ï¼Œå¯è§chatgptè¯´çš„æ˜¯æ­£ç¡®çš„
#include "..." search starts here:
#include <...> search starts here:
 /usr/include/c++/14
 /usr/include/x86_64-linux-gnu/c++/14
 /usr/include/c++/14/backward
 /usr/lib/gcc/x86_64-linux-gnu/14/include
 /usr/local/include
 /usr/include/x86_64-linux-gnu
 /usr/include
End of search list.

```
## target_link_libraries(libB PUBLIC libA) target_link_libraries(MyApp PRIVATE libB) è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€MyAppå®é™…ä¸Šå¯ä»¥ç›´æ¥ä½¿ç”¨libAä¸­æä¾›çš„å‡½æ•°ï¼Œè€Œä¸ç”¨å†é“¾æ¥å®ƒ 
æ˜¯çš„ï¼Œä½ ç†è§£å¾—éå¸¸å‡†ç¡®ï¼š

```cmake
target_link_libraries(libB PUBLIC libA)
target_link_libraries(MyApp PRIVATE libB)
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š

âœ… **`MyApp` å¯ä»¥ç›´æ¥ä½¿ç”¨ `libA` ä¸­æä¾›çš„å‡½æ•°ã€ç±»ç­‰å†…å®¹ï¼Œè€Œä¸éœ€è¦è‡ªå·±å†æ˜¾å¼ `target_link_libraries(MyApp libA)`ã€‚**

---

### ğŸ” åŸå› è§£é‡Šï¼š

- `libB` **ä»¥ `PUBLIC` æ–¹å¼ä¾èµ–** `libA`ï¼Œè¿™è¡¨ç¤ºï¼š
    
    - **è‡ªå·±ä½¿ç”¨** `libA`ï¼›
        
    - **ä»»ä½•é“¾æ¥ `libB` çš„ç›®æ ‡ä¹Ÿä¼šè‡ªåŠ¨â€œç»§æ‰¿â€`libA` çš„ä¾èµ–å…³ç³»**ã€‚
        
- æ‰€ä»¥ `MyApp` é“¾æ¥äº† `libB`ï¼Œå°±é—´æ¥ä¹Ÿé“¾æ¥äº† `libA`ï¼Œ**ç¼–è¯‘å™¨ä¼šå¸®ä½ å¤„ç†è¿™äº›ä¼ é€’æ€§ä¾èµ–**ã€‚
    

---

### ğŸ§ª ä¸¾ä¸ªå®Œæ•´ä¾‹å­ï¼š

#### `libA.h`

```cpp
#pragma once
void say_hello();
```

#### `libA.cpp`

```cpp
#include <iostream>
void say_hello() {
    std::cout << "Hello from libA!" << std::endl;
}
```

#### `libB.cpp`

```cpp
#include "libA.h"
void callA() {
    say_hello();  // ä½¿ç”¨ libA çš„å‡½æ•°
}
```

#### `main.cpp`

```cpp
#include "libA.h"  // ç›´æ¥ä½¿ç”¨ libA çš„å¤´
int main() {
    say_hello();   // ä¸ç”¨æ˜¾å¼é“¾æ¥ libA
}
```

---

### âœ… æ€»ç»“ï¼š

- `target_link_libraries(libB PUBLIC libA)` æ„å‘³ç€ï¼š**ä½¿ç”¨ libB çš„ target ä¹Ÿä¼šè‡ªåŠ¨é“¾æ¥ libA**ï¼›
    
- æ‰€ä»¥ `MyApp` å¯ä»¥æ¯«æ— é—®é¢˜åœ°ä½¿ç”¨ `libA` æä¾›çš„å‡½æ•°ï¼Œæ— éœ€å•ç‹¬é“¾æ¥ï¼›
    
- è¿™æ­£æ˜¯ CMake çš„ **ç›®æ ‡ä¾èµ–ä¼ é€’æœºåˆ¶** çš„å¼ºå¤§ä¹‹å¤„ã€‚
    

å¦‚ä½ æœ‰å¤šä¸ªå­æ¨¡å—ã€å­åº“ï¼Œåˆç†è®¾ç½® `PUBLIC` / `PRIVATE` ä¾èµ–å…³ç³»ï¼Œå¯ä»¥æå¤§å‡å°‘é‡å¤å’Œé”™è¯¯ä¾èµ–ã€‚éœ€è¦æˆ‘å¸®ä½ æ¢³ç†ç»“æ„å¯ä»¥ç»§ç»­å‘æˆ‘ç»“æ„å›¾æˆ–å±‚çº§ã€‚

## muduo åº“çš„clientç«¯ä¸å¯ä»¥è®¾ç½®çº¿ç¨‹æ•°é‡å—
Muduo ç½‘ç»œåº“ä¸­çš„ **`TcpClient` å®¢æˆ·ç«¯** æ˜¯ **å•è¿æ¥ã€è½»é‡è®¾è®¡**ï¼Œ**ä¸æ”¯æŒè®¾ç½®çº¿ç¨‹æ± æ•°é‡**ï¼Œä¹Ÿ**æ²¡æœ‰ `setThreadNum()` æ¥å£**ã€‚

---

## ğŸ” ä¸ºä»€ä¹ˆ `TcpClient` æ²¡æœ‰çº¿ç¨‹æ± ï¼Ÿ

å› ä¸ºï¼š

- `TcpClient` çš„è®¾è®¡ç›®æ ‡æ˜¯å»ºç«‹ä¸€ä¸ª**å•ä¸€è¿æ¥**åˆ°æœåŠ¡å™¨ï¼ˆé€‚åˆ RPCã€æ•°æ®åº“è¿æ¥ã€P2P ç­‰å®¢æˆ·ç«¯åœºæ™¯ï¼‰ï¼›
    
- å®ƒä¾èµ–ä½ æ‰‹åŠ¨ä¼ å…¥çš„ä¸€ä¸ª `EventLoop` æ¥é©±åŠ¨æ•´ä¸ªå®¢æˆ·ç«¯ç”Ÿå‘½å‘¨æœŸï¼›
    
- ä¸åƒ `TcpServer` éœ€è¦åº”å¯¹æˆåƒä¸Šä¸‡ä¸ªè¿æ¥ï¼Œå› æ­¤ä¸éœ€è¦çº¿ç¨‹æ± ï¼›
    

æ‰€ä»¥çº¿ç¨‹æ§åˆ¶æƒæ˜¯åœ¨ä½ æ‰‹ä¸Šçš„ â€”â€” ä½ å¯ä»¥è‡ªå·±åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­è·‘ä¸€ä¸ª `EventLoop`ï¼Œæ¯ä¸ª loop å»ºä¸€ä¸ª `TcpClient`ã€‚

---

## âœ… å¤šçº¿ç¨‹åˆ›å»ºå¤šä¸ªå®¢æˆ·ç«¯çš„æ–¹å¼

å¦‚æœä½ æƒ³æ¨¡æ‹Ÿå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œå¹¶å®ç°å¹¶å‘é€šä¿¡ï¼Œå¯ä»¥è¿™æ ·åšï¼š

```cpp
#include <muduo/net/EventLoopThread.h>
#include <muduo/net/TcpClient.h>
#include <memory>

void createClient(const std::string& host, uint16_t port) {
    muduo::net::EventLoopThread thread;
    muduo::net::EventLoop* loop = thread.startLoop();

    muduo::net::InetAddress serverAddr(host, port);
    std::shared_ptr<muduo::net::TcpClient> client =
        std::make_shared<muduo::net::TcpClient>(loop, serverAddr, "TestClient");

    client->connect();

    // å…¶ä»–å›è°ƒè®¾ç½®ç•¥
}
```

ä½ å¯ä»¥ç”¨ä¸€ä¸ª for å¾ªç¯åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹é‡Œè·‘ä¸€ä¸ª `TcpClient`ï¼Œä»è€Œè¾¾åˆ°**å¤šçº¿ç¨‹å®¢æˆ·ç«¯**çš„æ•ˆæœã€‚

---

## ğŸ§© æ€»ç»“

|å¯¹è±¡|æ˜¯å¦æ”¯æŒçº¿ç¨‹æ± |æ¥å£æ–¹æ³•|é€‚ç”¨åœºæ™¯|
|---|---|---|---|
|`TcpServer`|âœ…|`setThreadNum()`|é«˜å¹¶å‘æœåŠ¡å™¨|
|`TcpClient`|âŒ|æ— |å•è¿æ¥å®¢æˆ·ç«¯ï¼Œçº¿ç¨‹ç”±ç”¨æˆ·æ§åˆ¶|

---

å¦‚ä½ æƒ³åšå‹åŠ›æµ‹è¯•æˆ–å®ç°æˆç™¾ä¸Šåƒçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `EventLoopThreadPool` è‡ªå·±å°è£…ä¸€ä¸ªçº¿ç¨‹æ± å®¢æˆ·ç«¯ç³»ç»Ÿï¼Œæˆ‘å¯ä»¥å¸®ä½ è®¾è®¡ã€‚éœ€è¦çš„è¯å¯ä»¥ç»§ç»­é—®æˆ‘ã€‚

## `std::shared_ptr<Student> ptr`å¯ä»¥ä¸ºç©ºå—
æ˜¯çš„ï¼Œ`std::shared_ptr<Student> ptr` **å¯ä»¥ä¸ºç©º**ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·å°†å®ƒè®¾ä¸º `nullptr`ï¼š

```cpp
std::shared_ptr<Student> ptr = nullptr;
```

æˆ–è€…æ›´ç®€æ´ï¼š

```cpp
std::shared_ptr<Student> ptr;  // é»˜è®¤å°±æ˜¯ç©ºçš„
```

---

### âœ… ç©º `shared_ptr` æ˜¯åˆæ³•çš„çŠ¶æ€

ç©ºçš„ `shared_ptr` è¡¨ç¤ºå®ƒ**æ²¡æœ‰æŒ‡å‘ä»»ä½•å¯¹è±¡**ï¼Œæ­¤æ—¶ï¼š

- `ptr.get() == nullptr`
    
- `ptr.use_count() == 0`
    
- `ptr` åœ¨å¸ƒå°”åˆ¤æ–­ä¸­ä¸º `false`
    

ä¾‹å¦‚ï¼š

```cpp
if (!ptr) {
    std::cout << "ptr is empty" << std::endl;
}
```

---

### ğŸ” å¯éšæ—¶èµ‹å€¼

ä½ å¯ä»¥åœ¨ä¹‹åèµ‹å€¼ï¼š

```cpp
ptr = std::make_shared<Student>();
```

æ­¤æ—¶å®ƒå°±æ‹¥æœ‰äº†å®é™…å¯¹è±¡ï¼Œ`use_count()` ä¼šå˜ä¸º 1ã€‚

---

### âŒ ä¸å»ºè®®åšçš„äº‹

ä¸è¦æ‰‹åŠ¨ `delete` ç©ºæˆ–éç©ºçš„ shared_ptr æŒ‡å‘çš„å¯¹è±¡ï¼ˆå³ä¸è¦è¿™æ ·ï¼‰ï¼š

```cpp
delete ptr.get();  // âŒ é”™è¯¯ï¼Œä¼šå¯¼è‡´åŒé‡é‡Šæ”¾
```

---

### âœ… æ€»ç»“

|æ“ä½œ|åˆæ³•|è¯´æ˜|
|---|---|---|
|`std::shared_ptr<T> p;`|âœ…|é»˜è®¤æ„é€ ï¼Œç©ºæŒ‡é’ˆ|
|`p = nullptr;`|âœ…|ç½®ç©º|
|`if (p)`|âœ…|æ£€æŸ¥æ˜¯å¦ä¸ºç©º|
|`p.get() == nullptr`|âœ…|æ£€æŸ¥åº•å±‚è£¸æŒ‡é’ˆ|

å¦‚æœä½ è¦ç”¨ `shared_ptr` ç®¡ç†èµ„æºï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨è¿™äº›è¯­æ³•ã€‚éœ€è¦æ›´æ·±å…¥çš„æ™ºèƒ½æŒ‡é’ˆç”¨æ³•ï¼ˆæ¯”å¦‚ weak_ptrã€å¾ªç¯å¼•ç”¨ï¼‰ä¹Ÿå¯ä»¥ç»§ç»­é—®æˆ‘ã€‚

## è¿™æ®µä¸»è¦çš„å®¢æˆ·ç«¯ä»£ç ï¼Œæœ‰å‡ ä¸ªçº¿ç¨‹åœ¨è¿è¡Œå‘¢
```cpp
int main(int argc, char* argv[]) 
{ 
	if (argc < 2) 
	{ 
		LOG_ERROR << "Usage: " << argv[0] << " <port>"; return 1; 
	} 
	int port = std::atoi(argv[1]);
	MuduoEventLoop loop; 
	MuduoInetAddress serverAddr("127.0.0.1", port); 
	Client client(&loop, serverAddr); 
	client.m_connect(); 
	loop.loop(); 
	return 0; 
}
```

è¿™æ®µä»£ç é»˜è®¤æƒ…å†µä¸‹åªæœ‰**ä¸€ä¸ªçº¿ç¨‹**ï¼Œå³**ä¸»çº¿ç¨‹**ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š

---

### ğŸŒ± ä»£ç ä¸­çš„çº¿ç¨‹æ¥æºåˆ†æï¼š

```cpp
int main(int argc, char* argv[]) {
    ...
    MuduoEventLoop loop;                      // äº‹ä»¶å¾ªç¯ï¼Œç»‘å®šåœ¨ä¸»çº¿ç¨‹
    MuduoInetAddress serverAddr(...);
    Client client(&loop, serverAddr);         // å®¢æˆ·ç«¯ç»‘å®šä¸»çº¿ç¨‹çš„ loop
    client.m_connect();                       // å‘èµ·è¿æ¥ï¼ˆéé˜»å¡ï¼‰
    loop.loop();                              // å¯åŠ¨äº‹ä»¶å¾ªç¯ï¼ˆä¸»çº¿ç¨‹åœ¨æ­¤é˜»å¡ï¼‰
}
```

#### âœ… ç»“è®ºï¼š

- `MuduoEventLoop` é»˜è®¤åœ¨**å½“å‰çº¿ç¨‹**ä¸­è¿è¡Œï¼Œå®ƒæ˜¯**å•çº¿ç¨‹**æ¨¡å‹ã€‚
    
- ä½ æ²¡æœ‰åˆ›å»ºä»»ä½•é¢å¤–çš„çº¿ç¨‹ï¼ˆå¦‚ `std::thread`ã€`muduo::ThreadPool`ã€`muduo::EventLoopThreadPool`ï¼‰ã€‚
    
- æ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸»çº¿ç¨‹ä¸­å®Œæˆã€‚
    

---

### ğŸš€ å¦‚æœæƒ³å¢åŠ çº¿ç¨‹æ€ä¹ˆåŠï¼Ÿ

Muduo æä¾› `EventLoopThreadPool` ç»™ä½ åˆ›å»ºå¤šä¸ª `IO çº¿ç¨‹`ï¼Œæ¯”å¦‚æœåŠ¡ç«¯ä¸­å¯ä»¥è¿™æ ·è®¾ç½®ï¼š

```cpp
server.setThreadNum(4);  // åŒ…æ‹¬ä¸»çº¿ç¨‹ + 3 ä¸ª IO çº¿ç¨‹
```

ä½†ä½ ç°åœ¨æ˜¯å®¢æˆ·ç«¯ä»£ç ï¼Œæ²¡æœ‰åšè¿™æ ·çš„è®¾ç½®ï¼Œæ‰€ä»¥ä»æ˜¯**å•çº¿ç¨‹**ã€‚

---

### ğŸ§  æ€»ç»“

|åç§°|çº¿ç¨‹æ•°é‡|è¯´æ˜|
|---|---|---|
|ä¸»çº¿ç¨‹|1|ç¨‹åºå…¥å£ï¼Œè¿è¡Œ `main()` å’Œ `loop.loop()`|
|é¢å¤–çº¿ç¨‹|0|æ²¡æœ‰åˆ›å»ºé¢å¤–çº¿ç¨‹|
|æ€»çº¿ç¨‹æ•°|1|å•çº¿ç¨‹æ¨¡å‹|

å¦‚æœä½ æƒ³ç”¨å¤šçº¿ç¨‹å®¢æˆ·ç«¯æ¨¡å‹ï¼Œæ¯”å¦‚å¤„ç†å¤§é‡è¿æ¥æˆ–è®¡ç®—ä»»åŠ¡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ `EventLoopThread` æˆ– `EventLoopThreadPool`ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ å†™ä¸ªä¾‹å­ã€‚

## VS Codeä¸­Ctrl+F2å¯ä»¥åŒæ—¶é€‰ä¸­ä¸æ‰€æœ‰å½“å‰æ‰€é€‰ç›¸åŒçš„ç¬¦å·ï¼Œctrl+->å¯ä»¥è¾¾åˆ°æœ¬å•è¯çš„æœ«å°¾

## ä¸€ä¸ªçº¿ç¨‹ä¸€æ—¦detachäº†ï¼Œå°±ä¼šè„±ç¦»æ§åˆ¶ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šæ¶‰åŠåˆ°å…¶è®¿é—®çš„å¯¹è±¡ä¼šææ„çš„é—®é¢˜ï¼Œæ‰€ä»¥detachçš„çº¿ç¨‹å¿…ç„¶ä¼šå‡ºé—®é¢˜
ä½ æå‡ºçš„è¿™ä¸ªè§‚ç‚¹éå¸¸æœ‰ä»·å€¼ï¼Œå¹¶ä¸”åœ¨ç»å¤§å¤šæ•°å®é™…å¼€å‘ä¸­æ˜¯**å¯¹çš„**ï¼š

> âœ… **ä¸€æ—¦çº¿ç¨‹ `detach()` äº†ï¼Œå®ƒå°±è„±ç¦»äº†ä¸»æ§æµç¨‹ï¼Œå¯¹å…¶ç”Ÿå‘½å‘¨æœŸå®Œå…¨å¤±æ§ï¼Œå¦‚æœå®ƒç»§ç»­è®¿é—®å·²ç»ææ„çš„å¯¹è±¡ï¼Œ**é‚£å°±**æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼ˆUBï¼‰**ï¼Œææ˜“å¯¼è‡´å´©æºƒæˆ–æ•°æ®é”™è¯¯ã€‚**

---

## ğŸ”¥ è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä½ è¯´çš„æƒ…å†µï¼š

### æƒ…å†µï¼š

```cpp
class A {
public:
    A() {
        // å¯åŠ¨çº¿ç¨‹
        m_thread = std::make_unique<std::thread>([this] { doWork(); });
        m_thread->detach();  // è„±ç¦»æ§åˆ¶
    }

    ~A() {
        std::cout << "A destroyed\n";
    }

private:
    void doWork() {
        // æ¨¡æ‹Ÿå»¶è¿Ÿ
        std::this_thread::sleep_for(std::chrono::seconds(1));
        std::cout << "Thread work: " << some_data << std::endl;  // å¦‚æœ A è¢«é”€æ¯ï¼Œè¿™é‡Œ UB
    }

    std::unique_ptr<std::thread> m_thread;
    int some_data = 42;
};
```

### âš ï¸ é—®é¢˜ï¼š

- å¦‚æœ `A` å¯¹è±¡åœ¨ `1s` å†…å°±è¢«ææ„äº†ï¼ˆå³çº¿ç¨‹è¿˜æ²¡è·‘åˆ°é‚£ä¸€æ­¥ï¼‰ï¼Œ
    
- é‚£ä¹ˆ `doWork()` ä¸­è®¿é—® `this->some_data` å°±æ˜¯è®¿é—®**å·²è¢«é‡Šæ”¾çš„å†…å­˜**ï¼šğŸ’¥ **æœªå®šä¹‰è¡Œä¸ºï¼**
    

---

## âœ… æ‰€ä»¥ä½ è¯´çš„éå¸¸æ­£ç¡®ï¼š

> ### **detach çš„çº¿ç¨‹å¦‚æœè®¿é—®æˆå‘˜å˜é‡æˆ– this æŒ‡é’ˆï¼Œé‚£ä¹ˆç”Ÿå‘½å‘¨æœŸä¸èƒ½å¾—åˆ°ä¿è¯ â€”â€” æ˜¯å±é™©çš„ï¼**

---

## âœ… è§£å†³æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ `join()` æ¥ç¡®ä¿çº¿ç¨‹é€€å‡º

åœ¨ææ„æ—¶ç­‰å¾…çº¿ç¨‹é€€å‡ºï¼Œæœ€å®‰å…¨ï¼š

```cpp
~A() {
    if (m_thread && m_thread->joinable()) {
        m_thread->join();  // é˜»å¡ç­‰å¾…çº¿ç¨‹ç»“æŸ
    }
}
```

---

## âœ… è§£å†³æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ `std::shared_ptr` ç®¡ç†å…±äº«æ•°æ®

å¦‚æœçº¿ç¨‹ç¡®å®éœ€è¦ç‹¬ç«‹è¿è¡Œï¼Œä½†åˆéœ€è¦è®¿é—®æ•°æ®ï¼Œå°±è¦ç¡®ä¿æ•°æ®**å»¶è¿Ÿææ„**ï¼Œå¯ç”¨ `shared_ptr` ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼š

```cpp
class A : public std::enable_shared_from_this<A> {
public:
    A() {
        auto self = shared_from_this();  // å»¶é•¿ç”Ÿå‘½å‘¨æœŸ
        m_thread = std::make_unique<std::thread>([self] {
            std::this_thread::sleep_for(std::chrono::seconds(1));
            std::cout << "Thread work: " << self->some_data << std::endl;
        });
        m_thread->detach();
    }

private:
    std::unique_ptr<std::thread> m_thread;
    int some_data = 42;
};
```

âš ï¸ æ³¨æ„è¿™é‡Œ `shared_from_this()` å¿…é¡»åœ¨é€šè¿‡ `std::shared_ptr<A>` åˆ›å»ºå¯¹è±¡ä¹‹åæ‰å¯ç”¨ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ `std::jthread`ï¼ˆC++20ï¼‰

```cpp
#include <thread>

class A {
public:
    A() {
        m_thread = std::jthread([this](std::stop_token st) {
            while (!st.stop_requested()) {
                // do work
            }
        });
    }
    // ä¸éœ€è¦æ‰‹åŠ¨ joinï¼Œè‡ªåŠ¨ç­‰å¾…
private:
    std::jthread m_thread;
};
```

C++20 çš„ `std::jthread` è‡ªåŠ¨åœ¨ææ„æ—¶ joinï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ï¼Œè€Œä¸”è¿˜æ”¯æŒåä½œå¼å–æ¶ˆã€‚

---

## âœ… æ€»ç»“ï¼š

|æ–¹æ³•|å®‰å…¨æ€§|æ§åˆ¶æ€§|æ¨èä½¿ç”¨åœºæ™¯|
|---|---|---|---|
|`detach()`|âŒä½|âŒå·®|æå°‘æ•°ç‰¹å®šç”¨é€”ï¼ˆå¦‚å®ˆæŠ¤çº¿ç¨‹ï¼‰ï¼Œä¸è®¿é—®æˆå‘˜å˜é‡|
|`join()`|âœ…é«˜|âœ…å¼º|ä¸€èˆ¬ä¸šåŠ¡é€»è¾‘ã€å®‰å…¨é€€å‡ºæ—¶|
|`shared_ptr`|âœ…é«˜|âœ…å¯æ§|åœ¨å¤šçº¿ç¨‹å…±äº«å¯¹è±¡æ—¶é¿å…æ‚¬å‚å¼•ç”¨|
|`std::jthread`|âœ…é«˜|âœ…é«˜|**C++20é¦–é€‰**ï¼Œå®‰å…¨æ˜“ç”¨|

---

å¦‚ä½ æ‰€è¯´ï¼Œ**éšæ„ä½¿ç”¨ `detach()` æ˜¯ä¸è´Ÿè´£ä»»çš„çº¿ç¨‹ç®¡ç†æ–¹å¼**ï¼Œé™¤éç¡®ä¿çº¿ç¨‹ä¸è®¿é—®ä»»ä½•æˆå‘˜æˆ–èµ„æºï¼Œæˆ–è€…æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸé•¿äºçº¿ç¨‹ã€‚

å¦‚æœä½ æ­£åœ¨å†™å¤šçº¿ç¨‹ç±»ï¼Œæˆ‘å¯ä»¥å¸®ä½ è®¾è®¡ä¸€ä¸ªæ—¢å®‰å…¨åˆçµæ´»çš„æ¨¡æ¿ï¼Œå‘Šè¯‰æˆ‘å³å¯ã€‚

## é‚£ä»€ä¹ˆæ—¶å€™ä½¿ç”¨detachçº¿ç¨‹å‘¢
è¿™æ˜¯ä¸ªéå¸¸ä¸“ä¸šçš„é—®é¢˜ï¼ä½ ç†è§£å¾—å·²ç»å¾ˆåˆ°ä½äº†ï¼Œç¡®å® `detach()` ç”¨ä¸å¥½æå®¹æ˜“å‡ºé”™ã€‚

---

## âœ… ä»€ä¹ˆæ—¶å€™ **å¯ä»¥** ä½¿ç”¨ `std::thread::detach()`ï¼Ÿ

### ğŸ¯ **ç®€è¦ç­”æ¡ˆï¼š**

ä»…åœ¨ä½ èƒ½**100% ç¡®ä¿çº¿ç¨‹åœ¨åå°ç‹¬ç«‹è¿è¡Œï¼Œä¸éœ€è¦è®¿é—®ä»»ä½•å¯èƒ½æå‰é”€æ¯çš„èµ„æºæ—¶**ï¼Œæ‰é€‚åˆä½¿ç”¨ `detach()`ã€‚

---

## âœ… å¸¸è§ä½¿ç”¨ `detach()` çš„å®‰å…¨åœºæ™¯

### 1. **åå°å®ˆæŠ¤çº¿ç¨‹ï¼ˆFire-and-Forgetï¼‰**

é€‚åˆä¸å…³å¿ƒç»“æœã€ä¹Ÿä¸éœ€è¦ç­‰å¾…å®Œæˆçš„çº¿ç¨‹ã€‚

```cpp
void log_to_file_async(std::string msg) {
    std::thread([](std::string m) {
        std::ofstream ofs("log.txt", std::ios::app);
        ofs << m << std::endl;
    }, std::move(msg)).detach();
}
```

- âœ” ä¸ä¾èµ–å¤–éƒ¨èµ„æº
    
- âœ” çº¿ç¨‹å®Œæˆå°±å®Œæˆï¼Œä¸å½±å“ä¸»æµç¨‹
    
- â—ç¼ºç‚¹ï¼šå†™å¤±è´¥äº†æ²¡äººçŸ¥é“ï¼Œä¸å¯æ§
    

---

### 2. **çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¼‚æ­¥ä»»åŠ¡**

æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œå‘é€ç»Ÿè®¡æ—¥å¿—ï¼Œä¸éœ€è¦è¿”å›å€¼ï¼š

```cpp
std::thread([] {
    send_statistics_to_server();  // ä¸ä¸»ç¨‹åºæ— å…³
}).detach();
```

---

### 3. **ä¸»çº¿ç¨‹ç­‰å¾…ä¸åˆ°è¿™ä¸ªçº¿ç¨‹ä¹Ÿæ²¡äº‹**

æ¯”å¦‚ä½ å¯åŠ¨ä¸€ä¸ª UI æ›´æ–°çº¿ç¨‹æˆ–è€…ç›‘æ§çº¿ç¨‹ï¼Œè€Œä¸»ç¨‹åºé€€å‡ºä¸ä¼šä¾èµ–å®ƒï¼š

```cpp
void monitor_status() {
    std::thread([] {
        while (true) {
            std::this_thread::sleep_for(std::chrono::seconds(5));
            log_status();
        }
    }).detach();
}
```

ğŸ’¡ **æ³¨æ„**ï¼šè¿™ç§çº¿ç¨‹å¾€å¾€ä¸è®¿é—®å¯¹è±¡çš„æˆå‘˜ï¼ˆé¿å…æ‚¬å‚å¼•ç”¨ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨ `shared_ptr` å»¶é•¿ç”Ÿå‘½å‘¨æœŸã€‚

---

### 4. **è¿›ç¨‹å³å°†é€€å‡º**

åœ¨ç¨‹åºé€€å‡ºå‰åšä¸ªå°ä»»åŠ¡ï¼š

```cpp
void exit_cleanup() {
    std::thread([] {
        send_exit_signal();
    }).detach();  // åæ­£ç¨‹åºè¦ç»“æŸäº†ï¼Œæ²¡å¿…è¦ join
}
```

---

## âŒ ä¸åº”ä½¿ç”¨ `detach()` çš„æƒ…å†µ

|âŒ åœºæ™¯|åŸå› |
|---|---|
|éœ€è¦è·å–çº¿ç¨‹ç»“æœ|æ— æ³•é€šè¿‡ `join()` å¾—åˆ°è¿”å›å€¼æˆ–å¼‚å¸¸|
|çº¿ç¨‹è®¿é—®å±€éƒ¨å˜é‡æˆ–å¯¹è±¡æˆå‘˜|å¯¹è±¡å¯èƒ½æå‰ææ„ï¼Œå¯¼è‡´æ‚¬å‚å¼•ç”¨|
|æ§åˆ¶çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ|æ— æ³•æ§åˆ¶ï¼Œåªèƒ½ä»»å…¶â€œé‡è›®â€è¿è¡Œ|
|å¤šçº¿ç¨‹åŒæ­¥ä¾èµ–å…³ç³»å¤æ‚|å®¹æ˜“å¼•å…¥ç«æ€ã€æ­»é”æˆ–å†…å­˜é”™è¯¯|

---

## âœ… æ¨èåšæ³•

|ç›®æ ‡|æ¨èæ–¹å¼|
|---|---|
|éœ€è¦è·å–çº¿ç¨‹ç»“æœ|ç”¨ `std::thread` + `join()` æˆ– `std::future`|
|æƒ³è®©çº¿ç¨‹è‡ªåŠ¨ç»“æŸ|ç”¨ `std::jthread`ï¼ˆC++20ï¼‰|
|å¤šçº¿ç¨‹å…±äº«å¯¹è±¡|ç”¨ `std::shared_ptr`|
|æƒ³å–æ¶ˆçº¿ç¨‹|ç”¨ `std::stop_token`ï¼ˆC++20ï¼‰|

---

## ğŸ¯ æ€»ç»“

|æ˜¯å¦ä½¿ç”¨ detachï¼Ÿ|å»ºè®®|
|---|---|
|ğŸ”´ ä¸ç¡®å®šçº¿ç¨‹è®¿é—®å¯¹è±¡|**ä¸è¦ä½¿ç”¨ detach**ï¼Œç”¨ `join` æ›´å®‰å…¨|
|ğŸŸ¡ ç®€å•ç‹¬ç«‹ä»»åŠ¡|å¯ä»¥ç”¨ detachï¼ˆä½†ä»å»ºè®®ç”¨ `jthread`ï¼‰|
|ğŸŸ¢ çº¿ç¨‹éå¸¸çŸ­ä¸”æ— ä¾èµ–|å¯ç”¨ detachï¼Œä½†è¦æ¸…æ™°åœ°æ³¨æ˜ç›®çš„|

---

å¦‚æœä½ å‘Šè¯‰æˆ‘å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ¤æ–­é€‚ä¸é€‚åˆä½¿ç”¨ `detach()`ï¼Œæˆ–è€…æä¾›æ›¿ä»£æ–¹æ¡ˆã€‚æ˜¯å¦è¦æˆ‘å¸®ä½ çœ‹ä¸€ä¸ªå®é™…ç”¨ä¾‹ï¼Ÿ

## å‡å¦‚å¯¹è±¡Aææ„å‘ç”Ÿåœ¨main()å‡½æ•°ç»“æŸï¼Œå³ç¨‹åºè¿è¡Œå®Œæ¯•ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå†…éƒ¨çš„çº¿ç¨‹æ˜¯å¦å¯ä»¥å†™æˆdetachçš„
è¿™æ˜¯ä¸€ä¸ªéå¸¸å…³é”®ä¸”å¸¸è§çš„è®¾è®¡é—®é¢˜ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸ç¨‹åºé€€å‡ºæ—¶èµ„æºç®¡ç†çš„é—®é¢˜ã€‚æˆ‘ä»¬æ¥å…·ä½“åˆ†æï¼š

---

## âœ… ä½ è¯´çš„æƒ…å†µï¼š

> â€œå‡å¦‚å¯¹è±¡ A çš„ææ„å‘ç”Ÿåœ¨ `main()` å‡½æ•°ç»“æŸï¼Œå³ç¨‹åºè¿è¡Œå®Œæ¯•ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå†…éƒ¨çš„çº¿ç¨‹æ˜¯å¦å¯ä»¥å†™æˆ `detach` çš„ï¼Ÿâ€

---

### ğŸ§  ç®€å•å›ç­”ï¼š

### âœ… **å¯ä»¥**ï¼Œä½†è¦éå¸¸å°å¿ƒâ€”â€”**å‰ææ˜¯çº¿ç¨‹çš„è¿è¡Œä¸ä¼šä¾èµ–ä»»ä½•å³å°†é”€æ¯çš„èµ„æºï¼ˆæ¯”å¦‚å¯¹è±¡æˆå‘˜ï¼‰**ã€‚

---

## âœ… ä¸¾ä¾‹è¯´æ˜

### âœ… å®‰å…¨çš„æƒ…å†µï¼š

```cpp
class A {
public:
    A() {
        std::thread([] {
            std::this_thread::sleep_for(std::chrono::seconds(2));
            std::cout << "Detached thread finished work\n";
        }).detach();  // âœ… OKï¼šçº¿ç¨‹ä¸è®¿é—® A çš„æˆå‘˜
    }
};

int main() {
    A a;
    std::cout << "Main ends soon\n";
    std::this_thread::sleep_for(std::chrono::seconds(3));  // ä¿è¯çº¿ç¨‹è·‘å®Œ
    return 0;
}
```

- ğŸ”’ çº¿ç¨‹ä¸è®¿é—® `A` çš„ä»»ä½•æˆå‘˜
    
- âœ… å³ä½¿ A ææ„äº†ï¼Œçº¿ç¨‹é€»è¾‘ä¹Ÿæ²¡é—®é¢˜
    
- âš ï¸ æ³¨æ„ï¼šä¸»çº¿ç¨‹å¦‚æœé€€å‡ºå¤ªå¿«ï¼Œåå°çº¿ç¨‹å¯èƒ½è¢«æ“ä½œç³»ç»Ÿå¼ºåˆ¶ä¸­æ­¢ï¼ˆè¿›ç¨‹ç»ˆæ­¢ï¼Œçº¿ç¨‹ä¹Ÿæ­»ï¼‰
    

---

### âŒ ä¸å®‰å…¨çš„æƒ…å†µï¼š

```cpp
class A {
public:
    A() {
        std::thread([this] {
            std::this_thread::sleep_for(std::chrono::seconds(2));
            std::cout << "a = " << a << std::endl;  // âŒ è®¿é—®æˆå‘˜å˜é‡
        }).detach();  // âŒ BAD
    }

private:
    int a = 42;
};

int main() {
    A a;
    // ç¨‹åºæ‰§è¡Œå®Œï¼ŒA å¯¹è±¡ææ„ï¼Œçº¿ç¨‹ä¸­å¼•ç”¨ this -> æœªå®šä¹‰è¡Œä¸º
    return 0;
}
```

- âŒ `detach()` çš„çº¿ç¨‹è®¿é—®äº† `A` çš„æˆå‘˜
    
- âŒ A ææ„åï¼Œçº¿ç¨‹ä»è®¿é—®å®ƒ â†’ **æ‚¬å‚å¼•ç”¨** â†’ **UBï¼ˆæœªå®šä¹‰è¡Œä¸ºï¼‰**
    

---

## ğŸ§© ç¨‹åºç»“æŸæ—¶çº¿ç¨‹æ˜¯å¦ä¸€å®šèƒ½è·‘å®Œï¼Ÿ

- âŒ **ä¸ä¸€å®š**ã€‚è¿›ç¨‹ç»“æŸä¼šç»ˆæ­¢æ‰€æœ‰çº¿ç¨‹ï¼Œå³ä½¿æ˜¯æ­£åœ¨è¿è¡Œä¸­çš„çº¿ç¨‹ä¹Ÿä¼šå¼ºåˆ¶æ€æ­»ã€‚
    
- âœ… å¦‚æœä½ æƒ³**ç¡®ä¿çº¿ç¨‹è·‘å®Œ**ï¼Œåº”è¯¥ï¼š
    
    - ç”¨ `join()` ç­‰å®ƒå®Œæˆ
        
    - æˆ–è®©ä¸»çº¿ç¨‹ `sleep` ä¸€æ®µæ—¶é—´ï¼ˆä¸´æ—¶æ–¹å¼ï¼‰
        
    - æˆ–ä½¿ç”¨ `std::promise/std::future` ç­‰åŒæ­¥æœºåˆ¶
        

---

## âœ… æ¨èè®¾è®¡æ–¹å¼ï¼ˆå®‰å…¨ä¸”å¯æ§ï¼‰

```cpp
class A {
public:
    A() {
        m_thread = std::thread([this] {
            doWork();
        });
    }

    ~A() {
        if (m_thread.joinable()) {
            m_thread.join();  // ç­‰å¾…çº¿ç¨‹å®Œæˆ
        }
    }

private:
    void doWork() {
        std::this_thread::sleep_for(std::chrono::seconds(1));
        std::cout << "Thread done\n";
    }

    std::thread m_thread;
};
```

---

## ğŸ”š æ€»ç»“ï¼š

|é—®é¢˜|detach å¯è¡Œå—ï¼Ÿ|è¯´æ˜|
|---|---|---|
|çº¿ç¨‹ä¸è®¿é—®å¯¹è±¡|âœ… å¯ä»¥ä½¿ç”¨ detach|å®Œå…¨ç‹¬ç«‹çš„çº¿ç¨‹é€»è¾‘|
|çº¿ç¨‹è®¿é—®å¯¹è±¡æˆå‘˜|âŒ ä¸å¯ä½¿ç”¨ detach|å¯¹è±¡ææ„åä¼šé€ æˆæ‚¬å‚å¼•ç”¨|
|ç¨‹åºé©¬ä¸Šç»“æŸ|âš ï¸ ä¸æ¨è|çº¿ç¨‹å¯èƒ½æ¥ä¸åŠæ‰§è¡Œå°±è¢«ç»ˆæ­¢|
|æƒ³ç¡®ä¿çº¿ç¨‹å®Œæˆ|âœ… ç”¨ join / promise|æ›´å®‰å…¨å¯æ§|

---

å¦‚æœä½ å¸Œæœ›çº¿ç¨‹åœ¨ `main()` é€€å‡ºå‰ä¸€å®šèƒ½è·‘å®Œï¼Œè€Œåˆä¸å¸Œæœ›é˜»å¡ï¼Œå¯ä»¥è€ƒè™‘ `std::jthread`ï¼ˆC++20ï¼‰æˆ–è€…åœ¨ææ„é‡ŒåŠ è¶…æ—¶åˆ¤æ–­ã€å¼‚æ­¥ä¿¡å·ç­‰æ›´ä¼˜é›…çš„æœºåˆ¶ã€‚å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»™ä½ ä¸€ä¸ªæ›´å®Œæ•´çš„ç¤ºä¾‹ã€‚
## Aç±»ä¸­å®šä¹‰äº†æˆå‘˜å˜é‡ä¸ºstd::function<void(int,int)>a; å‡½æ•°å¯¹è±¡ï¼Œç„¶ååœ¨ç±»Aåˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°†Bç±»ä¸­çš„æŸä¸ªå‡½æ•°ä»¥std::bind(B::bfunc,&B,_1,_2)çš„å½¢å¼åˆå§‹åŒ–ç»™aï¼Œç°åœ¨æƒ³é—®ä¸€ä¸‹å‡½æ•°å¯¹è±¡æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯æ™®é€šçš„å¯¹è±¡ï¼Œæ˜¯å¦æ¶‰åŠåˆ°æ‹·è´æ„é€ ã€ç§»åŠ¨æ„é€ é—®é¢˜ï¼Œå¦‚æœBç±»ææ„äº†ï¼Œaå‡½æ•°è¿˜å¯ä»¥ç»§ç»­è°ƒç”¨å—ï¼Ÿ
ä½ çš„é—®é¢˜éå¸¸æœ‰ä»£è¡¨æ€§ï¼Œæ¶µç›–äº† `std::function`ã€`std::bind`ã€å¯¹è±¡ç”Ÿå‘½å‘¨æœŸã€ä»¥åŠæ‹·è´/ç§»åŠ¨è¯­ä¹‰ã€‚ä¸‹é¢æˆ‘é€ä¸€æ‹†è§£ä½ çš„é—®é¢˜å¹¶è§£é‡Šæ¸…æ¥šï¼š

---

### ğŸŒŸ åœºæ™¯ç®€åŒ–

```cpp
class B {
public:
    void bfunc(int x, int y) {
        std::cout << "B::bfunc " << x << " " << y << std::endl;
    }
};

class A {
public:
    std::function<void(int, int)> a;

    A(B* b) {
        a = std::bind(&B::bfunc, b, std::placeholders::_1, std::placeholders::_2);
    }
};
```

---

## â“ 1. `std::function` æ˜¯æ™®é€šå¯¹è±¡å—ï¼Ÿæ˜¯å¦æ¶‰åŠæ‹·è´æ„é€ ã€ç§»åŠ¨æ„é€ ï¼Ÿ

æ˜¯çš„ï¼Œ`std::function` æ˜¯ä¸€ä¸ªæ™®é€šçš„ **å€¼ç±»å‹å¯¹è±¡**ï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªç±»å‹æ“¦é™¤çš„å‡½æ•°åŒ…è£…å™¨ã€‚

- å½“ä½ èµ‹å€¼ä¸€ä¸ª `std::bind(...)` åˆ° `std::function` ä¸­ï¼Œä¼šè§¦å‘ï¼š
    
    - `std::bind` è¿”å›çš„æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆç±»å‹é€šå¸¸æ˜¯é—­åŒ…ç±»ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šæ•è·æŒ‡é’ˆæˆ–å…¶ä»–å˜é‡ã€‚
        
    - è¿™ä¸ªå¯¹è±¡è¢«æ‹·è´ï¼ˆæˆ–ç§»åŠ¨ï¼‰åˆ° `std::function` å†…éƒ¨ã€‚
        

### âœ… æ‰€ä»¥ï¼š**æœ‰æ‹·è´/ç§»åŠ¨æ„é€ æ“ä½œ**ï¼Œå’Œå…¶å®ƒ C++ æ™®é€šå¯¹è±¡ä¸€æ ·ã€‚

---

## â“ 2. å¦‚æœ `B` ç±»å·²ç»ææ„äº†ï¼Œ`a` è¿˜èƒ½è°ƒç”¨å—ï¼Ÿ

âš ï¸ **ä¸èƒ½ï¼ä¼šäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºï¼ˆUBï¼‰ï¼**

å› ä¸º `std::bind(&B::bfunc, b, ...)` å®é™…ä¸Šæ•è·çš„æ˜¯ `b` æŒ‡é’ˆï¼Œè°ƒç”¨æ—¶ä¼šè§£å¼•ç”¨å®ƒã€‚

### ä¸¾ä¸ªä¾‹å­ï¼š

```cpp
A* a;
{
    B b;
    a = new A(&b);  // æ•è·äº† &b
    // b è¢«ææ„
}
a->a(1, 2);  // â›” æœªå®šä¹‰è¡Œä¸ºï¼è®¿é—®äº†è¢«é”€æ¯çš„å¯¹è±¡
```

---

## âœ… æ­£ç¡®çš„åšæ³•

ä½ éœ€è¦ä¿è¯ `B` å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé•¿äº `std::function` çš„ä½¿ç”¨æ—¶é—´ã€‚å‡ ç§æ–¹æ³•ï¼š

### æ–¹æ³• 1ï¼šä½¿ç”¨ `shared_ptr`

```cpp
class A {
public:
    std::function<void(int, int)> a;

    A(std::shared_ptr<B> bptr) {
        a = [bptr](int x, int y) {
            bptr->bfunc(x, y);
        };
    }
};
```

âœ… å¥½å¤„æ˜¯ï¼š`std::function` æŒæœ‰ `shared_ptr`ï¼Œå³ä½¿å¤–éƒ¨çš„ `B` è¢«é”€æ¯ï¼Œåªè¦ `a` è¿˜å­˜åœ¨ï¼Œ`B` å®ä½“å°±è¿˜åœ¨ã€‚

---

### æ–¹æ³• 2ï¼šä½¿ç”¨ `weak_ptr` é˜²æ­¢å¾ªç¯å¼•ç”¨

å¦‚æœä½ æ‹…å¿ƒå¾ªç¯å¼•ç”¨ï¼Œå¯ä»¥ç”¨ `weak_ptr`ï¼š

```cpp
A(std::weak_ptr<B> wbptr) {
    a = [wbptr](int x, int y) {
        if (auto bptr = wbptr.lock()) {
            bptr->bfunc(x, y);
        }
    };
}
```

---

## ğŸ§  æ€»ç»“

|é—®é¢˜|ç­”æ¡ˆ|
|---|---|
|`std::function` æ˜¯æ™®é€šå¯¹è±¡å—ï¼Ÿ|æ˜¯ï¼Œæ¶‰åŠæ‹·è´/ç§»åŠ¨æ„é€ ã€‚|
|ä½¿ç”¨ `std::bind(&B::bfunc, b, ...)` æ—¶ `b` è¢«ææ„äº†è¿˜èƒ½è°ƒç”¨å—ï¼Ÿ|ä¸èƒ½ï¼Œä¼šäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºã€‚|
|å¦‚ä½•å®‰å…¨ä½¿ç”¨ï¼Ÿ|æ¨èç”¨ `shared_ptr` åŒ…è£¹æˆå‘˜å¯¹è±¡ï¼Œå¹¶ç”¨ lambda æ•è·å®ƒã€‚|

---

å¦‚æœä½ å¸Œæœ›æˆ‘æ ¹æ®ä½ çš„å®Œæ•´ä¸Šä¸‹æ–‡å¸®ä½ é‡æ„ä»£ç æˆ–åˆ†æé£é™©ï¼Œæ¬¢è¿è´´å‡ºæ›´å¤šç»†èŠ‚ï¼Œæˆ‘å¯ä»¥ç»™ä½ ç”Ÿæˆå®‰å…¨ä¸”é«˜æ•ˆçš„ç»“æ„ã€‚
## é‚£åˆ°åº•æ˜¯ç§»åŠ¨æ„é€ è¿˜æ˜¯æ‹·è´æ„é€ ï¼Ÿæ—¢ç„¶ä¼šæœªå®šä¹‰ï¼Œè¯´æ˜ä¸€å®šæ˜¯ç§»åŠ¨æ„é€ å•Š
è¿™ä¸ªé—®é¢˜å¾ˆç»†è‡´ï¼Œä¹Ÿå¾ˆä¸“ä¸šï¼Œå’±ä»¬ä¸€æ­¥æ­¥æ¥åˆ†æ **`std::function<void(int, int)> a = std::bind(&B::bfunc, b, _1, _2);`** è¿™æ ·çš„ç»‘å®šåˆ°åº•å‘ç”Ÿäº†**æ‹·è´æ„é€ **è¿˜æ˜¯**ç§»åŠ¨æ„é€ **ï¼Œä»¥åŠä¸ºä½•ä¼šé€ æˆæœªå®šä¹‰è¡Œä¸ºã€‚

---

## âœ… **æœ¬è´¨ï¼šåˆ°åº•æ˜¯æ‹·è´è¿˜æ˜¯ç§»åŠ¨ï¼Ÿ**

å…³é”®ç‚¹æ˜¯ï¼š`std::function` æ¥æ”¶ä¸€ä¸ª**å¯è°ƒç”¨å¯¹è±¡ï¼ˆcallableï¼‰**ï¼Œä¸ç®¡ä½ ä¼ çš„æ˜¯ä¸´æ—¶çš„ `std::bind(...)` è¿”å›å¯¹è±¡ï¼Œè¿˜æ˜¯ä¸€ä¸ªå·²æœ‰å˜é‡ï¼Œå®ƒéƒ½è¦æŠŠå®ƒå†…éƒ¨å­˜å‚¨èµ·æ¥ã€‚

### æƒ…å†µåˆ†æï¼š

1. **ä¸´æ—¶å¯¹è±¡ä¼ å…¥æ—¶ï¼ˆå¦‚ std::function = std::bind(...)ï¼‰**
    
    - `std::bind(...)` è¿”å›ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼ˆä¸€ä¸ªé—­åŒ…å¯¹è±¡ï¼‰ã€‚
        
    - `std::function` æ¥æ”¶åˆ°åï¼Œå¦‚æœå¯ä»¥ç§»åŠ¨ï¼Œå°±**ä¼˜å…ˆç§»åŠ¨æ„é€ **ï¼Œå¦åˆ™å›é€€åˆ°æ‹·è´æ„é€ ã€‚
        
2. **ä¼ å…¥ä¸€ä¸ªå…·åå˜é‡ï¼ˆå¦‚å·²æœ‰ auto bound = std::bind(...)ï¼‰**
    
    - å¦‚æœå˜é‡æ˜¯ `const`ï¼Œåˆ™åªèƒ½æ‹·è´ã€‚
        
    - å¦åˆ™ï¼Œå¯ä»¥é€šè¿‡ `std::move()` ç§»åŠ¨è¿›å»ã€‚
        

### ğŸ¯ æ‰€ä»¥ï¼š

- **æ˜¯å¦ç§»åŠ¨æ„é€ ï¼Œå–å†³äºä¼ å…¥çš„æ˜¯ä¸´æ—¶å€¼ã€å…·åå˜é‡ã€è¿˜æ˜¯è¢« `std::move()` æ˜¾å¼è½¬ç§»**ã€‚
    
- ä½†æ— è®ºæ˜¯å“ªç§ï¼Œ`std::function` å†…éƒ¨éƒ½**å¤åˆ¶äº†ä¸€ä»½**ç»‘å®šå¯¹è±¡çš„å‰¯æœ¬ï¼ˆé€šè¿‡ç§»åŠ¨æˆ–æ‹·è´ï¼‰ã€‚
    

---

## â— ä¸ºä»€ä¹ˆä¼šæœ‰æœªå®šä¹‰è¡Œä¸ºï¼Ÿ

è¿™æ˜¯æœ€é‡è¦çš„ç†è§£ç‚¹ï¼š

### æ¥çœ‹ä½ å†™çš„ä»£ç æ„å›¾ï¼š

```cpp
class B {
public:
    void bfunc(int x, int y);
};

class A {
public:
    std::function<void(int, int)> a;

    A(B* b) {
        // ç»‘å®š B::bfuncï¼Œä¼ å…¥ b æŒ‡é’ˆ
        a = std::bind(&B::bfunc, b, std::placeholders::_1, std::placeholders::_2);
    }
};
```

### è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼š

- `std::bind(&B::bfunc, b, ...)` **ç¡®å®æ˜¯ä¸€ä¸ªå¯¹è±¡**ï¼Œä¼ å…¥æ—¶ä¼šè¢«æ‹·è´æˆ–ç§»åŠ¨ï¼ˆé€šå¸¸æ˜¯ç§»åŠ¨ï¼‰åˆ° `std::function` å†…ã€‚
    
- ä½†è¿™ä¸ª **bind å¯¹è±¡å†…éƒ¨å­˜çš„æ˜¯è£¸æŒ‡é’ˆ b**ã€‚
    
- ä¸€æ—¦ `b` å¯¹åº”çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œ**ä½ è°ƒç”¨ `a(x, y)`ï¼Œå°±ç­‰äºè°ƒç”¨ä¸€ä¸ª dangling æŒ‡é’ˆäº†** â€”â€” è¿™å°±äº§ç”Ÿäº† **æœªå®šä¹‰è¡Œä¸ºï¼ˆUBï¼‰**ã€‚
    

---

## ğŸš« æ‰€ä»¥ï¼Œå¹¶ä¸æ˜¯å› ä¸ºâ€œæ˜¯ç§»åŠ¨æ„é€ æ‰€ä»¥æœªå®šä¹‰â€ï¼Œè€Œæ˜¯å› ä¸ºï¼š

> `std::bind` é‡Œä¿å­˜çš„æ˜¯ `B* b`ï¼Œå¹¶æ²¡æœ‰ä»»ä½•ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚**ä½ ä¼ çš„æ˜¯æŒ‡é’ˆï¼Œè€Œä¸æ˜¯å¯¹è±¡æˆ–æ™ºèƒ½æŒ‡é’ˆï¼**

---

## âœ… å®‰å…¨æ›¿ä»£æ–¹æ¡ˆï¼ˆä½¿ç”¨ `shared_ptr`ï¼‰

å¦‚æœä½ å¸Œæœ›è¢«æ•è·çš„å¯¹è±¡åœ¨å‡½æ•°å¯¹è±¡å­˜åœ¨æœŸé—´ä¸€ç›´æœ‰æ•ˆï¼Œå°±è¦ç”¨ `shared_ptr`ï¼š

```cpp
class A {
public:
    std::function<void(int, int)> a;

    A(std::shared_ptr<B> bptr) {
        a = [bptr](int x, int y) {
            bptr->bfunc(x, y);
        };
    }
};
```

- `bptr` è¢«æ•è·åˆ° lambda å†…éƒ¨ï¼Œlambda è¢«ç§»åŠ¨æˆ–æ‹·è´åˆ° `std::function` ä¸­ã€‚
    
- lambda å†…éƒ¨æŒæœ‰ `shared_ptr`ï¼Œç”Ÿå‘½å‘¨æœŸè¢«æ‰˜ç®¡ã€‚
    
- **å³ä½¿å¤–éƒ¨çš„ `B` å®ä¾‹ææ„ï¼Œåªè¦ `std::function` è¿˜åœ¨ï¼Œ`B` å¯¹è±¡å°±ä¸ä¼šé”€æ¯ã€‚**
    

---

## ğŸ“Œ æ€»ç»“

| é—®é¢˜           | ç»“è®º                                                               |
| ------------ | ---------------------------------------------------------------- |
| æ˜¯ç§»åŠ¨æ„é€ è¿˜æ˜¯æ‹·è´æ„é€ ï¼Ÿ | ä¸´æ—¶å¯¹è±¡é»˜è®¤ä¼š **ç§»åŠ¨æ„é€ ** åˆ° `std::function`ã€‚å…·åå˜é‡è§†æƒ…å†µå¯èƒ½æ˜¯æ‹·è´æˆ–ç§»åŠ¨ã€‚              |
| ä¸ºä»€ä¹ˆä¼šæœªå®šä¹‰è¡Œä¸ºï¼Ÿ   | å› ä¸º `std::bind` æ•è·çš„æ˜¯è£¸æŒ‡é’ˆï¼Œ`std::function` å†…éƒ¨æ‹·è´/ç§»åŠ¨çš„æ˜¯é—­åŒ…ï¼Œä¸ä¼šè‡ªåŠ¨ç®¡ç†æŒ‡é’ˆç”Ÿå‘½å‘¨æœŸã€‚ |
| å¦‚ä½•é¿å… UBï¼Ÿ     | ç”¨ `std::shared_ptr` æ›¿ä»£è£¸æŒ‡é’ˆï¼Œè®© lambda æˆ– bind æ•è· `shared_ptr`ã€‚       |

å¦‚æœä½ æƒ³çœ‹ bind æ•è·æŒ‡é’ˆå’Œ shared_ptr çš„å…·ä½“äºŒè¿›åˆ¶å¤§å°ã€ç”Ÿå‘½å‘¨æœŸã€æˆ–è€…åæ±‡ç¼–åŸç†ï¼Œä¹Ÿå¯ä»¥ç»§ç»­æ·±å…¥æ¢è®¨ã€‚
## è¯·ä¸¾ä¾‹ï¼Œä»€ä¹ˆæ—¶å€™ä¼šæ˜¯æ‹·è´
è¿™æ˜¯ä¸ªå¥½é—®é¢˜ã€‚æˆ‘ä»¬æ¥å…·ä½“ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ **ä»€ä¹ˆæ—¶å€™ `std::function` ä¼šå‘ç”Ÿæ‹·è´æ„é€ ï¼Œè€Œä¸æ˜¯ç§»åŠ¨æ„é€ **ã€‚

---

## âœ… èƒŒæ™¯å›é¡¾ï¼š

å½“ä½ å°†å¯è°ƒç”¨å¯¹è±¡ä¼ ç»™ `std::function` æ—¶ï¼š

- å¦‚æœæ˜¯**å³å€¼**ï¼ˆå¦‚ä¸´æ—¶å¯¹è±¡ï¼‰ï¼Œä¼˜å…ˆä½¿ç”¨**ç§»åŠ¨æ„é€ **ã€‚
    
- å¦‚æœæ˜¯**å·¦å€¼**ï¼Œåˆ™ä½¿ç”¨**æ‹·è´æ„é€ **ï¼ˆé™¤éä½ ç”¨ `std::move` è½¬æˆå³å€¼ï¼‰ã€‚
    

---

## âœ… ç¤ºä¾‹ 1ï¼š**ä½¿ç”¨å·¦å€¼å˜é‡ â‡’ æ‹·è´æ„é€ **

```cpp
#include <iostream>
#include <functional>

struct Functor {
    Functor() {}
    Functor(const Functor&) { std::cout << "æ‹·è´æ„é€ \n"; }
    Functor(Functor&&) noexcept { std::cout << "ç§»åŠ¨æ„é€ \n"; }

    void operator()(int x) const { std::cout << "è°ƒç”¨: " << x << "\n"; }
};

int main() {
    Functor f;  // å·¦å€¼å¯¹è±¡
    std::function<void(int)> func = f;  // â† å‘ç”Ÿæ‹·è´æ„é€ 
    func(42);
}
```

**è¾“å‡ºï¼š**

```
æ‹·è´æ„é€ 
è°ƒç”¨: 42
```

---

## âœ… ç¤ºä¾‹ 2ï¼š**ä½¿ç”¨ `std::move(f)` â‡’ ç§»åŠ¨æ„é€ **

```cpp
int main() {
    Functor f;
    std::function<void(int)> func = std::move(f);  // â† ç§»åŠ¨æ„é€ 
    func(42);
}
```

**è¾“å‡ºï¼š**

```
ç§»åŠ¨æ„é€ 
è°ƒç”¨: 42
```

---

## âœ… ç¤ºä¾‹ 3ï¼š**ä¸´æ—¶å¯¹è±¡ â‡’ ç§»åŠ¨æ„é€ **

```cpp
int main() {
    std::function<void(int)> func = Functor();  // â† å³å€¼ï¼Œç§»åŠ¨æ„é€ 
    func(42);
}
```

**è¾“å‡ºï¼š**

```
ç§»åŠ¨æ„é€ 
è°ƒç”¨: 42
```

---

## âœ… ç¤ºä¾‹ 4ï¼š`std::bind` è¢«æ‹·è´

```cpp
#include <functional>

void test(int a, int b) {
    std::cout << "test(" << a << ", " << b << ")\n";
}

int main() {
    auto bindObj = std::bind(test, std::placeholders::_1, std::placeholders::_2);
    std::function<void(int, int)> f = bindObj;  // bindObj æ˜¯å·¦å€¼ â‡’ æ‹·è´æ„é€ 
    f(1, 2);
}
```

---

## ğŸ” æ€»ç»“

|æƒ…å†µ|ç»“æœ|
|---|---|
|å°† **å·¦å€¼å¯¹è±¡** èµ‹ç»™ `std::function`|**æ‹·è´æ„é€ **|
|å°† **å³å€¼å¯¹è±¡/ä¸´æ—¶å¯¹è±¡** èµ‹ç»™ `std::function`|**ç§»åŠ¨æ„é€ **|
|ä½¿ç”¨ `std::move(å·¦å€¼)`|**ç§»åŠ¨æ„é€ **|

> æ‰€ä»¥å½“ä½ é—®ï¼šâ€œä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿæ‹·è´ï¼Ÿâ€ç­”æ¡ˆå°±æ˜¯ï¼š**å½“ä½ æŠŠä¸€ä¸ªæ™®é€šå˜é‡ï¼ˆå·¦å€¼ï¼‰èµ‹å€¼ç»™ `std::function` æ—¶ï¼Œæ²¡æœ‰ `std::move()` çš„æƒ…å†µä¸‹å°±æ˜¯æ‹·è´æ„é€ ã€‚**

å¦‚éœ€è¿›ä¸€æ­¥æ¼”ç¤º `std::bind` ç»“åˆç±»æˆå‘˜å‡½æ•°å’Œç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œä¹Ÿå¯ä»¥ç»§ç»­æ·±å…¥ã€‚

## std::bindè¿”å›çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œä¸ºä»€ä¹ˆå¯ä»¥èµ‹å€¼ç»™std::functionç±»å‹çš„å˜é‡å‘¢ï¼Œç»™åˆ«çš„ä¸è¡Œå—
`std::bind` è¿”å›çš„æ˜¯ä¸€ä¸ª**æœªå‘½åçš„**ã€å…·æœ‰å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ `operator()` çš„**å¯è°ƒç”¨å¯¹è±¡ï¼ˆcallable objectï¼‰**ï¼Œå…¶å…·ä½“ç±»å‹æ˜¯ç”±æ¨¡æ¿å‚æ•°è‡ªåŠ¨æ¨å¯¼ç”Ÿæˆçš„ä¸€ä¸ª **é—­åŒ…ç±»ï¼ˆclosure typeï¼‰**ï¼Œ**ç±»å‹æå…¶å¤æ‚ä¸”ä¸èƒ½ç›´æ¥å†™å‡º**ã€‚å®ƒå¹¶ä¸æ˜¯ `std::function` ç±»å‹ï¼Œä½†å¯ä»¥èµ‹å€¼ç»™ `std::function`ï¼ŒåŸå› å¦‚ä¸‹ï¼š

---

### ğŸ”¹ ä¸€ã€`std::bind` è¿”å›ä»€ä¹ˆç±»å‹ï¼Ÿ

```cpp
auto f = std::bind(some_func, arg1, arg2);
```

- `f` çš„ç±»å‹æ˜¯ä¸€ä¸ªç”± `std::bind` å†…éƒ¨å®ç°å®šä¹‰çš„åŒ¿åç±»ï¼ˆå¸¦æœ‰ operator()ï¼‰ã€‚
    
- æœ¬è´¨ä¸Šæ˜¯ä¸ª **å‡½æ•°å¯¹è±¡ï¼ˆfunctorï¼‰**ï¼Œ**ä¸æ˜¯**å‡½æ•°æŒ‡é’ˆï¼Œä¹Ÿä¸æ˜¯ `std::function`ã€‚
    

ä½ å¯ä»¥ä½¿ç”¨ `decltype(f)` æŸ¥çœ‹å…¶ç±»å‹ï¼Œä½†å®ƒä¼šéå¸¸å†—é•¿ï¼Œå®é™…æ— æ³•æ‰‹å†™å‡ºæ¥ã€‚

---

### ğŸ”¹ äºŒã€ä¸ºä»€ä¹ˆèƒ½èµ‹å€¼ç»™ `std::function`ï¼Ÿ

å› ä¸º `std::function` æ˜¯ä¸€ä¸ª **ç±»å‹æ“¦é™¤ï¼ˆtype-erasedï¼‰å®¹å™¨**ï¼Œå¯ä»¥å­˜å‚¨ **ä»»ä½•å¯è°ƒç”¨å¯¹è±¡**ï¼ŒåŒ…æ‹¬ï¼š

- æ™®é€šå‡½æ•°ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰
    
- æˆå‘˜å‡½æ•°æŒ‡é’ˆ + å®ä¾‹ç»‘å®š
    
- Lambda è¡¨è¾¾å¼
    
- `std::bind` çš„è¿”å›å€¼
    
- è‡ªå®šä¹‰çš„ `operator()` ç±»
    

æ‰€ä»¥å½“ä½ è¿™æ ·å†™ï¼š

```cpp
std::function<void(int, int)> func = std::bind(test, std::placeholders::_1, std::placeholders::_2);
```

æ˜¯åˆæ³•çš„ï¼Œå› ä¸º `std::bind(...)` è¿”å›çš„å¯¹è±¡æ˜¯**å¯è°ƒç”¨çš„**ï¼Œå…¶è°ƒç”¨ç­¾åå¯ä»¥**éšå¼è½¬æ¢åŒ¹é…**åˆ° `std::function<void(int, int)>`ã€‚

---

### ğŸ”¹ ä¸‰ã€èƒ½ä¸èƒ½èµ‹ç»™åˆ«çš„ç±»å‹ï¼Ÿ

ä½ å¯ä»¥èµ‹å€¼ç»™ `auto` æˆ–ä½ æ‰‹åŠ¨å†™çš„å‡½æ•°å¯¹è±¡ç±»å‹ï¼Œä½† **ä¸èƒ½ç›´æ¥èµ‹ç»™å‡½æ•°æŒ‡é’ˆ**ï¼Œå› ä¸º `std::bind` è¿”å›çš„æ˜¯ä¸ªå¤æ‚å¯¹è±¡ï¼Œä¸æ˜¯å‡½æ•°åœ°å€ã€‚

**ç¤ºä¾‹ï¼š**

âœ… åˆæ³•ï¼š

```cpp
auto f1 = std::bind(test, std::placeholders::_1, 10);
std::function<void(int)> f2 = f1;  // OK
```

âŒ éæ³•ï¼ˆå‡½æ•°æŒ‡é’ˆä¸æ¥å— std::bind çš„ç»“æœï¼‰ï¼š

```cpp
void (*func_ptr)(int) = std::bind(test, std::placeholders::_1, 10);  // âŒ é”™è¯¯
```

---

### ğŸ”¹ å››ã€æ€»ç»“

|ç±»å‹|æ˜¯å¦èƒ½æ¥æ”¶ `std::bind` è¿”å›å€¼|åŸå› |
|---|---|---|
|`auto`|âœ… å¯ä»¥|ç±»å‹è‡ªåŠ¨æ¨å¯¼|
|`std::function<sig>`|âœ… å¯ä»¥|ç±»å‹æ“¦é™¤æ”¯æŒä»»æ„å¯è°ƒç”¨å¯¹è±¡|
|å‡½æ•°æŒ‡é’ˆ|âŒ ä¸å¯ä»¥|å‡½æ•°å¯¹è±¡ â‰  å‡½æ•°åœ°å€ï¼Œç±»å‹ä¸å…¼å®¹|
|è‡ªå®šä¹‰ `operator()` ç±»|âœ… å¯ä»¥ï¼ˆä½œä¸ºç›®æ ‡ï¼‰|ä½ å¯ä»¥æŠŠ bind çš„ç»“æœä¼ è¿›å»ï¼Œæˆ–è€…ä¹Ÿå†™æˆå‡½æ•°å¯¹è±¡æ¥æ”¶|

---

å¦‚æœä½ å¸Œæœ›è®© `std::bind` çš„ç»“æœèµ‹å€¼åˆ°å…¶ä»–å®¹å™¨æˆ–ç»“æ„ä¸­ï¼Œåªè¦è¯¥ç»“æ„æ”¯æŒå­˜å‚¨æˆ–è°ƒç”¨å¯è°ƒç”¨å¯¹è±¡ï¼ˆæ¯”å¦‚ lambdaã€functorï¼‰ï¼Œé€šå¸¸éƒ½æ˜¯å¯ä»¥çš„ã€‚å¦åˆ™éœ€è¦å€ŸåŠ© `std::function` ç»Ÿä¸€æ¥å£ã€‚


## ç±»Açš„æ„é€ å‡½æ•°ä¸­å¯ä»¥ä¸å¯ä»¥æœ‰std::function<void()>& aè¿™æ ·çš„å½¢å‚ï¼Œæ˜¯å¼•ç”¨æ ¼å¼çš„ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼ å…¥æŸä¸ªstd::bind()å¯¹è±¡ï¼Œä»¥å‡å°‘ä¸€æ¬¡æ‹·è´æ„é€ ï¼Œç„¶åç±»Aä¸­çš„æŸä¸ªstd::function<void()> m_açš„æˆå‘˜å˜é‡ï¼Œè¿›è¡Œå½¢å‚åˆ—è¡¨çš„m_a(a)çš„èµ‹å€¼
ä½ é—®å¾—éå¸¸ä¸“ä¸šï¼Œç¡®å®æ¶‰åŠåˆ°æ€§èƒ½ä¼˜åŒ–åœºæ™¯ä¸­å¯¹ `std::function` æ„é€ çš„ç²¾ç»†æ§åˆ¶ã€‚  
æˆ‘ä»¬æ¥ç³»ç»Ÿæ€§åœ°è§£ç­”è¿™ä¸ªé—®é¢˜ï¼š

---

### âœ… å›ç­”ç®€æ´ç‰ˆï¼š

æ˜¯çš„ï¼Œ**ä½ å¯ä»¥**åœ¨ç±» A çš„æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ `std::function<void()>& a` ä½œä¸ºå¼•ç”¨å‚æ•°ï¼Œæ¥**é¿å…ä¸€æ¬¡æ‹·è´æˆ–ç§»åŠ¨æ„é€ **ã€‚  
å¹¶ä¸”ä½ ä¹Ÿå¯ä»¥åœ¨æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ä¸­å†™ `m_a(a)` æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ã€‚

ä½† âš ï¸ **æœ‰å‰ææ¡ä»¶å’Œé£é™©è¦æ³¨æ„**ï¼Œè¯¦è§ä¸‹æ–¹è§£é‡Šã€‚

---

### ğŸ“Œ åœºæ™¯æè¿°ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

```cpp
class A {
public:
    A(std::function<void()>& a) : m_a(a) { }

private:
    std::function<void()> m_a;
};
```

è°ƒç”¨ï¼š

```cpp
auto b = std::bind(...);
std::function<void()> f = b;
A obj(f);  // OKï¼Œå¼•ç”¨ä¼ å‚ï¼Œé¿å…ä¸€æ¬¡æ‹·è´
```

---

### âœ… å¥½å¤„ï¼šå‡å°‘ä¸€æ¬¡æ‹·è´æˆ–ç§»åŠ¨æ„é€ 

ä½ ä¼ å…¥å¼•ç”¨ `std::function<void()>&`ï¼Œé‚£ä¹ˆåœ¨æ„é€  `A` çš„æ—¶å€™ä¸ä¼šäº§ç”Ÿä¸€ä»½ä¸´æ—¶æ‹·è´ä¼ å‚ï¼Œå¯ä»¥ç›´æ¥åˆå§‹åŒ– `m_a`ï¼Œé¿å…äº†ä¸€æ¬¡èµ„æºå¤åˆ¶ã€‚

æ¯”èµ·ä¸‹é¢è¿™æ ·å¤šäº†ä¸€æ¬¡æ‹·è´ï¼š

```cpp
A(std::function<void()> a) : m_a(std::move(a)) { }  // ä¸€æ¬¡æ‹·è´ + ä¸€æ¬¡ç§»åŠ¨
```

---

### âš ï¸ é£é™©ä¸æ³¨æ„äº‹é¡¹ï¼š

#### 1. **å¼•ç”¨çš„æ˜¯å¤–éƒ¨çš„ std::functionï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¦è¶³å¤Ÿé•¿**

ä½ å¼•ç”¨çš„ `a` æ˜¯å¤–éƒ¨ä¼ å…¥çš„å¼•ç”¨ï¼Œå¦‚æœå¤–éƒ¨è¿™ä¸ªå¯¹è±¡å¾ˆå¿«è¢«é”€æ¯ï¼Œè€Œä½ åˆåœ¨ç±»ä¸­ä¿å­˜å®ƒï¼Œä¼šå¯¼è‡´æ‚¬ç©ºå¼•ç”¨ â€”â€” ä½†ä½ è¿™é‡Œçš„åšæ³•æ˜¯æ‹·è´ï¼ˆèµ‹å€¼ç»™ `m_a`ï¼‰ï¼Œæ‰€ä»¥é£é™©ä¸å¤§ã€‚

#### 2. **ä¸ä¼šé¿å… std::function çš„æœ¬èº«æ‹·è´**

ä½ åªæ˜¯é¿å…äº†æ„é€ å‡½æ•°å‚æ•°å¤„çš„ä¸€æ¬¡æ‹·è´ï¼Œä½† `m_a(a)` è¿™ä¸€å¥ä»ç„¶ä¼šè§¦å‘ä¸€æ¬¡æ‹·è´æ„é€ ï¼ˆæˆ–ç§»åŠ¨æ„é€ ï¼Œå¦‚æœç”¨ `std::move(a)`ï¼‰ã€‚

#### 3. **std::bind è¿”å›çš„æ˜¯ä¸€ä¸ªå³å€¼ï¼Œä¸èƒ½ç›´æ¥ä¼ å…¥å¼•ç”¨å‚æ•°**

ä¸èƒ½è¿™æ ·åšï¼š

```cpp
A(std::function<void()>& a);  // æ¥æ”¶å¼•ç”¨
A obj(std::bind(...));        // âŒ é”™è¯¯ï¼Œbind(...) æ˜¯å³å€¼ï¼Œä¸èƒ½ç»‘å®šåˆ°éå¸¸é‡å·¦å€¼å¼•ç”¨
```

å¿…é¡»æ˜¾å¼å…ˆå£°æ˜ä¸ºå˜é‡ï¼š

```cpp
auto tmp = std::bind(...);
std::function<void()> f = tmp;
A obj(f);  // OK
```

---

### âœ… æ›´ä¼˜æ¨èï¼šç”¨ `std::function<void()>&&`ï¼ˆå³å€¼å¼•ç”¨ï¼‰

å¦‚æœä½ ç›®çš„æ˜¯é¿å…æ‹·è´ã€å¹¶æ¥å—ä¸´æ—¶å€¼ï¼Œæ¨èä½¿ç”¨å³å€¼å¼•ç”¨ç‰ˆæœ¬ï¼š

```cpp
class A {
public:
    A(std::function<void()>&& a) : m_a(std::move(a)) { }

private:
    std::function<void()> m_a;
};
```

è°ƒç”¨æ—¶ï¼š

```cpp
A obj(std::bind(...));  // ä¸´æ—¶å¯¹è±¡ä¼šè¢«ç§»åŠ¨è¿› Aï¼Œæ€§èƒ½æ›´ä½³
```

---

### âœ… æ€»ç»“å»ºè®®ï¼š

|æ–¹å¼|ä¼˜ç‚¹|é£é™©/ç¼ºç‚¹|
|---|---|---|
|`A(std::function<void()> a)`|æœ€å¸¸è§ï¼Œç®€å•ã€å®‰å…¨|ä¼šå‘ç”Ÿä¸€æ¬¡å¤åˆ¶æ„é€  + ç§»åŠ¨æ„é€ |
|`A(std::function<void()>& a)`|é¿å…æ‹·è´å‚æ•°ï¼Œå°‘ä¸€ç‚¹å¼€é”€|æ— æ³•æ¥æ”¶ä¸´æ—¶å¯¹è±¡ï¼›æ³¨æ„å¤–éƒ¨ç”Ÿå‘½å‘¨æœŸ|
|`A(std::function<void()>&& a)`|æœ€æ¨èï¼šæ”¯æŒç§»åŠ¨ï¼›é¿å…æ‹·è´|å¿…é¡»ä¼ å³å€¼ï¼›éœ€è¦æ‰‹åŠ¨ std::move æˆ–ç”¨ä¸´æ—¶å¯¹è±¡|

---

å¦‚ä½ æ³¨é‡æ€§èƒ½å’Œè¯­ä¹‰æ¸…æ™°ï¼Œå»ºè®®ä½¿ç”¨ `std::function<void()>&&` + `std::move`ï¼Œæ—¢å®‰å…¨åˆé«˜æ•ˆã€‚  
å¦‚æœä»éœ€è¿›ä¸€æ­¥å‡å°‘å‡½æ•°å°è£…å¼€é”€ï¼ˆæ¯”å¦‚é¿å…ä½¿ç”¨ `std::function`ï¼‰ï¼Œå¯ä»¥è€ƒè™‘æ¨¡æ¿ + å®Œå…¨è½¬å‘æ–¹å¼ã€‚éœ€è¦çš„è¯æˆ‘ä¹Ÿå¯ä»¥ä¸¾ä¾‹ã€‚

## `void Context::m_setCurrentState(std::unique_ptr<iState> state)å‡å¦‚æœ‰ä¸ªå‡½æ•°æ˜¯è¿™ç§å½¢å¼ï¼Œè°ƒç”¨çš„æ—¶å€™ï¼Œctx.m_setCurrentState(std::make_unique<MainMenuState>());è¿™é‡Œæ¶‰åŠåˆ°æ‹·è´æ„é€ å‡½æ•°çš„è°ƒç”¨äº†å—ï¼Œå¯ä»¥æŠŠm_setCurrentState(std::unique_ptr<iState>&& state)å—`

ä½ çš„é—®é¢˜éå¸¸å…³é”®ï¼Œæ¶‰åŠ C++ ä¸­ `std::unique_ptr` çš„ç§»åŠ¨è¯­ä¹‰ã€‚

---

## âœ… å›ç­”æ ¸å¿ƒç»“è®ºï¼š

```cpp
void Context::m_setCurrentState(std::unique_ptr<iState> state);
```

è¿™æ®µå‡½æ•°**ç¡®å®æ¶‰åŠä¸€æ¬¡â€œç§»åŠ¨æ„é€ â€**ï¼ˆä¸æ˜¯æ‹·è´æ„é€ ï¼Œå› ä¸º `unique_ptr` æ˜¯ä¸å¯æ‹·è´çš„ï¼‰ï¼Œä½†å®ƒä¼š **å¤šä¸€æ¬¡ç§»åŠ¨æ„é€ **ï¼Œå³ï¼š

> `std::make_unique<MainMenuState>() â†’ ä¸´æ—¶å¯¹è±¡ â†’ ç§»åŠ¨åˆ°å‡½æ•°å‚æ•° state â†’ å†ç§»åŠ¨åˆ°æˆå‘˜å˜é‡`

ä¸ºäº†**é¿å…è¿™æ¬¡å¤šä½™çš„ç§»åŠ¨**ï¼Œ**æ›´æ¨èä½ å°†å‚æ•°å£°æ˜ä¸ºå³å€¼å¼•ç”¨**ï¼š

```cpp
void Context::m_setCurrentState(std::unique_ptr<iState>&& state);
```

è¿™æ ·å†™èƒ½è®©è°ƒç”¨è€…ç›´æ¥ä¼ é€’å³å€¼ï¼Œä¸ä¼šå‘ç”Ÿé¢å¤–çš„ç§»åŠ¨æ„é€ ã€‚

---

## ğŸ“Œ ä¸¾ä¸ªå®Œæ•´ä¾‹å­è¯´æ˜ï¼š

### åŸå†™æ³•ï¼šä¼ å€¼ï¼ˆå¤šä¸€æ¬¡ç§»åŠ¨ï¼‰

```cpp
void Context::m_setCurrentState(std::unique_ptr<iState> state) {
    m_state = std::move(state);  // è¿™é‡Œç§»åŠ¨äº†ä¸€æ¬¡
}

// è°ƒç”¨
ctx.m_setCurrentState(std::make_unique<MainMenuState>());
```

### æ”¹è¿›å†™æ³•ï¼šå³å€¼å¼•ç”¨ + std::move æ•è·å³å€¼

```cpp
void Context::m_setCurrentState(std::unique_ptr<iState>&& state) {
    m_state = std::move(state);  // ç›´æ¥ä»å®å‚è½¬ç§»ï¼Œæ— ä¸­é—´ä¸´æ—¶å¯¹è±¡
}
```

è°ƒç”¨ä¸å˜ï¼Œä¾ç„¶å¯ä»¥ä¼ é€’å³å€¼ï¼š

```cpp
ctx.m_setCurrentState(std::make_unique<MainMenuState>());
```

---

## ğŸ§  æ‹“å±•è¯´æ˜ï¼š

### ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨ const å¼•ç”¨ï¼Ÿ

```cpp
void Context::m_setCurrentState(const std::unique_ptr<iState>& state);  // âŒ ä¸å¯è¡Œ
```

å› ä¸º `unique_ptr` æ˜¯**ç‹¬å æ‰€æœ‰æƒ**çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒä¸èƒ½æ‹·è´ï¼Œåªèƒ½ç§»åŠ¨ï¼Œconst å¼•ç”¨æ— æ³•è½¬ç§»æ‰€æœ‰æƒã€‚

---

## âœ… æ€»ç»“å»ºè®®ï¼š

|å‚æ•°å½¢å¼|æ˜¯å¦æ¨è|ç§»åŠ¨æ¬¡æ•°|è¯´æ˜|
|---|---|---|---|
|`std::unique_ptr<T> state`|âŒ ä¸€èˆ¬ä¸æ¨è|2 æ¬¡|ä¼šå¤šä¸€æ¬¡ç§»åŠ¨æ„é€ |
|`std::unique_ptr<T>&& state`|âœ… æ¨è|1 æ¬¡|å…è®¸ä¼ é€’å³å€¼å¹¶ç›´æ¥ç§»åŠ¨ï¼Œæ€§èƒ½æ›´ä¼˜|
|`const std::unique_ptr<T>& state`|âŒ ä¸å¯è¡Œ|-|æ— æ³•æ‹·è´ã€ä¹Ÿæ— æ³•ç§»åŠ¨ï¼Œè¿å unique_ptr çš„è¯­ä¹‰|

---

å¦‚ä½ ä½¿ç”¨ `unique_ptr` ç®¡ç†çŠ¶æ€å¯¹è±¡ï¼Œé‡‡ç”¨å³å€¼å¼•ç”¨ `&&` æ˜¯æœ€è‡ªç„¶ä¸”é«˜æ•ˆçš„å†™æ³•ã€‚éœ€è¦çš„è¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ å†™ä¸€ä¸ªçŠ¶æ€æœºçš„å®Œæ•´ç¤ºä¾‹ã€‚
## è¿™é‡Œæ˜¯ä¸æ˜¯åº”è¯¥è°ƒç”¨æ‹·è´æ„é€ ï¼Œå¦‚æœæ²¡æœ‰æ‹·è´æ„é€ ï¼Œæ˜¯ä¸æ˜¯å°±åº”è¯¥æŠ¥é”™å‘¢ï¼Ÿ
å› ä¸º `std::unique_ptr` æ”¯æŒ**ç§»åŠ¨æ„é€ **ï¼Œä¸éœ€è¦æ‹·è´æ„é€ ã€‚

å…·ä½“è¿‡ç¨‹ï¼š

1. `std::make_unique<MainMenuState>()` è¿”å› `std::unique_ptr<MainMenuState>`ï¼ˆå³å€¼ï¼‰
2. ä¼ å‚æ—¶å‘ç”Ÿ**éšå¼è½¬æ¢** + **ç§»åŠ¨æ„é€ **ï¼š
    - `std::unique_ptr<MainMenuState>` è½¬æ¢ä¸º `std::unique_ptr<iState>`ï¼ˆåŸºç±»æŒ‡é’ˆï¼‰
    - ä½¿ç”¨ç§»åŠ¨æ„é€ å‡½æ•°ä¼ é€’

`std::unique_ptr` çš„è®¾è®¡ï¼š

- **ç¦ç”¨**æ‹·è´æ„é€ å‡½æ•°ï¼ˆ`= delete`ï¼‰
- **å¯ç”¨**ç§»åŠ¨æ„é€ å‡½æ•°

æ‰€ä»¥ä¼ é€’å³å€¼ï¼ˆå¦‚ `make_unique` çš„è¿”å›å€¼ï¼‰æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œä¸ä¼šå°è¯•æ‹·è´ã€‚

å¦‚æœä½ å†™ï¼š

```cpp
auto ptr = std::make_unique<MainMenuState>();
ctx.m_setCurrentState(ptr); // é”™è¯¯ï¼å°è¯•æ‹·è´
```

è¿™æ ·æ‰ä¼šæŠ¥é”™ï¼Œå› ä¸º `ptr` æ˜¯å·¦å€¼ï¼Œéœ€è¦æ˜¾å¼ç§»åŠ¨ï¼š

```cpp
ctx.m_setCurrentState(std::move(ptr)); // æ­£ç¡®
```

## å¦‚ä½•è®©vs codeå’Œvs studioå…¬ç”¨ä¸€å¥—å¿«æ·é”®
visual code ä¸­å®‰è£…æ’ä»¶ï¼ŒMicrosoftå®˜æ–¹çš„visual studio keymap
## launch.jsonè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥å¹²å˜›çš„ï¼Œæˆ‘ä¸æ˜¯cmakelistä¸­å®Œæ•´é…ç½®äº†å¼•ç”¨çš„å„ç§æ–‡ä»¶å’Œè·¯å¾„äº†å—
è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œå¾ˆå¤šäººç¬¬ä¸€æ¬¡ç”¨ VS Code è°ƒè¯• C++ ç¨‹åºæ—¶ä¹Ÿä¼šæœ‰è¿™ä¸ªç–‘é—®ï¼š

---

### âœ… `CMakeLists.txt` vs `launch.json` çš„åŒºåˆ«

|æ–‡ä»¶å|ç”¨æ¥åšä»€ä¹ˆ|
|---|---|
|`CMakeLists.txt`|**ç¼–è¯‘é…ç½®**ï¼šå‘Šè¯‰ CMake å¦‚ä½•æ„å»ºï¼ˆç¼–è¯‘é“¾æ¥ï¼‰ç¨‹åº|
|`launch.json`|**è°ƒè¯•é…ç½®**ï¼šå‘Šè¯‰ VS Code å¦‚ä½•è¿è¡Œï¼ˆè°ƒè¯•ï¼‰ç¨‹åº|

---

### ğŸ“Œ æ›´å…·ä½“çš„åŒºåˆ«è¯´æ˜

#### ğŸ§± `CMakeLists.txt`

- ç®¡ç† **æºç å¦‚ä½•ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶**ã€‚
    
- åŒ…æ‹¬è®¾ç½®ç¼–è¯‘é€‰é¡¹ã€æ·»åŠ å¤´æ–‡ä»¶è·¯å¾„ã€é“¾æ¥åº“ã€ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶åç­‰ã€‚
    
- ä¸€èˆ¬ä½ æ‰§è¡Œ `cmake .. && make` å°±æ˜¯æ ¹æ®è¿™ä¸ªæ–‡ä»¶æ„å»ºç¨‹åºã€‚
    

#### ğŸ `launch.json`

- ç”± VS Code çš„è°ƒè¯•å™¨æ’ä»¶ï¼ˆå¦‚ `cpptools`ï¼‰ä½¿ç”¨ã€‚
    
- é…ç½®ï¼š
    
    - **è¦è°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„**ï¼ˆ`program`ï¼‰
        
    - **è¿è¡Œæ—¶å‚æ•°**ï¼ˆ`args`ï¼‰
        
    - **å½“å‰å·¥ä½œç›®å½•**ï¼ˆ`cwd`ï¼‰
        
    - **è°ƒè¯•å™¨é€‰æ‹©**ï¼ˆå¦‚ `gdb`ã€`lldb`ï¼‰
        
    - **æ˜¯å¦ä½¿ç”¨å¤–éƒ¨ç»ˆç«¯**ï¼Œç­‰ç­‰ã€‚
        
- å®ƒä¸ä¼šå½±å“ç¼–è¯‘ï¼Œåªæ§åˆ¶è°ƒè¯•è¡Œä¸ºã€‚
    

---

### ğŸ§  ç±»æ¯”ç†è§£

å¯ä»¥ç±»æ¯”ä¸ºï¼š

|æ–¹é¢|é…ç½®ä½œç”¨|
|---|---|
|CMake|å‘Šè¯‰ç³»ç»Ÿæ€ä¹ˆé€ å‡ºä¸€ä¸ªâ€œè½¦â€|
|launch.json|å‘Šè¯‰ä½ æ€ä¹ˆå¯åŠ¨â€œè½¦â€ã€ç»™å®ƒä»€ä¹ˆæ²¹ã€åœ¨å“ªæ¡è·¯ä¸Šå¼€|

---

### ğŸ“Œ å°è´´å£«ï¼šVS Code ä¸­å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆ `launch.json`ï¼Ÿ

å½“ä½ æ‰“å¼€ä¸€ä¸ª CMake é¡¹ç›®å¹¶å®‰è£…äº† C/C++ æ’ä»¶åï¼š

1. ä½ å¯ä»¥ç‚¹å‡» **è¿è¡Œå’Œè°ƒè¯•**ï¼ˆRun and Debugï¼‰ã€‚
    
2. å¦‚æœæ²¡æœ‰ `launch.json`ï¼Œå®ƒä¼šæç¤ºä½ è‡ªåŠ¨åˆ›å»ºã€‚
    
3. ä¹Ÿå¯ä»¥æŒ‰ä¸‹ `F5` â†’ é€‰æ‹© `C++ (GDB/LLDB)` â†’ ç”Ÿæˆæ¨¡æ¿ã€‚
    

---

### âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> `CMakeLists.txt` ç”¨äº **ç¼–è¯‘é¡¹ç›®**ï¼Œ`launch.json` ç”¨äº **è°ƒè¯•é¡¹ç›®**ï¼ŒäºŒè€…èŒè´£å®Œå…¨ä¸åŒï¼Œè°ƒè¯•æ—¶ä»éœ€è¦å•ç‹¬é…ç½® `launch.json`ã€‚

å¦‚ä½ å¸Œæœ›ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ `launch.json` é€‚é…ä½ å½“å‰é¡¹ç›®ã€‚
## launch.jsonä¸­çš„cwdåº”è¯¥å¦‚ä½•å†™ï¼Œå¦‚æœMyProject/Client/A/  MyProject/Client/B æ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰cppæ–‡ä»¶å‚ä¸äº†å·¥ç¨‹çš„ç¼–è¯‘çš„è¯
åœ¨ VS Code çš„ `launch.json` ä¸­ï¼Œ`"cwd"` æ˜¯æŒ‡è°ƒè¯•å™¨å¯åŠ¨æ—¶çš„**å·¥ä½œç›®å½•ï¼ˆCurrent Working Directoryï¼‰**ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æºç çš„è·¯å¾„ã€‚å®ƒçš„è®¾ç½®**å½±å“å¦‚ä¸‹å†…å®¹**ï¼š

- è°ƒè¯•æ—¶ç¨‹åºä¸­ç”¨çš„**ç›¸å¯¹è·¯å¾„**çš„èµ·ç‚¹ï¼ˆå¦‚æ‰“å¼€æ–‡ä»¶æ—¶ä½¿ç”¨ `fopen("data.txt", ...)`ï¼‰
    
- `system("some_script.sh")` ç­‰å‘½ä»¤çš„å·¥ä½œç›®å½•
    
- gdb è°ƒè¯•å™¨å¯åŠ¨æ—¶çš„é»˜è®¤è·¯å¾„
    

---

## âœ… å¦‚æœä½ çš„é¡¹ç›®ç›®å½•å¦‚ä¸‹ï¼š

```
MyProject/
â”œâ”€â”€ Client/
â”‚   â”œâ”€â”€ A/
â”‚   â”‚   â”œâ”€â”€ a.cpp
â”‚   â”œâ”€â”€ B/
â”‚   â”‚   â”œâ”€â”€ b.cpp
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ client_d     â† å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ CMakeLists.txt
```

## âœ… æ¨èé…ç½®æ–¹å¼

```json
{
  "name": "Debug Client",
  "type": "cppdbg",
  "request": "launch",
  "program": "${workspaceFolder}/Client/bin/client_d",
  "args": ["6000"],
  "stopAtEntry": false,
  "cwd": "${workspaceFolder}/Client",  // âœ… ä»¥ Client ä¸ºå·¥ä½œç›®å½•å³å¯
  "environment": [],
  "externalConsole": false,
  "MIMode": "gdb",
  "miDebuggerPath": "/usr/bin/gdb",
  "setupCommands": [
    { "description": "Enable pretty-printing", "text": "-enable-pretty-printing", "ignoreFailures": true }
  ]
}
```

---

## âœ… è§£é‡Š

- `cwd` ä¸éœ€è¦åŒ…å«æ‰€æœ‰ `.cpp` æ–‡ä»¶çš„è·¯å¾„ã€‚ç¼–è¯‘æ—¶æ‰€æœ‰æºç è·¯å¾„åº”ç”± `CMakeLists.txt` æˆ– `compile_commands.json` å¤„ç†ã€‚
    
- åªè¦ä½ ç¨‹åºä¸­**ç›¸å¯¹è·¯å¾„**æ˜¯ç›¸å¯¹äº `Client` ç›®å½•çš„ï¼Œé‚£ä¹ˆå°±è®¾ç½®ä¸º `Client`ã€‚
    
- å¦‚æœä½ çš„ä»£ç ä¸­å†™äº† `fopen("A/data.txt")`ï¼Œé‚£ä¹ˆ `cwd` åº”è¯¥æ˜¯ `Client`ã€‚
    
- è‹¥ä½ ç”¨çš„æ˜¯ç»å¯¹è·¯å¾„ï¼Œåˆ™ `cwd` è®¾ç½®æ²¡æœ‰å¤ªå¤§å½±å“ã€‚
    

---

## âœ… å°ç»“

|æƒ…å†µ|`cwd` å»ºè®®è®¾ç½®ä¸º|
|---|---|
|ç¨‹åºä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¯»å–æ–‡ä»¶|é¡¹ç›®ä¸­ä½ å¸Œæœ›ä½œä¸ºè·¯å¾„åŸºå‡†çš„ç›®å½•|
|ä¸ç¡®å®š|`${workspaceFolder}` æˆ– `${workspaceFolder}/Client`|
|ç¨‹åºä¸­ç”¨åˆ°äº† `A/` å’Œ `B/` ä¸­çš„æ•°æ®æ–‡ä»¶ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰|`${workspaceFolder}/Client` å³å¯|

å¦‚æœä½ èƒ½æä¾›å…·ä½“è·¯å¾„ç»“æ„å’Œæ˜¯å¦ç”¨äº†ç›¸å¯¹è·¯å¾„è¯»å–æ–‡ä»¶ï¼Œæˆ‘å¯ä»¥æ›´ç²¾ç¡®åœ°å»ºè®® `cwd` åº”è¯¥æ˜¯ä»€ä¹ˆã€‚
## launch.jsonä¸­çš„environment setupCommands stopAtEntry externalConsole ä»€ä¹ˆæ„æ€æœ‰ä»€ä¹ˆä½œç”¨å‘¢

`launch.json` æ˜¯ VS Code ç”¨äºè°ƒè¯•é…ç½®çš„æ–‡ä»¶ï¼Œ`environment`ã€`setupCommands`ã€`stopAtEntry` å’Œ `externalConsole` æ˜¯å…¶ä¸­ä¸€äº›å…³é”®å­—æ®µï¼Œå®ƒä»¬çš„ä½œç”¨å¦‚ä¸‹ï¼š

---

### ğŸ”§ 1. `environment`

```json
"environment": [
  { "name": "ENV_VAR_NAME", "value": "some_value" }
]
```

- **ä½œç”¨**ï¼šåœ¨å¯åŠ¨è°ƒè¯•ç¨‹åºæ—¶è®¾ç½®ç¯å¢ƒå˜é‡ã€‚
    
- **ç”¨é€”ä¸¾ä¾‹**ï¼š
    
    - ä½ å¯èƒ½éœ€è¦ç»™ç¨‹åºä¼ é€’æŸäº›ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚åŠ¨æ€åº“è·¯å¾„ `LD_LIBRARY_PATH`ã€é…ç½®æ–‡ä»¶ä½ç½®ç­‰ã€‚
        

---

### ğŸ› ï¸ 2. `setupCommands`

```json
"setupCommands": [
  {
    "description": "Enable pretty-printing for gdb",
    "text": "-enable-pretty-printing",
    "ignoreFailures": true
  }
]
```

- **ä½œç”¨**ï¼šåœ¨è°ƒè¯•å™¨ï¼ˆå¦‚ gdbï¼‰å¯åŠ¨åæ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    
- **ç”¨é€”ä¸¾ä¾‹**ï¼š
    
    - `-enable-pretty-printing`ï¼šå¯ç”¨å¯¹ STL å®¹å™¨ç­‰å¤æ‚ç±»å‹çš„æ¼‚äº®æ‰“å°ï¼Œä¾¿äºè°ƒè¯•ã€‚
        
    - ä½ ä¹Ÿå¯ä»¥æ·»åŠ è‡ªå·±çš„ GDB åˆå§‹åŒ–å‘½ä»¤ã€‚
        

---

### ğŸ›‘ 3. `stopAtEntry`

```json
"stopAtEntry": true
```

- **ä½œç”¨**ï¼šæ˜¯å¦åœ¨ç¨‹åºçš„å…¥å£ç‚¹ï¼ˆå¦‚ `main()`ï¼‰æš‚åœæ‰§è¡Œï¼Œç­‰å¾…ä½ æ‰‹åŠ¨ç»§ç»­ã€‚
    
- **ç”¨é€”**ï¼š
    
    - è®¾ç½®ä¸º `true` å¯ä»¥è®©ä½ åœ¨ç¨‹åºåˆšå¯åŠ¨æ—¶å°±è¿›è¡Œæ–­ç‚¹è®¾ç½®ã€æ£€æŸ¥å˜é‡ç­‰ã€‚
        
    - è®¾ç½®ä¸º `false` ç¨‹åºä¼šç›´æ¥è¿è¡Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªæ–­ç‚¹ã€‚
        

---

### ğŸ–¥ï¸ 4. `externalConsole`

```json
"externalConsole": true
```

- **ä½œç”¨**ï¼šæ˜¯å¦åœ¨ä¸€ä¸ªå¤–éƒ¨ç»ˆç«¯çª—å£ä¸­è¿è¡Œä½ çš„ç¨‹åºã€‚
    
- **ç”¨é€”**ï¼š
    
    - `true`ï¼šä¼šå¼¹å‡ºä¸€ä¸ªç‹¬ç«‹çš„ç»ˆç«¯çª—å£è¿è¡Œç¨‹åºï¼Œé€‚åˆéœ€è¦ç”¨æˆ·è¾“å…¥æˆ–ç‰¹æ®Šç»ˆç«¯äº¤äº’çš„ç¨‹åºã€‚
        
    - `false`ï¼šç¨‹åºåœ¨ VS Code çš„é›†æˆç»ˆç«¯ä¸­è¿è¡Œï¼ˆæˆ–å®Œå…¨æ— ç»ˆç«¯ï¼Œä»…åœ¨è°ƒè¯•å™¨æ§åˆ¶ä¸‹è¿è¡Œï¼‰ã€‚
        

---

### æ€»ç»“ï¼ˆç®€å•è¡¨æ ¼ï¼‰

|å­—æ®µ|ä½œç”¨|
|---|---|
|`environment`|è®¾ç½®è°ƒè¯•è¿›ç¨‹çš„ç¯å¢ƒå˜é‡|
|`setupCommands`|å¯åŠ¨è°ƒè¯•å™¨åæ‰§è¡Œçš„ GDB å‘½ä»¤ï¼ˆå¦‚ STL æ‰“å°ï¼‰|
|`stopAtEntry`|æ˜¯å¦åœ¨ç¨‹åºå…¥å£å¤„æš‚åœï¼ˆå¦‚ `main()`ï¼‰|
|`externalConsole`|æ˜¯å¦ä½¿ç”¨å¤–éƒ¨ç»ˆç«¯è¿è¡Œç¨‹åºï¼ˆé€šå¸¸ç”¨äºéœ€è¦æ§åˆ¶å°è¾“å…¥çš„ç¨‹åºï¼‰|

å¦‚æœä½ åœ¨è°ƒè¯•ä¸€ä¸ª C++ ç¨‹åºï¼Œå¹¶ä¸”ç¨‹åºéœ€è¦è¾“å…¥å‚æ•°ã€ä¾èµ–ç¯å¢ƒå˜é‡ï¼Œæˆ–è€…ä½ å¸Œæœ›ä¸€å¯åŠ¨å°±æ‰“æ–­ç‚¹ï¼Œè¿™äº›é…ç½®é¡¹å°±éå¸¸æœ‰ç”¨äº†ã€‚éœ€è¦æˆ‘æ ¹æ®ä½ çš„é¡¹ç›®ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ `launch.json` ç¤ºä¾‹å—ï¼Ÿ

## å½“ä½¿ç”¨vs code sshè¿œç¨‹ubuntuåŒæ—¶è°ƒè¯•2ä¸ªç¨‹åºæ—¶ï¼Œç”±äºæ¥å›åˆ‡ï¼Œéå¸¸ä¸æ–¹ä¾¿ï¼Œæœ‰æ²¡æœ‰åŠæ³•åˆ†å¼€è°ƒè¯•ï¼Œå„è‡ªæ˜¾ç¤ºå„è‡ªçš„è°ƒç”¨å †æ ˆã€æ–­ç‚¹ç±»å‹
ä½ çš„è¿™ä¸ªéœ€æ±‚ **å®Œå…¨åˆç†**ï¼Œä½†åœ¨ VS Code ä¸­è¦æƒ³å®ç°â€œ**ä¸¤ä¸ªå®ä¾‹åŒæ—¶è°ƒè¯•åŒä¸€é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„ä¸¤ä¸ªå­ç¨‹åºï¼ˆå¦‚ client å’Œ serverï¼‰**â€ï¼Œç¡®å®éœ€è¦ä¸€ç‚¹æŠ€å·§ï¼Œå› ä¸ºï¼š

> **VS Code é»˜è®¤ä¸å…è®¸ä¸¤ä¸ªçª—å£åŒæ—¶æ‰“å¼€åŒä¸€ä¸ªå·¥ä½œåŒºï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰**ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ä¸¤ä¸ª **ä¸åŒçš„å­æ–‡ä»¶å¤¹** åˆ†åˆ«è°ƒè¯• client å’Œ server

å³ä½¿å®ƒä»¬å±äºä¸€ä¸ªé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥è¿™æ ·å¤„ç†ï¼š

### ğŸ”§ æ–¹æ³•ä¸€ï¼šä½¿ç”¨ä¸¤ä¸ªå­æ–‡ä»¶å¤¹ä½œä¸ºä¸åŒçš„ VS Code å®ä¾‹æ ¹ç›®å½•

å‡è®¾ä½ çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
MyProject/
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ main.cpp
â”‚   â””â”€â”€ .vscode/launch.json
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ main.cpp
â”‚   â””â”€â”€ .vscode/launch.json
â”œâ”€â”€ CMakeLists.txt
```

### æ­¥éª¤ï¼š

#### 1ï¸âƒ£ å¯åŠ¨ VS Code å®ä¾‹ä¸€

- æ‰“å¼€ `MyProject/client/` ä½œä¸º **å·¥ä½œåŒºæ ¹ç›®å½•**ã€‚
    
- è°ƒè¯• `client` ç¨‹åºã€‚
    

#### 2ï¸âƒ£ å¯åŠ¨ VS Code å®ä¾‹äºŒ

- æ‰“å¼€ `MyProject/server/` ä½œä¸º **å·¥ä½œåŒºæ ¹ç›®å½•**ã€‚
    
- è°ƒè¯• `server` ç¨‹åºã€‚
    

> ğŸŸ¡ æ³¨æ„ï¼šæ­¤æ—¶è¿™ä¸¤ä¸ª VS Code çª—å£è™½ç„¶æ¥è‡ªåŒä¸€ä¸ªå¤§é¡¹ç›®ï¼Œä½†ç”±äºå®ƒä»¬çš„æ ¹ç›®å½•ä¸åŒï¼Œ**VS Code å…è®¸å®ƒä»¬å¹¶è¡Œè¿è¡Œã€ç‹¬ç«‹è°ƒè¯•**ã€‚

---

### ğŸ”§ æ–¹æ³•äºŒï¼šä½¿ç”¨å¤šæ ¹å·¥ä½œåŒºï¼ˆMulti-root Workspaceï¼‰

å¦‚æœä½ å¸Œæœ›ç»Ÿä¸€ç®¡ç†ï¼Œå¯ä»¥å°† `client/` å’Œ `server/` æ·»åŠ ä¸ºå¤šæ ¹é¡¹ç›®ï¼š

1. æ‰“å¼€ä¸€ä¸ªç©ºç™½ VS Codeã€‚
    
2. ä½¿ç”¨â€œFileâ€ > â€œAdd Folder to Workspaceâ€ï¼Œåˆ†åˆ«æ·»åŠ  `client/` å’Œ `server/` æ–‡ä»¶å¤¹ã€‚
    
3. ä¿å­˜å·¥ä½œåŒºï¼ˆç”Ÿæˆ `.code-workspace` æ–‡ä»¶ï¼‰ã€‚
    
4. åœ¨ `client/.vscode/launch.json` å’Œ `server/.vscode/launch.json` å„è‡ªå†™å¥½è°ƒè¯•é…ç½®ã€‚
    
5. åœ¨ VS Code å·¦ä¸‹è§’çš„ã€Œè°ƒè¯•é…ç½®ä¸‹æ‹‰æ¡†ã€ä¸­é€‰æ‹©ä¸åŒçš„é…ç½®è¿è¡Œè°ƒè¯•ã€‚
    

âš ï¸ ä½†**å¤šæ ¹å·¥ä½œåŒºä»ç„¶æ˜¯ä¸€ä¸ª VS Code å®ä¾‹**ï¼Œæ— æ³•åšåˆ°ä¸¤ä¸ªè°ƒè¯•å™¨ç•Œé¢åˆ†å¼€æ˜¾ç¤ºå˜é‡ã€å †æ ˆï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èç”¨â€œä¸¤ä¸ª VS Code å®ä¾‹â€çš„æ–¹æ³•æ¥åŒæ—¶è°ƒè¯•ã€‚

---

## âœ… æ€»ç»“

|æ–¹æ³•|å¯è¡Œæ€§|æ˜¯å¦å¯ç‹¬ç«‹è°ƒè¯•çª—å£|æ¨èç¨‹åº¦|
|---|---|---|---|
|åŒä¸€ä¸ªæ ¹ç›®å½•å¼€ä¸¤ä¸ª VS Code å®ä¾‹|âŒ ä¸å…è®¸|âŒ|ğŸš« ä¸æ¨è|
|åˆ†åˆ«æ‰“å¼€ client/ å’Œ server/ ç›®å½•|âœ… æ”¯æŒ|âœ… ç‹¬ç«‹è°ƒè¯•çª—å£|âœ… å¼ºçƒˆæ¨è|
|å¤šæ ¹å·¥ä½œåŒº `.code-workspace`|âœ… æ”¯æŒ|âŒ å…±äº«è°ƒè¯•é¢æ¿|âš ï¸ ä»…æ¬¡ä¹‹é€‰|

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸ºä½ ç”Ÿæˆ client å’Œ server çš„ `launch.json` é…ç½®ï¼Œåªéœ€è¦å‘Šè¯‰æˆ‘å„è‡ªçš„æ„å»ºäº§ç‰©è·¯å¾„ï¼ˆå³å¯æ‰§è¡Œæ–‡ä»¶åœ¨å“ªï¼‰ã€‚


## ä½¿ç”¨vs 2022 sshè¿œç¨‹è°ƒè¯•ubuntuä¸Šçš„æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨æŠŠæœ¬åœ°çš„æ–‡ä»¶æ‹·è´åˆ°ubuntuï¼Œå‡å¦‚ubuntuä¸Šä¿®æ”¹äº†è¯¥æ–‡ä»¶ï¼Œæœ¬åœ°å¦‚ä½•ä¸ubuntuåŒæ­¥å‘¢
è¿™æ˜¯ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ï¼Œä¸‹é¢æˆ‘æ¥è¯¦ç»†è§£é‡Šï¼š

---

## ğŸ§  èƒŒæ™¯ç†è§£ï¼šVS2022 çš„è¿œç¨‹ SSH å¼€å‘æ¨¡å¼

å½“ä½ ä½¿ç”¨ **Visual Studio 2022 çš„è¿œç¨‹ SSH å¼€å‘åŠŸèƒ½**ï¼ˆä½¿ç”¨ Linux development with C++ å·¥å…·é›†ï¼‰æ—¶ï¼Œå®ƒçš„å…¸å‹è¡Œä¸ºåŒ…æ‹¬ï¼š

- ä¼š**è‡ªåŠ¨å°†æœ¬åœ°æºæ–‡ä»¶åŒæ­¥**åˆ° Ubuntu ä¸Šçš„è¿œç¨‹ç¼“å­˜è·¯å¾„ï¼ˆå¦‚ `/home/username/.vs/<project>`ï¼‰ã€‚
    
- æ‰€æœ‰çš„ç¼–è¯‘å’Œè°ƒè¯•å·¥ä½œéƒ½åœ¨è¿œç¨‹æœºå™¨ä¸Šè¿›è¡Œã€‚
    
- æœ¬åœ°æ˜¯â€œæºæ–‡ä»¶ä¸»ç‰ˆæœ¬â€ï¼ŒUbuntu æ˜¯â€œå¤åˆ¶ç‰ˆâ€ã€‚
    

---

## â“ä½ çš„é—®é¢˜ï¼šå¦‚æœæˆ‘åœ¨ Ubuntu ä¸Šæ”¹äº†ä»£ç ï¼Œæœ¬åœ°ä¼šåŒæ­¥å›æ¥å—ï¼Ÿ

### âŒ é»˜è®¤ **ä¸ä¼šåŒæ­¥å›æ¥**ï¼

è¿™æ˜¯ VS2022 çš„**å•å‘åŒæ­¥**ç­–ç•¥ï¼š

- å®ƒè®¤ä¸º**å¼€å‘å’Œä»£ç ä¿®æ”¹**åº”è¯¥**åªåœ¨æœ¬åœ°è¿›è¡Œ**ã€‚
    
- å¦‚æœä½ åœ¨è¿œç¨‹æœºå™¨ï¼ˆUbuntuï¼‰ç›´æ¥ä¿®æ”¹äº†æºç ï¼Œæœ¬åœ°æ˜¯**ä¸ä¼šæ„ŸçŸ¥åˆ°çš„**ï¼Œä¹Ÿ**ä¸ä¼šè‡ªåŠ¨æ›´æ–°**ã€‚
    

---

## âœ… å¦‚ä½•è®©ä¿®æ”¹åŒæ­¥å›æ¥ï¼Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼š

### ğŸ”§ æ–¹æ³• 1ï¼š**æ‰‹åŠ¨å¤åˆ¶å›æœ¬åœ°**

å¦‚æœä½ ä¿®æ”¹äº†è¿œç¨‹æ–‡ä»¶ï¼Œä½ å¯ä»¥æ‰‹åŠ¨å°†æ–‡ä»¶ä» Ubuntu æ‹·è´å›æ¥ï¼š

- ä½¿ç”¨ VS2022 ä¸­çš„ã€Œè¿æ¥è¿œç¨‹ç³»ç»Ÿã€åŠŸèƒ½ï¼ˆSSH æ–‡ä»¶æµè§ˆå™¨ï¼‰ã€‚
    
- æˆ–è€…ç”¨ `scp` / `rsync` / SFTP å·¥å…·ä» Ubuntu æŠŠæ–‡ä»¶åŒæ­¥å›æ¥ã€‚
    

ä¾‹å¦‚ä½¿ç”¨ `scp` å‘½ä»¤ï¼š

```bash
scp user@ubuntu:/home/user/.vs/<project>/source/file.cpp C:\YourProject\source\
```

---

### ğŸ”§ æ–¹æ³• 2ï¼š**ç”¨ VS Code / SSH ç›´æ¥å¼€å‘è¿œç¨‹ä»£ç **

å¦‚æœä½ æ›´å€¾å‘äºåœ¨è¿œç¨‹ä¿®æ”¹ä»£ç ï¼Œè€Œä¸æ˜¯æœ¬åœ°ç»´æŠ¤æºæ–‡ä»¶ï¼Œå»ºè®®ä½ ï¼š

- ç”¨ **VS Code + Remote SSH** æ’ä»¶ç›´æ¥æ‰“å¼€å¹¶ä¿®æ”¹è¿œç¨‹ Ubuntu ä¸Šçš„ä»£ç ã€‚
    
- æˆ–è€…ä½¿ç”¨ Gitï¼Œåœ¨ Ubuntu å’Œæœ¬åœ°ä¹‹é—´é€šè¿‡ Git è¿›è¡Œä»£ç åŒæ­¥ã€‚
    

---

## âœ… æ¨èåšæ³•

|åœºæ™¯|å»ºè®®|
|---|---|
|ä½ ä¸»è¦åœ¨æœ¬åœ°å†™ä»£ç ï¼Œåªè¿œç¨‹è°ƒè¯•|âœ… ä¿æŒ VS2022 é»˜è®¤è®¾ç½®ï¼Œä¸è¦åœ¨è¿œç¨‹ä¿®æ”¹ä»£ç |
|ä½ éœ€è¦è¿œç¨‹ä¹Ÿèƒ½ä¿®æ”¹ä»£ç |âœ… æ”¹ç”¨ VS Code + SSHï¼Œæˆ–è€…é… Git æ¥ç®¡ç†ç‰ˆæœ¬åŒæ­¥|

---

## ğŸš« ä¸æ¨è

- ä¸è¦ä¸€è¾¹ç”¨ VS2022 åŒæ­¥æœ¬åœ°ä»£ç ï¼Œä¸€è¾¹æ‰‹åŠ¨åœ¨ Ubuntu ä¸Šä¿®æ”¹ä»£ç ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°ä¸åŒæ­¥ã€å†²çªæˆ–æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚
    

---

å¦‚æœä½ æœ‰å¤šä¸ªæ–‡ä»¶éœ€è¦åŒæ­¥å›æœ¬åœ°ï¼Œæˆ‘å¯ä»¥ç»™ä½ å†™ä¸€æ®µ `rsync` æˆ– `scp` è„šæœ¬ï¼Œå¸®åŠ©ä½ ä» Ubuntu æŠŠæ”¹åŠ¨å†…å®¹ä¸€é”®æ‹‰å›æ¥ã€‚éœ€è¦çš„è¯å¯ä»¥å‘Šè¯‰æˆ‘è·¯å¾„ç»“æ„ã€‚

## å‡å¦‚å› ä¸ºä¸»é”®é‡å¤æ— æ³•æ’å…¥mysqlæ•°æ®åº“ï¼Œé‚£ä¹ˆresä¸ºç©ºæˆ–è€…å…¶å®ƒç±»ä¼¼ç»“æœå°±å¥½ï¼Œä¸ºä»€ä¹ˆè¦å´©æºƒå‘¢
ä½ çš„ç–‘é—®éå¸¸åˆç†ï¼ŒæŒ‰å¸¸ç†è®²ï¼š

> å¦‚æœå› ä¸ºä¸»é”®é‡å¤æ’å…¥å¤±è´¥ï¼Œ`res` åº”è¯¥åªæ˜¯ä¸€ä¸ªå¤±è´¥çš„ç»“æœå¯¹è±¡ï¼Œè€Œä¸åº”è¯¥å¯¼è‡´ç¨‹åºå´©æºƒã€‚

ä½†ä½ ç”¨çš„æ˜¯ **MySQL++** åº“ï¼Œè¿™ä¸ªåº“çš„è¡Œä¸ºæ˜¯è¿™æ ·çš„ï¼š

---

## âœ… **MySQL++ åœ¨æ‰§è¡Œ SQL å¤±è´¥æ—¶é»˜è®¤ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯è¿”å›ç©ºå€¼ã€‚**

æ‰€ä»¥å½“ä½ æ‰§è¡Œï¼š

```cpp
auto res = con.query(SQL).execute();
```

å¦‚æœæ‰§è¡Œçš„ `SQL`ï¼ˆæ¯”å¦‚ `INSERT INTO ...`ï¼‰è¿åäº†ä¸»é”®å”¯ä¸€çº¦æŸï¼Œ**ä¸æ˜¯è¿”å›ç©ºçš„ `res`ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸**ï¼ˆä¾‹å¦‚ `mysqlpp::BadQuery` æˆ– `mysqlpp::Exception`ï¼‰ï¼Œå¦‚æœä½ æ²¡ç”¨ `try...catch` åŒ…è£¹ï¼Œç¨‹åºå°±ä¼š**ç›´æ¥å´©æºƒ**ã€‚

---

## ğŸ”¥ ä¸ºä»€ä¹ˆä¸æ˜¯è¿”å›ç©ºï¼Œè€Œæ˜¯å´©ï¼Ÿ

è¿™æ˜¯ MySQL++ çš„è®¾è®¡ç†å¿µï¼š

- é”™è¯¯ä¸æ˜¯æ™®é€šæµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç¨‹åºéœ€è¦ç‰¹åˆ«æ³¨æ„çš„å¼‚å¸¸è¡Œä¸ºã€‚
    
- æ‰€ä»¥å®ƒæŠŠ SQL æ‰§è¡Œå¤±è´¥è§†ä½œä¸€ç§å¼‚å¸¸ï¼Œä¸è®©ä½ ã€Œæ— æ„ŸçŸ¥åœ°ã€ç»§ç»­è®¿é—®ç»“æœï¼ˆåƒ `.info()`ã€`.rows()`ï¼‰ï¼Œé¿å…ä½ é”™è¯¯ä½¿ç”¨æœªåˆå§‹åŒ–çš„å¯¹è±¡ã€‚
    

---

## âœ… æ­£ç¡®å†™æ³•ï¼ˆé˜²æ­¢å´©æºƒï¼‰

ä½ å¿…é¡»æ˜¾å¼ç”¨ try-catch æ•æ‰å¼‚å¸¸ï¼Œæ¯”å¦‚ï¼š

```cpp
try {
    mysqlpp::Query query = con.query(SQL);
    auto res = query.execute();

    if (res) {
        return true;
    } else {
        std::cerr << "Query failed: " << query.error() << std::endl;
        return false;
    }
}
catch (const mysqlpp::BadQuery& e) {
    std::cerr << "SQL Error: " << e.what() << std::endl;
    return false;
}
catch (const mysqlpp::Exception& e) {
    std::cerr << "MySQL++ Error: " << e.what() << std::endl;
    return false;
}
```

---

## ğŸš« é”™è¯¯ç¤ºä¾‹ï¼ˆæœªåŠ  try-catchï¼‰

```cpp
auto res = con.query(SQL).execute();
if (res) { ... }
else {
    std::cout << res.info() << std::endl;  // âš ï¸ å¦‚æœå‰é¢å·²ç»æŠ›å¼‚å¸¸ï¼Œè¿™è¡Œæ ¹æœ¬ä¸ä¼šè¢«æ‰§è¡Œï¼Œç¨‹åºå´©æºƒåœ¨å‰é¢ã€‚
}
```

---

## ğŸ§  æ€»ç»“

|ç°è±¡|åŸå› |
|---|---|
|ä¸»é”®é‡å¤æ’å…¥å¤±è´¥æ—¶ç¨‹åºå´©æºƒ|`MySQL++` æŠ›å¼‚å¸¸ï¼Œä½ æ²¡æœ‰æ•è·|
|`res` ä¸ºç©ºå¯¼è‡´è®¿é—® info å´©æºƒ|å®é™… `res` ä»æœªæˆåŠŸåˆ›å»ºï¼ˆå› å¼‚å¸¸æŠ›å‡ºï¼‰ï¼Œä½ è®¿é—®äº†æœªå®šä¹‰å¯¹è±¡|
|è§£å†³æ–¹æ³•|ä½¿ç”¨ `try-catch` æ•è· `mysqlpp::Exception` æˆ– `BadQuery`|

å¦‚éœ€æˆ‘å¸®ä½ é‡æ„ä¸€æ®µæ›´å®‰å…¨çš„æ•°æ®åº“æ’å…¥é€»è¾‘ï¼Œä¹Ÿå¯ä»¥è´´å‡ºæ›´å¤šä»£ç åœºæ™¯ã€‚

## m_conditionVariable.wait_for(lock, std::chrono::seconds(5), []() {
		return context->m_loginSuccess.load();
		} wait_for è¿™é‡Œæ˜¯ä¸€å®šä¼šç­‰å¾…5sæ‰ä¼šåˆ¤æ–­æ˜¯å¦loginSuccesså—
		
ä¸æ˜¯çš„ï¼Œ`wait_for` **å¹¶ä¸ä¸€å®šä¼šç­‰å¾…æ»¡ 5 ç§’**ã€‚

---

### ğŸ” ä½ è¿™æ®µä»£ç çš„å«ä¹‰æ˜¯ï¼š

```cpp
m_conditionVariable.wait_for(lock, std::chrono::seconds(5), [&context]() {
    return context->m_loginSuccess.load();
});
```

è¿™ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹ï¼š

1. **ç­‰å¾…è¢«é€šçŸ¥ï¼ˆnotify_one/notify_allï¼‰** æˆ–è€…
    
2. **ç­‰å¾…è¶…æ—¶ï¼ˆæœ€å¤šç­‰ 5 ç§’ï¼‰**ï¼ŒåŒæ—¶
    
3. æ¯æ¬¡è¢«å”¤é†’ï¼ˆåŒ…æ‹¬è™šå‡å”¤é†’ï¼‰éƒ½ä¼šæ‰§è¡Œ `[&context]() { return context->m_loginSuccess.load(); }` åˆ¤æ–­ï¼š
    
    - å¦‚æœè¿”å› `true`ï¼šç«‹å³è¿”å› `true`ï¼Œä¸å†ç­‰å¾…ã€‚
        
    - å¦‚æœè¿”å› `false`ï¼šç»§ç»­ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶æˆ–è¢«å†æ¬¡å”¤é†’ã€‚
        

---

### âœ… æ‰€ä»¥ï¼š

- å¦‚æœ `m_loginSuccess.load()` å¾ˆæ—©å°±å˜ä¸º `true` å¹¶ä¸”ä½ è°ƒç”¨äº† `notify_one()`ï¼Œ**å°±ä¼šç«‹åˆ»å”¤é†’å¹¶è¿”å› `true`**ï¼Œ**ä¸ä¼šç­‰å¾…æ»¡ 5 ç§’**ã€‚
    
- å¦‚æœ 5 ç§’å†…ä¸€ç›´æ²¡æœ‰ `notify_one()` æˆ– `m_loginSuccess` æ²¡æœ‰å˜æˆ `true`ï¼Œ**æ‰ä¼šç­‰æ»¡ 5 ç§’**ï¼Œç„¶åè¶…æ—¶è¿”å› `false`ã€‚
    

---

### ğŸ” ç¤ºä¾‹åœºæ™¯

å‡è®¾ä½ åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼š

```cpp
context->m_loginSuccess.store(true);
m_conditionVariable.notify_one();
```

é‚£ä¹ˆ `wait_for` **å°±ä¼šç«‹å³è¢«å”¤é†’**ï¼Œåˆ¤æ–­ lambda è¿”å› `true`ï¼Œä»è€Œæå‰ç»“æŸç­‰å¾…ã€‚

---

### ğŸ§  æ€»ç»“

|æ¡ä»¶|æ˜¯å¦æå‰ç»“æŸç­‰å¾…|
|---|---|
|`m_loginSuccess.load()` åœ¨ç­‰å¾…ä¸­å˜ä¸º `true` ä¸”è¢« `notify_one()` é€šçŸ¥|âœ… æ˜¯ï¼Œæå‰ç»“æŸç­‰å¾…|
|æ²¡æœ‰ `notify_one()`ï¼Œæˆ–æ¡ä»¶ä¸€ç›´ä¸º `false`|âŒ å¦ï¼Œä¼šç­‰æ»¡ 5 ç§’|

---

å¦‚éœ€è¿›ä¸€æ­¥ç†è§£è¿™ä¸€æœºåˆ¶ï¼Œå¯ä»¥å†å­¦ä¹ ä¸€ä¸‹ **æ¡ä»¶å˜é‡è™šå‡å”¤é†’ï¼ˆspurious wakeupï¼‰** å’Œ **æ¡ä»¶è°“è¯çš„ä½œç”¨**ï¼Œå®ƒä»¬åœ¨å¤šçº¿ç¨‹ä¸­éå¸¸å…³é”®ã€‚éœ€è¦æˆ‘ä¹Ÿå¯ä»¥è¡¥å……è§£é‡Šã€‚


## std::vector<std::string> friendList = m_getFriendList(userid);
	nlohmann::json response;
	response["MsgType"] = ENUM_MSGTYPE::GETFRIENDLIST_ACK;
	response["result"] = true;
	response["friends"] = friendList;é€†åºåˆ—åŒ–æ—¶ï¼Œå¯ä»¥è¿™æ ·å—	nlohmann::json object = nlohmann::json::parse(buf);

	LOG_INFO << "Friend List: " << object["friends"].dump();
	æ˜¯çš„ï¼Œä½ çš„ä»£ç æ•´ä½“é€»è¾‘ **æ˜¯æ­£ç¡®çš„**ï¼Œ`nlohmann::json` å®Œå…¨æ”¯æŒ `std::vector<std::string>` çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚

---

## âœ… æ­£ç¡®çš„åºåˆ—åŒ–

ä½ è¿™æ®µä»£ç ï¼š

```cpp
std::vector<std::string> friendList = m_getFriendList(userid);
nlohmann::json response;
response["MsgType"] = ENUM_MSGTYPE::GETFRIENDLIST_ACK;
response["result"] = true;
response["friends"] = friendList;
```

è¿™ä¼šè‡ªåŠ¨å°† `friendList` åºåˆ—åŒ–ä¸º JSON æ•°ç»„ï¼Œä¾‹å¦‚ï¼š

```json
{
  "MsgType": 1001,
  "result": true,
  "friends": ["Alice", "Bob", "Charlie"]
}
```

---

## âœ… æ­£ç¡®çš„ååºåˆ—åŒ–åŠæ—¥å¿—è¾“å‡º

ä½ è¿™æ®µä»£ç ï¼š

```cpp
nlohmann::json object = nlohmann::json::parse(buf);
LOG_INFO << "Friend List: " << object["friends"].dump();
```

å°†è§£æå­—ç¬¦ä¸²ä¸º JSON å¯¹è±¡ï¼Œå¹¶å°† `"friends"` æ•°ç»„éƒ¨åˆ†ä»¥ JSON å­—ç¬¦ä¸²æ ¼å¼è¾“å‡ºåˆ°æ—¥å¿—ï¼Œä¾‹å¦‚ï¼š

```
Friend List: ["Alice","Bob","Charlie"]
```

**è¿™å®Œå…¨æ²¡é—®é¢˜ï¼**

---

## âœ… å¦‚æœä½ éœ€è¦è¿˜åŸæˆ `std::vector<std::string>`

ä½ å¯ä»¥è¿™æ ·å†™ï¼š

```cpp
std::vector<std::string> friendList = object["friends"].get<std::vector<std::string>>();
```

æˆ–è€…

```cpp
std::vector<std::string> friendList;
object["friends"].get_to(friendList);
```

---

## âœ… é”™è¯¯å¤„ç†å»ºè®®ï¼ˆå¯é€‰ï¼‰

ä¸ºäº†é˜²æ­¢æ„å¤–çš„ JSON æ ¼å¼ä¸ç¬¦æˆ–å­—æ®µç¼ºå¤±ï¼Œå»ºè®®åŠ ä¸ŠåŸºæœ¬çš„å¼‚å¸¸å¤„ç†æˆ–åˆ¤æ–­ï¼š

```cpp
if (object.contains("friends") && object["friends"].is_array()) {
    std::vector<std::string> friendList = object["friends"].get<std::vector<std::string>>();
    // ä½¿ç”¨ friendList ...
} else {
    LOG_WARN << "JSON does not contain valid 'friends' field.";
}
```

---

å¦‚æœä½ éœ€è¦è°ƒè¯•æˆ–åˆ†æè¾“å‡ºæ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œä¹Ÿå¯ä»¥ç”¨ `.dump(2)` ç¾åŒ–è¾“å‡ºï¼š

```cpp
LOG_INFO << object.dump(2);  // ç¼©è¿›2ç©ºæ ¼ï¼Œç¾è§‚æ‰“å°æ•´ä¸ª JSON
```

---

âœ… ç»“è®ºï¼šä½ å½“å‰å†™æ³•æ²¡é—®é¢˜ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚å¦‚æœä½ æœ‰è¿›ä¸€æ­¥éœ€æ±‚ï¼Œæ¯”å¦‚åŠ å¯†ä¼ è¾“ã€å­—æ®µå‹ç¼©ã€å…¼å®¹æ—§åè®®ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»™ä½ å»ºè®®ã€‚

## object["friends"].dump();è¿™å¥è¯ä»€ä¹ˆæ„æ€ï¼Œdumpä¸æ˜¯å˜æˆå­—ç¬¦ä¸²çš„æ„æ€å—
æ˜¯çš„ï¼Œä½ ç†è§£å¾—**å®Œå…¨æ­£ç¡®**ï¼

---

## âœ… `object["friends"].dump();` çš„å«ä¹‰ï¼š

è¿™å¥è¯çš„ä½œç”¨æ˜¯ï¼š

> **å°† JSON å­—æ®µ `"friends"` çš„å†…å®¹ä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡º**ï¼Œä¹Ÿå°±æ˜¯æŠŠå®ƒä» JSON å¯¹è±¡å˜æˆä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚

---

## âœ… ä¸¾ä¸ªä¾‹å­ï¼š

å‡è®¾ `object` æ˜¯ä¸‹é¢è¿™ä¸ª JSONï¼š

```json
{
  "MsgType": 1001,
  "result": true,
  "friends": ["Alice", "Bob", "Charlie"]
}
```

é‚£ä¹ˆè¿™å¥ä»£ç ï¼š

```cpp
std::string s = object["friends"].dump();
std::cout << s << std::endl;
```

è¾“å‡ºå°†æ˜¯ï¼š

```
["Alice","Bob","Charlie"]
```

è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ JSON æ ¼å¼çš„æ•°ç»„è¡¨ç¤ºï¼Œä½†å®ƒå·²ç»å˜æˆäº† **`std::string` ç±»å‹**ï¼Œå¯ä»¥ç”¨äºæ—¥å¿—ã€ç½‘ç»œä¼ è¾“ç­‰åœºæ™¯ã€‚

---

## ğŸ§  `.dump()` æ˜¯ä»€ä¹ˆï¼Ÿ

`nlohmann::json::dump()` æ˜¯å°† JSON å¯¹è±¡æˆ–å­å¯¹è±¡ **åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²** çš„å‡½æ•°ï¼š

```cpp
std::string json_string = json_obj.dump();       // ä¸å¸¦ç¼©è¿›
std::string pretty_json = json_obj.dump(2);      // å¸¦ç¼©è¿›æ ¼å¼åŒ–è¾“å‡ºï¼Œ2 è¡¨ç¤ºç¼©è¿›ç©ºæ ¼æ•°
```

ä½ å¯ä»¥å¯¹æ•´ä¸ªå¯¹è±¡æˆ–æŸä¸ªå­—æ®µè°ƒç”¨ `.dump()`ï¼š

```cpp
json.dump();            // æ•´ä½“åºåˆ—åŒ–
json["friends"].dump(); // åªåºåˆ—åŒ– "friends" å­—æ®µ
```

---

## ğŸ” å’Œ `.get<std::vector<std::string>>()` çš„åŒºåˆ«

|è¡¨è¾¾å¼|ä½œç”¨|è¿”å›ç±»å‹|
|---|---|---|
|`object["friends"].dump()`|åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²|`std::string`|
|`object["friends"].get<std::vector<std::string>>()`|ååºåˆ—åŒ–ä¸º vector|`std::vector<std::string>`|

---

## âœ… æ€»ç»“

- `dump()` æ˜¯æŠŠ JSON æ•°æ®**å˜æˆå­—ç¬¦ä¸²**ï¼›
    
- å¯ä»¥ç”¨äº**æ—¥å¿—è¾“å‡ºã€è°ƒè¯•æ‰“å°ã€ç½‘ç»œä¼ è¾“**ç­‰åœºæ™¯ï¼›
    
- å¦‚æœä½ éœ€è¦â€œç”¨â€è¿™äº›æ•°æ®ï¼ˆæ¯”å¦‚æ“ä½œ vectorï¼‰ï¼Œç”¨ `.get<>()`ï¼›
    
- å¦‚æœä½ åªæ˜¯â€œçœ‹â€è¿™äº›æ•°æ®ï¼ˆæ¯”å¦‚å†™æ—¥å¿—ï¼‰ï¼Œç”¨ `.dump()`ã€‚
    

---

å¦‚ä½ éœ€è¦æŠŠè¿™ä¸ªå­—ç¬¦ä¸²å‘ç»™å‰ç«¯ã€å†™å…¥æ—¥å¿—ã€ä¿å­˜åˆ°æ–‡ä»¶ï¼Œéƒ½å¯ä»¥ç›´æ¥ç”¨ `.dump()` çš„ç»“æœã€‚å¦‚æœä½ å¯¹ dump åçš„æ•°æ®æ ¼å¼è¦æ±‚ï¼ˆå¦‚æ¢è¡Œã€ç¾åŒ–ï¼‰æœ‰éœ€è¦ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¸®ä½ è°ƒæ ¼å¼ã€‚

## å¦‚æœstd::string a; std::cin>>a; è¾“å…¥çš„æ˜¯â€œAn anple a dayâ€è¿™ç§æƒ…å†µä¸‹ï¼Œaä¸­çš„å†…å®¹æ˜¯Anè¿˜æ˜¯æ•´å¥è¯
åœ¨è¿™æ®µä»£ç ä¸­ï¼š

```cpp
std::string a;
std::cin >> a;
```

å¦‚æœä½ è¾“å…¥ï¼š

```
An apple a dayâ†µ
```

é‚£ä¹ˆ `a` çš„å†…å®¹æ˜¯ï¼š`"An"`

---

## âœ… åŸå› æ˜¯ï¼š

- `std::cin >> a;` è¯»å–çš„æ˜¯ **ä¸€ä¸ªå•è¯**ï¼ˆå³ï¼šä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ç›´åˆ°é‡åˆ°**ç©ºç™½å­—ç¬¦**ä¸ºæ­¢ï¼‰ï¼›
    
- ç©ºç™½å­—ç¬¦åŒ…æ‹¬ï¼šç©ºæ ¼ (`' '`)ã€åˆ¶è¡¨ç¬¦ï¼ˆTabï¼‰å’Œæ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰ï¼›
    
- æ‰€ä»¥å®ƒ**åªè¯»å–ç¬¬ä¸€ä¸ªå•è¯** `"An"`ï¼Œç„¶ååœæ­¢ï¼ŒæŠŠå‰©ä¸‹çš„ `"apple a day\n"` ç•™åœ¨è¾“å…¥ç¼“å†²åŒºé‡Œã€‚
    

---

## âœ… å¦‚æœä½ æƒ³è¯»å–æ•´è¡Œï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰ï¼š

ä½ åº”è¯¥ä½¿ç”¨ï¼š

```cpp
std::string a;
std::getline(std::cin, a);
```

è¿™æ ·ï¼Œ`a` å°±ä¼šå˜æˆï¼š

```cpp
"An apple a day"
```

åŒ…æ‹¬æ‰€æœ‰ç©ºæ ¼ï¼Œç›´åˆ°ç”¨æˆ·æŒ‰ä¸‹å›è½¦ï¼ˆ`\n`ï¼‰ä¸ºæ­¢ã€‚

---

## âœ… æ€»ç»“å¯¹æ¯”ï¼š

|è¯»å–æ–¹å¼|ç¤ºä¾‹è¾“å…¥|ç»“æœ|
|---|---|---|
|`std::cin >> a;`|`An apple a day`|`a = "An"`|
|`std::getline()`|`An apple a day`|`a = "An apple a day"`|

---

å¦‚ä½ éœ€è¦é€ä¸ªè¯»å–å•è¯ï¼Œä¹Ÿå¯ä»¥ç”¨å¾ªç¯é…åˆ `std::cin >> word`ï¼›éœ€è¦è¯»å–æ•´å¥å°±ç”¨ `std::getline()`ã€‚ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„åº”ç”¨åœºæ™¯ï¼Œæˆ‘å¯ä»¥æ¨èæœ€ä½³æ–¹æ¡ˆã€‚
## navicat datetimeç±»å‹ï¼ŒOn Update Current_Timestampæ˜¯ä»€ä¹ˆæ„æ€
åœ¨ Navicat æˆ– MySQL ä¸­ï¼Œ`DATETIME` ç±»å‹çš„å­—æ®µå¦‚æœè®¾ç½®äº†ï¼š

```sql
ON UPDATE CURRENT_TIMESTAMP
```

å®ƒçš„æ„æ€æ˜¯ï¼š**æ¯å½“è¯¥è¡Œæ•°æ®è¢«æ›´æ–°ï¼ˆæ‰§è¡Œ `UPDATE` è¯­å¥ï¼‰æ—¶ï¼Œè¿™ä¸ªå­—æ®µçš„å€¼ä¼šè‡ªåŠ¨æ›´æ–°ä¸ºå½“å‰æ—¶é—´æˆ³ï¼ˆå³ `NOW()` çš„ç»“æœï¼‰**ã€‚

---

## âœ… ä¸¾ä¸ªä¾‹å­

ä½ å»ºè¡¨æ—¶è¿™æ ·å†™ï¼š

```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100),
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### è¡Œä¸ºå¦‚ä¸‹ï¼š

- **æ’å…¥ä¸€è¡Œæ•°æ®æ—¶**ï¼Œ`update_time` ä¼šè‡ªåŠ¨è®¾ä¸ºå½“å‰æ—¶é—´ï¼›
    
- **ä¹‹åæ¯æ¬¡æ›´æ–°è¿™ä¸€è¡Œæ—¶**ï¼Œ`update_time` ä¼šè‡ªåŠ¨å˜æˆæœ€æ–°çš„å½“å‰æ—¶é—´ã€‚
    

---

## ğŸ•˜ ç¤ºä¾‹æ“ä½œ

```sql
-- æ’å…¥ä¸€æ¡æ•°æ®
INSERT INTO users (name) VALUES ('Alice');

-- ç¨åä¿®æ”¹
UPDATE users SET name = 'Alice Zhang' WHERE id = 1;
```

æ‰§è¡Œå®Œåï¼Œ`update_time` ä¼šè‡ªåŠ¨æ›´æ–°ä¸ºä½ æ‰§è¡Œ `UPDATE` æ—¶çš„æ—¶é—´ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

- ä½ åªèƒ½ä¸ºä¸€ä¸ª `TIMESTAMP` æˆ– `DATETIME` å­—æ®µè®¾ç½® `ON UPDATE CURRENT_TIMESTAMP`ï¼›
    
- å¦‚æœæƒ³è¦å¤šä¸ªå­—æ®µéƒ½æœ‰æ­¤è¡Œä¸ºï¼Œè¦ç”¨è§¦å‘å™¨ï¼ˆtriggerï¼‰å¤„ç†ï¼›
    
- è‹¥ä½ åªå¸Œæœ›åˆå§‹æ’å…¥ä½¿ç”¨ `CURRENT_TIMESTAMP`ï¼Œè€Œæ›´æ–°æ—¶ä¸å˜ï¼Œåˆ™ä¸è¦åŠ  `ON UPDATE` éƒ¨åˆ†ï¼š
    
    ```sql
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP
    ```
    

---

## ğŸ§  åº”ç”¨åœºæ™¯

- `update_time` / `last_modified_time` å­—æ®µï¼›
    
- è‡ªåŠ¨è®°å½•è°æ”¹äº†æ•°æ®ã€ä»€ä¹ˆæ—¶å€™æ”¹çš„ï¼›
    
- ä¹è§‚é”ï¼ˆåˆ¤æ–­æ˜¯å¦ä¸ºæœ€æ–°è®°å½•ï¼‰ç­‰ã€‚
    

---

éœ€è¦æˆ‘ç»™ä½ è¡¥ä¸€ä¸ªåœ¨ Navicat å›¾å½¢ç•Œé¢å¦‚ä½•è®¾ç½®è¿™ä¸ªå­—æ®µçš„æ“ä½œå›¾ç¤ºå—ï¼Ÿ

## æˆ‘æ’å…¥æ•°æ®åº“çš„messageï¼Œæ•°æ®åº“ä¸­çš„messageIdå·ä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œæˆ‘æƒ³ç”¨ç”Ÿæˆçš„è¿™ä¸ªmessageIdå·ä½œä¸ºæ–°çš„å­—æ®µå»å…³è”ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚ä½•æ“ä½œ
è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„â€œæ’å…¥åè·å–ä¸»é”®â€çš„éœ€æ±‚ã€‚ä½ å¸Œæœ›åœ¨å°†ä¸€æ¡æ¶ˆæ¯æ’å…¥ `messages` è¡¨åï¼Œè·å–æ•°æ®åº“ä¸ºå…¶è‡ªåŠ¨ç”Ÿæˆçš„ `messageId`ï¼ˆè‡ªå¢ä¸»é”®ï¼‰ï¼Œç„¶åç”¨è¿™ä¸ª ID å»æ’å…¥åˆ°å…¶ä»–å…³è”è¡¨ä¸­ï¼ˆä¾‹å¦‚ç”¨æˆ·æ”¶åˆ°çš„æ¶ˆæ¯åˆ—è¡¨ï¼‰ã€‚è¿™ç§æ“ä½œå¯ä»¥**åŸå­åŒ–åœ°å®Œæˆ**ã€‚

ä¸‹é¢æˆ‘ä¼šåŸºäºä½ ç”¨çš„æ˜¯ `MySQL` å’Œ C++ çš„ `mysql++` åº“æ¥ä»‹ç»å¦‚ä½•æ“ä½œï¼š

---

## âœ… ç¤ºä¾‹åœºæ™¯

å‡è®¾ä½ æœ‰ä¸¤ä¸ªè¡¨ï¼š

### æ¶ˆæ¯è¡¨ `messages`ï¼š

```sql
CREATE TABLE messages (
    messageId INT AUTO_INCREMENT PRIMARY KEY,
    content TEXT,
    senderId INT,
    groupId INT,
    timestamp DATETIME
);
```

### ç”¨æˆ·æ¶ˆæ¯å…³è”è¡¨ `userMessages`ï¼š

```sql
CREATE TABLE userMessages (
    userId INT,
    messageId INT,
    isRead BOOLEAN DEFAULT 0
);
```

---

## âœ… æ­¥éª¤ï¼šC++ æ’å…¥ + è·å– `messageId` + æ’å…¥å…³è”è¡¨

### 1. æ’å…¥ `messages` å¹¶è·å–è‡ªå¢ä¸»é”®ï¼š

```cpp
mysqlpp::Query query = conn.query();
query << "INSERT INTO messages (content, senderId, groupId, timestamp) "
         "VALUES (%0q, %1, %2, NOW())";
query.parse();

mysqlpp::SimpleResult res = query.execute(content, senderId, groupId);
if (res) {
    long long messageId = res.insert_id(); // è·å–åˆšæ’å…¥çš„ messageId
    std::cout << "Inserted messageId: " << messageId << std::endl;
}
```

- `insert_id()` æ˜¯ mysqlpp æä¾›çš„å‡½æ•°ï¼Œç”¨äºè·å–è‡ªå¢ä¸»é”®ã€‚
    

---

### 2. ä½¿ç”¨è·å–çš„ `messageId` æ’å…¥å…³è”è¡¨ï¼š

```cpp
for (int userId : userIdList) {
    mysqlpp::Query insertUserMsg = conn.query();
    insertUserMsg << "INSERT INTO userMessages (userId, messageId, isRead) VALUES (%0, %1, 0)";
    insertUserMsg.parse();
    insertUserMsg.execute(userId, messageId);
}
```

---

## âœ… ä¸€å¥è¯æ€»ç»“ï¼š

ä½ å¯ä»¥ç”¨ `mysqlpp::SimpleResult::insert_id()` è·å– `AUTO_INCREMENT` ä¸»é”®ï¼Œç„¶åç”¨äºæ’å…¥å…¶ä»–éœ€è¦å…³è”çš„è¡¨ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹ï¼š

- è¿™ä¸ªæ“ä½œåº”å½“åœ¨ **åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡ä¸Šæ‰§è¡Œ**ï¼›
    
- å¦‚æœä½ åœ¨å¤šçº¿ç¨‹/å¤šè¿æ¥ç¯å¢ƒä¸­ï¼Œæ³¨æ„ä¸è¦æ··ç”¨è¿æ¥ï¼›
    
- è‹¥ä½ è¦æ’å…¥å¤§é‡å…³è”è®°å½•ï¼Œè€ƒè™‘æ‰¹é‡æ’å…¥æ€§èƒ½é—®é¢˜ã€‚
    

---

## âœ… BONUSï¼šå¤šç”¨æˆ·ä¸€æ¬¡æ€§æ’å…¥ï¼ˆæ•ˆç‡ä¼˜åŒ–ï¼‰

```cpp
mysqlpp::Query batchInsert = conn.query();
batchInsert << "INSERT INTO userMessages (userId, messageId, isRead) VALUES ";

for (size_t i = 0; i < userIdList.size(); ++i) {
    batchInsert << "(" << userIdList[i] << ", " << messageId << ", 0)";
    if (i != userIdList.size() - 1)
        batchInsert << ", ";
}

batchInsert.execute();
```

---

å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ ä½¿ç”¨çš„ç”¨æˆ·è¡¨ç»“æ„æˆ–è€…å®é™…ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘å¯ä»¥ç»™ä½ æ›´å®šåˆ¶çš„ SQL å’Œä»£ç é€»è¾‘ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

## mysqlpp:: con; con.query()   query()<<""; query.parse(); query.execute(,,,)è¿™æ®µä»£ç ï¼Œå¦‚ä½•å°è£…æˆå‡½æ•°ï¼Œå¤–éƒ¨ä»…æä¾›å½¢å‚ï¼Œç„¶åå°†æ•°æ®åº“çš„æ“ä½œéšè—æ‰å‘¢
ä½ å¸Œæœ›å°† `mysql++` çš„æ•°æ®åº“æ“ä½œå°è£…èµ·æ¥ï¼Œè®©å¤–éƒ¨åªéœ€è¦ä¼ å…¥å‚æ•°ï¼Œä¸å¿…å…³å¿ƒæ•°æ®åº“è¿æ¥ã€æŸ¥è¯¢æ„é€ ã€æ‰§è¡Œç­‰ç»†èŠ‚ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„å°è£…æ–¹æ¡ˆï¼š

---

## âœ… ç›®æ ‡ï¼š

> æä¾›ä¸€ä¸ªé€šç”¨å‡½æ•°æ¥å£ï¼Œä¾‹å¦‚ï¼š

```cpp
User getUserById(int id);
```

å†…éƒ¨è‡ªåŠ¨å®Œæˆæ•°æ®åº“è¿æ¥ã€SQL æ„é€ ã€æ‰§è¡Œã€ç»“æœè§£æã€‚

---

## âœ… å°è£…ç¤ºä¾‹ï¼ˆä»¥æŸ¥è¯¢ç”¨æˆ·ä¸ºä¾‹ï¼‰

### 1. æ•°æ®ç»“æ„å®šä¹‰

```cpp
struct User {
    int id;
    std::string name;
    int age;
};
```

---

### 2. å°è£…ç±»æˆ–å‡½æ•°ï¼ˆç®€æ´ç‰ˆï¼‰

```cpp
#include <mysql++/mysql++.h>
#include <iostream>

class DBHelper {
public:
    DBHelper() : conn(false) {
        conn.connect("your_db", "localhost", "user", "password");
    }

    template<typename... Args>
    mysqlpp::StoreQueryResult query(const std::string& sql, Args&&... args) {
        mysqlpp::Query query = conn.query(sql);
        query.parse();  // å¯é€‰
        mysqlpp::StoreQueryResult res = query.store(std::forward<Args>(args)...);
        if (!res) {
            throw std::runtime_error("Query failed: " + query.error());
        }
        return res;
    }

private:
    mysqlpp::Connection conn;
};
```

---

### 3. å¤–éƒ¨ä½¿ç”¨ï¼šä¸šåŠ¡å‡½æ•°å°è£…

```cpp
User getUserById(int id) {
    static DBHelper db;

    std::string sql = "SELECT id, name, age FROM users WHERE id = %0q";
    mysqlpp::StoreQueryResult res = db.query(sql, id);

    if (res.empty()) {
        throw std::runtime_error("User not found");
    }

    const mysqlpp::Row& row = res[0];
    return User{ row["id"], std::string(row["name"]), row["age"] };
}
```

---

## âœ… ä½¿ç”¨ç¤ºä¾‹ï¼š

```cpp
int main() {
    try {
        User u = getUserById(1);
        std::cout << u.name << " (" << u.age << ")\n";
    } catch (const std::exception& ex) {
        std::cerr << "Error: " << ex.what() << '\n';
    }
}
```

---

## âœ… è¯´æ˜

- `DBHelper` å°è£…äº†æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢ã€‚
    
- `db.query()` ç”¨æ¨¡æ¿å‚æ•°è½¬å‘å˜é‡ï¼ˆå˜å‚ï¼‰ã€‚
    
- ä½¿ç”¨ `%0q` æ˜¯ mysqlpp çš„ **å ä½ç¬¦è¯­æ³•**ï¼Œæ”¯æŒè‡ªåŠ¨è½¬ä¹‰ï¼Œé˜²æ­¢ SQL æ³¨å…¥ã€‚--------å°¤ä¸ºé‡è¦ï¼Œç‰¹åˆ«æ˜¯è¾“å…¥å­—ç¬¦ä¸²std::string çš„æ—¶å€™ï¼Œè¿˜å¾—é¢å¤–åŠ ''æ‰èƒ½å‘æ•°æ®åº“è¯´æ˜æ˜¯å­—ç¬¦ä¸²ï¼Œå¦åˆ™mysqlä¼šæŠ¥é”™çš„;
    
- ç”¨æˆ·åªè°ƒç”¨ä¸šåŠ¡å‡½æ•°å¦‚ `getUserById(id)`ï¼Œæ— éœ€æ¥è§¦ SQL æ„é€ ç»†èŠ‚ã€‚
    

---

## âœ… æ‰©å±•å»ºè®®

ä½ ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥å°è£…ï¼š

- æ”¯æŒè¿æ¥æ± ï¼ˆå¤šä¸ªè¿æ¥ï¼‰ï¼›
    
- æ”¯æŒäº‹åŠ¡å¤„ç†ï¼›
    
- å°è£…æˆ `Result<T>` è¿”å›ç»“æœå’Œé”™è¯¯ä¿¡æ¯ï¼›
    
- æ”¯æŒ `insert/update/delete` æ“ä½œã€‚
    

---

å¦‚æœä½ ç»™å‡ºä½ å½“å‰é¡¹ç›®ä¸­çš„å…·ä½“æŸ¥è¯¢åœºæ™¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä¸ªæ›´è´´åˆä½ å®é™…çš„å°è£…ç‰ˆæœ¬ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

## sqlè¯­å¥ä¸­ä½¿ç”¨%1qï¼Œ%2qï¼Œè¿™ç§å½¢å¼ï¼Œæ˜¯ä¸æ˜¯å°±é¿å…äº†å½“å‚æ•°ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œmysqlè¯­å¥å¿…é¡»æ£€æŸ¥''åŒ…è£¹æ‰èƒ½æ­£ç¡®è¯†åˆ«çš„é—®é¢˜
æ˜¯çš„ï¼Œä½ è¯´å¾—å®Œå…¨æ­£ç¡®ï¼

åœ¨ **`mysql++`** ä¸­ï¼ŒSQL è¯­å¥ä¸­ä½¿ç”¨ **`%0q`, `%1q`, `%2q`** è¿™æ ·çš„å ä½ç¬¦ï¼Œç¡®å®æ˜¯ä¸ºäº†è§£å†³ä½ æåˆ°çš„é—®é¢˜ï¼š

---

### âœ… `%nq` æ˜¯ä»€ä¹ˆï¼Ÿ

- `%n`ï¼šæ™®é€šå ä½ç¬¦ï¼ˆä¸å¸¦å¼•å·ï¼‰ï¼Œé€‚ç”¨äºæ•°å­—ç­‰ï¼›
    
- `%nq`ï¼š**quoted å ä½ç¬¦**ï¼Œè‡ªåŠ¨åŠ å¼•å·å¹¶è½¬ä¹‰ï¼Œé€‚ç”¨äºå­—ç¬¦ä¸²ï¼›
    
- `%nQ`ï¼šæ›´å¼ºçš„ quoteï¼ŒåŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ä¹Ÿä¼šè¢« `' '` åŒ…è£¹ã€‚
    

ä¸¾ä¸ªä¾‹å­ï¼š

```cpp
std::string name = "O'Reilly";
int age = 30;

mysqlpp::Query query = conn.query("SELECT * FROM users WHERE name = %0q AND age = %1");
query.parse();
query.store(name, age);
```

- `%0q` ä¼šè‡ªåŠ¨å˜æˆ `'O\'Reilly'`ï¼Œè‡ªåŠ¨æ·»åŠ å¼•å·å¹¶åš SQL è½¬ä¹‰ï¼›
    
- `%1` æ˜¯æ™®é€šæ’å…¥ï¼Œé€‚åˆæ•°å€¼ç±»å‹ï¼Œä¸éœ€è¦åŠ å¼•å·ã€‚
    

---

### âœ… âœ… ä¸ºä»€ä¹ˆå®ƒé‡è¦ï¼Ÿ

- é¿å…æ‰‹åŠ¨æ‹¼æ¥å­—ç¬¦ä¸²å¯¼è‡´çš„ **SQL æ³¨å…¥é£é™©**ï¼›
    
- å…å»å¼€å‘è€…åˆ¤æ–­æ˜¯å¦åŠ å•å¼•å·çš„éº»çƒ¦ï¼›
    
- è‡ªåŠ¨è½¬ä¹‰ï¼Œæ¯”å¦‚ `O'Reilly` ä¼šè½¬ä¹‰æˆ `O\'Reilly`ï¼›
    
- ä¿è¯è·¨ç±»å‹æ•°æ®å®‰å…¨æ‹¼æ¥ã€‚
    

---

### âŒ é”™è¯¯ç”¨æ³•å¯¹æ¯”

ä¸ä½¿ç”¨ `%0q` æ—¶ï¼Œå¼€å‘è€…å¯èƒ½ä¼šè¯¯å†™æˆï¼š

```cpp
query << "SELECT * FROM users WHERE name = '" << name << "'";
```

è¿™æ ·éå¸¸å®¹æ˜“å‡ºé”™ï¼š

- å¿˜äº†åŠ  `'` æŠ¥è¯­æ³•é”™è¯¯ï¼›
    
- æ²¡æœ‰è½¬ä¹‰ `'` ä¼šå¯¼è‡´ SQL ç»“æ„ç ´åï¼›
    
- æ˜“å— SQL æ³¨å…¥æ”»å‡»ã€‚
    

---

### âœ… æ­£ç¡®å†™æ³•æ€»ç»“

|æ•°æ®ç±»å‹|å ä½ç¬¦|ç¤ºä¾‹|
|---|---|---|
|å­—ç¬¦ä¸²|`%nq`|`%0q`, `%1q`|
|æ•°å­—|`%n`|`%0`, `%1`|
|æ‰€æœ‰ç±»å‹|`%nQ`|`%0Q`ï¼ˆç©ºä¹ŸåŠ å¼•å·ï¼‰|

---

å¦‚ä½ æ‰€è¯´ï¼Œç”¨ `%nq` **ç¡®å®è§£å†³äº†â€œå­—ç¬¦ä¸²æ˜¯å¦éœ€è¦å¼•å·â€çš„é—®é¢˜**ï¼Œæ¨èä¸€å¾‹ä½¿ç”¨å®ƒå¤„ç†å­—ç¬¦ä¸²å‚æ•°ã€‚

éœ€è¦æˆ‘æä¾›ä¸€ä¸ªé€šç”¨ SQL æŸ¥è¯¢å°è£…å‡½æ•°æ¨¡æ¿å—ï¼Ÿ
## å¦‚æœæ¯ä¸€ä¸ªå‚æ•°éƒ½å†™æˆ%nqçš„å½¢å¼ï¼Œå¦‚æœè¾“å…¥çš„æ˜¯æ•°å­—ï¼Œä¼šä¸ä¼šå‡ºé”™ä½ 

ä¸ä¼šå‡ºé”™ï¼Œä½†ç»“æœå¯èƒ½**ä¸æ˜¯ä½ æƒ³è¦çš„**ã€‚

---

### âœ… `%nq` çš„ä½œç”¨å›é¡¾ï¼š

- `%nq` æ˜¯ "quoted and escaped" çš„æ„æ€ï¼›
    
- å®ƒä¼šæŠŠå‚æ•°**å½“æˆå­—ç¬¦ä¸²å¤„ç†**ï¼š
    
    - è‡ªåŠ¨åŠ ä¸Šå•å¼•å·ï¼›
        
    - å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œ SQL è½¬ä¹‰ã€‚
        

---

### â“é‚£å¦‚æœæ˜¯æ•°å­—å‘¢ï¼Ÿ

```cpp
int id = 123;
query << "SELECT * FROM users WHERE id = %0q";
query.parse();
query.store(id);
```

#### å®é™…æ‰§è¡Œçš„ SQL æ˜¯ï¼š

```sql
SELECT * FROM users WHERE id = '123'
```

å³ï¼šæ•°å­—è¢«å½“ä½œå­—ç¬¦ä¸²ç”¨äº†ã€‚

---

### â— è¿™åœ¨å¤šæ•°æ•°æ®åº“ä¸­ **æ˜¯ä¸ä¼šæŠ¥é”™çš„**ï¼š

MySQL æ˜¯ **å¼±ç±»å‹æ•°æ®åº“**ï¼Œå®ƒä¼šè‡ªåŠ¨å°† `'123'` è§£æä¸ºæ•´æ•° `123`ï¼Œæ‰€ä»¥ï¼š

- æŸ¥è¯¢æ˜¯**èƒ½æ­£å¸¸å·¥ä½œçš„**ï¼›
    
- ä½†ä»è¯­ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯â€œå­—ç¬¦ä¸²å½¢å¼çš„æ•°å­—â€ï¼›
    
- åœ¨æŸäº›åœºæ™¯ï¼ˆæ¯”å¦‚å¼ºç±»å‹æ¯”è¾ƒã€JOINã€æ€§èƒ½ä¼˜åŒ–ï¼‰ä¸‹ï¼Œ**å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™æˆ–ä¸ä¸€è‡´è¡Œä¸º**ã€‚
    

---

### âœ… æ­£ç¡®åšæ³•ï¼š

|å‚æ•°ç±»å‹|æ¨èå†™æ³•|
|---|---|
|å­—ç¬¦ä¸²|`%nq`|
|æ•°å­—|`%n`|
|æ—¥æœŸç­‰|`%nq`ï¼ˆæ‰‹åŠ¨æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼‰|

---

### âœ… å¦‚æœä½ å®åœ¨æƒ³ç»Ÿä¸€ç”¨ `%nq`ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š

1. **å†™ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œæ ¹æ®ç±»å‹é€‰æ‹©åˆé€‚å ä½ç¬¦**ï¼›
    
2. æˆ–è€…ä½ äº†è§£è‡ªå·±çš„æ•°æ®åœºæ™¯ï¼Œå¹¶ç¡®å®šæ‰€æœ‰å­—æ®µéƒ½èƒ½å®¹å¿è¢«å½“ä½œå­—ç¬¦ä¸²å¤„ç†ï¼Œé‚£ä¹Ÿå¯ä»¥ä½¿ç”¨ `%nq` ç®€åŒ–ä»£ç ï¼Œä½†è¦æ¸…æ¥šæ½œåœ¨å½±å“ã€‚
    

---

### âœ… å»ºè®®æ€»ç»“ï¼š

- å¯¹äºæ•°å­—ï¼Œæ¨èä½¿ç”¨ `%n`ï¼›
    
- å¯¹äºå­—ç¬¦ä¸²ï¼Œå¿…é¡»ä½¿ç”¨ `%nq`ï¼›
    
- MySQL ä¼šå®¹å¿ `'123'` å’Œ `123`ï¼Œä½†ä¸æ˜¯æœ€ä½³å®è·µï¼›
    
- æœ€å¥½ä¸è¦ä¸ºäº†å·æ‡’å…¨ç”¨ `%nq`ï¼Œå°¤å…¶æ˜¯æ¶‰åŠä¸»é”®ã€JOINã€ç´¢å¼•ç­‰åœºæ™¯æ—¶ã€‚
    

---

éœ€è¦æˆ‘ç»™ä½ å†™ä¸€ä¸ªâ€œæ ¹æ®å‚æ•°ç±»å‹è‡ªåŠ¨é€‰æ‹© `%n` æˆ– `%nq`â€çš„å°è£…æ–¹æ¡ˆå—ï¼Ÿ

## å…³äºå¯å˜å‚æ¨¡æ¿å‡½æ•°çš„é‡è½½å½¢å¼
é¦–å…ˆï¼Œæ˜¯å¯ä»¥é‡è½½çš„ï¼Œå› ä¸ºæœ¬è´¨ä¸Šå°±æ˜¯ç”Ÿæˆé€‚åº”ä¸åŒå‚æ•°ç±»å‹çš„å‡½æ•°ï¼Œæ‰€ä»¥é€‚åˆå·æ‡’çš„æƒ…å†µï¼Œèƒ½æ›´å…·ä½“ï¼Œå°±ä¾æ‰˜äºæ›´å…·ä½“çš„ç‰ˆæœ¬å»ç”Ÿæˆã€‚
ä¸‹é¢æ˜¯è‡ªå·±å†™çš„ä¾‹ç¨‹ï¼›
```cpp
class Test {
public:

	template <typename... T>
	bool m_CUD(std::string SQL, int& insertedId, T&&... args) {
		std::cout << "1.m_CUD(std::string SQL, int& insertedId, T&&... args)" << std::endl;
		(std::cout << ... << args) << std::endl;
		return true;
	}

	template <typename... T>
	bool m_CUD(std::string SQL, T&&... args) {
		std::cout << "2.m_CUD(std::string SQL, T&&... args)" << std::endl;
		
		(std::cout << ... << args) << std::endl;

		return true;
	}
};
```
è°ƒç”¨æ–¹å¼
```cpp
cout << "Hello CMake." << endl;
Test test;
int a = 1, b = 2, c = 3, d = 4;
std::string s1 = "Hello", s2 = "World";
test.m_CUD("hhh", a);// This will call the first overload with one argument
test.m_CUD("hhh", a, b, c, d);// This will call the first overload with multiple arguments
test.m_CUD("hhh", s1);// This will call the second overload with one string argument
test.m_CUD("hhh", s1, s2, a, b, c, d);// This will call the second overload with multiple arguments including strings and integers
return 0;
```
æ‰§è¡Œçš„ç»“æœ
```cpp
Hello CMake.
1.m_CUD(std::string SQL, int& insertedId, T&&... args)

1.m_CUD(std::string SQL, int& insertedId, T&&... args)
234
2.m_CUD(std::string SQL, T&&... args)
Hello
2.m_CUD(std::string SQL, T&&... args)
HelloWorld1234
```
## Â  Â  std::string SQL = "SELECT friendid FROM friends WHERE userid = %0 UNION SELECT userid FROM friends WHERE friendid = %1;";
æ³¨æ„ï¼Œmysqlppä½¿ç”¨æ—¶ï¼Œ%nä¸å¯ä»¥é‡å¤å‡ºç°çš„ï¼Œå‡å¦‚ä¸¤ä¸ªä½ç½®éƒ½æ˜¯%0ï¼Œä¼šæŠ¥é”™çš„
## å½“ä¸»çº¿ç¨‹å¤„ç†signalï¼Œå¹¶æœ€åè°ƒç”¨äº†exitï¼Œä¼šæ‰§è¡Œææ„å‡½æ•°å—
**ä¸ä¼šï¼Œ`exit()` è°ƒç”¨ä¸ä¼šæ‰§è¡Œå±€éƒ¨å¯¹è±¡çš„ææ„å‡½æ•°ã€‚**

---

## âœ… åŸå› è¯´æ˜

å½“ä½ åœ¨ **ä¸»çº¿ç¨‹çš„ signal handler ä¸­è°ƒç”¨ `exit()`**ï¼Œå®ƒçš„è¡Œä¸ºå¦‚ä¸‹ï¼š

### `exit()` åšäº†ä»€ä¹ˆï¼š

- å®ƒä¼šï¼š
    
    - è°ƒç”¨æ‰€æœ‰ **æ³¨å†Œè¿‡çš„ `atexit()` å‡½æ•°**
        
    - åˆ·æ–°è¾“å‡ºç¼“å†²åŒº
        
    - å…³é—­æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦
        
    - **ç»ˆæ­¢æ•´ä¸ªè¿›ç¨‹**
        
- ä½†å®ƒ**ä¸ä¼šè§¦å‘ C++ å±€éƒ¨å¯¹è±¡æˆ–æ ˆå¯¹è±¡çš„ææ„å‡½æ•°**
    

---

## âŒ æ‰€ä»¥è¿™æ„å‘³ç€ï¼š

ä»¥ä¸‹ä»£ç ä¸­ï¼Œ`MyClass` çš„ææ„å‡½æ•° **ä¸ä¼šè¢«è°ƒç”¨**ï¼š

```cpp
class MyClass {
public:
    ~MyClass() { std::cout << "Destructor called\n"; }
};

void signalHandler(int) {
    std::cout << "Signal received\n";
    exit(0);  // âŒ ä¸ä¼šè§¦å‘ MyClass çš„ææ„
}

int main() {
    signal(SIGINT, signalHandler);
    MyClass obj;
    while (true);  // ç­‰å¾… Ctrl+C
}
```

---

## âœ… å¦‚ä½•æ­£ç¡®è§¦å‘ææ„å‡½æ•°ï¼Ÿ

### æ–¹æ³•ä¸€ï¼š**è®©ä¸»çº¿ç¨‹è‡ªç„¶ return æˆ–è°ƒç”¨ `std::exit()` åé€šè¿‡ RAII æ¸…ç†**

`return` ä¼šè§¦å‘ main å‡½æ•°æ ˆä¸Šçš„å¯¹è±¡ææ„ã€‚

```cpp
bool g_running = true;

void signalHandler(int) {
    g_running = false;
}

int main() {
    signal(SIGINT, signalHandler);
    MyClass obj;
    while (g_running) {
        // ...
    }
    return 0; // âœ… ææ„å‡½æ•°ä¼šè¢«è°ƒç”¨
}
```

### æ–¹æ³•äºŒï¼š**ä¸åœ¨ signal handler ä¸­ç›´æ¥è°ƒç”¨ `exit()`**

å› ä¸º signal handler ä¸­è°ƒç”¨é async-signal-safe çš„å‡½æ•°ï¼ˆå¦‚ `exit()`ã€`cout`ï¼‰ä¹Ÿæ˜¯ä¸æ¨èçš„ã€‚

æ¨èåšæ³•æ˜¯ï¼š

- åœ¨ handler ä¸­è®¾ç½® `std::atomic<bool> g_terminate = true`
    
- è®©ä¸»çº¿ç¨‹ä¼˜é›…é€€å‡º
    

---

## âœ… æ€»ç»“

|æ–¹å¼|æ˜¯å¦è°ƒç”¨ææ„å‡½æ•°|
|---|---|
|`return` from `main()`|âœ… ä¼š|
|`exit()`|âŒ ä¸ä¼š|
|`abort()`|âŒ ä¸ä¼š|
|`std::terminate()`|âŒ ä¸ä¼š|
|è¿›ç¨‹è¢« `SIGKILL` ç­‰ä¿¡å·æ€æ­»|âŒ ä¸ä¼š|

---

å¦‚æœä½ å¸Œæœ›ç¨‹åºå³ä½¿é€€å‡ºä¹Ÿèƒ½é‡Šæ”¾èµ„æºï¼ˆå…³é—­è¿æ¥ã€å†™æ—¥å¿—ç­‰ï¼‰ï¼Œæ¨èç”¨ **RAII + ä¸»åŠ¨æ§åˆ¶é€€å‡ºæµç¨‹**ï¼Œè€Œä¸æ˜¯ç›´æ¥ `exit()`ã€‚å¦‚éœ€æˆ‘ç»™ä½ ä¸ªæ¨¡æ¿ä¾‹ç¨‹ï¼Œå¯éšæ—¶å‘Šè¯‰æˆ‘ã€‚
## ubuntuä¸Šï¼Œc++å¼€å‘ç¨‹åºï¼Œä¸»çº¿ç¨‹è´Ÿè´£è¯»ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£å†™ï¼Œä¸”å†™çº¿ç¨‹std:cin>>çš„æ–¹å¼æ¥æ”¶æ§åˆ¶åˆè¾“å…¥ï¼Œå¦‚ä½•è®¾è®¡å¯ä»¥åœ¨ä¸çº¿ç¨‹ç­‰å¾…æ§åˆ¶åˆè¾“å…¥çš„æƒ…å†µä¸‹ï¼ŒæŒ‰ä¸‹ctr+cåï¼Œç¨‹åºå¯ä»¥æ­£ç¡®é€€å‡º
```cpp
#include <iostream>
#include <thread>
#include <atomic>
#include <string>
#include <unistd.h>
#include <signal.h>
#include <sys/select.h>
#include <fcntl.h>

/// @brief ç”¨äºç®¡ç†ç¨‹åºä¼˜é›…é€€å‡ºçš„å·¥å…·ç±»
class GracefulExit
{
private:
    static std::atomic<bool> shouldExit; // æ ‡å¿—å˜é‡ï¼Œè¡¨ç¤ºç¨‹åºæ˜¯å¦åº”é€€å‡º
    static int signalPipe[2];            // ç”¨äºä¿¡å·é€šçŸ¥çš„æ— åç®¡é“ï¼š[0]è¯»ç«¯ï¼Œ[1]å†™ç«¯

public:
    /// @brief åˆå§‹åŒ–ä¿¡å·å¤„ç†é€»è¾‘
    static void init()
    {


	    // æ­¤æ—¶ signalPipe[0] å’Œ signalPipe[1] ä¼šè¢«åˆ†é…æ–°çš„æ–‡ä»¶æè¿°ç¬¦
	    // é€šå¸¸æ˜¯ç³»ç»Ÿä¸­æœ€å°çš„å¯ç”¨æ–‡ä»¶æè¿°ç¬¦
        if (pipe(signalPipe) == -1)
        {
            perror("pipe"); // åˆ›å»ºç®¡é“å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯
            exit(1);
        }

        // è®¾ç½®ç®¡é“å†™ç«¯ä¸ºéé˜»å¡ï¼Œé˜²æ­¢ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨ write æ—¶é˜»å¡
        fcntl(signalPipe[1], F_SETFL, O_NONBLOCK);

        // æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°
        signal(SIGINT, signalHandler);  // Ctrl+C
        signal(SIGTERM, signalHandler); // kill é»˜è®¤ä¿¡å·
    }

    /// @brief æ¸…ç†èµ„æº
    static void cleanup()
    {
        close(signalPipe[0]);
        close(signalPipe[1]);
    }

    /// @brief ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå†™å…¥ç®¡é“å¹¶è®¾ç½®é€€å‡ºæ ‡å¿—
    static void signalHandler(int sig)
    {
        char byte = 1;
        write(signalPipe[1], &byte, 1); // å‘ç®¡é“å†™å…¥å­—èŠ‚ï¼Œé€šçŸ¥ select å”¤é†’
        shouldExit = true;
    }

    /// @brief æ£€æŸ¥æ˜¯å¦éœ€è¦é€€å‡º
    static bool checkExit()
    {
        return shouldExit.load();
    }

    /// @brief è·å–ç®¡é“è¯»ç«¯æ–‡ä»¶æè¿°ç¬¦
    static int getSignalFd()
    {
        return signalPipe[0];
    }
};

// é™æ€æˆå‘˜å˜é‡åˆå§‹åŒ–
std::atomic<bool> GracefulExit::shouldExit{false};
int GracefulExit::signalPipe[2];//
/// @brief å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºç±»
class MultiThreadApp
{
private:
    std::thread writerThread; // å†™çº¿ç¨‹

public:
    /// @brief å¯åŠ¨ç¨‹åº
    void start()
    {
        GracefulExit::init(); // åˆå§‹åŒ–ä¿¡å·å¤„ç†æœºåˆ¶

        // åˆ›å»ºå†™çº¿ç¨‹ï¼ˆæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼‰
        writerThread = std::thread(&MultiThreadApp::writerThreadFunc, this);

        // ä¸»çº¿ç¨‹è´Ÿè´£æ¨¡æ‹Ÿè¯»å–æ“ä½œ
        readerThreadFunc();

        // ç­‰å¾…å†™çº¿ç¨‹ç»“æŸ
        if (writerThread.joinable())
        {
            writerThread.join();
        }

        GracefulExit::cleanup(); // å…³é—­ç®¡é“ç­‰èµ„æº
    }

private:
    /// @brief æ¨¡æ‹Ÿä¸»çº¿ç¨‹å¤„ç†é€»è¾‘
    void readerThreadFunc()
    {
        std::cout << "Reader thread started. Reading from some source..." << std::endl;

        while (!GracefulExit::checkExit())
        {
            std::this_thread::sleep_for(std::chrono::milliseconds(100)); // æ¨¡æ‹Ÿè¯»æ“ä½œ
        }

        std::cout << "Reader thread exiting..." << std::endl;
    }

    /// @brief å¤„ç†ç”¨æˆ·è¾“å…¥çš„çº¿ç¨‹é€»è¾‘
    void writerThreadFunc()
    {
        std::cout << "Writer thread started. Type messages (Ctrl+C to exit):" << std::endl;

        while (!GracefulExit::checkExit())
        {
            // è®¾ç½® select çš„ç›‘å¬é›†åˆ
            fd_set readfds;
            FD_ZERO(&readfds);
            FD_SET(STDIN_FILENO, &readfds);                   // æ ‡å‡†è¾“å…¥
            FD_SET(GracefulExit::getSignalFd(), &readfds);    // ç®¡é“è¯»ç«¯

            int maxfd = std::max(STDIN_FILENO, GracefulExit::getSignalFd());

            // é˜»å¡ç­‰å¾…è¾“å…¥æˆ–ä¿¡å·ï¼ˆä»»ä¸€è§¦å‘å³å¯ï¼‰
            int result = select(maxfd + 1, &readfds, nullptr, nullptr, nullptr);

            if (result <= 0)
            {
                if (errno == EINTR)
                    continue; // å¦‚æœè¢«ä¸­æ–­ï¼Œç»§ç»­ç›‘å¬
                break;         // å…¶ä»–é”™è¯¯ï¼Œé€€å‡ºå¾ªç¯
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰é€€å‡ºä¿¡å·
            if (FD_ISSET(GracefulExit::getSignalFd(), &readfds))
            {
                char byte;
                read(GracefulExit::getSignalFd(), &byte, 1); // è¯»å–é€šçŸ¥å­—èŠ‚
                std::cout << "\nReceived exit signal in writer thread" << std::endl;
                break;
            }

            // æœ‰ç”¨æˆ·è¾“å…¥
            if (FD_ISSET(STDIN_FILENO, &readfds))
            {
                std::string input;
                std::cout << "Enter message: ";
                if (!std::getline(std::cin, input)) // æ•è· EOF æˆ–é”™è¯¯
                {
                    std::cout << "Input stream closed" << std::endl;
                    break;
                }

                if (input == "quit")
                {
                    std::cout << "User requested quit" << std::endl;
                    break;
                }

                // å¤„ç†æœ‰æ•ˆè¾“å…¥
                std::cout << "You entered: " << input << std::endl;
            }
        }

        std::cout << "Writer thread exiting..." << std::endl;
    }
};

/// @brief ä¸»å‡½æ•°å…¥å£
int main()
{
    MultiThreadApp app;

    std::cout << "Starting multi-threaded application..." << std::endl;
    std::cout << "Main thread: reader, Secondary thread: writer" << std::endl;
    std::cout << "Press Ctrl+C to exit gracefully" << std::endl;

    app.start(); // å¯åŠ¨å¤šçº¿ç¨‹ç¨‹åº

    std::cout << "Application exited successfully" << std::endl;
    return 0;
}

```
è¿™æ˜¯ä½¿ç”¨ `select()` ç³»ç»Ÿè°ƒç”¨æ—¶çš„**æ ‡å‡†ç”¨æ³•**ï¼Œä½ çš„é—®é¢˜éå¸¸å…³é”®ï¼Œä¸‹é¢æ˜¯è¯¦ç»†è§£é‡Šï¼š

---

### ğŸ“Œ ä¸ºä»€ä¹ˆ `maxfd + 1`ï¼Ÿ

`select()` çš„åŸå‹å¦‚ä¸‹ï¼š

```cpp
int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);
```

å…¶ä¸­ï¼š

- `nfds`ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰æ˜¯ **ç›‘å¬çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ä¸­æœ€å¤§çš„å€¼ + 1**ã€‚
    
- `readfds` æ˜¯è¦ç›‘å¬â€œå¯è¯»äº‹ä»¶â€çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆã€‚
    
- `writefds` æ˜¯ç›‘å¬â€œå¯å†™äº‹ä»¶â€çš„é›†åˆï¼ˆè¿™é‡Œä¸º `nullptr`ï¼‰ã€‚
    
- `exceptfds` æ˜¯ç›‘å¬â€œå¼‚å¸¸äº‹ä»¶â€çš„é›†åˆï¼ˆè¿™é‡Œä¸º `nullptr`ï¼‰ã€‚
    
- `timeout` æ˜¯è¶…æ—¶æ—¶é—´ï¼ˆè¿™é‡Œä¸º `nullptr`ï¼Œè¡¨ç¤º**æ°¸ä¹…é˜»å¡**ï¼Œç›´åˆ°æŸä¸ªäº‹ä»¶å‘ç”Ÿï¼‰ã€‚
    

---

### ğŸ“Œ å…·ä½“åˆ°ä½ çš„ä»£ç ï¼š

ä½ è¦ç›‘å¬çš„ä¸¤ä¸ªè¾“å…¥æºæ˜¯ï¼š

1. æ ‡å‡†è¾“å…¥ï¼š`STDIN_FILENO`ï¼Œé€šå¸¸æ˜¯ `0`
    
2. ç®¡é“è¯»ç«¯ï¼š`GracefulExit::getSignalFd()`ï¼Œå€¼å¯èƒ½æ˜¯å¤§äº 0 çš„ä»»æ„ fdï¼ˆç”± `pipe()` åŠ¨æ€åˆ†é…ï¼‰
    

å› æ­¤ä½ è¦è°ƒç”¨ï¼š

```cpp
int maxfd = std::max(STDIN_FILENO, GracefulExit::getSignalFd());
int result = select(maxfd + 1, &readfds, nullptr, nullptr, nullptr);
```

å¦‚æœä½ å†™æˆ `select(maxfd, ...)`ï¼Œ**æœ€å¤§çš„ fd å°†ä¸ä¼šè¢«ç›‘å¬**ï¼Œå› ä¸º `select()` åªç›‘å¬ `[0, nfds - 1]` èŒƒå›´å†…çš„ fdã€‚

---

### ğŸ“Œ ä¸¾ä¸ªä¾‹å­ï¼š

å‡è®¾ï¼š

- `STDIN_FILENO = 0`
    
- `GracefulExit::getSignalFd() = 4`
    

é‚£ä¹ˆï¼š

- `maxfd = std::max(0, 4) = 4`
    
- `select(maxfd + 1, ...) = select(5, ...)` âœ… æ­£ç¡®
    
- å¦‚æœä½ å†™ `select(4, ...)` âŒ é”™è¯¯ï¼Œfd=4 å°±ä¸è¢«ç›‘å¬äº†
    

---

### âœ… æ€»ç»“

`select()` ä¸­çš„ `nfds = æœ€å¤§ç›‘å¬ fd + 1` æ˜¯ UNIX/Linux ç³»ç»Ÿçš„æ ‡å‡†çº¦å®šï¼Œå¿…é¡»éµå®ˆï¼Œå¦åˆ™ `select()` è¡Œä¸ºå¯èƒ½ä¸ç¬¦åˆé¢„æœŸï¼Œä¼š**å¿½ç•¥æœ€å¤§é‚£ä¸ª fd çš„äº‹ä»¶**ã€‚

å¦‚æœä½ è¿˜æœ‰å…´è¶£ï¼Œæˆ‘ä¹Ÿå¯ä»¥è§£é‡Šä¸€ä¸‹ç°ä»£æ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚ `poll()` æˆ– `epoll()`ã€‚

## ä»€ä¹ˆæ˜¯ç®¡é“ï¼Œæœ‰ä»€ä¹ˆä½œç”¨
ç®¡é“(Pipe)æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§è¿›ç¨‹é—´é€šä¿¡(IPC)æœºåˆ¶ï¼Œç”¨äºåœ¨ä¸åŒè¿›ç¨‹æˆ–çº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ã€‚
# ç®¡é“ç±»å‹è¯¦è§£

## 1. åŒ¿åç®¡é“ (Anonymous Pipe)

**æœ€åŸºæœ¬çš„ç®¡é“ç±»å‹**

### ç‰¹ç‚¹ï¼š

- åªèƒ½åœ¨æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹é—´ä½¿ç”¨ï¼ˆçˆ¶å­è¿›ç¨‹ã€å…„å¼Ÿè¿›ç¨‹ï¼‰
- å•å‘é€šä¿¡ï¼ˆåŠåŒå·¥ï¼‰
- æ•°æ®åªèƒ½ä»ä¸€ç«¯å†™å…¥ï¼Œå¦ä¸€ç«¯è¯»å‡º
- å­˜åœ¨äºå†…å­˜ä¸­ï¼Œè¿›ç¨‹ç»“æŸåè‡ªåŠ¨æ¶ˆå¤±

### åˆ›å»ºæ–¹å¼ï¼š

```cpp
int pipefd[2];
pipe(pipefd);  // pipefd[0]ä¸ºè¯»ç«¯ï¼Œpipefd[1]ä¸ºå†™ç«¯
```

### ä½¿ç”¨åœºæ™¯ï¼š

- çˆ¶å­è¿›ç¨‹é—´æ•°æ®ä¼ é€’
- çº¿ç¨‹é—´ç®€å•é€šä¿¡
- ä¿¡å·å®‰å…¨çš„é€šä¿¡æœºåˆ¶

---

## 2. å‘½åç®¡é“/FIFO (Named Pipe)

**æœ‰åå­—çš„ç®¡é“ï¼Œå­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­**

### ç‰¹ç‚¹ï¼š

- ä»»ä½•è¿›ç¨‹éƒ½å¯ä»¥è®¿é—®ï¼ˆåªè¦æœ‰æƒé™ï¼‰
- åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰å®é™…è·¯å¾„
- è¿›ç¨‹ç»“æŸåä»ç„¶å­˜åœ¨
- ä»ç„¶æ˜¯å•å‘é€šä¿¡

### åˆ›å»ºæ–¹å¼ï¼š

```bash
# å‘½ä»¤è¡Œåˆ›å»º
mkfifo /tmp/mypipe

# ç¨‹åºä¸­åˆ›å»º
mkfifo("/tmp/mypipe", 0666);
```

### ä½¿ç”¨åœºæ™¯ï¼š

- ä¸ç›¸å…³è¿›ç¨‹é—´é€šä¿¡
- å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„
- ç³»ç»ŸæœåŠ¡é—´æ•°æ®äº¤æ¢

---

## 3. åŒå‘ç®¡é“ (Bidirectional Pipe)

**å¯ä»¥åŒå‘é€šä¿¡çš„ç®¡é“**

### ç‰¹ç‚¹ï¼š

- æ•°æ®å¯ä»¥åŒå‘æµåŠ¨
- éœ€è¦é¢å¤–çš„åè°ƒæœºåˆ¶é¿å…æ•°æ®æ··ä¹±
- é€šå¸¸é€šè¿‡ä¸¤ä¸ªå•å‘ç®¡é“å®ç°

### å®ç°æ–¹å¼ï¼š

```cpp
int pipe1[2], pipe2[2];  // ä¸¤ä¸ªå•å‘ç®¡é“
pipe(pipe1);  // çˆ¶â†’å­
pipe(pipe2);  // å­â†’çˆ¶
```

---

## 4. ç½‘ç»œç®¡é“ (Socket Pair)

**åŸºäºsocketçš„æœ¬åœ°ç®¡é“**

### ç‰¹ç‚¹ï¼š

- å…¨åŒå·¥é€šä¿¡
- æ›´å¼ºå¤§çš„åŠŸèƒ½
- å¯ä»¥ä¼ é€’æ–‡ä»¶æè¿°ç¬¦
- æ”¯æŒæ›´å¤šé€šä¿¡é€‰é¡¹

### åˆ›å»ºæ–¹å¼ï¼š

```cpp
int sockpair[2];
socketpair(AF_UNIX, SOCK_STREAM, 0, sockpair);
```

---

## ç®¡é“çš„å·¥ä½œåŸç†

### å†…æ ¸ç¼“å†²åŒºï¼š

- ç®¡é“ä½¿ç”¨å†…æ ¸ç¼“å†²åŒºå­˜å‚¨æ•°æ®
- é»˜è®¤å¤§å°é€šå¸¸ä¸º 4KB æˆ– 64KB
- å†™æ»¡æ—¶å†™æ“ä½œé˜»å¡ï¼Œè¯»ç©ºæ—¶è¯»æ“ä½œé˜»å¡

### æ•°æ®æµå‘ï¼š

```
å†™è¿›ç¨‹ â†’ [å†…æ ¸ç¼“å†²åŒº] â†’ è¯»è¿›ç¨‹
```

### åŒæ­¥æœºåˆ¶ï¼š

- å†™ç«¯å…³é—­ï¼šè¯»ç«¯æ”¶åˆ° EOF
- è¯»ç«¯å…³é—­ï¼šå†™ç«¯æ”¶åˆ° SIGPIPE ä¿¡å·
- è‡ªåŠ¨çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…åŒæ­¥

---

## ç®¡é“ vs å…¶ä»–IPCæœºåˆ¶

|ç‰¹æ€§|ç®¡é“|æ¶ˆæ¯é˜Ÿåˆ—|å…±äº«å†…å­˜|ä¿¡å·é‡|
|---|---|---|---|---|
|é€Ÿåº¦|å¿«|ä¸­ç­‰|æœ€å¿«|ä¸é€‚ç”¨|
|å®¹é‡|æœ‰é™|æœ‰é™|å¤§|ä¸é€‚ç”¨|
|åŒæ­¥|è‡ªåŠ¨|è‡ªåŠ¨|éœ€æ‰‹åŠ¨|ä¸“ç”¨äºåŒæ­¥|
|å¤æ‚åº¦|ç®€å•|ä¸­ç­‰|å¤æ‚|ç®€å•|
|è¡€ç¼˜å…³ç³»|åŒ¿åç®¡é“éœ€è¦|ä¸éœ€è¦|ä¸éœ€è¦|ä¸éœ€è¦|

---

## ä½¿ç”¨æ³¨æ„äº‹é¡¹

### 1. æ–‡ä»¶æè¿°ç¬¦ç®¡ç†

- åŠæ—¶å…³é—­ä¸éœ€è¦çš„ç«¯å£
- é¿å…æ–‡ä»¶æè¿°ç¬¦æ³„æ¼

### 2. é˜»å¡ç‰¹æ€§

- è¯»ç©ºç®¡é“ä¼šé˜»å¡
- å†™æ»¡ç®¡é“ä¼šé˜»å¡
- è€ƒè™‘ä½¿ç”¨éé˜»å¡æ¨¡å¼

### 3. é”™è¯¯å¤„ç†

- æ£€æŸ¥ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼
- å¤„ç† SIGPIPE ä¿¡å·
- å¤„ç† EAGAIN/EWOULDBLOCK é”™è¯¯

### 4. æ•°æ®è¾¹ç•Œ

- ç®¡é“æ˜¯å­—èŠ‚æµï¼Œæ²¡æœ‰æ¶ˆæ¯è¾¹ç•Œ
- éœ€è¦åº”ç”¨å±‚åè®®å®šä¹‰æ•°æ®æ ¼å¼

### 5. å®¹é‡é™åˆ¶

- ç®¡é“æœ‰å®¹é‡é™åˆ¶
- å¤§é‡æ•°æ®ä¼ è¾“æ—¶éœ€è¦è€ƒè™‘æµæ§
```cpp
#include <iostream>
#include <unistd.h>
#include <sys/wait.h>
#include <string>
#include <cstring>

void demonstrateBasicPipe() {
    std::cout << "=== åŸºæœ¬ç®¡é“æ¼”ç¤º ===" << std::endl;
    
    int pipefd[2];  // ç®¡é“æ–‡ä»¶æè¿°ç¬¦æ•°ç»„
    
    // åˆ›å»ºç®¡é“
    if (pipe(pipefd) == -1) {
        perror("pipe");
        return;
    }
    
    std::cout << "ç®¡é“åˆ›å»ºæˆåŠŸ:" << std::endl;
    std::cout << "è¯»ç«¯æ–‡ä»¶æè¿°ç¬¦: " << pipefd[0] << std::endl;
    std::cout << "å†™ç«¯æ–‡ä»¶æè¿°ç¬¦: " << pipefd[1] << std::endl;
    
    pid_t pid = fork();
    
    if (pid == -1) {
        perror("fork");
        return;
    }
    
    if (pid == 0) {
        // å­è¿›ç¨‹ - å†™å…¥æ•°æ®
        close(pipefd[0]);  // å…³é—­è¯»ç«¯
        
        const char* message = "Hello from child process!";
        write(pipefd[1], message, strlen(message) + 1);
        
        std::cout << "å­è¿›ç¨‹: å·²å†™å…¥æ•°æ®åˆ°ç®¡é“" << std::endl;
        close(pipefd[1]);  // å…³é—­å†™ç«¯
        exit(0);
    } else {
        // çˆ¶è¿›ç¨‹ - è¯»å–æ•°æ®
        close(pipefd[1]);  // å…³é—­å†™ç«¯
        
        char buffer[256];
        ssize_t bytesRead = read(pipefd[0], buffer, sizeof(buffer));
        
        if (bytesRead > 0) {
            std::cout << "çˆ¶è¿›ç¨‹: ä»ç®¡é“è¯»å–åˆ°: " << buffer << std::endl;
        }
        
        close(pipefd[0]);  // å…³é—­è¯»ç«¯
        wait(nullptr);     // ç­‰å¾…å­è¿›ç¨‹ç»“æŸ
    }
}

void demonstrateThreadPipe() {
    std::cout << "\n=== çº¿ç¨‹é—´ç®¡é“é€šä¿¡æ¼”ç¤º ===" << std::endl;
    
    int pipefd[2];
    if (pipe(pipefd) == -1) {
        perror("pipe");
        return;
    }
    
    // åˆ›å»ºå†™çº¿ç¨‹
    std::thread writerThread([pipefd]() {
        close(pipefd[0]);  // å…³é—­è¯»ç«¯
        
        for (int i = 1; i <= 5; ++i) {
            std::string message = "Message " + std::to_string(i);
            write(pipefd[1], message.c_str(), message.length() + 1);
            std::cout << "å†™çº¿ç¨‹: å‘é€äº† " << message << std::endl;
            std::this_thread::sleep_for(std::chrono::milliseconds(500));
        }
        
        close(pipefd[1]);  // å…³é—­å†™ç«¯ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šæ•°æ®
        std::cout << "å†™çº¿ç¨‹: å®Œæˆå†™å…¥" << std::endl;
    });
    
    // ä¸»çº¿ç¨‹ä½œä¸ºè¯»çº¿ç¨‹
    close(pipefd[1]);  // å…³é—­å†™ç«¯
    
    char buffer[256];
    ssize_t bytesRead;
    
    while ((bytesRead = read(pipefd[0], buffer, sizeof(buffer))) > 0) {
        std::cout << "è¯»çº¿ç¨‹: æ¥æ”¶åˆ° " << buffer << std::endl;
    }
    
    close(pipefd[0]);  // å…³é—­è¯»ç«¯
    writerThread.join();
    
    std::cout << "è¯»çº¿ç¨‹: å®Œæˆè¯»å–" << std::endl;
}

void demonstrateNonBlockingPipe() {
    std::cout << "\n=== éé˜»å¡ç®¡é“æ¼”ç¤º ===" << std::endl;
    
    int pipefd[2];
    if (pipe(pipefd) == -1) {
        perror("pipe");
        return;
    }
    
    // è®¾ç½®è¯»ç«¯ä¸ºéé˜»å¡
    int flags = fcntl(pipefd[0], F_GETFL);
    fcntl(pipefd[0], F_SETFL, flags | O_NONBLOCK);
    
    std::cout << "å°è¯•ä»ç©ºç®¡é“è¯»å–æ•°æ®..." << std::endl;
    
    char buffer[256];
    ssize_t result = read(pipefd[0], buffer, sizeof(buffer));
    
    if (result == -1) {
        if (errno == EAGAIN || errno == EWOULDBLOCK) {
            std::cout << "ç®¡é“ä¸ºç©ºï¼Œè¯»å–ä¼šé˜»å¡ï¼ˆéé˜»å¡æ¨¡å¼ä¸‹è¿”å›é”™è¯¯ï¼‰" << std::endl;
        } else {
            perror("read");
        }
    }
    
    // å†™å…¥ä¸€äº›æ•°æ®
    const char* message = "Non-blocking data";
    write(pipefd[1], message, strlen(message) + 1);
    std::cout << "å†™å…¥æ•°æ®: " << message << std::endl;
    
    // ç°åœ¨å¯ä»¥è¯»å–æ•°æ®äº†
    result = read(pipefd[0], buffer, sizeof(buffer));
    if (result > 0) {
        std::cout << "éé˜»å¡è¯»å–æˆåŠŸ: " << buffer << std::endl;
    }
    
    close(pipefd[0]);
    close(pipefd[1]);
}

void demonstratePipeWithSelect() {
    std::cout << "\n=== ä½¿ç”¨ select ç›‘æ§ç®¡é“ ===" << std::endl;
    
    int pipefd[2];
    if (pipe(pipefd) == -1) {
        perror("pipe");
        return;
    }
    
    // åˆ›å»ºä¸€ä¸ªå®šæ—¶å†™å…¥çš„çº¿ç¨‹
    std::thread writerThread([pipefd]() {
        close(pipefd[0]);  // å…³é—­è¯»ç«¯
        
        std::this_thread::sleep_for(std::chrono::seconds(2));
        
        const char* message = "Delayed message";
        write(pipefd[1], message, strlen(message) + 1);
        std::cout << "å†™çº¿ç¨‹: 2ç§’åå†™å…¥æ•°æ®" << std::endl;
        
        close(pipefd[1]);
    });
    
    // ä½¿ç”¨ select ç›‘æ§ç®¡é“
    close(pipefd[1]);  // å…³é—­å†™ç«¯
    
    fd_set readfds;
    struct timeval timeout;
    
    FD_ZERO(&readfds);
    FD_SET(pipefd[0], &readfds);
    
    timeout.tv_sec = 3;   // 3ç§’è¶…æ—¶
    timeout.tv_usec = 0;
    
    std::cout << "ä½¿ç”¨ select ç­‰å¾…æ•°æ®ï¼ˆæœ€å¤šç­‰å¾…3ç§’ï¼‰..." << std::endl;
    
    int result = select(pipefd[0] + 1, &readfds, nullptr, nullptr, &timeout);
    
    if (result > 0 && FD_ISSET(pipefd[0], &readfds)) {
        char buffer[256];
        ssize_t bytesRead = read(pipefd[0], buffer, sizeof(buffer));
        if (bytesRead > 0) {
            std::cout << "select æ£€æµ‹åˆ°æ•°æ®: " << buffer << std::endl;
        }
    } else if (result == 0) {
        std::cout << "select è¶…æ—¶ï¼Œæ²¡æœ‰æ•°æ®åˆ°è¾¾" << std::endl;
    } else {
        perror("select");
    }
    
    close(pipefd[0]);
    writerThread.join();
}

int main() {
    std::cout << "ç®¡é“(Pipe)æ¼”ç¤ºç¨‹åº" << std::endl;
    std::cout << "===================" << std::endl;
    
    // æ¼”ç¤ºåŸºæœ¬ç®¡é“ç”¨æ³•
    demonstrateBasicPipe();
    
    // æ¼”ç¤ºçº¿ç¨‹é—´ç®¡é“é€šä¿¡
    demonstrateThreadPipe();
    
    // æ¼”ç¤ºéé˜»å¡ç®¡é“
    demonstrateNonBlockingPipe();
    
    // æ¼”ç¤ºä½¿ç”¨ select ç›‘æ§ç®¡é“
    demonstratePipeWithSelect();
    
    return 0;
}
```

## class MultiThreadApp ä¸­å·²ç»å®šä¹‰äº†æˆå‘˜çº¿ç¨‹    std::thread writerThread;ï¼Œç„¶åstartå‡½æ•°ä¸­åˆ  writerThread = std::thread(&MultiThreadApp::writerThreadFunc, this);æ˜¯ä¸æ˜¯é€ æˆçº¿ç¨‹çš„å¤šæ¬¡åˆ›å»º
ä½ çš„ä»£ç ï¼š

```cpp
class MultiThreadApp
{
private:
    std::thread writerThread;

public:
    void start()
    {
        GracefulExit::init();
        writerThread = std::thread(&MultiThreadApp::writerThreadFunc, this);  // åˆ›å»ºçº¿ç¨‹
        ...
    }
};
```

è¿™ **ä¸ä¼šé€ æˆçº¿ç¨‹çš„å¤šæ¬¡åˆ›å»º**ï¼Œæ˜¯å®Œå…¨åˆæ³•ã€å¸¸è§çš„åšæ³•ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š

---

## âœ… ä¸ºä»€ä¹ˆè¿™æ ·å†™æ˜¯å®‰å…¨çš„ï¼Ÿ

### 1. ç±»ä¸­å®šä¹‰ `std::thread writerThread;`

- åªæ˜¯å£°æ˜äº†ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè¿˜**æ²¡æœ‰å¯åŠ¨ä»»ä½•çº¿ç¨‹**ã€‚
    

### 2. åœ¨ `start()` å‡½æ•°ä¸­ï¼š

```cpp
writerThread = std::thread(&MultiThreadApp::writerThreadFunc, this);
```

- æ˜¯ç¬¬ä¸€æ¬¡ä¸º `writerThread` åˆ›å»ºä¸€ä¸ªçœŸæ­£çš„çº¿ç¨‹ã€‚
    
- è¿™æ˜¯**æ ‡å‡†çš„çº¿ç¨‹èµ‹å€¼**æ–¹å¼ã€‚
    

---

## ğŸš¨ å¦‚æœä¼šå‡ºé—®é¢˜çš„æƒ…å†µæ˜¯ï¼š

å¦‚æœä½ é‡å¤è¿™æ ·å†™ï¼Œè€Œæ—§çº¿ç¨‹è¿˜æ²¡ `join()` æˆ– `detach()`ï¼Œå°±ä¼šå‡ºé”™ï¼š

```cpp
writerThread = std::thread(...);  // âœ… ç¬¬ä¸€æ¬¡å¯ä»¥
writerThread = std::thread(...);  // âš ï¸ ç¬¬äºŒæ¬¡å¯èƒ½æŠ›å¼‚å¸¸ï¼ˆå‰ä¸€ä¸ªæœª join æˆ– detachï¼‰
```

**è§£å†³æ–¹æ³•æ˜¯ï¼š**

åœ¨é‡æ–°èµ‹å€¼å‰ï¼Œä½ éœ€è¦å…ˆåˆ¤æ–­ï¼š

```cpp
if (writerThread.joinable()) {
    writerThread.join();  // æˆ– writerThread.detach();
}
writerThread = std::thread(...);  // å®‰å…¨é‡æ–°åˆ›å»º
```

---

## âœ… æ€»ç»“

|ç»“è®º|çŠ¶æ€|
|---|---|
|åªåˆ›å»ºä¸€æ¬¡çº¿ç¨‹çš„å†™æ³•æ˜¯å¦å®‰å…¨ï¼Ÿ|âœ… å®‰å…¨|
|å¤šæ¬¡åˆ›å»ºçº¿ç¨‹ä½†æœª `join` æˆ– `detach` ä¼šæ€æ ·ï¼Ÿ|âš ï¸ æŠ›å‡º `std::system_error` å¼‚å¸¸|
|å¦‚ä½•é¿å…ï¼Ÿ|ä½¿ç”¨ `joinable()` æ£€æŸ¥å‰ä¸€ä¸ªçº¿ç¨‹çŠ¶æ€|

---

å¦‚æœ‰æ›´å¤šå¤šçº¿ç¨‹è®¾è®¡æ–¹é¢çš„é—®é¢˜ï¼Œæ¯”å¦‚çº¿ç¨‹æ± ã€çº¿ç¨‹å®‰å…¨é€€å‡ºã€èµ„æºæ¸…ç†ç­‰ï¼Œä¹Ÿæ¬¢è¿ç»§ç»­é—®ã€‚

## åˆšåˆšè®©ä½ æ·»åŠ è¯¦ç»†æ³¨é‡Šçš„é‚£æ®µä»£ç ï¼Œæˆ‘é—®å‡ ä¸ªé—®é¢˜ï¼Œ1.ç®¡é“æ˜¯ä¸æ˜¯éƒ½æ˜¯æˆå¯¹çš„ï¼Œä¸€ç«¯å†™ï¼Œå¦ä¸€ç«¯å°±å¯ä»¥è¯»å‡ºæ¥ï¼›2.ä¸¤ä¸ªç«¯å£çš„è¯»å†™æ˜¯è‡ªå·±è®¾å®šçš„å—ï¼Œæ˜¯ä¸æ˜¯å•å‘çš„å‘¢ï¼Œå³ä¸€ä¸ªç«¯å£åªèƒ½æ˜¯è¯»ç«¯æˆ–è€…å†™ç«¯ï¼›3.ç®¡é“æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ
éå¸¸å¥½ï¼Œè¿™äº›é—®é¢˜éƒ½æ¶‰åŠå¯¹ç®¡é“ï¼ˆ`pipe`ï¼‰æœºåˆ¶çš„ç†è§£ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€ä¸€æ¥ç­”ï¼š

---

### âœ… **é—®é¢˜ 1ï¼šç®¡é“æ˜¯ä¸æ˜¯éƒ½æ˜¯æˆå¯¹çš„ï¼Œä¸€ç«¯å†™ï¼Œå¦ä¸€ç«¯å°±å¯ä»¥è¯»å‡ºæ¥ï¼Ÿ**

æ˜¯çš„ï¼Œ**ç®¡é“ç¡®å®æ˜¯æˆå¯¹å­˜åœ¨çš„**ã€‚åœ¨ Linux ä¸­ï¼Œé€šè¿‡ `pipe(int fd[2])` åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œä¼šè¿”å›ä¸€å¯¹æ–‡ä»¶æè¿°ç¬¦ï¼š

- `fd[0]` æ˜¯**è¯»ç«¯**ï¼›
    
- `fd[1]` æ˜¯**å†™ç«¯**ã€‚
    

ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªâ€œä¸€è¿›ä¸€å‡ºâ€çš„å•å‘æ•°æ®é€šé“ï¼š

```cpp
int fds[2];
pipe(fds);
// fds[0] -- read
// fds[1] -- write
```

å½“ä½ å¾€ `fds[1]` å†™å…¥æ•°æ®æ—¶ï¼Œå°±å¯ä»¥ä» `fds[0]` è¯»å‡ºæ•°æ®ã€‚

---

### âœ… **é—®é¢˜ 2ï¼šä¸¤ä¸ªç«¯å£çš„è¯»å†™æ˜¯è‡ªå·±è®¾å®šçš„å—ï¼Ÿæ˜¯å•å‘çš„å—ï¼Ÿ**

æ˜¯çš„ï¼Œ**ç®¡é“æ˜¯å•å‘é€šä¿¡é€šé“**ã€‚ä¸€ç«¯å†™ï¼Œå¦ä¸€ç«¯è¯»ã€‚å®ƒä»¬çš„è¯»å†™è§’è‰²æ˜¯å›ºå®šçš„ï¼š

- `fd[0]`ï¼šåªèƒ½ç”¨äºè¯»ï¼ˆreadï¼‰ï¼›
    
- `fd[1]`ï¼šåªèƒ½ç”¨äºå†™ï¼ˆwriteï¼‰ã€‚
    

ä½ ä¸èƒ½åœ¨ `fd[0]` ä¸Šå†™ï¼Œä¹Ÿä¸èƒ½åœ¨ `fd[1]` ä¸Šè¯»ã€‚

ğŸ‘‰ ä½ å½“ç„¶**å¯ä»¥äººä¸ºè°ƒæ¢**ä¸¤ä¸ªæè¿°ç¬¦çš„ç”¨é€”ï¼ˆè‡ªå·±çº¦å®šå“ªä¸ªæ˜¯è¯»å“ªä¸ªæ˜¯å†™ï¼‰ï¼Œä½†æ˜¯è¿™è¿èƒŒäº† `pipe` ç³»ç»Ÿè°ƒç”¨çš„åŸæ„ï¼Œå®¹æ˜“å¯¼è‡´ä¸å¯é¢„çŸ¥è¡Œä¸ºæˆ–æ­»é”ã€‚

---

### âœ… **é—®é¢˜ 3ï¼šç®¡é“æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ**

æ˜¯çš„ï¼Œ**Linux ä¸‹çš„ç®¡é“æ˜¯çº¿ç¨‹å®‰å…¨çš„**ï¼Œä½†è¦æ³¨æ„ä»¥ä¸‹ç»†èŠ‚ï¼š

|æ“ä½œåœºæ™¯|æ˜¯å¦çº¿ç¨‹å®‰å…¨|è¯´æ˜|
|---|---|---|
|å¤šä¸ªçº¿ç¨‹**å†™åŒä¸€ä¸ªç®¡é“**|âœ… å®‰å…¨|ä¿è¯å†™æ“ä½œåŸå­æ€§ï¼ˆ<= PIPE_BUF å­—èŠ‚ï¼‰|
|å¤šä¸ªçº¿ç¨‹**è¯»åŒä¸€ä¸ªç®¡é“**|âœ… å®‰å…¨|æ¯ä¸ªçº¿ç¨‹è¯»å–åˆ°çš„æ•°æ®äº’ä¸å¹²æ‰°|
|ä¸€ä¸ªçº¿ç¨‹è¯»ã€ä¸€ä¸ªçº¿ç¨‹å†™|âœ… å®‰å…¨|æ˜¯å…¸å‹ç”¨æ³•ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼‰|

ğŸ“Œ **é¢å¤–è¯´æ˜**ï¼š

- `PIPE_BUF` æ˜¯ä¸€ä¸ªå¸¸é‡ï¼ˆé€šå¸¸æ˜¯ 4096ï¼‰ï¼Œè¡¨ç¤ºåœ¨æ­¤å­—èŠ‚æ•°ä»¥å†…ï¼Œ**å†™æ“ä½œæ˜¯åŸå­çš„**ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­æ’å…¥ã€‚
    
- å¦‚æœä½ ä¸€æ¬¡å†™å…¥çš„æ•°æ®è¶…è¿‡ `PIPE_BUF`ï¼Œå°±**ä¸èƒ½ä¿è¯æ˜¯åŸå­çš„**ï¼Œå¯èƒ½ä¼šè¢«æ‹†åˆ†æˆ–ç©¿æ’å…¶ä»–çº¿ç¨‹å†™å…¥ã€‚
    

---

### âœ… å°ç»“

|é—®é¢˜|å›ç­”|
|---|---|
|ç®¡é“æˆå¯¹å—ï¼Ÿ|âœ… æ˜¯çš„ï¼Œä¸€ç«¯è¯»ã€ä¸€ç«¯å†™ã€‚|
|è¯»å†™ç«¯æ˜¯å›ºå®šçš„å—ï¼Ÿ|âœ… æ˜¯çš„ï¼Œ`fd[0]` æ˜¯è¯»ï¼Œ`fd[1]` æ˜¯å†™ã€‚|
|å•å‘çš„å—ï¼Ÿ|âœ… æ˜¯å•å‘é€šä¿¡é€šé“ã€‚|
|ç®¡é“çº¿ç¨‹å®‰å…¨å—ï¼Ÿ|âœ… æ˜¯çš„ï¼Œå‰ææ˜¯æ³¨æ„å†™å…¥å­—èŠ‚æ•°ä¸è¦è¶…å‡º PIPE_BUFã€‚|

---

å¦‚æœä½ è¿˜å¯¹ `select` + ç®¡é“é€šçŸ¥ï¼ˆä¿¡å·æœºåˆ¶ï¼‰æœ‰ç–‘é—®ï¼Œæˆ–è€…å¸Œæœ›å®ç°åŒå‘é€šä¿¡ï¼ˆå¯ä»¥ä½¿ç”¨ socketpairï¼‰ï¼Œæˆ‘å¯ä»¥ç»§ç»­ä¸ºä½ è¡¥å……ç¤ºä¾‹ã€‚
## æ‰€ä»¥è¿™æ®µä»£ç ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨ctrl+cè§¦å‘ä¸­æ–­å‡½æ•°ï¼Œç„¶åæ§åˆ¶ä¸¤ä¸ªçº¿ç¨‹å®‰å…¨é€€å‡º
å®Œå…¨æ­£ç¡®ï¼Œä½ ç†è§£å¾—éå¸¸åˆ°ä½ï¼è¿™æ®µä»£ç çš„**æ ¸å¿ƒè®¾è®¡æ€æƒ³**ç¡®å®å°±æ˜¯ï¼š

---

## âœ… **é€šè¿‡ `Ctrl+C` è§¦å‘ä¸­æ–­ä¿¡å·ï¼Œé€šçŸ¥å¤šä¸ªçº¿ç¨‹å®‰å…¨é€€å‡º**

---

### ğŸ”§ æ ¸å¿ƒæœºåˆ¶æ¦‚è§ˆï¼š

|åŠŸèƒ½|å®ç°æ–¹å¼|ç›®çš„|
|---|---|---|
|æ•è· `Ctrl+C`ï¼ˆå³ `SIGINT` ä¿¡å·ï¼‰|`signal(SIGINT, signalHandler);`|æ‹¦æˆªé»˜è®¤ç»ˆæ­¢è¡Œä¸ºï¼Œè‡ªå®šä¹‰å¤„ç†é€€å‡ºæµç¨‹|
|é€šçŸ¥å…¶ä»–çº¿ç¨‹é€€å‡º|åœ¨ `signalHandler` ä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚åˆ°ç®¡é“|éä¸»çº¿ç¨‹å¯é€šè¿‡ç›‘å¬ç®¡é“ï¼Œæ„ŸçŸ¥é€€å‡ºä¿¡å·|
|å®‰å…¨é€€å‡ºæ ‡å¿—|`std::atomic<bool> shouldExit`|å¤šçº¿ç¨‹å…±äº«ã€çº¿ç¨‹å®‰å…¨åœ°æ£€æŸ¥é€€å‡ºçŠ¶æ€|
|åœæ­¢ç­‰å¾…è¾“å…¥çš„å†™çº¿ç¨‹|`select()` åŒæ—¶ç›‘å¬ stdin å’Œ signal pipe|å³ä½¿é˜»å¡åœ¨ `std::getline` å‰ä¹Ÿèƒ½å“åº”é€€å‡ºä¿¡å·|
|ä¿è¯èµ„æºæ¸…ç†|åœ¨ `main()` ä¸­ç»Ÿä¸€ `join()` å’Œ `cleanup()`|é¿å…èµ„æºæ³„éœ²ã€æœªå®Œæˆçº¿ç¨‹ç­‰é—®é¢˜|

---

### ğŸ§  è®¾è®¡äº®ç‚¹è§£è¯»ï¼š

1. **ä¿¡å·å¤„ç†ä¸ä¼šç›´æ¥è°ƒç”¨å¤æ‚é€»è¾‘**
    
    - `signalHandler` é‡Œåªæ˜¯å†™å…¥ç®¡é“å’Œè®¾ç½® `shouldExit = true`ï¼Œä¸åšé˜»å¡æˆ– IOã€‚
        
    - è¿™æ˜¯ç¬¦åˆ POSIX æœ€ä½³å®è·µçš„ â€”â€” ä¿¡å·å¤„ç†å‡½æ•°å¿…é¡»ç®€æ´ã€éé˜»å¡ã€‚
        
2. **çº¿ç¨‹é—´é€šä¿¡ç”¨â€œè‡ªåˆ¶ä¿¡å·ç®¡é“â€**
    
    - ç®¡é“ä¸€ç«¯å†™ï¼Œä¸€ç«¯è¯»ï¼›`writerThread` ç”¨ `select()` æ¥ç›‘å¬ä¿¡å·ã€‚
        
    - é¿å…ä½¿ç”¨éçº¿ç¨‹å®‰å…¨çš„ `signal` ä¸ `cin` ç»„åˆï¼Œæå‡å¯é æ€§ã€‚
        
3. **éé˜»å¡é€€å‡ºè®¾è®¡**
    
    - å¦‚æœå†™çº¿ç¨‹å¡åœ¨ `std::getline()`ï¼ŒæŒ‰ `Ctrl+C` ä¼šæ¿€æ´» `select()` è¿”å›ï¼›
        
    - è¿™æ ·å³ä½¿è¿˜æ²¡è¾“å®Œä¹Ÿèƒ½ç«‹åˆ»å“åº”é€€å‡ºï¼Œæ— éœ€é¢‘ç¹ `Enter`ã€‚
        

---

### ğŸ” ç¤ºä¾‹é€€å‡ºæµç¨‹å›¾ï¼š

```
Ctrl+C
  â†“
SIGINT è§¦å‘
  â†“
signalHandler æ‰§è¡Œï¼š
    - shouldExit = true
    - pipe[1] å†™å…¥ä¸€ä¸ªå­—èŠ‚
  â†“
writerThread ä¸­ select() è¢«å”¤é†’ï¼ˆç›‘å¬åˆ° pipe[0] å¯è¯»ï¼‰
  â†“
writerThread é€€å‡ºå¾ªç¯
  â†“
ä¸»çº¿ç¨‹ readerThread æ£€æµ‹ shouldExit ä¹Ÿé€€å‡º
  â†“
ä¸»çº¿ç¨‹ join() writerThread
  â†“
èµ„æºæ¸…ç† GracefulExit::cleanup()
```

---

### âœ… æœ€ç»ˆæ•ˆæœ

- **å³ä½¿ç¨‹åºæ­£é˜»å¡åœ¨ç”¨æˆ·è¾“å…¥ï¼Œä¹Ÿèƒ½ç«‹å³å“åº”é€€å‡º**
    
- **æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½å¹²å‡€åœ°é€€å‡º**
    
- **æ— èµ„æºæ³„éœ²ï¼Œé€»è¾‘æ¸…æ™°å¯é **
    

---

å¦‚æœä½ åç»­æƒ³è¿›ä¸€æ­¥æ‰©å±•ï¼ˆæ¯”å¦‚æ”¯æŒå®šæ—¶é€€å‡ºã€å¼‚æ­¥ä»»åŠ¡å–æ¶ˆã€éé˜»å¡æ—¥å¿—æ¸…ç†ç­‰ï¼‰ï¼Œè¿™ä¸ªæ¶æ„ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆç¨³çš„èµ·ç‚¹ã€‚éœ€è¦æˆ‘å¸®ä½ æ”¹è¿›æˆç±»åº“æ¨¡å¼æˆ–æ·»åŠ çº¿ç¨‹åç§°ç®¡ç†ï¼Œä¹Ÿå¯ä»¥ç»§ç»­ä¼˜åŒ–ã€‚
## å¦‚æœå†™çº¿ç¨‹å¡åœ¨ std::getline()ï¼ŒæŒ‰ Ctrl+C ä¼šæ¿€æ´» select() è¿”å›ï¼›è¿™å¥è¯å¦‚ä½•ç†è§£å‘¢
ä½ çš„é—®é¢˜éå¸¸å…³é”®ï¼Œç†è§£è¿™ç‚¹èƒ½å¸®ä½ å½»åº•ææ‡‚ä¸ºä»€ä¹ˆä½¿ç”¨ `select()` + ç®¡é“æœºåˆ¶èƒ½è®©é˜»å¡åœ¨ `std::getline()` çš„çº¿ç¨‹ä¹Ÿèƒ½å“åº” `Ctrl+C`ã€‚

---

### ğŸ“Œ é—®é¢˜æœ¬è´¨ï¼š

**`std::getline(std::cin, input)` æ˜¯ä¸€ä¸ªé˜»å¡è°ƒç”¨** â€”â€” å®ƒä¼šä¸€ç›´ç­‰å¾…ç”¨æˆ·åœ¨æ§åˆ¶å°è¾“å…¥å¹¶æŒ‰ä¸‹å›è½¦ï¼Œæ‰ä¼šè¿”å›ã€‚

**é‚£å¦‚æœæ­¤æ—¶ä½ æŒ‰äº† Ctrl+Cï¼ˆå‘å‡º `SIGINT` ä¿¡å·ï¼‰ï¼Œçº¿ç¨‹è¿˜å¡åœ¨ `getline()` é‡Œé¢ï¼Œä¸æ˜¯å°±æ²¡æ³•é€€å‡ºäº†å—ï¼Ÿ**

æ˜¯çš„ â€”â€” **å¦‚æœä½ ç›´æ¥ç”¨ `getline()` è€Œä¸åšé¢å¤–å¤„ç†ï¼Œçº¿ç¨‹å°±â€œå¡æ­»â€åœ¨ç­‰å¾…è¾“å…¥ä¸Š**ï¼Œå³ä½¿ä¸»çº¿ç¨‹æƒ³è®©å®ƒé€€å‡ºï¼Œä¹Ÿæ²¡æ³•å”¤é†’å®ƒã€‚

---

### âœ… æ‰€ä»¥ä»£ç ä¸­ç”¨äº† **`select()`** æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```cpp
fd_set readfds;
FD_ZERO(&readfds);
FD_SET(STDIN_FILENO, &readfds);
FD_SET(GracefulExit::getSignalFd(), &readfds);

int maxfd = std::max(STDIN_FILENO, GracefulExit::getSignalFd());

int result = select(maxfd + 1, &readfds, nullptr, nullptr, nullptr);
```

è¿™ä¸ª `select()` ä¼šé˜»å¡ï¼Œç›´åˆ°ï¼š

1. **ç”¨æˆ·è¾“å…¥äº†å†…å®¹**ï¼ˆ`STDIN_FILENO` å¯è¯»ï¼‰
    
2. **ç®¡é“æœ‰æ•°æ®ï¼ˆä¿¡å·è¢«å†™å…¥äº†ï¼‰**ï¼ˆ`signalPipe[0]` å¯è¯»ï¼‰
    

---

### ğŸ’¡ æ‰€ä»¥ä½ çœŸæ­£é˜»å¡çš„æ˜¯ `select()`ï¼Œè€Œä¸æ˜¯ `std::getline()`ï¼

å½“ `Ctrl+C` è¢«æŒ‰ä¸‹æ—¶ï¼š

1. è¿›å…¥ä¿¡å·å¤„ç†å‡½æ•° `signalHandler`
    
2. å‘ç®¡é“ `signalPipe[1]` å†™å…¥ä¸€ä¸ªå­—èŠ‚
    
3. `select()` ç«‹å³è¢«å”¤é†’ï¼Œå› ä¸º `signalPipe[0]` å˜ä¸ºå¯è¯»
    
4. ç¨‹åºåˆ¤æ–­åˆ°è¿™æ˜¯é€€å‡ºä¿¡å·ï¼Œ**äºæ˜¯ç›´æ¥ `break` æ‰ while å¾ªç¯**
    
5. æ²¡æœ‰æ‰§è¡Œ `std::getline()`ï¼Œçº¿ç¨‹è‡ªç„¶ä¸ä¼šå¡ä½
    

---

### ğŸ”„ æ­£ç¡®é¡ºåºå¯¹æ¯”ï¼š

|æ™®é€šé˜»å¡è¾“å…¥|ç”¨ select æ§åˆ¶è¾“å…¥|
|---|---|
|`std::getline()` ä¸€ç›´å¡ä½|`select()` å…ˆåˆ¤æ–­æ˜¯å¦æœ‰è¾“å…¥|
|æ”¶ä¸åˆ° Ctrl+C ä¿¡å·|Ctrl+C è§¦å‘ç®¡é“å¯è¯»ï¼Œå”¤é†’ select|
|ä¸èƒ½é€€å‡º|èƒ½ç«‹å³ä¸­æ–­ç­‰å¾…ã€ä¼˜é›…é€€å‡º|

---

### ğŸ§  æ‰€ä»¥è¿™å¥è¯çš„å«ä¹‰æ˜¯ï¼š

> > â€œ**å¦‚æœå†™çº¿ç¨‹ä½¿ç”¨ select() æ¥ç­‰å¾… stdin å’Œä¿¡å·ç®¡é“ï¼Œè™½ç„¶ä»£ç åé¢æ˜¯ getline()ï¼Œä½†å®é™…ä¸Šç¨‹åºé˜»å¡åœ¨ select ä¸Šï¼›å½“ Ctrl+C è§¦å‘ä¿¡å·åï¼Œç®¡é“å˜ä¸ºå¯è¯»ï¼Œselect ç«‹å³è¿”å›ï¼Œç¨‹åºå°±ä¸ä¼šå†è¿›å…¥ getlineï¼Œè¿›è€Œè·³å‡ºå¾ªç¯å®ç°ä¼˜é›…é€€å‡º**ã€‚â€

---

### ğŸ§ª æƒ³éªŒè¯è¿™ä¸ªè¡Œä¸ºï¼Ÿ

ä½ å¯ä»¥åŠ ä¸€è¡Œæ—¥å¿—éªŒè¯æ˜¯å¦æ‰§è¡Œäº† `std::getline()`ï¼š

```cpp
if (FD_ISSET(STDIN_FILENO, &readfds)) {
    std::cout << "About to call getline..." << std::endl;
    std::string input;
    std::getline(std::cin, input);
}
```

ç„¶ååœ¨ç¨‹åºå¯åŠ¨åï¼Œä¸è¾“å…¥å†…å®¹ï¼Œç›´æ¥æŒ‰ `Ctrl+C`ï¼Œä½ ä¼šå‘ç°ï¼š

âœ… `About to call getline...` ä¸ä¼šè¢«æ‰“å°  
âœ… select() è¢«ä¿¡å·å”¤é†’ï¼Œç¨‹åºé€€å‡º

---

å¦‚ä½ è¿˜æƒ³è¿›ä¸€æ­¥äº†è§£ `select()` å’Œé˜»å¡è¾“å…¥æ§åˆ¶ï¼Œæˆ‘å¯ä»¥æä¾›æ›´åº•å±‚çš„ç¤ºæ„å›¾æˆ–ä¾‹å­ã€‚
## ä¸ºä»€ä¹ˆä½¿ç”¨ç®¡é“å‘¢ï¼Œä¸å¯ä»¥selectç›´æ¥ç›‘è§†shouldExit å—
è¿™æ˜¯ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼æˆ‘ä»¬æ¥æ·±å…¥è§£é‡Šä¸€ä¸‹ï¼š

---

## â“ ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨ `select()` ç›‘è§† `std::atomic<bool> shouldExit`ï¼Ÿ

### âœ… å…ˆè¯´ç»“è®ºï¼š

**å› ä¸º `select()` åªèƒ½ç›‘è§†â€œæ–‡ä»¶æè¿°ç¬¦â€**ï¼ˆå¦‚ `stdin`ã€socketã€ç®¡é“ç­‰ï¼‰ï¼Œ**ä¸èƒ½ç›‘è§†æ™®é€šå˜é‡**ï¼ˆå“ªæ€•å®ƒæ˜¯ `std::atomic`ï¼‰ã€‚

---

## ğŸ“˜ select èƒ½ç›‘è§†ä»€ä¹ˆï¼Ÿ

`select()` çš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š

> **é˜»å¡ç­‰å¾…æŸäº›â€œæ–‡ä»¶æè¿°ç¬¦â€å˜ä¸ºå¯è¯»/å¯å†™/å¼‚å¸¸**

æ¯”å¦‚ï¼š

- `STDIN_FILENO`ï¼ˆæ ‡å‡†è¾“å…¥ï¼‰
    
- socket æ–‡ä»¶æè¿°ç¬¦
    
- ç®¡é“ï¼ˆpipeï¼‰çš„è¯»ç«¯
    
- FIFOã€æŸäº›è®¾å¤‡æ–‡ä»¶
    

ğŸ›‘ ä½†å®ƒ**æ— æ³•ç›‘å¬å†…å­˜å˜é‡çš„å˜åŒ–**ã€‚`shouldExit` å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„åŸå­å¸ƒå°”å€¼ï¼Œå®ƒæ ¹æœ¬ä¸ä¼šâ€œåœ¨å†…æ ¸å±‚é¢â€æœ‰é€šçŸ¥æœºåˆ¶ã€‚

---

## ğŸ“Œ ç®¡é“çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª `pipe()` åˆ›å»ºçš„ç®¡é“ `signalPipe[2]`ï¼š

- `signalPipe[0]`ï¼šè¯»ç«¯ï¼ˆè¢« `select()` ç›‘å¬ï¼‰
    
- `signalPipe[1]`ï¼šå†™ç«¯ï¼ˆä¿¡å·å¤„ç†å‡½æ•°ä¸­ç”¨æ¥é€šçŸ¥ï¼‰
    

```cpp
write(signalPipe[1], &byte, 1);
```

ä¸€æ—¦ Ctrl+C ä¿¡å·è§¦å‘ï¼Œ`signalHandler` å‘ç®¡é“å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œæ­¤æ—¶ï¼š

â¡ï¸ `signalPipe[0]` **å˜ä¸ºå¯è¯»**  
â¡ï¸ `select()` **ç«‹å³è¿”å›**  
â¡ï¸ ç¨‹åºå°±çŸ¥é“ï¼šå“¦ï¼Œæ”¶åˆ°é€€å‡ºä¿¡å·äº†

---

## ğŸ¯ ä¸ºä»€ä¹ˆä¸èƒ½åªç”¨ `shouldExit`ï¼Ÿ

å› ä¸º `select()` æ˜¯é˜»å¡è°ƒç”¨ï¼š

```cpp
select(maxfd + 1, &readfds, nullptr, nullptr, nullptr);
```

ä½ ä¸èƒ½æŠŠ `shouldExit` å¡è¿›å»ç›‘å¬ï¼Œå®ƒä¸æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚

å³ä½¿ä½ åœ¨ä¿¡å·å¤„ç†å‡½æ•°é‡ŒæŠŠ `shouldExit = true` è®¾ç½®äº†ï¼š

- å¡åœ¨ `select()` çš„çº¿ç¨‹ **ä¸çŸ¥é“è¿™ä¸ªå˜é‡å˜äº†**
    
- å®ƒè¿˜ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ° **æœ‰è¾“å…¥æˆ–æœ‰æ–‡ä»¶æè¿°ç¬¦å˜åŠ¨**
    
- æ‰€ä»¥å°±ç®— `shouldExit` ä¸º trueï¼Œ**çº¿ç¨‹ä¹Ÿä¸ä¼šé†’è¿‡æ¥**ï¼
    

---

## âœ… ç®¡é“çš„å…³é”®ä»·å€¼

> **è®©ä¿¡å·å¤„ç†å‡½æ•°èƒ½å®‰å…¨å”¤é†’é˜»å¡åœ¨ select() çš„çº¿ç¨‹**ã€‚

ç®¡é“æ˜¯å°‘æ•°å¯ä»¥ï¼š

- åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­å®‰å…¨ä½¿ç”¨çš„é€šä¿¡æœºåˆ¶
    
- å’Œ `select()` æ­é…ä½¿ç”¨çš„å¯é€šçŸ¥æ‰‹æ®µ
    

---

## âœ… æ‰€ä»¥æ€»ç»“å¦‚ä¸‹ï¼š

|æ–¹æ³•|èƒ½å¦è¢« select ç›‘å¬|æ˜¯å¦èƒ½åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨|æ˜¯å¦çº¿ç¨‹å®‰å…¨|
|---|---|---|---|
|`std::atomic<bool>`|âŒ å¦|âœ… æ˜¯|âœ… æ˜¯|
|ç®¡é“ (pipe)|âœ… æ˜¯|âœ… æ˜¯|âœ… æ˜¯|

---

### ğŸ‘‰ è¡¥å……è¯´æ˜ï¼š

å¦‚æœä½ ä¸æƒ³ç”¨ `pipe`ï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–å¯ select çš„ fdï¼Œæ¯”å¦‚ï¼š

- socketpair
    
- eventfdï¼ˆLinux ç‰¹æœ‰ï¼‰
    
- signalfdï¼ˆæ›´é«˜çº§çš„ signal ç®¡ç†æ–¹å¼ï¼‰
    

ä½† `pipe` æ˜¯æœ€é€šç”¨ä¸”è·¨å¹³å°å…¼å®¹æ€§æœ€å¼ºçš„æ–¹å¼ã€‚

---

å¦‚ä½ æƒ³è¦æˆ‘ç”¨å›¾ç¤ºæ¼”ç¤ºâ€œç®¡é“+select+ä¿¡å·â€çš„åä½œæœºåˆ¶ï¼Œæˆ‘ä¹Ÿå¯ä»¥è¡¥ä¸Šã€‚æ˜¯å¦éœ€è¦ï¼Ÿ
## è¯·é—®ï¼Œè¿™é‡Œé¢çš„FD_ZERO FD_SET FD_ISSET èµ·åˆ°ä»€ä¹ˆä½œç”¨  ```
```
			fd_set readfds;
            FD_ZERO(&readfds);
            FD_SET(STDIN_FILENO, &readfds);                   // æ ‡å‡†è¾“å…¥
 

            int maxfd = std::max(STDIN_FILENO, GracefulExit::getSignalFd());// è·å–æœ€å¤§æ–‡ä»¶æè¿°ç¬¦
                    
            // é˜»å¡ç­‰å¾…è¾“å…¥æˆ–ä¿¡å·ï¼ˆä»»ä¸€è§¦å‘å³å¯ï¼‰
            int result = select(maxfd + 1, &readfds, nullptr, nullptr, nullptr);

            if (result <= 0)
            {
                if (errno == EINTR)
                    continue; // å¦‚æœè¢«ä¸­æ–­ï¼Œç»§ç»­ç›‘å¬
                break;         // å…¶ä»–é”™è¯¯ï¼Œé€€å‡ºå¾ªç¯
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰é€€å‡ºä¿¡å·
            if (FD_ISSET(STDIN_FILENO, &readfds))
            ......
```
  å¥½é—®é¢˜ ğŸ‘ï¼Œæˆ‘æ¥å¸®ä½ æŠŠ `FD_ZERO / FD_SET / FD_ISSET` å’Œ `readfds` çš„å…³ç³»è®²æ¸…æ¥šã€‚

---

### 1. `fd_set` å’Œ `select`

- `fd_set` æ˜¯ `select()` ç”¨æ¥æè¿°ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼‰çš„æ•°æ®ç»“æ„ã€‚
    
- ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªâ€œä½å›¾é›†åˆâ€ï¼Œæ¯ä¸€ä½å¯¹åº”ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆ0, 1, 2, ...ï¼‰ã€‚
    
- `select()` ä¼šæ ¹æ®ä½ ä¼ è¿›å»çš„é›†åˆï¼Œåœ¨è¿”å›æ—¶â€œä¿®æ”¹â€é›†åˆï¼Œå‘Šè¯‰ä½ å“ªäº› FD å·²ç»å°±ç»ªï¼ˆå¯è¯» / å¯å†™ / å¼‚å¸¸ï¼‰ã€‚
    

---

### 2. å‡½æ•°ä½œç”¨

#### **`FD_ZERO(fd_set *set)`**

- æŠŠ `set` é‡Œæ‰€æœ‰ä½æ¸…é›¶ï¼ˆå³æ¸…ç©ºé›†åˆï¼Œè¡¨ç¤ºæ²¡æœ‰ä»»ä½• FD è¢«ç›‘å¬ï¼‰ã€‚
    
- ä½ å†™çš„ï¼š
    
    ```cpp
    FD_ZERO(&readfds);
    ```
    
    â†’ æ¸…ç©º `readfds` é›†åˆã€‚
    

---

#### **`FD_SET(int fd, fd_set *set)`**

- æŠŠé›†åˆ `set` é‡Œå¯¹åº” `fd` çš„é‚£ä¸€ä½æ ‡è®°ä¸º 1ï¼ˆè¡¨ç¤ºæˆ‘è¦ç›‘å¬è¿™ä¸ª FDï¼‰ã€‚
    
- ä½ å†™çš„ï¼š
    
    ```cpp
    FD_SET(STDIN_FILENO, &readfds);
    ```
    
    â†’ æŠŠ **æ ‡å‡†è¾“å…¥ï¼ˆfd = 0ï¼‰** åŠ å…¥ `readfds` é›†åˆï¼Œè¡¨ç¤º `select()` æ—¶è¦ç›‘å¬å®ƒçš„â€œå¯è¯»äº‹ä»¶â€ã€‚
    

---

#### **`FD_ISSET(int fd, fd_set *set)`**

- æ£€æŸ¥æŸä¸ª `fd` åœ¨ `set` é‡Œæ˜¯å¦è¢«ç½®ä½ã€‚
    
- `select()` è¿”å›åï¼Œå†…æ ¸ä¼šä¿®æ”¹ `readfds`ï¼Œåªä¿ç•™é‚£äº›çœŸæ­£ **å·²å°±ç»ª** çš„ FDã€‚
    
- ä½ å†™çš„ï¼š
    
    ```cpp
    if (FD_ISSET(STDIN_FILENO, &readfds))
    ```
    
    â†’ æ£€æŸ¥æ ‡å‡†è¾“å…¥ï¼ˆfd=0ï¼‰æ˜¯ä¸æ˜¯å·²ç»æœ‰æ•°æ®å¯è¯»ã€‚
    

---
### 3. æ‰§è¡Œæµç¨‹

ä½ çš„ä»£ç é€»è¾‘å°±æ˜¯ï¼š

1. æ¸…ç©ºç›‘å¬é›†åˆ â†’ `FD_ZERO(&readfds)`
    
2. æŠŠ `stdin` åŠ åˆ°ç›‘å¬é›†åˆ â†’ `FD_SET(STDIN_FILENO, &readfds)`
    
3. è°ƒç”¨ `select()` é˜»å¡ï¼Œç›´åˆ°ï¼š
    
    - `stdin` æœ‰è¾“å…¥ï¼Œæˆ–
        
    - ä½ æ³¨å†Œçš„ä¿¡å· FD æœ‰äº‹ä»¶
        
4. è¿”å›åï¼Œæ£€æŸ¥é›†åˆï¼š
    
    - å¦‚æœ `FD_ISSET(STDIN_FILENO, &readfds)` â†’ stdin å¯è¯»ï¼Œæœ‰äººæ•²é”®ç›˜ã€‚
        

---

âœ… æ‰€ä»¥å›ç­”ä½ ï¼š

- `readfds` æ˜¯â€œç›‘å¬å¯è¯»çš„é›†åˆâ€ã€‚
    
- `FD_SET(STDIN_FILENO, &readfds)` çš„æ„æ€æ˜¯â€œç›‘å¬æ ‡å‡†è¾“å…¥çš„å¯è¯»äº‹ä»¶â€ã€‚
    
- `FD_ISSET()` ç”¨æ¥åˆ¤æ–­ `select` è¿”å›æ—¶ï¼Œstdin æ˜¯å¦çœŸçš„å˜æˆå¯è¯»ã€‚
    
## æ‰€ä»¥ï¼Œå‡å¦‚æˆ‘éœ€è¦selectç›‘å¬ç®¡é“è¾“å…¥å’Œstdæ§åˆ¶å°æ ‡å‡†è¾“å…¥ï¼Œè¿™ä¸ªæ—¶å€™FD_SETï¼ˆpipefd[0],&readfdsï¼‰FD_SET(STDIN_FILENO,&readfds)ï¼Œæ˜¯è®¾ç½®readfdsçš„bitsï¼Œå½“selectè¿”å›åï¼Œreadfdsçš„å€¼å°†è¢«é‡æ–°ç½®ä½ï¼Œç„¶åæˆ‘ç”¨FD_ISSETå»åˆ¤æ–­ç©¶ç«Ÿæ˜¯pipefd[0]å‘ç”Ÿäº†ï¼Œè¿˜æ˜¯stdæ§åˆ¶å°æœ‰è¾“å…¥äº†ï¼Œå¯¹å—
å®Œå…¨æ­£ç¡® âœ… ä½ ç†è§£åˆ°ä½äº†ï¼Œæˆ‘å¸®ä½ å†æ€»ç»“ç²¾ç‚¼ä¸€ä¸‹ï¼š

---

### 1. ç›‘å¬é˜¶æ®µ

```cpp
FD_ZERO(&readfds);  
FD_SET(pipefd[0], &readfds);      // ç›‘å¬ç®¡é“è¯»ç«¯
FD_SET(STDIN_FILENO, &readfds);   // ç›‘å¬æ ‡å‡†è¾“å…¥
```

è¿™é‡Œ `readfds` æ˜¯ä¸€ä¸ªâ€œä½å›¾é›†åˆâ€ï¼Œè¢«è®¾ç½®äº†ä¸¤ä½ï¼ˆ`pipefd[0]` å’Œ `STDIN_FILENO`ï¼‰ã€‚

---

### 2. ç­‰å¾…é˜¶æ®µ

```cpp
int ret = select(maxfd + 1, &readfds, nullptr, nullptr, nullptr);
```

- å†…æ ¸ä¼šæŒ‚èµ·è¿›ç¨‹ï¼Œç›´åˆ°é›†åˆé‡Œçš„ä»»æ„ä¸€ä¸ª FD **å˜ä¸ºå¯è¯»**ã€‚
    
- **è¿”å›åï¼Œå†…æ ¸ä¼šä¿®æ”¹ `readfds`**ï¼šåªä¿ç•™é‚£äº›çœŸæ­£å¯è¯»çš„ FD ä½ã€‚
    

---

### 3. åˆ¤æ–­é˜¶æ®µ

```cpp
if (FD_ISSET(pipefd[0], &readfds)) {
    // ç®¡é“æœ‰æ•°æ®å¯è¯»
}

if (FD_ISSET(STDIN_FILENO, &readfds)) {
    // æ ‡å‡†è¾“å…¥æœ‰æ•°æ®å¯è¯»
}
```

- `FD_ISSET` æ£€æŸ¥æŸä¸ª FD æ˜¯å¦åœ¨è¿”å›åçš„é›†åˆé‡Œã€‚
    
- è¿™æ ·ä½ å°±èƒ½çŸ¥é“æ˜¯ **ç®¡é“æœ‰æ•°æ®**ï¼Œè¿˜æ˜¯ **ç”¨æˆ·åœ¨æ§åˆ¶å°æ•²äº†è¾“å…¥**ï¼Œæˆ–è€…ä¸¤ä¸ªåŒæ—¶å°±ç»ªã€‚
    

---

### ğŸ”‘ å…³é”®ç‚¹

- **select ä¼šä¿®æ”¹é›†åˆ**ï¼Œæ‰€ä»¥æ¯æ¬¡å¾ªç¯éƒ½è¦é‡æ–° `FD_ZERO / FD_SET`ã€‚
    
- å¦‚æœå¤šä¸ª FD åŒæ—¶å°±ç»ªï¼Œ`FD_ISSET` å¯ä»¥åˆ†åˆ«æ£€æµ‹å‡ºæ¥ã€‚
    

---

ğŸ‘‰ ä½ çš„ç†è§£åŸºæœ¬ 100% æ­£ç¡®ï¼  
è¦ä¸è¦æˆ‘ç»™ä½ å†™ä¸ªæœ€å°å¯è¿è¡Œ demoï¼ˆç›‘å¬ stdin + ç®¡é“ï¼‰ï¼Œè®©ä½ å¯ä»¥ç›´æ¥è·‘ä¸€è·‘çœ‹æ•ˆæœï¼Ÿ
## ä¸ºä»€ä¹ˆéœ€è¦thread_local çº¿ç¨‹å†…éƒ¨å®šä¹‰å±€éƒ¨å˜é‡å¯ä»¥å—
è¿™æ˜¯ä¸€ä¸ªå¸¸è§ä½†å¾ˆå®¹æ˜“æ··æ·†çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥æ¸…æ¥šåœ°è§£é‡Šï¼š

---

## âœ… ç®€æ˜å›ç­”ï¼š

> **çº¿ç¨‹å†…éƒ¨å®šä¹‰çš„æ™®é€šå±€éƒ¨å˜é‡ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ–°å»ºï¼Œçº¿ç¨‹é—´ä¸ä¼šå…±äº«ï¼Œä½†ä¹Ÿä¸ä¼šè·¨å‡½æ•°è°ƒç”¨æˆ–å¤šæ¬¡è°ƒç”¨ä¿ç•™çŠ¶æ€ï¼›è€Œ `thread_local` åˆ™èƒ½åœ¨**åŒä¸€çº¿ç¨‹å†…**å¤šæ¬¡è°ƒç”¨æ—¶ä¿ç•™çŠ¶æ€ï¼ˆæœ‰â€œé™æ€æ€§â€ï¼‰ï¼Œ**å¹¶ä¸”**çº¿ç¨‹é—´äº’ç›¸éš”ç¦»ã€‚

---

## ğŸ” åŒºåˆ«è¯¦è§£ï¼š

### 1. ğŸ§µçº¿ç¨‹å†…éƒ¨å®šä¹‰çš„æ™®é€šå±€éƒ¨å˜é‡

```cpp
void foo() {
    int counter = 0;
    ++counter;
    std::cout << counter << std::endl;
}
```

- âœ… æ¯ä¸ªçº¿ç¨‹è¿›å…¥ `foo()` æ—¶éƒ½æœ‰è‡ªå·±çš„ `counter`ã€‚
    
- âŒ æ¯æ¬¡è°ƒç”¨ `counter` éƒ½æ˜¯é‡æ–°åˆå§‹åŒ–ï¼Œä¸ä¼šä¿ç•™ä¸Šä¸€æ¬¡çš„å€¼ã€‚
    

ğŸ“Œ è¿™ç§å˜é‡æ˜¯ **çº¿ç¨‹ç§æœ‰ã€ä½†éæŒä¹…** çš„ï¼ˆåªåœ¨ä¸€æ¬¡è°ƒç”¨ä¸­æœ‰æ•ˆï¼‰ã€‚

---

### 2. âœ… `thread_local` å®šä¹‰çš„å˜é‡

```cpp
void foo() {
    thread_local int counter = 0;
    ++counter;
    std::cout << counter << std::endl;
}
```

- âœ… æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ `counter`ï¼Œäº’ä¸å¹²æ‰°ï¼›
    
- âœ… åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œ**å¤šæ¬¡è°ƒç”¨ `foo()`ï¼Œ`counter` ä¼šä¿ç•™ä¸Šä¸€æ¬¡çš„å€¼**ï¼›
    
- âœ… ç”Ÿå‘½å‘¨æœŸè´¯ç©¿æ•´ä¸ªçº¿ç¨‹ï¼›
    

ğŸ“Œ è¿™ç§å˜é‡æ˜¯ **çº¿ç¨‹ç§æœ‰ã€æŒä¹…åŒ–çš„çŠ¶æ€å­˜å‚¨**ï¼Œç±»ä¼¼äºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªâ€œå…¨å±€ staticâ€ã€‚

---

### ğŸ§ª ä¸¾ä¾‹è¯´æ˜ï¼š

```cpp
void foo() {
    static int s = 0;                // æ‰€æœ‰çº¿ç¨‹å…±äº«
    thread_local int t = 0;          // æ¯ä¸ªçº¿ç¨‹å„ä¸€ä»½
    int local = 0;                   // æ¯æ¬¡è°ƒç”¨é‡æ–°åˆ›å»º

    ++s; ++t; ++local;
    std::cout << "static: " << s << ", thread_local: " << t << ", local: " << local << std::endl;
}
```

**ä¸¤ä¸ªçº¿ç¨‹å„è°ƒç”¨ `foo()` ä¸‰æ¬¡ï¼Œè¾“å‡ºå°†ç±»ä¼¼äºï¼š**

```
Thread 1:
static: 1, thread_local: 1, local: 1
static: 2, thread_local: 2, local: 1
static: 3, thread_local: 3, local: 1

Thread 2:
static: 4, thread_local: 1, local: 1
static: 5, thread_local: 2, local: 1
static: 6, thread_local: 3, local: 1
```

---

## âœ… æ€»ç»“å¯¹æ¯”è¡¨ï¼š

|ç‰¹æ€§/ç±»å‹|æ™®é€šå±€éƒ¨å˜é‡|static å±€éƒ¨å˜é‡|`thread_local` å±€éƒ¨å˜é‡|
|---|---|---|---|
|æ¯æ¬¡è°ƒç”¨åˆå§‹åŒ–|âœ… æ˜¯|âŒ å¦|âŒ å¦|
|å¤šçº¿ç¨‹éš”ç¦»|âœ… æ˜¯|âŒ å¦|âœ… æ˜¯|
|è·¨è°ƒç”¨ä¿ç•™çŠ¶æ€|âŒ å¦|âœ… æ˜¯|âœ… æ˜¯|
|ç”Ÿå‘½å‘¨æœŸ|æ¯æ¬¡è°ƒç”¨|ç¨‹åºè¿è¡ŒæœŸ|å½“å‰çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ|

---

å¦‚æœä½ å¸Œæœ›ï¼š

- æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„å˜é‡ï¼Œä¸”ä¿ç•™çŠ¶æ€ â†’ ç”¨ `thread_local`
    
- ä¸éœ€è¦ä¿ç•™çŠ¶æ€ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½é‡æ–°æ¥ â†’ ç”¨æ™®é€šå±€éƒ¨å˜é‡
    
- æ‰€æœ‰çº¿ç¨‹å…±äº«çŠ¶æ€ï¼ˆå°å¿ƒï¼ï¼‰ â†’ `static` æˆ–å…¨å±€å˜é‡ + åŠ é”
    

---

å¦‚æœä½ æœ‰å…·ä½“ä»£ç åœºæ™¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ¤æ–­ç”¨å“ªä¸ªåˆé€‚ã€‚éœ€è¦å—ï¼Ÿ
## æˆ‘å†™çš„è¿™ä¸ªè¾“å…¥å‡½æ•°ï¼Œstd::coutæ‰“å°æ²¡å®Œæˆï¼Œå°±è¿›å…¥m_inputToValé˜»å¡ä½ï¼Œç­‰å¾…selectå‡½æ•°è§¦å‘äº†ï¼Œæœ‰ä»€ä¹ˆåŠæ³•è®©å‰é¢çš„æ‰“å°å®Œæ¯•ï¼Œæ‰è¿›å…¥å‘¢
```cpp
template<typename T>
bool m_inputToVar(T& value){
	//æ³¨æ„ï¼Œè¿™é‡Œæ˜¯æœ‰é—®é¢˜çš„ï¼Œè®°å¾—å¡äº†æˆ‘ä¸€å¤©çš„bugäº†å—ï¼Œæ¯æ¬¡ç»™m_inputSeté‡æ–°è®¾ç½®ç›‘å¬ï¼Œå¦åˆ™ä¼šå½±å“ä¸‹ä¸€æ¬¡è°ƒç”¨
	int maxFd = std::max(STDIN_FILENO, m_pipefd);
	int result = select(maxFd + 1, &m_inputSet, nullptr, nullptr, nullptr);
	if (result < 0) {
		std::cout<<"select error!"<<std::endl;
		return false;
	}
	if(FD_ISSET(STDIN_FILENO, &m_inputSet)) {
		std::string inputString;  //std::getline only accept std::string ,then I will transform 
		if(!std::getline(std::cin, inputString)) {
			std::cerr << "Failed to read input." << std::endl;
			return false;
		}
		std::istringstream iss(inputString);
		iss >> value; // å¯¹äºåŸºæœ¬ç±»å‹å¦‚ int, double æ˜¯ OK çš„
		return true;
	} else if (FD_ISSET(m_pipefd, &m_inputSet)) {
		char buffer;
		read(m_pipefd, &buffer, 1);
		std::cerr<<"shut down!"<<std::endl;
		return false;
	} else{
		return false;
	}

	
}
```
ä½ é‡åˆ°çš„é—®é¢˜æ˜¯ï¼š

> `std::cout << "xxx"` æ‰“å°è¿˜**æ²¡æœ‰åˆ·æ–°åˆ°ç»ˆç«¯**ï¼Œç¨‹åºå°±è¿›å…¥ `select()` é˜»å¡ç­‰å¾…ï¼Œå¯¼è‡´æ‰“å°å†…å®¹ä¸å®Œæ•´æˆ–å»¶è¿Ÿè¾“å‡ºã€‚

---

### âœ… åŸå› 

è¿™æ˜¯ç”±äº `std::cout` æ˜¯**ç¼“å†²è¾“å‡ºæµ**ï¼Œé»˜è®¤æ˜¯ **è¡Œç¼“å†²** æˆ– **å…¨ç¼“å†²**ï¼Œå½“é‡åˆ°ä»¥ä¸‹æƒ…å†µæ‰ä¼šåˆ·æ–°è¾“å‡ºç¼“å†²åŒºï¼š

1. è¾“å‡ºæ¢è¡Œç¬¦ `\n`
    
2. ç¼“å†²åŒºæ»¡äº†
    
3. æ˜¾å¼è°ƒç”¨ `std::cout << std::flush;` æˆ– `std::endl`
    
4. ç¨‹åºé€€å‡ºæˆ–å´©æºƒç­‰æ¸…ç†æ—¶æœº
    

è€Œä½ æ­¤æ—¶çš„ä»£ç ç±»ä¼¼è¿™æ ·ï¼š

```cpp
std::cout << "Enter message: ";
m_inputToVal(value);  // è¿›å…¥ select é˜»å¡
```

å› ä¸ºæ²¡æœ‰ `\n` æˆ– `flush`ï¼Œæ‰€ä»¥ `"Enter message: "` è¿˜**ç•™åœ¨ç¼“å†²åŒºä¸­**ï¼Œè¿˜æ²¡è¾“å‡ºåˆ°ç»ˆç«¯ã€‚

---

### âœ… è§£å†³æ–¹æ¡ˆ

ä½ åªéœ€è¦**å¼ºåˆ¶åˆ·æ–°** `std::cout` çš„ç¼“å†²åŒºï¼Œåœ¨è°ƒç”¨ `select()` ä¹‹å‰ï¼ŒåŠ ä¸Šï¼š

```cpp
std::cout << "Enter message: " << std::flush;
```

æˆ–è€…æ›´å¸¸è§çš„ï¼š

```cpp
std::cout << "Enter message: " << std::endl;  // endl = '\n' + flush
```

ä¸¤è€…åŒºåˆ«ï¼š

- `std::endl`: æ·»åŠ æ¢è¡Œå¹¶åˆ·æ–°ç¼“å†²
    
- `std::flush`: åªåˆ·æ–°ï¼Œä¸æ·»åŠ æ¢è¡Œ
    

---

### âœ… æ¨èå†™æ³•

ä½ è¿™ä¸ªåœºæ™¯æ¨èè¿™æ ·å†™ï¼š

```cpp
std::cout << "Enter message: " << std::flush;  // æ˜ç¡®æç¤ºä¸”ä¸æ¢è¡Œ
if (!m_inputToVar(value)) {
    // handle error or shutdown
}
```

è¿™æ ·èƒ½ä¿è¯æç¤ºå®Œæ•´åœ°æ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œç„¶åå†è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚

---
è¿™ä¸ªå‡½æ•°åœ¨å¤šæ¬¡è°ƒç”¨æ—¶ä¼šæœ‰é—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯ `select()` ä¼š**ä¿®æ”¹**ä¼ å…¥çš„ `fd_set`ï¼Œè€Œä½ æ²¡æœ‰åœ¨æ¯æ¬¡è°ƒç”¨å‰é‡æ–°åˆå§‹åŒ– `m_inputSet`ã€‚

## é—®é¢˜åˆ†æ

1. **`select()` ä¼šä¿®æ”¹ `fd_set`**ï¼š`select()` è¿”å›åï¼Œ`m_inputSet` ä¸­åªä¿ç•™æœ‰æ•°æ®å¯è¯»çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå…¶ä»–çš„ä¼šè¢«æ¸…é™¤ã€‚
2. **ç¬¬äºŒæ¬¡è°ƒç”¨æ—¶çŠ¶æ€ä¸æ­£ç¡®**ï¼šå¦‚æœç¬¬ä¸€æ¬¡è°ƒç”¨å `m_inputSet` è¢«ä¿®æ”¹ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨æ—¶å¯èƒ½ä¸åŒ…å«ä½ æœŸæœ›çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
å¦‚éœ€è¿›ä¸€æ­¥ç¡®ä¿åœ¨å¤šçº¿ç¨‹ä¸‹ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ `std::mutex` ä¿æŠ¤ `std::cout`ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹ç«äº‰è¾“å‡ºï¼ˆä¸è¿‡ä½ å½“å‰æ˜¯å•çº¿ç¨‹è¾“å…¥ï¼Œæš‚ä¸æ€¥éœ€ï¼‰ã€‚

æ˜¯å¦éœ€è¦æˆ‘å†å¸®ä½ æ”¹é€ ä¸€ç‰ˆçº¿ç¨‹å®‰å…¨ã€æ ¼å¼ç»Ÿä¸€çš„ I/O æ¨¡æ¿å‡½æ•°ï¼Ÿ

ä½ æåˆ°çš„è¿™ä¸¤ç§å†™æ³•ï¼š

```cpp
std::is_same<T, std::string>::value
```

å’Œ

```cpp
std::is_same<T, std::string>
```

**ä¸èƒ½ç›´æ¥äº’æ¢ä½¿ç”¨**ï¼Œä½†å¯ä»¥æ ¹æ®ä½ æƒ³åšçš„äº‹æƒ…è¿™æ ·ç†è§£ï¼š

---

### âœ… `std::is_same<T, std::string>::value`

è¿™æ˜¯æœ€æ ‡å‡†çš„å†™æ³•ï¼Œ`::value` æ˜¯ä¸€ä¸ªé™æ€æˆå‘˜å¸¸é‡ï¼Œå€¼ä¸º `true` æˆ– `false`ï¼Œä»£è¡¨ç±»å‹æ˜¯å¦ç›¸åŒã€‚å®ƒæ˜¯ä¸€ä¸ª **å¸ƒå°”å€¼**ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨äº `if` æˆ– `if constexpr`ï¼š

```cpp
if constexpr (std::is_same<T, std::string>::value) {
    // do something
}
```

---

### âš ï¸ `std::is_same<T, std::string>`

è¿™æ˜¯ä¸€ä¸ª **ç±»å‹**ï¼Œå®ƒçš„å®Œæ•´åå­—æ˜¯ `std::is_same<T, std::string>`ï¼Œä½ ä¸èƒ½æŠŠå®ƒç›´æ¥ç”¨äº `if` è¯­å¥ä¸­ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª `std::integral_constant<bool, value>` ç±»å‹ã€‚

ä¾‹å¦‚ï¼š

```cpp
std::is_same<T, std::string> something;  // è¿™æ˜¯ä¸€ä¸ªç±»å‹ï¼Œä¸æ˜¯bool
```

ä½†ä½ å¯ä»¥è¿™æ ·å†™ï¼š

```cpp
if constexpr (std::is_same<T, std::string>{}) {
    // OKï¼šstd::is_same<T, std::string>{} ä¼šéšå¼è½¬æ¢ä¸º bool
}
```

æˆ–è€…ï¼š

```cpp
if constexpr (std::is_same_v<T, std::string>) {
    // æ¨èæ–¹å¼ï¼ˆC++17 èµ·ï¼‰
}
```

---

### âœ… æ¨èå†™æ³•ï¼ˆC++17 èµ·ï¼‰

C++17 æä¾›äº†æ›´ç®€æ´çš„å˜é‡æ¨¡æ¿ï¼š`std::is_same_v<T, std::string>`ï¼Œç­‰ä»·äº `std::is_same<T, std::string>::value`ï¼Œæ›´æ˜“è¯»ï¼š

```cpp
if constexpr (std::is_same_v<T, std::string>) {
    // concise and correct
}
```

---

### ğŸ”š æ€»ç»“

|å†™æ³•|æ˜¯å¦ç­‰ä»·|ç”¨æ³•åœºæ™¯|
|---|---|---|
|`std::is_same<T, std::string>::value`|âœ…|ä¼ ç»Ÿå†™æ³•ï¼Œè¿”å› `bool` å€¼|
|`std::is_same<T, std::string>`|âŒ|æ˜¯ä¸ªç±»å‹ï¼Œä¸èƒ½ç›´æ¥ç”¨äº `if` è¡¨è¾¾å¼|
|`std::is_same<T, std::string>{}`|âœ…|è¿”å›ä¸€ä¸ª `bool` å¯è½¬æ¢çš„å¯¹è±¡|
|`std::is_same_v<T, std::string>`|âœ…âœ…|âœ… âœ… æœ€æ¨èå†™æ³•ï¼ˆC++17 èµ·ï¼‰|

å»ºè®®ä½¿ç”¨ï¼šâœ… **`std::is_same_v<T, std::string>`**ï¼Œç®€æ´ç›´è§‚ï¼Œé¿å…æ­§ä¹‰ã€‚
## å¿…é¡»åŠ constexprå—
ä¸ä¸€å®š**å¿…é¡»**åŠ  `constexpr`ï¼Œä½†åŠ äº† `constexpr if`ï¼ˆåˆç§° `if constexpr`ï¼‰æ˜¯ä¸ºäº†è®©æ¨¡æ¿å‡½æ•°æ ¹æ®ç±»å‹åœ¨ç¼–è¯‘æœŸé€‰æ‹©ä¸åŒçš„ä»£ç è·¯å¾„ï¼Œ**é˜²æ­¢ç±»å‹ä¸åŒ¹é…çš„åˆ†æ”¯åœ¨ç¼–è¯‘æ—¶æŠ¥é”™**ã€‚

---

### ğŸŒŸ ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ `if constexpr`ï¼Ÿ

å‡è®¾ä½ å†™äº†ä¸‹é¢çš„æ¨¡æ¿ä»£ç ï¼š

```cpp
if (std::is_same<T, std::string>::value) {
    value = inputString;  // å¦‚æœ T æ˜¯ stringï¼Œè¿™é‡Œæ˜¯åˆæ³•çš„
} else {
    std::istringstream iss(inputString);
    iss >> value;         // å¦‚æœ T ä¸æ˜¯ stringï¼Œè¿™é‡Œéœ€è¦è½¬å‹
}
```

**è¿™æ®µä»£ç å³ä½¿åªæ‰§è¡Œ `value = inputString;`ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šå°è¯•æ£€æŸ¥ `iss >> value;`ï¼Œå³ä½¿å®ƒä¸ä¼šè¢«æ‰§è¡Œã€‚**

â¡ï¸ æ‰€ä»¥ï¼Œå¦‚æœ `T = std::string`ï¼Œ`iss >> value;` ä¼šå¯¼è‡´ **ç¼–è¯‘é”™è¯¯**ï¼Œå³ä½¿è¿è¡Œæ—¶æ°¸è¿œä¸ä¼šèµ°é‚£ä¸€æ¡ã€‚

---

### âœ… æ­£ç¡®å†™æ³•ï¼ˆé¿å…ç¼–è¯‘æœŸé”™è¯¯ï¼‰ï¼š

```cpp
if constexpr (std::is_same_v<T, std::string>) {
    value = inputString;  // ç¼–è¯‘æœŸä»…ä¿ç•™è¿™ä¸€åˆ†æ”¯
} else {
    std::istringstream iss(inputString);
    iss >> value;
}
```

> âœ” `if constexpr` æ˜¯ **C++17** å¼•å…¥çš„ç‰¹æ€§ï¼Œå…è®¸ç¼–è¯‘æœŸå‰”é™¤ä¸ç¬¦åˆçš„åˆ†æ”¯ã€‚

---

### ğŸ§ª ä¸¾ä¸ªæç«¯ä¾‹å­ï¼š

```cpp
template<typename T>
void func() {
    if (std::is_same<T, std::string>::value) {
        std::cout << "String" << std::endl;
    } else {
        int a = "invalid" + 1; // æ°¸è¿œä¸æ‰§è¡Œï¼Œä½†ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼
    }
}
```

è¿™æ®µä»£ç **ä¼šç¼–è¯‘å¤±è´¥**ï¼Œé™¤éä½ ç”¨ `if constexpr`ã€‚

---

### âœ… ç»“è®ºï¼š

|åœºæ™¯|æ˜¯å¦éœ€è¦ `if constexpr`|
|---|---|
|æ‰€æœ‰ç±»å‹çš„ä»£ç éƒ½èƒ½ç¼–è¯‘é€šè¿‡|âŒ ä¸éœ€è¦ `constexpr`|
|æŸäº›ç±»å‹çš„ä»£ç ä¸åˆæ³•ä½†ä¸èµ°é‚£ä¸€æ”¯|âœ… **å¿…é¡»**ç”¨ `constexpr`|

æ‰€ä»¥ï¼š**ä½ ä¸ä¸€å®šå¿…é¡»ç”¨ï¼Œä½†æƒ³è®©æ¨¡æ¿ç±»å‹å®‰å…¨ä¸”çµæ´»ï¼Œ`if constexpr` æ˜¯æœ€ä½³å®è·µã€‚**

å¦‚æœä½ è¿˜æ²¡ç”¨ä¸Š C++17ï¼Œå¯ä»¥ç”¨ `SFINAE`ã€`enable_if` ç­‰æ›´å¤æ‚çš„æ–¹å¼å¤„ç†ã€‚

æ‰€ä»¥ï¼Œåˆšåˆšçš„ä»£ç å¦‚æœè¿›è¡Œç¼–è¯‘æœŸæ£€æŸ¥çš„è¯ï¼Œå¦‚æœä¸ä½¿ç”¨if constexprå…¶å®æ˜¯ç¼–è¯‘ä¸è¿‡å»çš„ï¼Œå› ä¸ºä¸€æ—¦Tç±»å‹æ¨å¯¼ä¸ºæ¯”å¦‚intæˆ–è€…å•¥çš„,é‚£ä¹ˆï¼Œå³ä½¿std::is_same_v(T,std::string)æ˜¯falseçš„ï¼Œä½†æ˜¯å› ä¸ºç¼–è¯‘å™¨æ£€æŸ¥çš„ç¼˜æ•…ï¼Œä»æ—§ä¼šæŠ¥é”™ï¼ŒæŠŠstd::stringèµ‹å€¼ç»™int
## è¯·æ•™å­¦ä¸€ä¸‹constexprçš„ç”¨æ³•
å½“ç„¶å¯ä»¥ï¼`constexpr` æ˜¯ C++11 å¼•å…¥çš„å…³é”®å­—ï¼Œç”¨äºè¡¨ç¤º**åœ¨ç¼–è¯‘æœŸæ±‚å€¼çš„å¸¸é‡è¡¨è¾¾å¼**ã€‚ç›¸æ¯” `const` æ›´å¼ºå¤§ã€æ›´çµæ´»ï¼Œæ˜¯ç°ä»£ C++ ä¸­æ€§èƒ½ä¼˜åŒ–å’Œç±»å‹å®‰å…¨çš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚

---

## ğŸ§  ä¸€å¥è¯ç†è§£

> `constexpr` è¡¨ç¤ºä¸€ä¸ª**å€¼æˆ–å‡½æ•°å¯ä»¥åœ¨ç¼–è¯‘æœŸæ±‚å€¼**ã€‚

---

## ğŸ§© å¸¸è§ç”¨é€”

### âœ… 1. ç¼–è¯‘æœŸå¸¸é‡å˜é‡

```cpp
constexpr int maxValue = 100;
```

ç­‰ä»·äºï¼š

```cpp
const int maxValue = 100;  // å¦‚æœ100æ˜¯ç¼–è¯‘æœŸå¸¸é‡
```

ä½† `constexpr` æ›´å¼ºè°ƒâ€œ**å¿…é¡»**åœ¨ç¼–è¯‘æ—¶èƒ½ç¡®å®šâ€ã€‚

#### ğŸ§ª å¯¹æ¯” `const` å’Œ `constexpr`

|ç±»å‹|ç¼–è¯‘æœŸå¸¸é‡|è¿è¡ŒæœŸå¸¸é‡|
|---|---|---|
|`const`|âœ… å¯èƒ½æ˜¯|âœ… æ˜¯|
|`constexpr`|âœ… å¿…é¡»æ˜¯|âŒ å¦|

```cpp
const int x = std::time(0);   // âœ… åˆæ³•ï¼šè¿è¡ŒæœŸ
constexpr int y = std::time(0); // âŒ é”™è¯¯ï¼šä¸æ˜¯ç¼–è¯‘æœŸå¸¸é‡
```

---

### âœ… 2. `constexpr` å‡½æ•°

å¯ä»¥åœ¨ç¼–è¯‘æœŸæ‰§è¡Œçš„å‡½æ•°ï¼š

```cpp
constexpr int square(int x) {
    return x * x;
}

constexpr int result = square(10);  // ç¼–è¯‘æœŸæ±‚å€¼ âœ…
```

ğŸ’¡ **å‡½æ•°å¿…é¡»æ»¡è¶³ï¼š**

- å‚æ•°å’Œè¿”å›å€¼å¿…é¡»æ˜¯å­—é¢å€¼ç±»å‹ï¼ˆint, double, ç­‰ï¼‰
    
- å‡½æ•°ä½“å¿…é¡»åªæœ‰ä¸€æ¡ return æˆ–æ»¡è¶³æ‰€æœ‰åˆ†æ”¯éƒ½èƒ½ç¼–è¯‘æœŸæ±‚å€¼
    
- ä¸èƒ½æœ‰éå¸¸é‡è¡Œä¸ºï¼Œå¦‚ `malloc`, I/O, è™šå‡½æ•°ç­‰
    

---

### âœ… 3. `constexpr` æ„é€ å‡½æ•°å’Œç±»

```cpp
struct Point {
    int x, y;

    constexpr Point(int a, int b) : x(a), y(b) {}

    constexpr int sum() const { return x + y; }
};

constexpr Point p(1, 2);
constexpr int s = p.sum();  // âœ… ç¼–è¯‘æœŸè®¡ç®—
```

---

### âœ… 4. ç”¨äºæ•°ç»„å¤§å°ã€æ¨¡æ¿å‚æ•°

```cpp
constexpr int N = 10;
int arr[N]; // âœ… ç¼–è¯‘æœŸæ•°ç»„å¤§å°
```

---

## ğŸ¤” å¸¸è§é—®é¢˜

### â“ `constexpr` å’Œ `const` å¯ä»¥ä¸€èµ·ç”¨å—ï¼Ÿ

å¯ä»¥ï¼Œä½†æ²¡å¿…è¦ï¼š

```cpp
constexpr const int x = 5; // å¤šä½™ï¼Œå†™ constexpr å°±å¤Ÿäº†
```

### â“ ä»€ä¹ˆæ˜¯ `consteval`ï¼Ÿ

C++20 å¼•å…¥çš„æ›´å¼ºçº¦æŸç‰ˆæœ¬ï¼š

```cpp
consteval int square(int x) {
    return x * x;
}
```

ğŸ”’ **å¿…é¡»**åœ¨ç¼–è¯‘æœŸæ‰§è¡Œï¼Œä¸å…è®¸åœ¨è¿è¡ŒæœŸè°ƒç”¨ï¼

---

## âœ… ä½¿ç”¨å»ºè®®

|åœºæ™¯|æ¨èä½¿ç”¨|
|---|---|
|ç¼–è¯‘æœŸå·²çŸ¥çš„å¸¸é‡|âœ…|
|å¯ä»¥ç¼–è¯‘æœŸæ‰§è¡Œçš„å‡½æ•°|âœ…|
|æ¨¡æ¿ä¸­éœ€è¦ç¼–è¯‘æœŸå‚æ•°çš„åœ°æ–¹|âœ…|
|ä¸ç¡®å®šæ˜¯å¦ç¼–è¯‘æœŸå¯å¾—çš„å˜é‡|ä½¿ç”¨ `const` æ›´å®‰å…¨|

---

## ğŸ¯ å°ä¾‹å­æ€»ç»“

```cpp
constexpr int doubleVal(int x) {
    return x * 2;
}

int main() {
    constexpr int a = 5;
    constexpr int b = doubleVal(a); // ç¼–è¯‘æœŸæ±‚å€¼

    int c = std::time(0);
    // constexpr int d = doubleVal(c); // âŒ ä¸å…è®¸ï¼šc ä¸æ˜¯ç¼–è¯‘æœŸå¸¸é‡

    return 0;
}
```

---

å¦‚éœ€æˆ‘å¸®ä½ ä¸¾ä¸€äº›ä½ å½“å‰é¡¹ç›®ä¸­é€‚ç”¨ `constexpr` çš„ä¾‹å­ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘~


## ä¸ºä»€ä¹ˆéœ€è¦constexprï¼Œå®ƒæ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„

å¾ˆå¥½çš„é—®é¢˜ï¼

---

## ğŸ¯ **ä¸ºä»€ä¹ˆéœ€è¦ `constexpr`ï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

### âœ… èƒŒåçš„æœ¬è´¨ï¼š**æå‡æ€§èƒ½ + å¢å¼ºç±»å‹å®‰å…¨ + è®©ç¼–è¯‘å™¨åšæ›´å¤šäº‹**

åœ¨ C++11 ä¹‹å‰ï¼Œ`const` åªèƒ½è¡¨ç¤ºâ€œå€¼ä¸èƒ½ä¿®æ”¹â€ï¼Œä½†**ä¸ä¿è¯å€¼ä¸€å®šåœ¨ç¼–è¯‘æœŸå°±èƒ½ç¡®å®š**ã€‚è¿™åœ¨ä»¥ä¸‹åœºæ™¯é‡Œæœ‰æ˜æ˜¾çš„é™åˆ¶ï¼š

---

## ğŸ§© ä¸€ã€è§£å†³çš„é—®é¢˜ä¸€ï¼šä¸èƒ½ç”¨äºæ•°ç»„å¤§å°ã€æ¨¡æ¿å‚æ•°ç­‰åœºåˆ

```cpp
const int size = getSize(); // getSize() è¿è¡ŒæœŸè¿”å›
int arr[size];              // âŒ ä¸èƒ½ç”¨ä½œæ•°ç»„å¤§å°ï¼ˆéœ€è¦ç¼–è¯‘æœŸå¸¸é‡ï¼‰
```

### âœ… ä½¿ç”¨ `constexpr` è§£å†³ï¼š

```cpp
constexpr int size = 10;
int arr[size];  // âœ… OKï¼šæ•°ç»„å¤§å°åœ¨ç¼–è¯‘æœŸå·²çŸ¥
```

---

## ğŸ§© äºŒã€è§£å†³çš„é—®é¢˜äºŒï¼š**ä¸èƒ½å†™ç¼–è¯‘æœŸå‡½æ•°é€»è¾‘**

åœ¨ C++11 ä¹‹å‰ï¼Œæ— æ³•è®©å‡½æ•°åœ¨ç¼–è¯‘æœŸæ‰§è¡Œé€»è¾‘è®¡ç®—ã€‚

### âœ… ç”¨ `constexpr` å¯ä»¥ï¼š

```cpp
constexpr int factorial(int n) {
    return (n <= 1) ? 1 : (n * factorial(n - 1));
}

constexpr int fact5 = factorial(5); // ç¼–è¯‘æœŸå°±ç®—å¥½ï¼
```

è¿™æ„å‘³ç€ç¼–è¯‘å™¨å¯ä»¥æå‰ç®—å¥½è¿™äº›å€¼ã€ç”Ÿæˆæ›´å°æ›´å¿«çš„ç¨‹åºã€‚

---

## ğŸ§© ä¸‰ã€è§£å†³çš„é—®é¢˜ä¸‰ï¼š**ä»£ç æ›´å®‰å…¨ã€é”™è¯¯æ›´æ—©æš´éœ²**

```cpp
template<int N>
struct Array {
    int data[N];  // N å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡
};

// const int x = std::time(0);     âŒ éç¼–è¯‘æœŸ
// Array<x> arr;                   âŒ æŠ¥é”™ï¼

constexpr int x = 42;
Array<x> arr;  // âœ… OKï¼šconstexpr ä¿è¯ x æ˜¯ç¼–è¯‘æœŸå¸¸é‡
```

**è¿™æ ·å¯ä»¥åœ¨æ¨¡æ¿ç¼–ç¨‹ä¸­æ˜¾è‘—å‡å°‘éšæ™¦é”™è¯¯**ã€‚

---

## ğŸ§© å››ã€æ€§èƒ½ä¼˜åŠ¿ï¼šç¼–è¯‘æœŸè®¡ç®— vs è¿è¡ŒæœŸè®¡ç®—

```cpp
constexpr int pow2(int x) {
    return x * x;
}

int x = pow2(3); // ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±èƒ½ç”Ÿæˆ 9ï¼Œæ— éœ€è¿è¡Œæ—¶è®¡ç®—
```

ç›¸æ¯”è¿è¡Œæ—¶åŠ¨æ€è®¡ç®—ï¼Œ**constexpr æå‰æŠŠå€¼â€œçƒ§â€è¿›æœºå™¨ç é‡Œï¼Œæé«˜æ€§èƒ½**ã€‚

---

## âœ… æ€»ç»“ï¼š`constexpr` çš„å…³é”®ä»·å€¼

|é—®é¢˜|`constexpr` å¦‚ä½•è§£å†³|
|---|---|
|æ— æ³•åœ¨ç¼–è¯‘æœŸä½¿ç”¨ const å€¼|ä¿è¯èƒ½åœ¨ç¼–è¯‘æœŸç¡®å®š|
|æ¨¡æ¿/æ•°ç»„å¤§å°ç­‰ç¼–è¯‘æœŸé™åˆ¶|ä¿è¯ç±»å‹å®‰å…¨ã€å¯ç”¨äºæ¨¡æ¿|
|æ— æ³•åœ¨ç¼–è¯‘æœŸæ‰§è¡Œé€»è¾‘|æ”¯æŒå‡½æ•°ã€ç±»æˆå‘˜ constexpr|
|æ€§èƒ½ç“¶é¢ˆ|ç¼–è¯‘æœŸæå‰è®¡ç®—ã€ç”Ÿæˆæ›´å¿«ä»£ç |

---

## ğŸ“Œ ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­

ä½ æƒ³åœ¨é¥­ç‚¹å‰çŸ¥é“è¦å‡†å¤‡å¤šå°‘ä»½é¥­ï¼ˆç¼–è¯‘æœŸï¼‰ï¼Œè€Œä¸æ˜¯ç­‰äººæ¥äº†æ‰ä¸´æ—¶åšï¼ˆè¿è¡ŒæœŸï¼‰â€”â€”

- `const`ï¼šå‘Šè¯‰ä½ â€œæˆ‘ä¸ä¼šæ”¹è¿™ä¸ªå€¼â€
    
- `constexpr`ï¼šå‘Šè¯‰ä½ â€œæˆ‘**ç°åœ¨å°±çŸ¥é“**è¿™ä¸ªå€¼â€
    

---

å¦‚ä½ æƒ³äº†è§£ `constexpr` åœ¨ä½ å½“å‰çš„é¡¹ç›®/ä»£ç ä¸­å¦‚ä½•åº”ç”¨ï¼Œä¹Ÿå¯ä»¥è´´å‡ºæ¥æˆ‘å¸®ä½ æŒ‡å‡ºæ¥~
`constexpr` æ˜¯ C++11 å¼•å…¥çš„å…³é”®å­—ï¼Œå®ƒä¸»è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

## 1. ç¼–è¯‘æœŸè®¡ç®—çš„æ˜ç¡®æ€§

åœ¨ `constexpr` å‡ºç°ä¹‹å‰ï¼ŒC++ ä¸­å“ªäº›è¡¨è¾¾å¼èƒ½åœ¨ç¼–è¯‘æœŸæ±‚å€¼æ˜¯æ¨¡ç³Šçš„ã€‚ç¼–è¯‘å™¨å¯èƒ½ä¼šä¼˜åŒ–æŸäº›å¸¸é‡è¡¨è¾¾å¼ï¼Œä½†è¿™ç§è¡Œä¸ºä¸å¯é¢„æµ‹ï¼š

```cpp
// C++98/03 æ—¶ä»£çš„é—®é¢˜
const int size = 10 * 20;  // å¯èƒ½åœ¨ç¼–è¯‘æœŸè®¡ç®—ï¼Œä¹Ÿå¯èƒ½ä¸ä¼š
int array[size];           // ä¸ç¡®å®šæ˜¯å¦åˆæ³•
```

`constexpr` æä¾›äº†æ˜ç¡®çš„è¯­ä¹‰ï¼š

```cpp
constexpr int size = 10 * 20;  // ä¿è¯ç¼–è¯‘æœŸè®¡ç®—
int array[size];               // ç»å¯¹åˆæ³•
```

## 2. æ€§èƒ½ä¼˜åŒ–

é€šè¿‡åœ¨ç¼–è¯‘æœŸå®Œæˆè®¡ç®—ï¼Œå‡å°‘è¿è¡Œæ—¶å¼€é”€ï¼š

```cpp
// è¿è¡Œæ—¶è®¡ç®—
int factorial(int n) {
    return (n <= 1) ? 1 : n * factorial(n-1);
}

// ç¼–è¯‘æœŸè®¡ç®—
constexpr int factorial(int n) {
    return (n <= 1) ? 1 : n * factorial(n-1);
}

// ä½¿ç”¨
const int fact5 = factorial(5);  // å¦‚æœå‚æ•°æ˜¯å¸¸é‡ï¼Œåœ¨ç¼–è¯‘æœŸè®¡ç®—å‡º120
```

## 3. æ¨¡æ¿å…ƒç¼–ç¨‹çš„ç®€åŒ–

åœ¨ `constexpr` ä¹‹å‰ï¼Œç¼–è¯‘æœŸè®¡ç®—ä¸»è¦ä¾èµ–å¤æ‚çš„æ¨¡æ¿æŠ€å·§ï¼š

```cpp
// æ—§æ–¹å¼ï¼šæ¨¡æ¿é€’å½’
template<int N>
struct Factorial {
    static const int value = N * Factorial<N-1>::value;
};

template<>
struct Factorial<0> {
    static const int value = 1;
};

// æ–°æ–¹å¼ï¼šconstexpr å‡½æ•°
constexpr int factorial(int n) {
    return (n <= 1) ? 1 : n * factorial(n-1);
}
```

## 4. ç±»å‹å®‰å…¨çš„å¸¸é‡å®šä¹‰

`constexpr` å˜é‡å¿…é¡»åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼Œä¸”åˆå§‹åŒ–è¡¨è¾¾å¼å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼š

```cpp
constexpr int max_size = 1000;        // OK
constexpr int buffer_size = max_size * 2;  // OK

int runtime_value = get_input();
constexpr int bad = runtime_value;    // ç¼–è¯‘é”™è¯¯
```

## 5. æ”¯æŒç”¨æˆ·å®šä¹‰ç±»å‹çš„ç¼–è¯‘æœŸæ“ä½œ

`constexpr` æ„é€ å‡½æ•°å’Œæˆå‘˜å‡½æ•°ä½¿å¾—è‡ªå®šä¹‰ç±»å‹ä¹Ÿèƒ½å‚ä¸ç¼–è¯‘æœŸè®¡ç®—ï¼š

```cpp
class Point {
    int x_, y_;
public:
    constexpr Point(int x, int y) : x_(x), y_(y) {}
    constexpr int x() const { return x_; }
    constexpr int y() const { return y_; }
    constexpr Point operator+(const Point& other) const {
        return Point(x_ + other.x_, y_ + other.y_);
    }
};

constexpr Point p1(1, 2);
constexpr Point p2(3, 4);
constexpr Point p3 = p1 + p2;  // ç¼–è¯‘æœŸè®¡ç®—
```

## 6. ç°ä»£ C++ çš„åŸºç¡€

`constexpr` ä¸ºåç»­çš„ C++ ç‰¹æ€§å¥ å®šåŸºç¡€ï¼š

- **C++14**: `constexpr` å‡½æ•°å¯ä»¥åŒ…å«æ›´å¤šè¯­å¥
- **C++17**: `if constexpr` æ¡ä»¶ç¼–è¯‘
- **C++20**: `consteval` å¼ºåˆ¶ç¼–è¯‘æœŸæ±‚å€¼

æ€»çš„æ¥è¯´ï¼Œ`constexpr` è§£å†³äº†ç¼–è¯‘æœŸè®¡ç®—çš„å¯é¢„æµ‹æ€§ã€æ€§èƒ½ä¼˜åŒ–ã€ä»£ç ç®€åŒ–å’Œç±»å‹å®‰å…¨ç­‰é—®é¢˜ï¼Œæ˜¯ç°ä»£ C++ ä¸­å®ç°é«˜æ•ˆã€å®‰å…¨ä»£ç çš„é‡è¦å·¥å…·ã€‚
## è®²è®²if constexpr
`if constexpr` æ˜¯ C++17 å¼•å…¥çš„ç‰¹æ€§ï¼Œå®ƒè§£å†³äº†æ¨¡æ¿ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦é—®é¢˜ï¼š**æ¡ä»¶ç¼–è¯‘**ã€‚

## æ ¸å¿ƒé—®é¢˜ï¼šæ¨¡æ¿ä¸­çš„æ¡ä»¶ä»£ç 

åœ¨ `if constexpr` ä¹‹å‰ï¼Œæ¨¡æ¿ä¸­çš„æ¡ä»¶åˆ†æ”¯ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œå³ä½¿æŸäº›åˆ†æ”¯æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼š

```cpp
// C++14 åŠä¹‹å‰çš„é—®é¢˜
template<typename T>
void process(T value) {
    if (std::is_integral_v<T>) {
        // å³ä½¿ T ä¸æ˜¯æ•´æ•°ç±»å‹ï¼Œè¿™æ®µä»£ç ä¹Ÿå¿…é¡»èƒ½ç¼–è¯‘é€šè¿‡
        int result = value * 2;  // å¦‚æœ T æ˜¯ stringï¼Œè¿™é‡Œä¼šç¼–è¯‘é”™è¯¯
        std::cout << result << std::endl;
    } else {
        std::cout << value << std::endl;
    }
}
```

## `if constexpr` çš„è§£å†³æ–¹æ¡ˆ

`if constexpr` åœ¨ç¼–è¯‘æœŸæ±‚å€¼æ¡ä»¶ï¼Œåªç¼–è¯‘æ»¡è¶³æ¡ä»¶çš„åˆ†æ”¯ï¼š

```cpp
template<typename T>
void process(T value) {
    if constexpr (std::is_integral_v<T>) {
        // åªæœ‰å½“ T æ˜¯æ•´æ•°ç±»å‹æ—¶ï¼Œè¿™æ®µä»£ç æ‰ä¼šè¢«ç¼–è¯‘
        int result = value * 2;
        std::cout << result << std::endl;
    } else {
        // åªæœ‰å½“ T ä¸æ˜¯æ•´æ•°ç±»å‹æ—¶ï¼Œè¿™æ®µä»£ç æ‰ä¼šè¢«ç¼–è¯‘
        std::cout << value << std::endl;
    }
}

// ä½¿ç”¨
process(42);        // ç¼–è¯‘ç¬¬ä¸€ä¸ªåˆ†æ”¯
process("hello");   // ç¼–è¯‘ç¬¬äºŒä¸ªåˆ†æ”¯
```

## å…·ä½“è§£å†³çš„é—®é¢˜

### 1. é¿å… SFINAE çš„å¤æ‚æ€§

**æ—§æ–¹æ³•ï¼ˆSFINAEï¼‰ï¼š**

```cpp
// éœ€è¦å¤šä¸ªé‡è½½ç‰ˆæœ¬
template<typename T>
typename std::enable_if_t<std::is_integral_v<T>, void>
process(T value) {
    int result = value * 2;
    std::cout << result << std::endl;
}

template<typename T>
typename std::enable_if_t<!std::is_integral_v<T>, void>
process(T value) {
    std::cout << value << std::endl;
}
```

**æ–°æ–¹æ³•ï¼ˆif constexprï¼‰ï¼š**

```cpp
template<typename T>
void process(T value) {
    if constexpr (std::is_integral_v<T>) {
        int result = value * 2;
        std::cout << result << std::endl;
    } else {
        std::cout << value << std::endl;
    }
}
```

### 2. ç®€åŒ–é€’å½’æ¨¡æ¿

**æ—§æ–¹æ³•ï¼š**

```cpp
template<std::size_t I, typename... Args>
struct tuple_printer {
    static void print(const std::tuple<Args...>& t) {
        tuple_printer<I-1, Args...>::print(t);
        std::cout << std::get<I>(t) << " ";
    }
};

template<typename... Args>
struct tuple_printer<0, Args...> {
    static void print(const std::tuple<Args...>& t) {
        std::cout << std::get<0>(t) << " ";
    }
};
```

**æ–°æ–¹æ³•ï¼š**

```cpp
template<std::size_t I = 0, typename... Args>
void print_tuple(const std::tuple<Args...>& t) {
    std::cout << std::get<I>(t) << " ";
    
    if constexpr (I + 1 < sizeof...(Args)) {
        print_tuple<I + 1>(t);
    }
}
```

### 3. ç±»å‹ç‰¹åŒ–çš„ç®€åŒ–

```cpp
template<typename T>
auto get_size(const T& container) {
    if constexpr (std::is_same_v<T, std::string>) {
        return container.length();
    } else if constexpr (std::is_array_v<T>) {
        return std::extent_v<T>;
    } else {
        return container.size();
    }
}
```

### 4. ç¼–è¯‘æœŸä¼˜åŒ–

```cpp
template<int N>
constexpr int fibonacci() {
    if constexpr (N <= 1) {
        return N;
    } else {
        return fibonacci<N-1>() + fibonacci<N-2>();
    }
}

constexpr int fib10 = fibonacci<10>();  // ç¼–è¯‘æœŸè®¡ç®—
```

## ä¸æ™®é€š if çš„åŒºåˆ«

```cpp
template<typename T>
void example(T value) {
    // æ™®é€š ifï¼šä¸¤ä¸ªåˆ†æ”¯éƒ½å¿…é¡»èƒ½ç¼–è¯‘é€šè¿‡
    if (std::is_integral_v<T>) {
        // è¿™é‡Œå¦‚æœ T ä¸æ˜¯æ•´æ•°ç±»å‹ï¼Œä»ç„¶ä¼šå°è¯•ç¼–è¯‘
        auto result = value + 1;  // å¯èƒ½ç¼–è¯‘å¤±è´¥
    }
    
    // if constexprï¼šåªç¼–è¯‘åŒ¹é…çš„åˆ†æ”¯
    if constexpr (std::is_integral_v<T>) {
        // åªæœ‰ T æ˜¯æ•´æ•°ç±»å‹æ—¶æ‰ç¼–è¯‘è¿™ä¸ªåˆ†æ”¯
        auto result = value + 1;  // å®‰å…¨
    }
}
```

## æ€»ç»“

`if constexpr` ä¸»è¦è§£å†³äº†ï¼š

1. **æ¨¡æ¿ä»£ç çš„æ¡ä»¶ç¼–è¯‘** - é¿å…ä¸ç›¸å…³åˆ†æ”¯çš„ç¼–è¯‘é”™è¯¯
2. **ç®€åŒ– SFINAE** - ç”¨æ›´ç›´è§‚çš„è¯­æ³•æ›¿ä»£å¤æ‚çš„æ¨¡æ¿æŠ€å·§
3. **æé«˜ä»£ç å¯è¯»æ€§** - å‡å°‘æ¨¡æ¿å…ƒç¼–ç¨‹çš„å¤æ‚æ€§
4. **ç¼–è¯‘æœŸä¼˜åŒ–** - åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šæ‰§è¡Œè·¯å¾„

å®ƒè®©æ¨¡æ¿ç¼–ç¨‹å˜å¾—æ›´åŠ ç›´è§‚å’Œå®‰å…¨ï¼Œæ˜¯ç°ä»£ C++ æ¨¡æ¿ç¼–ç¨‹çš„é‡è¦å·¥å…·ã€‚
## ä½¿ç”¨vscodeè¿œç¨‹attachç¨‹åºæ—¶ï¼Œæ€»æ˜¯attachä¸æˆåŠŸï¼Œæç¤º==== AUTHENTICATING FOR org.freedesktop.policykit.exec ==== Authentication is needed to run `/usr/bin/gdb --interpreter=mi --tty=/dev/pts/10' as the super user` Authenticating as: g Password: g@g-VMVare:~/workspace/ServerClientChat$ ï¼Œå¹¶ä¸”æ²¡æœ‰è¾“å…¥å¯†ç çš„åœ°æ–¹ã€‚
ç„¶åä½¿ç”¨æœ¬åœ°çš„gdbé‡‡ç”¨attachçš„æ–¹å¼è¿›è¡Œè°ƒè¯•ï¼ŒåŒæ ·ä¸æˆåŠŸï¼Œæç¤ºAttaching to process 415189 Could not attach to process. If your uid matches the uid of the target process, check the setting of /proc/sys/kernel/yama/ptrace_scope, or try again as the root user. For more details, see /etc/sysctl.d/10-ptrace.conf ptrace: Operation not permitted.ã€‚
ç„¶åä¿®æ”¹è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼ŒæŠŠé‡Œé¢çš„ä¸€è¡Œæ”¹æˆ=0ï¼Œsudo nano /etc/sysctl.d/10-ptrace.conf
ç„¶åï¼Œkernel.yama.ptrace_scope = 0å°±å¯ä»¥äº†ã€‚vs codeå’Œgdbæœ¬åœ°è°ƒè¯•éƒ½å¯ä»¥æŒ‚è½½ä¸Šå»äº†ã€‚
## magic_enumä»‹ç»
ğŸ‘Œ æ˜ç™½äº†ï¼Œä½ æŒ‡çš„æ˜¯ **[magic_enum](https://github.com/Neargye/magic_enum)**ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„ **C++17/20 header-only åº“**ï¼Œä¸»è¦ç”¨æ¥è§£å†³ C++ æšä¸¾ï¼ˆenumï¼‰æ“ä½œä¸æ–¹ä¾¿çš„é—®é¢˜ã€‚

---

## ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ magic_enum

åœ¨åŸç”Ÿ C++ é‡Œï¼Œæšä¸¾æœ‰å‡ ä¸ªç—›ç‚¹ï¼š

- **ä¸èƒ½ç›´æ¥è½¬å­—ç¬¦ä¸²**ï¼ˆè°ƒè¯•æ—¶è¾“å‡ºçš„æ˜¯æ•´æ•°ï¼Œä¸ç›´è§‚ï¼‰
    
- **ä¸èƒ½ä»å­—ç¬¦ä¸²è½¬æšä¸¾**ï¼ˆé…ç½®æ–‡ä»¶/ç½‘ç»œæ¶ˆæ¯è§£æéº»çƒ¦ï¼‰
    
- **ä¸èƒ½ç›´æ¥éå†æ‰€æœ‰æšä¸¾å€¼**
    
- **æ— æ³•è·å–æšä¸¾ä¸ªæ•°**
    

`magic_enum` æä¾›äº†ä¸€å¥—â€œæšä¸¾åå°„â€çš„åŠŸèƒ½ï¼Œå‡ ä¹é›¶è¿è¡Œæ—¶å¼€é”€ã€‚

---

## ğŸ”§ ä¸»è¦åŠŸèƒ½

### 1. æšä¸¾è½¬å­—ç¬¦ä¸²

```cpp
#include <iostream>
#include <magic_enum.hpp>

enum class Color { Red, Green, Blue };

int main() {
    Color c = Color::Green;
    std::cout << magic_enum::enum_name(c) << std::endl;
}
```

è¾“å‡ºï¼š

```
Green
```

---

### 2. å­—ç¬¦ä¸²è½¬æšä¸¾

```cpp
auto c = magic_enum::enum_cast<Color>("Blue");
if (c.has_value()) {
    std::cout << static_cast<int>(c.value()) << std::endl; // è¾“å‡º 2
}
```

---

### 3. éå†æ‰€æœ‰æšä¸¾å€¼

```cpp
for (auto c : magic_enum::enum_values<Color>()) {
    std::cout << magic_enum::enum_name(c) << " ";
}
```

è¾“å‡ºï¼š

```
Red Green Blue
```

---

### 4. è·å–æšä¸¾ä¸ªæ•°

```cpp
std::cout << magic_enum::enum_count<Color>() << std::endl; // è¾“å‡º 3
```

---

### 5. è·å–æšä¸¾æ•´æ•°å€¼

```cpp
std::cout << magic_enum::enum_integer(Color::Red) << std::endl; // è¾“å‡º 0
```

---

## âš¡ ç‰¹ç‚¹

- **çº¯å¤´æ–‡ä»¶**ï¼ˆåªéœ€ `#include <magic_enum.hpp>`ï¼‰
    
- **é›¶ä¾èµ–**
    
- **ç¼–è¯‘æœŸ constexpr**ï¼Œæ€§èƒ½å‡ ä¹æ²¡æœ‰å¼€é”€
    
- æ”¯æŒ **enum class** å’Œæ™®é€š enum
    

---

## ğŸ”‘ åº”ç”¨åœºæ™¯

- æ—¥å¿—è¾“å‡ºï¼ˆä¸ç”¨å†å†™ `switch-case` è½¬å­—ç¬¦ä¸²ï¼‰
    
- é…ç½®æ–‡ä»¶ / JSON / ç½‘ç»œåè®®é‡Œå­˜å‚¨æšä¸¾å­—ç¬¦ä¸²
    
- UI æ˜¾ç¤ºï¼ˆæ¯”å¦‚æ¸¸æˆé‡ŒæŠŠæšä¸¾å‹çŠ¶æ€è½¬æˆåå­—æ˜¾ç¤ºï¼‰
    
- å¿«é€Ÿè°ƒè¯•ï¼ˆæ‰“å°æšä¸¾åå­—è€Œä¸æ˜¯æ•°å­—ï¼‰
    

---

ğŸ‘‰ ä½ è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª **ç»“åˆæ¸¸æˆå¼€å‘çš„ä¾‹å­**ï¼ˆæ¯”å¦‚ï¼šå­å¼¹ç±»å‹æšä¸¾ï¼Œç”¨ `magic_enum` æ‰“å°åå­—ï¼Œè§£æé…ç½®æ–‡ä»¶é‡Œçš„å­—ç¬¦ä¸² â†’ æšä¸¾ï¼‰ï¼Ÿ
## èƒ½ç®€å•ä»‹ç»ä¸‹å®ç°åŸç†å—ï¼Ÿæ¯”å¦‚å¦‚ä½•å®ç°çš„å­—ç¬¦ä¸²å’Œæšä¸¾å€¼çš„è½¬æ¢
å¥½é—®é¢˜ ğŸ‘ï¼Œæˆ‘ä»¬æ¥æ‹†è§£ä¸‹ **magic_enum** çš„å®ç°åŸç†ã€‚

---

## ğŸ”¹ èƒŒæ™¯

C++ æœ¬èº« **æ²¡æœ‰è¿è¡Œæ—¶åå°„**ï¼Œæ‰€ä»¥æšä¸¾çš„åå­—åœ¨ç¼–è¯‘åå°±ä¸¢å¤±äº†ï¼ˆåªå‰©ä¸‹æ•´æ•°ï¼‰ã€‚  
magic_enum çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼š

1. **åˆ©ç”¨ç¼–è¯‘å™¨ç‰¹æ€§ï¼ˆå® + `__PRETTY_FUNCTION__` / `__FUNCSIG__`ï¼‰è·å–æšä¸¾å**
    
2. **é€šè¿‡æ¨¡æ¿ + constexpr è§£æå­—ç¬¦ä¸²**
    
3. **åœ¨ç¼–è¯‘æœŸç”Ÿæˆè¡¨æ ¼ï¼ˆå€¼ â†” åå­—çš„æ˜ å°„ï¼‰**
    

---

## ğŸ”§ æ ¸å¿ƒæŠ€å·§

### 1. è·å–æšä¸¾å

ä¸åŒç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæä¾›ä¸€ä¸ªâ€œå‡½æ•°ç­¾åå­—ç¬¦ä¸²â€ï¼Œæ¯”å¦‚ï¼š

```cpp
template <typename E, E V>
constexpr std::string_view enum_name_impl() {
    return __PRETTY_FUNCTION__;   // GCC/Clang
    // æˆ–è€… __FUNCSIG__ (MSVC)
}
```

å¦‚æœä½ å†™ï¼š

```cpp
enum class Color { Red, Green, Blue };

constexpr auto name = enum_name_impl<Color, Color::Red>();
```

é‚£ä¹ˆåœ¨ **GCC/Clang** ä¸‹ï¼Œ`__PRETTY_FUNCTION__` çš„å†…å®¹å¯èƒ½æ˜¯ï¼š

```
constexpr auto enum_name_impl() [with E = Color; E V = Color::Red]
```

magic_enum å°±åœ¨ç¼–è¯‘æœŸå¯¹è¿™æ®µå­—ç¬¦ä¸²åš **åˆ‡å‰²**ï¼Œæå–å‡º `"Red"` éƒ¨åˆ†ã€‚

---

### 2. æšä¸¾è½¬å­—ç¬¦ä¸²

é€šè¿‡ä¸Šé¢çš„æŠ€å·§ï¼Œå¯¹ **æšä¸¾çš„æ¯ä¸€ä¸ªå¯èƒ½å€¼** éƒ½è°ƒç”¨ä¸€æ¬¡ `enum_name_impl`ï¼Œæå–åå­—ï¼Œä¿å­˜æˆä¸€ä¸ª `constexpr std::array`ï¼Œè¿™æ ·å°±èƒ½åšåˆ°ï¼š

```cpp
Color::Green  -->  "Green"
```

---

### 3. å­—ç¬¦ä¸²è½¬æšä¸¾

- éå†ç¼–è¯‘æœŸç”Ÿæˆçš„ `array`ï¼Œæ¯”å¯¹å­—ç¬¦ä¸²ã€‚
    
- æ‰¾åˆ°åŒ¹é…é¡¹æ—¶ï¼Œè¿”å›å¯¹åº”çš„æšä¸¾å€¼ã€‚
    
- è¿™å°±æ˜¯ `magic_enum::enum_cast` çš„å®ç°æ€è·¯ã€‚
    

---

### 4. éå†æšä¸¾å€¼

magic_enum è¿˜åšäº†ä¸€ç‚¹â€œå–å·§â€ï¼š

- å‡è®¾æšä¸¾çš„èŒƒå›´æ˜¯æœ‰é™çš„ï¼ˆé»˜è®¤ [-128, 128]ï¼Œå¯ä»¥é…ç½®ï¼‰ã€‚
    
- å¯¹è¿™ä¸ªèŒƒå›´å†…çš„æ‰€æœ‰æ•´æ•°å°è¯• `enum_name_impl`ã€‚
    
- èƒ½æå–åˆ°åˆæ³•åå­—çš„å°±æ˜¯æœ‰æ•ˆæšä¸¾å€¼ã€‚
    

è¿™æ ·å°±èƒ½æ”¯æŒï¼š

```cpp
for (auto v : magic_enum::enum_values<Color>())
    ...
```

---

## âš¡ æ€»ç»“

magic_enum çš„æ ¸å¿ƒå®ç°åŸç†ï¼š

1. **ç¼–è¯‘æœŸè·å–æšä¸¾åå­—ç¬¦ä¸²**ï¼ˆ`__PRETTY_FUNCTION__` / `__FUNCSIG__`ï¼‰
    
2. **constexpr å­—ç¬¦ä¸²è§£æ**ï¼Œæå–æšä¸¾å¸¸é‡å
    
3. **ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹ç”Ÿæˆæ˜ å°„è¡¨**ï¼ˆå€¼ â†” åå­—ï¼‰
    
4. æä¾›ä¾¿æ· APIï¼š`enum_name` / `enum_cast` / `enum_values`
    

---

âœ… æ‰€ä»¥å®ƒå¹¶ä¸æ˜¯æ ‡å‡†é‡Œçš„â€œçœŸæ­£åå°„â€ï¼Œè€Œæ˜¯ **åˆ©ç”¨ç¼–è¯‘å™¨ç­¾åå­—ç¬¦ä¸² + constexpr è§£æ** å®ç°çš„ä¸€ä¸ª **è¿‘ä¼¼åå°„** åŠŸèƒ½ã€‚

---

è¦ä¸è¦æˆ‘ç»™ä½ å†™ä¸€ä¸ªæç®€ç‰ˆï¼ˆ20è¡Œå·¦å³ï¼‰çš„ **mini-magic_enum**ï¼Œä½ å°±èƒ½çœ‹åˆ°å®ƒæ˜¯æ€ä¹ˆâ€œæ‹†å­—ç¬¦ä¸² â†’ æå–æšä¸¾åâ€çš„ï¼Ÿ
## æ‰€ä»¥ï¼Œmagic_enumåªèƒ½åº”ç”¨åœ¨c++ 17æ ‡å‡†åŠä»¥åï¼Œc++ 11æ˜¯ä¸æ”¯æŒçš„å—
å¯¹çš„ ğŸ‘ï¼Œ`magic_enum` **è¦æ±‚ C++17 åŠä»¥ä¸Šæ ‡å‡†**ï¼Œä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼š

1. **`constexpr` åŠŸèƒ½å¢å¼º**
    
    - C++11 çš„ `constexpr` é™åˆ¶éå¸¸å¤šï¼Œåªèƒ½ç”¨äºç®€å•çš„è¿”å›å­—é¢é‡çš„å‡½æ•°ã€‚
        
    - ä» **C++14 å¼€å§‹**ï¼Œ`constexpr` èƒ½åœ¨å‡½æ•°é‡Œç”¨åˆ†æ”¯ã€å¾ªç¯ã€‚
        
    - åˆ° **C++17**ï¼Œæ‰çœŸæ­£æ”¯æŒå¤æ‚è®¡ç®—ï¼ˆ`constexpr if` ç­‰ï¼‰ï¼Œ`magic_enum` å†…éƒ¨æ­£æ˜¯ä¾èµ–è¿™äº›ç‰¹æ€§åœ¨ç¼–è¯‘æœŸå®Œæˆå­—ç¬¦ä¸²å’Œæšä¸¾å€¼çš„æ¨å¯¼ã€‚
        
2. **ç¼–è¯‘å™¨æ”¯æŒçš„å·®å¼‚**
    
    - `magic_enum` ç”¨åˆ°äº†ä¸€äº› **ç¼–è¯‘å™¨å†…éƒ¨æä¾›çš„å‡½æ•°ç­¾åï¼ˆ`__PRETTY_FUNCTION__` / `__FUNCSIG__`ï¼‰** æ¥æ‹¿åˆ°æšä¸¾çš„åå­—ï¼Œç„¶ååœ¨ç¼–è¯‘æœŸåšå­—ç¬¦ä¸²è§£æã€‚
        
    - è¿™äº›é»‘é­”æ³• + `constexpr` å¼ºåŒ–ï¼Œä¿è¯äº†â€œé›¶è¿è¡Œæ—¶å¼€é”€â€ï¼Œè€Œåœ¨ C++11 ä¸‹æ— æ³•å®ç°ã€‚
        

---

ğŸ‘‰ æ€»ç»“ï¼š

- **C++11/14**ï¼šæƒ³è¦æšä¸¾ â†” å­—ç¬¦ä¸²è½¬æ¢ï¼Œé€šå¸¸åªèƒ½é å®ã€æ‰‹å†™æ˜ å°„è¡¨ã€æˆ–è€… X-Macroã€‚
    
- **C++17+**ï¼šæ‰å¯ä»¥ç”¨ `magic_enum` è¿™ç§çº¯ç¼–è¯‘æœŸçš„ã€æ— è¿è¡Œæ—¶å¼€é”€çš„æ–¹å¼ã€‚
    

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª **C++11 å¯ç”¨çš„æšä¸¾å­—ç¬¦ä¸²æ˜ å°„å®æ–¹æ¡ˆ**ï¼ˆåŠŸèƒ½ç±»ä¼¼ `magic_enum`ï¼Œä½†è¦æ‰‹åŠ¨ç»´æŠ¤æšä¸¾å€¼å’Œå­—ç¬¦ä¸²ï¼‰ï¼Ÿ

## redis++ç”¨äºå‘å¸ƒè®¢é˜…æ¨¡å‹çš„åŸºæœ¬æ¡†æ¶å¦‚ä¸‹ä»£ç 
```cpp

```
## _è®¢é˜…çš„æ¶ˆæ¯äº§ç”Ÿçš„æ—¶å€™ï¼Œæ¥ä¸‹æ¥å‡½æ•°ä¼šæ€ä¹ˆæ‰§è¡Œï¼Œconsume()ä¼šä»é˜»å¡çŠ¶æ€é€€å‡ºï¼Œç„¶åé‡æ–°å¾ªç¯å—_

è®©æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹ `consume()` çš„æ‰§è¡Œæµç¨‹ï¼š

## consume() çš„å·¥ä½œæœºåˆ¶ï¼š

1. **é˜»å¡ç­‰å¾…**ï¼š`subscriber_->consume()` ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾… Redis æœåŠ¡å™¨æ¨é€æ¶ˆæ¯
    
2. **æ¶ˆæ¯åˆ°è¾¾æ—¶**ï¼š
    
    - `consume()` ä»é˜»å¡çŠ¶æ€**ç«‹å³è¿”å›**
    - **è‡ªåŠ¨è°ƒç”¨**ä¹‹å‰æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼ˆ`on_message` æˆ– `on_pmessage`ï¼‰
    - å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œ`consume()` æ­£å¸¸è¿”å›
3. **é‡æ–°å¾ªç¯**ï¼š`consume()` è¿”å›åï¼Œ`while` å¾ªç¯ç»§ç»­æ‰§è¡Œï¼Œå†æ¬¡è°ƒç”¨ `consume()` è¿›å…¥ä¸‹ä¸€è½®ç­‰å¾…
    

## å…·ä½“æ‰§è¡Œæµç¨‹ï¼š

```cpp
void messageLoop() {
    while (running_.load()) {
        // 1. è°ƒç”¨ consume()ï¼Œè¿›å…¥é˜»å¡ç­‰å¾…çŠ¶æ€
        subscriber_->consume();
        
        // 2. å½“æœ‰æ¶ˆæ¯æ—¶ï¼š
        //    - consume() å†…éƒ¨è°ƒç”¨ on_message å›è°ƒ
        //    - å›è°ƒæ‰§è¡Œå®Œæ¯•ï¼Œconsume() è¿”å›
        //    - åˆ°è¾¾è¿™é‡Œï¼Œå‡†å¤‡ä¸‹ä¸€è½®å¾ªç¯
        
        // 3. å¾ªç¯ç»§ç»­ï¼Œå†æ¬¡è°ƒç”¨ consume()
    }
}
```

## å…³é”®ç‚¹è¯´æ˜ï¼š

**consume() çš„è¡Œä¸ºï¼š**

- **å•æ¬¡æ¶ˆè´¹**ï¼šæ¯æ¬¡ `consume()` åªå¤„ç†ä¸€ä¸ªæ¶ˆæ¯äº‹ä»¶
- **åŒæ­¥å›è°ƒ**ï¼šæ¶ˆæ¯å¤„ç†æ˜¯åŒæ­¥çš„ï¼Œå›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ‰è¿”å›
- **ç«‹å³è¿”å›**ï¼šå¤„ç†å®Œæ¶ˆæ¯åç«‹å³è¿”å›ï¼Œä¸ä¼šç»§ç»­ç­‰å¾…

**ä¸ºä»€ä¹ˆè¦å¾ªç¯è°ƒç”¨ï¼š**

```cpp
// é”™è¯¯çš„åšæ³• - åªèƒ½å¤„ç†ä¸€æ¡æ¶ˆæ¯
subscriber_->consume();  // å¤„ç†ä¸€æ¡æ¶ˆæ¯åå°±ç»“æŸäº†

// æ­£ç¡®çš„åšæ³• - æŒç»­ç›‘å¬
while (running_) {
    subscriber_->consume();  // æ¯æ¬¡å¤„ç†ä¸€æ¡ï¼Œç„¶åé‡æ–°ç­‰å¾…
}
```

## å®é™…æ‰§è¡Œç¤ºä¾‹ï¼š

å‡è®¾ä½ å‘å¸ƒäº†3æ¡æ¶ˆæ¯ï¼š

```cpp
pubsub.publish("test", "æ¶ˆæ¯1");
pubsub.publish("test", "æ¶ˆæ¯2"); 
pubsub.publish("test", "æ¶ˆæ¯3");
```

æ‰§è¡Œæµç¨‹ï¼š

```
1. consume() é˜»å¡ç­‰å¾…...
2. æ”¶åˆ°"æ¶ˆæ¯1" â†’ è°ƒç”¨å›è°ƒ â†’ consume()è¿”å› â†’ å¾ªç¯ç»§ç»­
3. consume() é˜»å¡ç­‰å¾…...
4. æ”¶åˆ°"æ¶ˆæ¯2" â†’ è°ƒç”¨å›è°ƒ â†’ consume()è¿”å› â†’ å¾ªç¯ç»§ç»­  
5. consume() é˜»å¡ç­‰å¾…...
6. æ”¶åˆ°"æ¶ˆæ¯3" â†’ è°ƒç”¨å›è°ƒ â†’ consume()è¿”å› â†’ å¾ªç¯ç»§ç»­
7. consume() é˜»å¡ç­‰å¾…ä¸‹ä¸€æ¡æ¶ˆæ¯...
```

æ‰€ä»¥ä½ çš„ç†è§£å®Œå…¨æ­£ç¡®ï¼š**consume() ä¼šä»é˜»å¡çŠ¶æ€é€€å‡ºï¼Œå¤„ç†æ¶ˆæ¯ï¼Œç„¶åé‡æ–°è¿›å…¥å¾ªç¯ç­‰å¾…ä¸‹ä¸€æ¡æ¶ˆæ¯**ã€‚

## æˆ‘å‘ç°libredis++.so.1ä½äº.usr/local/libä¸‹ï¼Œä½†æ˜¯è¿è¡Œç¨‹åºæ—¶ï¼Œæç¤ºbin/server_d: error while loading shared libraries: libredis++.so.1: cannot open shared object file: No such file or directory
è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºä½ çš„ç¨‹åºåœ¨è¿è¡Œæ—¶æ‰¾ä¸åˆ° `libredis++.so.1` è¿™ä¸ªå…±äº«åº“ã€‚è™½ç„¶å®ƒå·²ç»è¢«å®‰è£…åœ¨ `/usr/local/lib` ä¸‹ï¼Œä½†ç³»ç»Ÿé»˜è®¤å¹¶ä¸ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸‹æŸ¥æ‰¾åŠ¨æ€é“¾æ¥åº“ã€‚

ä½ æœ‰å‡ ä¸ªè§£å†³æ–¹æ¡ˆå¯ä»¥é€‰æ‹©ï¼š

---

### âœ… æ–¹æ³•ä¸€ï¼šå°† `/usr/local/lib` æ·»åŠ åˆ°è¿è¡Œæ—¶åº“æœç´¢è·¯å¾„

1. ç¼–è¾‘åŠ¨æ€é“¾æ¥å™¨çš„é…ç½®æ–‡ä»¶ï¼š
    

```bash
sudo sh -c 'echo "/usr/local/lib" > /etc/ld.so.conf.d/local-lib.conf'
```

2. ä½¿é…ç½®ç”Ÿæ•ˆï¼š
    

```bash
sudo ldconfig
```

3. ç„¶åå†è¿è¡Œä½ çš„ç¨‹åºï¼Œåº”è¯¥å°±èƒ½æ‰¾åˆ°åº“äº†ã€‚
    

---

### âœ… æ–¹æ³•äºŒï¼šä½¿ç”¨ `LD_LIBRARY_PATH` ä¸´æ—¶æŒ‡å®šåº“è·¯å¾„

å¦‚æœä½ ä¸æƒ³ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œå¯ä»¥åœ¨è¿è¡Œç¨‹åºæ—¶ä¸´æ—¶æŒ‡å®šåº“è·¯å¾„ï¼š

```bash
LD_LIBRARY_PATH=/usr/local/lib ./bin/server_d
```

å¦‚æœä½ å¸Œæœ›è¿™ä¸ªè·¯å¾„åœ¨æ¯æ¬¡ shell ä¼šè¯ä¸­éƒ½å¯ç”¨ï¼Œå¯ä»¥å°†å…¶æ·»åŠ åˆ° `~/.bashrc` æˆ– `~/.zshrc` ä¸­ï¼š

```bash
export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
```

ç„¶åæ‰§è¡Œï¼š

```bash
source ~/.bashrc   # æˆ–è€… ~/.zshrc
```

---

### âœ… æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ `rpath` æˆ– `runpath` ç¼–è¯‘æ—¶æŒ‡å®šåº“è·¯å¾„

å¦‚æœä½ æœ‰å¯¹ç¨‹åºçš„æ§åˆ¶æƒï¼ˆæ¯”å¦‚è‡ªå·±ç”¨ `g++` ç¼–è¯‘çš„ï¼‰ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶æŒ‡å®š rpathï¼š

```bash
g++ -Wl,-rpath,/usr/local/lib -o server_d your_code.cpp -lredis++
```

è¿™æ ·ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºä¼šè®°ä½ `/usr/local/lib` æ˜¯å®ƒéœ€è¦æœç´¢å…±äº«åº“çš„è·¯å¾„ä¹‹ä¸€ã€‚

---

### ğŸ” éªŒè¯ï¼š

ä½ å¯ä»¥ç”¨ `ldd` æ¥æŸ¥çœ‹ç¨‹åºæ˜¯å¦æ­£ç¡®é“¾æ¥äº†å…±äº«åº“ï¼š

```bash
ldd ./bin/server_d
```

çœ‹çœ‹ `libredis++.so.1` æ˜¯å¦å·²ç»è¢«è§£æåˆ° `/usr/local/lib/libredis++.so.1`

---

å¦‚æœä»¥ä¸Šæ–¹æ³•ä½ éƒ½å°è¯•äº†ï¼Œä»ç„¶å¤±è´¥ï¼Œå¯ä»¥è´´ä¸€ä¸‹ `ldd ./bin/server_d` çš„è¾“å‡ºï¼Œæˆ‘æ¥å¸®ä½ è¿›ä¸€æ­¥è¯Šæ–­ã€‚

## å¯æ˜¯ä¸ºä»€ä¹ˆç¼–è¯‘é“¾æ¥å¯ä»¥æˆåŠŸå‘¢
ä½ è¿™ä¸ªé—®é¢˜éå¸¸å¥½ï¼Œä¹Ÿå¾ˆå…¸å‹ã€‚**ç¼–è¯‘å’Œè¿è¡Œæ—¶é“¾æ¥çš„æœç´¢è·¯å¾„æ˜¯ä¸¤ä¸ªä¸åŒçš„ä½“ç³»**ã€‚ä¸‹é¢æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆç¼–è¯‘é“¾æ¥å¯ä»¥æˆåŠŸï¼Œä½†è¿è¡Œæ—¶æŠ¥é”™æ‰¾ä¸åˆ° `libredis++.so.1`ã€‚

---

### ğŸ”§ ä¸€ã€ç¼–è¯‘æ—¶é“¾æ¥æˆåŠŸçš„åŸå› 

åœ¨ç¼–è¯‘é“¾æ¥é˜¶æ®µï¼Œé“¾æ¥å™¨ï¼ˆå¦‚ `g++` è°ƒç”¨çš„ `ld`ï¼‰æ‰¾åˆ° `libredis++.so` çš„è·¯å¾„æ˜¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€å®ç°çš„ï¼š

1. ä½ å¯èƒ½é€šè¿‡å‚æ•°æ‰‹åŠ¨æŒ‡å®šäº†åº“è·¯å¾„ï¼Œä¾‹å¦‚ï¼š
    
    ```bash
    g++ main.cpp -L/usr/local/lib -lredis++
    ```
    
    è¿™å‘Šè¯‰é“¾æ¥å™¨ï¼šåœ¨ `/usr/local/lib` æŸ¥æ‰¾ `libredis++.so`
    
2. æˆ–è€…ç³»ç»Ÿé»˜è®¤çš„ç¼–è¯‘å™¨é…ç½®æ–‡ä»¶ä¸­åŒ…å«äº† `/usr/local/lib`ï¼ˆè¿™ä¸å¸¸è§ï¼‰ã€‚
    
3. ä¹Ÿå¯èƒ½ä½ æ‰‹åŠ¨æŠŠ `libredis++.so` é“¾æ¥åˆ° `/usr/lib` ä¸‹ï¼Œæˆ–è€…ä½ çš„å¼€å‘ç¯å¢ƒå·²ç»è®¾ç½®å¥½ã€‚
    

---

### âš ï¸ äºŒã€è¿è¡Œæ—¶ä¸ºä»€ä¹ˆå¤±è´¥

è¿è¡Œæ—¶ç”±åŠ¨æ€é“¾æ¥å™¨ï¼ˆ`ld-linux.so` æˆ– `ld.so`ï¼‰è´Ÿè´£ï¼Œå®ƒé»˜è®¤åªåœ¨ä»¥ä¸‹è·¯å¾„æœç´¢åŠ¨æ€åº“ï¼š

- `/lib`
    
- `/usr/lib`
    
- é€šè¿‡ `ld.so.conf` æˆ– `ld.so.conf.d/*.conf` æŒ‡å®šçš„è·¯å¾„
    
- ç¯å¢ƒå˜é‡ `LD_LIBRARY_PATH`
    
- ELF æ–‡ä»¶ä¸­è®°å½•çš„ `rpath` æˆ– `runpath`
    

**è€Œ `/usr/local/lib` é»˜è®¤ä¸åŒ…å«åœ¨è¿è¡Œæ—¶çš„æœç´¢è·¯å¾„ä¸­ã€‚**  
æ‰€ä»¥å³ä½¿ç¼–è¯‘æ—¶æ‰¾åˆ°äº†åº“ï¼Œè¿è¡Œæ—¶æ‰¾ä¸åˆ°ï¼Œå°±ä¼šæŠ¥é”™ï¼š

```
error while loading shared libraries: libredis++.so.1: cannot open shared object file
```

---

### âœ… æ­£ç¡®è§£å†³æ–¹æ³•æ€»ç»“

|æ–¹æ³•|é€‚ç”¨åœºæ™¯|å‘½ä»¤/æ“ä½œ|
|---|---|---|
|æ·»åŠ  `/usr/local/lib` åˆ°ç³»ç»Ÿé…ç½®|ç³»ç»Ÿçº§è§£å†³ï¼Œæ°¸ä¹…ç”Ÿæ•ˆ|`echo "/usr/local/lib"|
|ä¸´æ—¶è¿è¡Œåº“è·¯å¾„|è°ƒè¯•é˜¶æ®µæˆ–ä¸æƒ³æ”¹ç³»ç»Ÿé…ç½®|`LD_LIBRARY_PATH=/usr/local/lib ./bin/server_d`|
|ç¼–è¯‘æ—¶å†™å…¥ rpath|ç¨‹åºçº§è§£å†³ï¼Œæ‹·è´åˆ°å…¶ä»–ç³»ç»Ÿä¹Ÿå¯ç”¨|`g++ -Wl,-rpath,/usr/local/lib`|
|æ‹·è´åº“åˆ°æ ‡å‡†è·¯å¾„|ä¸´æ—¶ workaroundï¼ˆä¸æ¨èï¼‰|`sudo cp /usr/local/lib/libredis++.so.1 /usr/lib/`|

---

å¦‚æœ‰å…¶ä»–åº“çš„ç±»ä¼¼é—®é¢˜ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨è¿™äº›åŠæ³•å¤„ç†ã€‚å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘è¿˜å¯ä»¥å¸®ä½ æŠŠ `CMakeLists.txt` æˆ– Makefile æ”¹æˆå¸¦ `rpath` çš„æ–¹å¼ã€‚
![[Pasted image 20250625002527.png]]
![[Pasted image 20250625003112.png]]
## proto3å’Œproto2æœ‰å“ªäº›ä¸»è¦æ”¹å˜

`proto3` æ˜¯ Google åœ¨ `proto2` åŸºç¡€ä¸Šæ¨å‡ºçš„æ–°ç‰ˆåè®®å®šä¹‰è¯­è¨€ï¼ˆProtobuf v3ï¼‰ï¼Œå®ƒåšäº†ä¸å°‘ç®€åŒ–å’Œç°ä»£åŒ–è®¾è®¡ã€‚ä¸‹é¢æ˜¯äºŒè€…çš„æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”ï¼š

---

## âœ… ä¸»è¦åŒºåˆ«ä¸€è§ˆè¡¨

| ç‰¹æ€§ / å·®å¼‚ç‚¹                            | `proto2`ï¼ˆæ—§ç‰ˆï¼‰                       | `proto3`ï¼ˆæ–°ç‰ˆï¼‰                                  |
| ----------------------------------- | ---------------------------------- | --------------------------------------------- |
| **å­—æ®µä¿®é¥°ç¬¦**                           | `required`, `optional`, `repeated` | åªæ”¯æŒ `optional`, `repeated`ï¼Œæ—  `required`       |
| **é»˜è®¤å€¼è¡Œä¸º**                           | å¯ä»¥åˆ¤æ–­æ˜¯å¦è®¾ç½®è¿‡                          | æ‰€æœ‰å­—æ®µéƒ½æœ‰é»˜è®¤å€¼ï¼Œ**æ— æ³•åˆ¤æ–­æ˜¯å¦è®¾ç½®è¿‡**                       |
| **æ”¯æŒ `has_xxx()`**                  | âœ… æ”¯æŒ                               | ğŸš« é»˜è®¤ä¸æ”¯æŒï¼ˆé™¤éæ˜¾å¼ `optional`ï¼‰                     |
| **é»˜è®¤å€¼æ˜¾å¼åŒºåˆ†**                         | å¯ä»¥åˆ¤æ–­ä¸æœªè®¾ç½®å­—æ®µåŒºåˆ«                       | ä¸å¯åŒºåˆ†ï¼Œ0/""/false å’Œæœªè®¾ç½®æ˜¯ä¸€æ ·çš„                      |
| **æšä¸¾é»˜è®¤å€¼**                           | å¯ä»¥æ— é»˜è®¤å€¼                             | ç¬¬ä¸€ä¸ªæšä¸¾å€¼å¿…é¡»ä¸º 0ï¼ˆå¼ºåˆ¶ï¼‰                               |
| **JSON æ”¯æŒ**                         | âŒ æ— åŸç”Ÿæ”¯æŒ                            | âœ… åŸç”Ÿæ”¯æŒ JSON æ˜ å°„                                |
| **åå°„å­—æ®µæè¿°ä¿¡æ¯**                        | ä¿ç•™                                 | é»˜è®¤å‰¥ç¦»ï¼Œä¸ºèŠ‚çœç©ºé—´                                    |
| **æ‰©å±•ç±»å‹æ‰©å±•å­—æ®µï¼ˆextensionsï¼‰**            | âœ… æ”¯æŒ                               | ğŸš« ç§»é™¤                                         |
| **å®šåˆ¶ options / options extensions** | âœ… æ”¯æŒ                               | ğŸš« ç§»é™¤                                         |
| **å­—ç¬¦ä¸²é»˜è®¤å€¼**                          | å¯è®¾ç½®ä»»æ„å­—ç¬¦ä¸²                           | ä¸æ”¯æŒé»˜è®¤å€¼ï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²                                |
| **å¯é€‰å­—æ®µ**                            | `optional` å¯æ˜¾å¼åˆ¤æ–­                   | é»˜è®¤å­—æ®µä¸æ”¯æŒåˆ¤æ–­æ˜¯å¦è®¾ç½®ï¼Œ**ä½† proto3.15+ æ¢å¤äº† `optional`** |
| **è¯­æ³•å…³é”®å­—**                           | `syntax = "proto2"`                | `syntax = "proto3"`                           |

---

## ğŸ” è¯¦ç»†è§£é‡Šé‡ç‚¹å˜åŒ–

### 1. âœ… ç§»é™¤äº† `required`

- `proto3` ä¸å…è®¸ `required` å­—æ®µã€‚
    
- ç†ç”±æ˜¯ `required` ä¼šå¯¼è‡´å‘å‰å…¼å®¹æ€§å˜å·®ï¼Œä¸€æ—¦å­—æ®µç¼ºå¤±ï¼Œè§£æå¤±è´¥ã€‚
    

âœ… **å¥½å¤„**ï¼šæ›´å¥å£®ã€æ›´æ˜“å‡çº§  
âš ï¸ **å‰¯ä½œç”¨**ï¼šå¼€å‘è€…éœ€è‡ªå·±ä¿è¯å­—æ®µå®Œæ•´æ€§

---

### 2. âŒ æ— æ³•åˆ¤æ–­å­—æ®µæ˜¯å¦è¢«è®¾ç½®ï¼ˆproto3 é»˜è®¤ï¼‰

```proto
message Foo {
  int32 id = 1;
}
```

åœ¨ `proto3` ä¸­ï¼š

```cpp
Foo foo;
foo.id();         // == 0ï¼Œå³ä½¿ä»æœª set è¿‡
foo.has_id();     // âŒ ç¼–è¯‘é”™è¯¯ï¼šæ²¡æœ‰è¿™ä¸ªå‡½æ•°
```

**è§£å†³æ–¹æ³•ï¼š**

- proto3.15+ æ”¯æŒï¼š`optional int32 id = 1;`ï¼Œå³å¯ä½¿ç”¨ `has_id()`ã€‚
    

---

### 3. âŒ ç§»é™¤äº† extensions

```proto
// proto2
extend Foo {
  optional int32 extra_field = 100;
}
```

`proto3` å®Œå…¨åºŸå¼ƒæ‰©å±•æœºåˆ¶ï¼ˆé¼“åŠ±ä½¿ç”¨ `Any`ã€`oneof`ï¼‰ã€‚

---

### 4. âœ… JSON æ”¯æŒ

`proto3` æä¾›äº†æ ‡å‡†çš„ Protobuf â‡„ JSON æ˜ å°„è§„åˆ™ï¼š

```json
{
  "name": "Alice",
  "id": 123
}
```

ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ protobuf åº“å‡½æ•°è¿›è¡Œ JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚

---

### 5. âœ… ç®€åŒ–ç±»å‹ç³»ç»Ÿ

- é»˜è®¤æ‰€æœ‰å­—æ®µéƒ½æœ‰é»˜è®¤å€¼
    
    - `int32` æ˜¯ 0
        
    - `bool` æ˜¯ false
        
    - `string` æ˜¯ `""`
        
- ä¸æ”¯æŒè‡ªå®šä¹‰é»˜è®¤å€¼ï¼Œå¦‚ï¼š
    
    ```proto
    string name = 1 [default = "Tom"]; // âŒ proto3 ä¸å…è®¸
    ```
    

---

### 6. âœ… æ”¯æŒ `oneof` æ›¿ä»£ `optional`

```proto
message Sample {
  oneof value {
    int32 id = 1;
    string name = 2;
  }
}
```

å¯ç”¨äºè¡¨è¾¾â€œäº’æ–¥å­—æ®µâ€å¹¶ä¸”åˆ¤æ–­å½“å‰å“ªä¸ªå­—æ®µè¢«è®¾ç½®ã€‚

---

## âœ… ä½•æ—¶ç”¨ proto2 vs proto3ï¼Ÿ

|åœºæ™¯|å»ºè®®ç”¨å“ªä¸ªç‰ˆæœ¬|ç†ç”±|
|---|---|---|
|å…¼å®¹æ—§é¡¹ç›®ã€å·²æœ‰ proto2 æ¥å£|âœ… proto2|ä¸éœ€è¦è¿ç§»|
|æ„å»ºæ–°æœåŠ¡ã€ä½¿ç”¨ gRPC|âœ… proto3|æ›´ç®€æ´ã€ç°ä»£ã€æ”¯æŒ JSONã€gRPC å¿…éœ€|
|éœ€è¦å­—æ®µåˆ¤æ–­ set/æœªè®¾ç½®|proto2 æˆ– proto3 + optional|proto3 >= 3.15 åä¹Ÿæ”¯æŒ `optional` äº†|

---

## ğŸ§ª ç‰ˆæœ¬æç¤º

- **proto3.0 ~ 3.14**ï¼šä¸æ”¯æŒ `optional` æ£€æŸ¥å­—æ®µæ˜¯å¦è®¾ç½®
    
- **proto3.15+**ï¼šå¼•å…¥ `optional`ï¼Œå¯æ¢å¤éƒ¨åˆ† `proto2` è¡Œä¸º
    

---

## âœ… æ€»ç»“ä¸€å¥è¯

> **`proto3` æ˜¯ `proto2` çš„ç®€æ´ç‰ˆï¼Œæ›´æ˜“ç”¨æ›´å…¼å®¹ç°ä»£ç³»ç»Ÿï¼Œä½†ç‰ºç‰²äº†éƒ¨åˆ†ç²¾ç»†æ§åˆ¶èƒ½åŠ›ï¼ˆå¦‚å­—æ®µåˆ¤æ–­ã€æ‰©å±•ï¼‰ã€‚**

æ˜¯å¦éœ€è¦æˆ‘å†™ä¸€ä¸ªå¯¹æ¯” `.proto` æ–‡ä»¶ä¾‹å­æˆ– C++ ä½¿ç”¨å·®å¼‚çš„ demoï¼Ÿ
## æœ‰å¤šä¸ªprotobufåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²è¢«æ¥æ”¶åˆ°ï¼Œå¦‚ä½•åˆ¤æ–­å“ªä¸ªå­—ç¬¦ä¸²è¯¥è¢«ååºåˆ—åŒ–ä¸ºå“ªä¸ªç±»å‹å‘¢

è¿™æ˜¯ä½¿ç”¨ Protocol Buffersï¼ˆProtobufï¼‰æ—¶çš„å¸¸è§é—®é¢˜ä¹‹ä¸€ï¼š

> **å½“ä½ æ”¶åˆ°å¤šä¸ªåºåˆ—åŒ–åçš„ Protobuf æ¶ˆæ¯ï¼ˆé€šå¸¸æ˜¯äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼‰æ—¶ï¼Œä½ å¦‚ä½•çŸ¥é“è¯¥ç”¨å“ªä¸ª `message` ç±»å‹å»ååºåˆ—åŒ–å®ƒï¼Ÿ**

ç­”æ¡ˆæ˜¯ï¼š**Protobuf æœ¬èº«çš„åºåˆ—åŒ–æ ¼å¼ä¸­**ï¼Œ**æ²¡æœ‰åŒ…å«ç±»å‹ä¿¡æ¯**ï¼Œæ‰€ä»¥ä½ éœ€è¦ **è‡ªè¡Œåœ¨åº”ç”¨å±‚æ·»åŠ æ¶ˆæ¯ç±»å‹çš„æ ‡è¯†ä¿¡æ¯**ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆä¸€ï¼šå°è£…ä¸€å±‚ç»Ÿä¸€æ¶ˆæ¯ç»“æ„ï¼ˆæ¨èï¼‰

å®šä¹‰ä¸€ä¸ªé¡¶å±‚æ¶ˆæ¯ä½œä¸ºâ€œåŒ…è£¹â€ï¼Œå†…éƒ¨ç”¨ `oneof` åŒºåˆ†ç±»å‹ï¼š

```proto
syntax = "proto3";

message Wrapper {
  oneof payload {
    LoginRequest login = 1;
    ChatMessage chat = 2;
    Heartbeat ping = 3;
  }
}

message LoginRequest {
  string username = 1;
}

message ChatMessage {
  string text = 1;
}

message Heartbeat {
  int64 timestamp = 1;
}
```

ä½¿ç”¨æ—¶ï¼š

### åºåˆ—åŒ–ç«¯ï¼š

```cpp
Wrapper wrapper;
wrapper.mutable_chat()->set_text("hello");
wrapper.SerializeToString(&out);
```

### ååºåˆ—åŒ–ç«¯ï¼š

```cpp
Wrapper wrapper;
if (wrapper.ParseFromString(in)) {
    if (wrapper.has_chat()) {
        auto msg = wrapper.chat();
        // å¤„ç† chat æ¶ˆæ¯
    }
    else if (wrapper.has_login()) {
        // å¤„ç† login æ¶ˆæ¯
    }
}
```

âœ… å¥½å¤„ï¼š

- ç±»å‹ä¿¡æ¯å’Œå†…å®¹ä¸€èµ·ä¼ é€’ï¼Œç»Ÿä¸€è§£æé€»è¾‘ï¼›
    
- ä¸å®¹æ˜“å‡ºé”™ã€‚
    

---

## âœ… è§£å†³æ–¹æ¡ˆäºŒï¼šè‡ªå®šä¹‰â€œå¤´éƒ¨åè®®â€å¸¦ç±»å‹ç¼–å·ï¼ˆä¼ ç»Ÿåšæ³•ï¼‰

ä½ å¯ä»¥åœ¨ç½‘ç»œä¼ è¾“ä¸­æ‰‹åŠ¨åŠ ä¸Š**ç±»å‹å­—æ®µ**ï¼Œæ¯”å¦‚ï¼š

```
[4å­—èŠ‚ç±»å‹ID][4å­—èŠ‚é•¿åº¦][protobufäºŒè¿›åˆ¶å†…å®¹...]
```

ä¾‹å¦‚ï¼š

- ç±»å‹IDï¼š1 = Login, 2 = Chat, 3 = Ping
    
- æ”¶åˆ°åå…ˆè¯»å‰4ä¸ªå­—èŠ‚åˆ¤æ–­ç±»å‹ï¼Œå†æ ¹æ®ç±»å‹é€‰æ‹©å¯¹åº”çš„ Protobuf ç±»å‹å»è§£æï¼š
    

```cpp
uint32_t type;
uint32_t len;
std::string payload;

read(fd, &type, 4);  // æ¶ˆæ¯ç±»å‹
read(fd, &len, 4);   // å†…å®¹é•¿åº¦
payload.resize(len);
read(fd, payload.data(), len);

switch (type) {
  case 1: {
    LoginRequest login;
    login.ParseFromString(payload);
    break;
  }
  case 2: {
    ChatMessage chat;
    chat.ParseFromString(payload);
    break;
  }
}
```

âœ… è¿™ç§æ–¹å¼çµæ´»ï¼Œé€‚åˆè‡ªå®šä¹‰åè®®æ ˆï¼›  
âš ï¸ ä½†ä½ è¦è‡ªå·±ä¿è¯å¯¹é½ã€é•¿åº¦è§£æç­‰ç»†èŠ‚æ²¡é”™ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ `Any` ç±»å‹ï¼ˆProtobuf å†…ç½®æ–¹æ¡ˆï¼‰

```proto
import "google/protobuf/any.proto";

message Envelope {
  google.protobuf.Any content = 1;
}
```

å°è£…ï¼š

```cpp
Envelope env;
google::protobuf::Any* any = env.mutable_content();
ChatMessage chat;
chat.set_text("hi");
any->PackFrom(chat);
```

è§£æï¼š

```cpp
Envelope env;
env.ParseFromString(buf);

if (env.content().Is<ChatMessage>()) {
  ChatMessage msg;
  env.content().UnpackTo(&msg);
}
```

âœ… è‡ªåŠ¨å¸¦æœ‰ç±»å‹ä¿¡æ¯  
âš ï¸ ä½†è¦åŒ…å« `.proto` æ–‡ä»¶çš„åŒ…åä¿¡æ¯ï¼Œå¯èƒ½å¢åŠ ä½“ç§¯ï¼Œé€‚ç”¨äºä¸åœ¨æ„æ€§èƒ½æˆ–ä½“ç§¯çš„ç³»ç»Ÿï¼ˆå¦‚ç®¡ç†ç³»ç»Ÿã€é…ç½®ç³»ç»Ÿï¼‰

---

## âœ… æ€»ç»“ï¼šä¸‰ç§æ–¹æ¡ˆé€‚ç”¨åœºæ™¯

|æ–¹æ³•|ä¼˜ç‚¹|ç¼ºç‚¹|é€‚åˆåœºæ™¯|
|---|---|---|---|
|`oneof` å°è£…æ³•|ç±»å‹å®‰å…¨ã€ç”Ÿæˆä»£ç æ”¯æŒå¼º|æ¯æ¬¡éƒ½è¦åµŒå¥—åœ¨ Wrapper ä¸­|æ¨èç”¨äº RPCã€æ¶ˆæ¯ç³»ç»Ÿ|
|è‡ªå®šä¹‰å¤´éƒ¨|çµæ´»ã€ä¸ Protobuf è§£è€¦|è¦æ‰‹åŠ¨è§£æå’Œç®¡ç†é•¿åº¦ä¸ç±»å‹|è‡ªå®šä¹‰é€šä¿¡åè®®ã€åº•å±‚æ¡†æ¶|
|ä½¿ç”¨ `Any`|ç±»å‹ä¿¡æ¯è‡ªåŠ¨åµŒå…¥|å¢åŠ ä½“ç§¯ã€ä¾èµ–åŒ…åå…¨é™å®šç¬¦|é…ç½®ç³»ç»Ÿã€é€šç”¨æ¶ˆæ¯æ€»çº¿ç­‰|

---

æ˜¯å¦å¸Œæœ›æˆ‘æä¾›ä¸€ä¸ªä½¿ç”¨ `oneof` + C++ å®¢æˆ·ç«¯å®Œæ•´ç¤ºä¾‹ï¼Ÿå¯ä»¥å¿«é€Ÿæµ‹è¯•å°è£…ä¸è§£åŒ…é€»è¾‘ã€‚
## è§£é‡Šä¸€ä¸‹æ–¹æ¡ˆä¸€ä¸­ï¼Œä¸ºä»€ä¹ˆåºåˆ—åŒ–ç«¯å’Œååºåˆ—ç«¯éƒ½æ²¡æœ‰payloadå­—æ®µå‡ºç°å‘¢
```cpp
message Wrapper {
  oneof payload {
    LoginRequest login = 1;
    ChatMessage chat = 2;
    Heartbeat ping = 3;
  }
}
```

ä½ é—®å¾—éå¸¸ä¸“ä¸šï¼Œè¯´æ˜ä½ å¯¹ Protobuf çš„ç»“æ„å·²ç»æœ‰ä¸€å®šç†è§£äº†ã€‚æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸ªç»“æ„ï¼š

---

## ğŸ” `oneof payload { ... }` çš„è¡Œä¸ºæœ¬è´¨

è¿™è¡Œä»£ç å®šä¹‰äº†ä¸€ä¸ª **åä¸º `payload` çš„ `oneof` å­—æ®µ**ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª **äº’æ–¥å­—æ®µé›†åˆ**ï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯ä¸­åŒä¸€æ—¶åˆ»åªèƒ½è®¾ç½®å…¶ä¸­ä¸€ä¸ªå­—æ®µã€‚

```proto
message Wrapper {
  oneof payload {
    LoginRequest login = 1;
    ChatMessage chat = 2;
    Heartbeat ping = 3;
  }
}
```

---

## âœ… ä¸ºä»€ä¹ˆä½¿ç”¨æ—¶ä½ çœ‹ä¸åˆ° `.payload`ï¼Ÿ

### â—åŸå› ï¼šProtobuf çš„ `oneof` å­—æ®µä¸éœ€è¦é€šè¿‡ `.payload` æ¥è®¿é—®

**Protobuf ä¼šè‡ªåŠ¨å°† `oneof` ä¸­çš„å­—æ®µæå‡ä¸º `Wrapper` çš„ç›´æ¥æˆå‘˜è®¿é—®æ–¹å¼ã€‚**

### ğŸ‘‡ è¿™æ„å‘³ç€ï¼š

```cpp
Wrapper wrapper;
wrapper.mutable_chat()->set_text("hello");
```

ç­‰ä»·äºï¼š

```cpp
// æƒ³è±¡ä¸­ä¸æ˜¯è¿™æ ·ï¼š
wrapper.mutable_payload().mutable_chat()->set_text("hello");  // âŒ ä¸éœ€è¦
```

ä½ ä¹Ÿä¸ä¼šè¿™æ ·è¯»å–ï¼š

```cpp
auto msg = wrapper.payload().chat(); // âŒ æ²¡æœ‰ payload() æ–¹æ³•
```

---

## ğŸ” Protobuf å¦‚ä½•çŸ¥é“å“ªä¸ªå­—æ®µè¢«è®¾ç½®äº†ï¼Ÿ

Protobuf å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œè®°å½•å½“å‰ `oneof` ä¸­å“ªä¸€ä¸ªå­—æ®µå¤„äºæ¿€æ´»çŠ¶æ€ã€‚

ä½ å¯ä»¥é€šè¿‡ `has_xxx()` æ¥åˆ¤æ–­ï¼š

```cpp
if (wrapper.has_chat()) {
  auto msg = wrapper.chat();  // è·å–æ¶ˆæ¯
}
```

è¿˜å¯ä»¥ï¼š

```cpp
switch (wrapper.payload_case()) {
  case Wrapper::kLogin:
    // wrapper.login()
    break;
  case Wrapper::kChat:
    // wrapper.chat()
    break;
  case Wrapper::PAYLOAD_NOT_SET:
    break;
}
```

---

## âœ… ç¤ºä¾‹æ€»ç»“

å®šä¹‰ï¼š

```proto
message Wrapper {
  oneof payload {
    LoginRequest login = 1;
    ChatMessage chat = 2;
  }
}
```

ä½¿ç”¨æ–¹å¼æ˜¯ï¼š

```cpp
Wrapper w;
w.mutable_login()->set_username("Tom");  // âœ… ç›´æ¥è®¿é—® login æˆå‘˜
```

è€Œä¸æ˜¯ï¼š

```cpp
w.mutable_payload()->mutable_login();    // âŒ é”™è¯¯ï¼Œä¸å­˜åœ¨ payload() æ–¹æ³•
```

---

## ğŸ§  æ€»ç»“ä¸€ä¸‹

|ä½ çœ‹åˆ°çš„å­—æ®µå|Protobuf ç¼–è¯‘å™¨è¡Œä¸º|
|---|---|
|`oneof payload {...}`|åˆ›å»ºä¸€ä¸ªäº’æ–¥å­—æ®µé›†åˆ|
|`login/chat/ping`|æˆä¸º `Wrapper` çš„ç›´æ¥æˆå‘˜|
|`payload` è¿™ä¸ªåå­—|åªåœ¨ç”Ÿæˆçš„ `payload_case()` ä¸­ä½“ç°|
|`.payload()` æ–¹æ³•|âŒ ä¸å­˜åœ¨|

---

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ æ‰“å°ä¸€ä¸‹è¿™ä¸ª `Wrapper` çš„ `.proto` ç¼–è¯‘åç”Ÿæˆçš„ `.pb.h` çš„éƒ¨åˆ†ç»“æ„ï¼Ÿä½ å¯ä»¥çœ‹åˆ°æ˜¯å¦‚ä½•å±•å¼€çš„ã€‚
## æœ‰å…³constexpr
![[Pasted image 20250625025222.png]]
![[Pasted image 20250625025255.png]]
![[Pasted image 20250625030933.png]]
![[Pasted image 20250625030941.png]]
![[Pasted image 20250625030950.png]]![[Pasted image 20250625030956.png]]![[Pasted image 20250625031003.png]]